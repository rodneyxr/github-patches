[
  {
    "name": "Race condition on isDetecting",
    "url": "https://github.com/phrack/ShootOFF/issues/270",
    "description": "Should make isDetecting and isStreaming volatile\n\ncom/shootoff/camera/CameraManager.isDetecting@688029\n\nGtkNativeMainLoopThread (15)    Thread-12 (30)\ncom/sun/glass/ui/gtk/GtkApplication.lambda$null$50\ncom/shootoff/camera/CameraManager$Detector.run\ncom/sun/glass/ui/Window.notifyClose\ncom/shootoff/camera/CameraManager$Detector.streamCameraFrames\ncom/sun/glass/ui/Window.handleWindowEvent\ncom/shootoff/camera/CameraManager$Detector.processFrame\ncom/sun/javafx/tk/quantum/GlassWindowEventHandler.handleWindowEvent\ncom/shootoff/camera/shotdetection/ShotDetectionManager.processFrame\ncom/sun/javafx/tk/quantum/QuantumToolkit.runWithoutRenderLock\ncom/shootoff/camera/shotdetection/ShotDetectionManager.applyFilter\ncom/sun/javafx/tk/quantum/GlassWindowEventHandler.lambda$handleWindowEvent$424\ncom/shootoff/camera/shotdetection/ShotDetectionManager.deepCopy\ncom/sun/javafx/tk/quantum/GlassWindowEventHandler.run\ncom/shootoff/camera/CameraManager.isDetecting\nREAD\n\ncom/sun/javafx/tk/quantum/GlassWindowEventHandler.run\ncom/sun/javafx/stage/WindowPeerListener.closing\njavafx/event/Event.fireEvent\ncom/sun/javafx/event/EventUtil.fireEvent\ncom/sun/javafx/event/EventUtil.fireEventImpl\ncom/sun/javafx/event/EventDispatchChainImpl.dispatchEvent\ncom/sun/javafx/event/BasicEventDispatcher.dispatchEvent\ncom/sun/javafx/event/CompositeEventDispatcher.dispatchBubblingEvent\ncom/sun/javafx/event/EventHandlerManager.dispatchBubblingEvent\ncom/sun/javafx/event/EventHandlerManager.dispatchBubblingEvent\ncom/sun/javafx/event/CompositeEventHandler.dispatchBubblingEvent\ncom/shootoff/gui/controller/ShootOFFController.lambda$0\ncom/shootoff/camera/CameraManager.setDetecting\nWRITE\n",
    "keywords": [
      "com/shootoff/camera/shotdetection/shotdetectionmanager",
      "com/shootoff/camera/cameramanager",
      "isdetecting",
      "com/sun/javafx/tk/quantum/glasswindoweventhandler",
      "com/shootoff/camera/cameramanager$detector",
      "run",
      "dispatchbubblingevent"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/phrack/ShootOFF/commit/bf47dba5a4f0abb61e0b18fe2fc92b416c0261a3",
      "files": [
        {
          "file_name": "build.gradle",
          "patch": "@@ -28,7 +28,6 @@ def keyStore \u003d \u0027shootoff_cs.jks\u0027\n def keyAlias \u003d \u0027cscert\u0027\n def tsaURL \u003d \u0027http://timestamp.comodoca.com/rfc3161\u0027\n \n-\n repositories {\n     mavenCentral()\n     // Next 2 are used for tts\n@@ -89,7 +88,7 @@ dependencies {\n     }\n     \n     //OpenCV\n-\tcompile \u0027org.openpnp:opencv:2.4.11-1\u0027\n+    compile \u0027org.openpnp:opencv:2.4.11-1\u0027\n \n     testCompile group: \u0027junit\u0027, name: \u0027junit\u0027, version: \u00274.+\u0027\n     testCompile group: \u0027org.hamcrest\u0027, name: \u0027hamcrest-core\u0027, version: \u00271.+\u0027"
        },
        {
          "file_name": "src/main/java/com/shootoff/camera/CameraManager.java",
          "patch": "@@ -83,8 +83,8 @@\n \tprivate final Configuration config;\n \tprivate Optional\u003cBounds\u003e projectionBounds \u003d Optional.empty();\n \n-\tprivate boolean isStreaming \u003d true;\n-\tprivate boolean isDetecting \u003d true;\n+\tprivate volatile boolean isStreaming \u003d true;\n+\tprivate volatile boolean isDetecting \u003d true;\n \tprivate boolean shownBrightnessWarning \u003d false;\n \tprivate boolean cropFeedToProjection \u003d false;\n \tprivate boolean limitDetectProjection \u003d false;"
        }
      ]
    }
  },
  {
    "name": "Race condition on reset button",
    "url": "https://github.com/phrack/ShootOFF/issues/104",
    "description": "If shots are detected while the reset is happening it\u0027s possible for the shot markers to become permanent on the stream for the session.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/phrack/ShootOFF/commit/d141b0eb6460b3e06d8e849c1ee829b049795fa4",
      "files": [
        {
          "file_name": "src/main/java/com/shootoff/gui/CanvasManager.java",
          "patch": "@@ -20,6 +20,7 @@\n \n import java.io.File;\n import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.Iterator;\n import java.util.List;\n import java.util.Map;\n@@ -60,7 +61,7 @@\n \tprivate final CamerasSupervisor camerasSupervisor;\n \tprivate final ObservableList\u003cShotEntry\u003e shotEntries;\n \tprivate final ImageView background \u003d new ImageView();\n-\tprivate final List\u003cShot\u003e shots \u003d new ArrayList\u003cShot\u003e();\n+\tprivate final List\u003cShot\u003e shots;\n \tprivate final List\u003cGroup\u003e targets \u003d new ArrayList\u003cGroup\u003e();\n \t\n \tprivate ProgressIndicator progress;\n@@ -78,6 +79,7 @@ public CanvasManager(Group canvasGroup, Configuration config, CamerasSupervisor\n \t\tthis.config \u003d config;\n \t\tthis.camerasSupervisor \u003d camerasSupervisor;\n \t\tthis.shotEntries \u003d shotEntries;\n+\t\tshots \u003d Collections.synchronizedList(new ArrayList\u003cShot\u003e());\n \t\n \t\tthis.background.setOnMouseClicked((event) -\u003e {\n \t\t\t\ttoggleTargetSelection(Optional.empty());"
        }
      ]
    }
  },
  {
    "name": "Race condition in roster synchronization point",
    "url": "https://github.com/kontalk/androidclient/issues/301",
    "description": "This leads to ANR: http://pastebin.com/bRu63RJz\nBecause the roster is loaded after authentication.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/kontalk/androidclient/commit/417d43f83d71847e814ab58b5de4e1dcd71e7f6e",
      "files": [
        {
          "file_name": "app/build.gradle",
          "patch": "@@ -84,10 +84,10 @@ dependencies {\n     compile \u0027com.jcraft:jzlib:1.1.3\u0027\n     compile \u0027com.nineoldandroids:library:2.4.0\u0027\n     compile \u0027com.jcraft:jzlib:1.1.3\u0027\n-    compile \u0027org.igniterealtime.smack:smack-android:4.1.0-rc1\u0027\n-    compile \u0027org.igniterealtime.smack:smack-core:4.1.0-rc1\u0027\n-    compile \u0027org.igniterealtime.smack:smack-tcp:4.1.0-rc1\u0027\n-    compile \u0027org.igniterealtime.smack:smack-extensions:4.1.0-rc1\u0027\n+    compile \u0027org.igniterealtime.smack:smack-android:4.1.0-rc2-SNAPSHOT\u0027\n+    compile \u0027org.igniterealtime.smack:smack-core:4.1.0-rc2-SNAPSHOT\u0027\n+    compile \u0027org.igniterealtime.smack:smack-tcp:4.1.0-rc2-SNAPSHOT\u0027\n+    compile \u0027org.igniterealtime.smack:smack-extensions:4.1.0-rc2-SNAPSHOT\u0027\n \n     googleplayCompile \u0027com.google.android.gms:play-services-base:6.5.87\u0027\n }"
        },
        {
          "file_name": "app/src/main/java/org/kontalk/service/msgcenter/MessageCenterService.java",
          "patch": "@@ -43,6 +43,7 @@\n import org.jivesoftware.smack.provider.ProviderManager;\n import org.jivesoftware.smack.roster.Roster;\n import org.jivesoftware.smack.roster.RosterEntry;\n+import org.jivesoftware.smack.roster.RosterLoadedListener;\n import org.jivesoftware.smack.roster.packet.RosterPacket;\n import org.jivesoftware.smack.util.StringUtils;\n import org.jivesoftware.smackx.caps.packet.CapsExtension;\n@@ -165,6 +166,13 @@\n     public static final String ACTION_CONNECTED \u003d \"org.kontalk.action.CONNECTED\";\n \n     /**\n+     * Broadcasted when the roster has been loaded.\n+     * Send this intent to receive the same as a broadcast if the roster has\n+     * already been loaded.\n+     */\n+    public static final String ACTION_ROSTER_LOADED \u003d \"org.kontalk.action.ROSTER_LOADED\";\n+\n+    /**\n      * Broadcasted when a presence stanza is received.\n      * Send this intent to broadcast presence.\n      * Send this intent with type\u003d\"probe\" to request a presence in the roster.\n@@ -655,7 +663,7 @@ else if (ACTION_REGENERATE_KEYPAIR.equals(action)) {\n \n             else if (ACTION_IMPORT_KEYPAIR.equals(action)) {\n                 // zip file with keys\n-                Uri file \u003d (Uri) intent.getParcelableExtra(EXTRA_KEYPACK);\n+                Uri file \u003d intent.getParcelableExtra(EXTRA_KEYPACK);\n                 // passphrase to decrypt files\n                 String passphrase \u003d intent.getStringExtra(EXTRA_PASSPHRASE);\n                 beginKeyPairImport(file, passphrase);\n@@ -701,6 +709,14 @@ else if (ACTION_ROSTER.equals(action) || ACTION_ROSTER_MATCH.equals(action)) {\n                 }\n             }\n \n+            else if (ACTION_ROSTER_LOADED.equals(action)) {\n+                if (isConnected) {\n+                    if (getRoster().isLoaded()) {\n+                        broadcast(ACTION_ROSTER_LOADED);\n+                    }\n+                }\n+            }\n+\n             else if (ACTION_PRESENCE.equals(action)) {\n                 if (canConnect \u0026\u0026 isConnected) {\n                     final String id \u003d intent.getStringExtra(EXTRA_PACKET_ID);\n@@ -709,7 +725,7 @@ else if (ACTION_PRESENCE.equals(action)) {\n \n                     if (\"probe\".equals(type)) {\n                         // probing is actually looking into the roster\n-                        Roster roster \u003d Roster.getInstanceFor(mConnection);\n+                        Roster roster \u003d getRoster();\n \n                         if (to \u003d\u003d null) {\n                             for (RosterEntry entry : roster.getEntries()) {\n@@ -770,7 +786,7 @@ else if (ACTION_PUBLICKEY.equals(action)) {\n                     }\n                     else {\n                         // request public keys for the whole roster\n-                        Collection\u003cRosterEntry\u003e buddies \u003d Roster.getInstanceFor(mConnection).getEntries();\n+                        Collection\u003cRosterEntry\u003e buddies \u003d getRoster().getEntries();\n                         for (RosterEntry buddy : buddies) {\n                             if (isRosterEntrySubscribed(buddy)) {\n                                 PublicKeyPublish p \u003d new PublicKeyPublish();\n@@ -1026,13 +1042,18 @@ private void discovery() {\n         info.setTo(mServer.getNetwork());\n \n         PacketFilter filter \u003d new PacketIDFilter(info.getStanzaId());\n-        mConnection.addPacketListener(new DiscoverInfoListener(this), filter);\n+        mConnection.addAsyncPacketListener(new DiscoverInfoListener(this), filter);\n         sendPacket(info);\n     }\n \n     /** Requests the roster. */\n     private void roster() {\n-        Roster.getInstanceFor(mConnection);\n+        getRoster().addRosterLoadedListener(new RosterLoadedListener() {\n+            @Override\n+            public void onRosterLoaded(Roster roster) {\n+                broadcast(ACTION_ROSTER_LOADED);\n+            }\n+        });\n     }\n \n     /** Sends our initial presence. */\n@@ -1225,6 +1246,10 @@ private void sendPendingSubscriptionReplies() {\n         c.close();\n     }\n \n+    private Roster getRoster() {\n+        return (mConnection !\u003d null) ? Roster.getInstanceFor(mConnection) : null;\n+    }\n+\n     private boolean isRosterEntrySubscribed(RosterEntry entry) {\n         return (entry !\u003d null \u0026\u0026 (entry.getType() \u003d\u003d RosterPacket.ItemType.to || entry.getType() \u003d\u003d RosterPacket.ItemType.both) \u0026\u0026\n             entry.getStatus() !\u003d RosterPacket.ItemStatus.SUBSCRIPTION_PENDING);\n@@ -1873,6 +1898,12 @@ public static void requestConnectionStatus(final Context context) {\n         context.startService(i);\n     }\n \n+    public static void requestRosterStatus(final Context context) {\n+        Intent i \u003d new Intent(context, MessageCenterService.class);\n+        i.setAction(MessageCenterService.ACTION_ROSTER_LOADED);\n+        context.startService(i);\n+    }\n+\n     public static void requestVCard(final Context context, String to) {\n         Intent i \u003d new Intent(context, MessageCenterService.class);\n         i.setAction(MessageCenterService.ACTION_VCARD);"
        },
        {
          "file_name": "app/src/main/java/org/kontalk/ui/ComposeMessageFragment.java",
          "patch": "@@ -1991,7 +1991,9 @@ else if (MessageCenterService.ACTION_CONNECTED.equals(action)) {\n                         mComposeSent \u003d false;\n                         // reset available resources list\n                         mAvailableResources.clear();\n+                    }\n \n+                    else if (MessageCenterService.ACTION_ROSTER_LOADED.equals(action)) {\n                         // probe presence\n                         presenceSubscribe();\n                     }\n@@ -2020,12 +2022,14 @@ else if (MessageCenterService.ACTION_MESSAGE.equals(action)) {\n             IntentFilter filter \u003d new IntentFilter();\n             filter.addAction(MessageCenterService.ACTION_PRESENCE);\n             filter.addAction(MessageCenterService.ACTION_CONNECTED);\n+            filter.addAction(MessageCenterService.ACTION_ROSTER_LOADED);\n             filter.addAction(MessageCenterService.ACTION_MESSAGE);\n \n             mLocalBroadcastManager.registerReceiver(mPresenceReceiver, filter);\n \n-            // request connection status\n+            // request connection and roster load status\n             MessageCenterService.requestConnectionStatus(getActivity());\n+            MessageCenterService.requestRosterStatus(getActivity());\n         }\n     }\n "
        },
        {
          "file_name": "build.gradle",
          "patch": "@@ -11,5 +11,8 @@ buildscript {\n allprojects {\n     repositories {\n         jcenter()\n+        maven {\n+            url \u0027https://oss.sonatype.org/content/repositories/snapshots\u0027\n+        }\n     }\n }"
        },
        {
          "file_name": "client-common-java",
          "patch": "@@ -1 +1 @@\n-Subproject commit 5134766fc35c220acc427d9c146943b6dea80439\n+Subproject commit 7dfca6e374b153fe2e9e658b8baa0d886ba20c86"
        }
      ]
    }
  },
  {
    "name": "(CDAP-1218) Fix service discovery getURL logic to remove possible race condition.",
    "url": "https://github.com/caskdata/cdap/pull/1055",
    "description": "See JIRA https://issues.cask.co/browse/CDAP-1218 for details.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/caskdata/cdap/commit/d53ab1fed1ed423fcc081de7621d08d47ca5a9dc",
      "files": [
        {
          "file_name": "cdap-app-fabric/src/main/java/co/cask/cdap/app/services/AbstractServiceDiscoverer.java",
          "patch": "@@ -19,22 +19,11 @@\n import co.cask.cdap.api.ServiceDiscoverer;\n import co.cask.cdap.app.program.Program;\n import co.cask.cdap.common.conf.Constants;\n-import co.cask.cdap.common.discovery.EndpointStrategy;\n-import co.cask.cdap.common.discovery.RandomEndpointStrategy;\n-import org.apache.twill.common.Cancellable;\n-import org.apache.twill.common.Threads;\n-import org.apache.twill.discovery.Discoverable;\n+import co.cask.cdap.common.discovery.ServiceDiscoveries;\n import org.apache.twill.discovery.DiscoveryServiceClient;\n-import org.apache.twill.discovery.ServiceDiscovered;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n \n-import java.net.MalformedURLException;\n import java.net.URL;\n-import java.util.NoSuchElementException;\n-import java.util.concurrent.SynchronousQueue;\n import java.util.concurrent.TimeUnit;\n-import javax.annotation.Nullable;\n \n /**\n  * An abstract implementation of {@link ServiceDiscoverer}.\n@@ -43,8 +32,6 @@\n  */\n public abstract class AbstractServiceDiscoverer implements ServiceDiscoverer {\n \n-  private static final Logger LOG \u003d LoggerFactory.getLogger(AbstractServiceDiscoverer.class);\n-\n   protected String namespaceId;\n   protected String applicationId;\n \n@@ -58,64 +45,18 @@ public AbstractServiceDiscoverer(Program program) {\n \n   @Override\n   public URL getServiceURL(final String applicationId, final String serviceId) {\n-    ServiceDiscovered serviceDiscovered \u003d getDiscoveryServiceClient().discover(String.format(\"service.%s.%s.%s\",\n-                                                                                             namespaceId,\n-                                                                                             applicationId,\n-                                                                                             serviceId));\n-    EndpointStrategy endpointStrategy \u003d new RandomEndpointStrategy(serviceDiscovered);\n-    Discoverable discoverable \u003d endpointStrategy.pick();\n-    if (discoverable !\u003d null) {\n-      return createURL(discoverable, applicationId, serviceId);\n-    }\n-\n-    final SynchronousQueue\u003cURL\u003e discoverableQueue \u003d new SynchronousQueue\u003cURL\u003e();\n-    Cancellable discoveryCancel \u003d serviceDiscovered.watchChanges(new ServiceDiscovered.ChangeListener() {\n-      @Override\n-      public void onChange(ServiceDiscovered serviceDiscovered) {\n-        try {\n-          URL url \u003d createURL(serviceDiscovered.iterator().next(), applicationId, serviceId);\n-          discoverableQueue.offer(url);\n-        } catch (NoSuchElementException e) {\n-          LOG.debug(\"serviceDiscovered is empty\");\n-        }\n-      }\n-    }, Threads.SAME_THREAD_EXECUTOR);\n-\n-    try {\n-      URL url \u003d discoverableQueue.poll(1, TimeUnit.SECONDS);\n-      if (url \u003d\u003d null) {\n-        LOG.debug(\"Discoverable endpoint not found for appID: {}, serviceID: {}.\", applicationId, serviceId);\n-      }\n-      return url;\n-    } catch (InterruptedException e) {\n-      LOG.error(\"Exception raised when discovering endpoint for {}/{}\", applicationId, serviceId, e);\n-      return null;\n-    } finally {\n-      discoveryCancel.cancel();\n-    }\n+    String discoveryName \u003d String.format(\"service.%s.%s.%s\", namespaceId, applicationId, serviceId);\n+    String path \u003d String.format(\"%s/namespaces/%s/apps/%s/services/%s/methods/\",\n+                                Constants.Gateway.API_VERSION_3, namespaceId, applicationId, serviceId);\n+    return ServiceDiscoveries.discoverURL(getDiscoveryServiceClient(),\n+                                          discoveryName, \"http\", path, 1, TimeUnit.SECONDS);\n   }\n \n   @Override\n   public URL getServiceURL(String serviceId) {\n     return getServiceURL(applicationId, serviceId);\n   }\n \n-  private URL createURL(@Nullable Discoverable discoverable, String applicationId, String serviceId) {\n-    if (discoverable \u003d\u003d null) {\n-      return null;\n-    }\n-    String hostName \u003d discoverable.getSocketAddress().getHostName();\n-    int port \u003d discoverable.getSocketAddress().getPort();\n-    String path \u003d String.format(\"http://%s:%d%s/namespaces/%s/apps/%s/services/%s/methods/\", hostName, port,\n-                                Constants.Gateway.API_VERSION_3, namespaceId, applicationId, serviceId);\n-    try {\n-      return new URL(path);\n-    } catch (MalformedURLException e) {\n-      LOG.error(\"Got exception while creating serviceURL\", e);\n-      return null;\n-    }\n-  }\n-\n   /**\n    * @return the {@link DiscoveryServiceClient} for Service Discovery\n    */"
        },
        {
          "file_name": "cdap-common/src/main/java/co/cask/cdap/common/discovery/ServiceDiscoveries.java",
          "patch": "@@ -0,0 +1,105 @@\n+/*\n+ * Copyright © 2015 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package co.cask.cdap.common.discovery;\n+\n+import com.google.common.util.concurrent.SettableFuture;\n+import org.apache.twill.common.Cancellable;\n+import org.apache.twill.common.Threads;\n+import org.apache.twill.discovery.Discoverable;\n+import org.apache.twill.discovery.DiscoveryServiceClient;\n+import org.apache.twill.discovery.ServiceDiscovered;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.net.InetSocketAddress;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.concurrent.TimeUnit;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * A helper class to help using {@link DiscoveryServiceClient} and {@link ServiceDiscovered} correctly.\n+ */\n+public final class ServiceDiscoveries {\n+\n+  private static final Logger LOG \u003d LoggerFactory.getLogger(ServiceDiscoveries.class);\n+\n+  /**\n+   * Creates an URL based on the endpoint discovered by the given service name. If there are multiple endpoints\n+   * available, one will be picked randomly.\n+   *\n+   * @param discoveryClient the discovery client to discover endpoints\n+   * @param serviceName name of the service for endpoint discovery\n+   * @param protocol protocol for the resulting {@link URL}\n+   * @param path path for the resulting {@link URL}\n+   * @param timeout maximum time to spend to wait for endpoint to be available\n+   * @param unit unit for the timeout\n+   * @return an URL in the format of {@code protocol://host:port/path} or {@code null} if no endpoint is available\n+   */\n+  @Nullable\n+  public static URL discoverURL(DiscoveryServiceClient discoveryClient,\n+                                String serviceName, final String protocol, final String path,\n+                                long timeout, TimeUnit unit) {\n+\n+    ServiceDiscovered serviceDiscovered \u003d discoveryClient.discover(serviceName);\n+    URL url \u003d createURL(new RandomEndpointStrategy(serviceDiscovered), protocol, path);\n+    if (url !\u003d null) {\n+      return url;\n+    }\n+\n+    final SettableFuture\u003cURL\u003e result \u003d SettableFuture.create();\n+    final Cancellable discoveryCancel \u003d serviceDiscovered.watchChanges(new ServiceDiscovered.ChangeListener() {\n+      @Override\n+      public void onChange(ServiceDiscovered serviceDiscovered) {\n+        URL url \u003d createURL(new RandomEndpointStrategy(serviceDiscovered), protocol, path);\n+        if (url !\u003d null) {\n+          result.set(url);\n+        }\n+      }\n+    }, Threads.SAME_THREAD_EXECUTOR);\n+\n+    try {\n+      return result.get(timeout, unit);\n+    } catch (Exception e) {\n+      LOG.debug(\"No discovery available for service {}\", serviceName);\n+    } finally {\n+      discoveryCancel.cancel();\n+    }\n+    return null;\n+  }\n+\n+  @Nullable\n+  private static URL createURL(EndpointStrategy endpointStrategy, String protocol, String path) {\n+    Discoverable discoverable \u003d endpointStrategy.pick();\n+    if (discoverable \u003d\u003d null) {\n+      return null;\n+    }\n+    try {\n+      if (path.charAt(0) !\u003d \u0027/\u0027) {\n+        path \u003d \u0027/\u0027 + path;\n+      }\n+      InetSocketAddress address \u003d discoverable.getSocketAddress();\n+      return new URL(protocol, address.getHostName(), address.getPort(), path);\n+    } catch (MalformedURLException e) {\n+      LOG.warn(\"Malformed URL\", e);\n+      return null;\n+    }\n+  }\n+\n+  private ServiceDiscoveries() {\n+  }\n+}"
        },
        {
          "file_name": "cdap-unit-test/src/main/java/co/cask/cdap/test/internal/DefaultServiceManager.java",
          "patch": "@@ -17,33 +17,21 @@\n package co.cask.cdap.test.internal;\n \n import co.cask.cdap.common.conf.Constants;\n-import co.cask.cdap.common.discovery.EndpointStrategy;\n-import co.cask.cdap.common.discovery.RandomEndpointStrategy;\n+import co.cask.cdap.common.discovery.ServiceDiscoveries;\n import co.cask.cdap.proto.ServiceInstances;\n import co.cask.cdap.test.AbstractServiceManager;\n import co.cask.cdap.test.ServiceManager;\n import com.google.common.base.Preconditions;\n import com.google.common.base.Throwables;\n-import org.apache.twill.common.Cancellable;\n-import org.apache.twill.common.Threads;\n-import org.apache.twill.discovery.Discoverable;\n import org.apache.twill.discovery.DiscoveryServiceClient;\n-import org.apache.twill.discovery.ServiceDiscovered;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n \n-import java.net.MalformedURLException;\n import java.net.URL;\n-import java.util.NoSuchElementException;\n-import java.util.concurrent.SynchronousQueue;\n import java.util.concurrent.TimeUnit;\n-import javax.annotation.Nullable;\n \n /**\n  * A default implementation of {@link ServiceManager}.\n  */\n public class DefaultServiceManager extends AbstractServiceManager {\n-  private static final Logger LOG \u003d LoggerFactory.getLogger(DefaultServiceManager.class);\n \n   private final DefaultApplicationManager.ProgramId serviceId;\n   private final String accountId;\n@@ -114,56 +102,9 @@ public URL getServiceURL() {\n \n   @Override\n   public URL getServiceURL(long timeout, TimeUnit timeoutUnit) {\n-    ServiceDiscovered serviceDiscovered \u003d discoveryServiceClient.discover(String.format(\"service.%s.%s.%s\",\n-                                                                                        accountId,\n-                                                                                        applicationId,\n-                                                                                        serviceName));\n-    EndpointStrategy endpointStrategy \u003d new RandomEndpointStrategy(serviceDiscovered);\n-    Discoverable discoverable \u003d endpointStrategy.pick();\n-    if (discoverable !\u003d null) {\n-      return createURL(discoverable, applicationId, serviceName);\n-    }\n-\n-    final SynchronousQueue\u003cURL\u003e discoverableQueue \u003d new SynchronousQueue\u003cURL\u003e();\n-    Cancellable discoveryCancel \u003d serviceDiscovered.watchChanges(new ServiceDiscovered.ChangeListener() {\n-      @Override\n-      public void onChange(ServiceDiscovered serviceDiscovered) {\n-        try {\n-          URL url \u003d createURL(serviceDiscovered.iterator().next(), applicationId, serviceName);\n-          discoverableQueue.offer(url);\n-        } catch (NoSuchElementException e) {\n-          LOG.debug(\"serviceDiscovered is empty\");\n-        }\n-      }\n-    }, Threads.SAME_THREAD_EXECUTOR);\n-\n-    try {\n-      URL url \u003d discoverableQueue.poll(timeout, timeoutUnit);\n-      if (url \u003d\u003d null) {\n-        LOG.debug(\"Discoverable endpoint not found for appID: {}, serviceName: {}.\", applicationId, serviceName);\n-      }\n-      return url;\n-    } catch (InterruptedException e) {\n-      LOG.error(\"Got exception: \", e);\n-      return null;\n-    } finally {\n-      discoveryCancel.cancel();\n-    }\n-  }\n-\n-  private URL createURL(@Nullable Discoverable discoverable, String applicationId, String serviceName) {\n-    if (discoverable \u003d\u003d null) {\n-      return null;\n-    }\n-    String hostName \u003d discoverable.getSocketAddress().getHostName();\n-    int port \u003d discoverable.getSocketAddress().getPort();\n-    String path \u003d String.format(\"http://%s:%d%s/namespaces/%s/apps/%s/services/%s/methods/\", hostName, port,\n+    String discoveryName \u003d String.format(\"service.%s.%s.%s\", accountId, applicationId, serviceName);\n+    String path \u003d String.format(\"%s/namespaces/%s/apps/%s/services/%s/methods/\",\n                                 Constants.Gateway.API_VERSION_3, accountId, applicationId, serviceName);\n-    try {\n-      return new URL(path);\n-    } catch (MalformedURLException e) {\n-      LOG.error(\"Got exception while creating serviceURL\", e);\n-      return null;\n-    }\n+    return ServiceDiscoveries.discoverURL(discoveryServiceClient, discoveryName, \"http\", path, timeout, timeoutUnit);\n   }\n }"
        }
      ]
    }
  },
  {
    "name": "fix skip() race condition and request overflow",
    "url": "https://github.com/ReactiveX/RxJava/pull/2987",
    "description": "`OperatorSkip` suffered from this race condition:\n\nSuppose we wanted to skip 5 elements, then\n- two concurrent requests of say 1 between onStart request of 0 and first emission would request 1+ (5-0) and 1 + (5-0) elements \u003d 12 elements. To deliver the two requested we only need 7 from upstream so we have overrequested.\n\nIt also lacked protection from request overflow.\n\nTwo unit tests have been added that failed on previous code and now pass.\n",
    "keywords": [
      "request",
      "elements",
      "two"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/ReactiveX/RxJava/commit/ae09b866a41d374087cb98aaf0c5919fe4dd8710",
      "files": [
        {
          "file_name": "src/main/java/rx/internal/operators/OperatorSkip.java",
          "patch": "@@ -15,6 +15,8 @@\n  */\n package rx.internal.operators;\n \n+import java.util.concurrent.atomic.AtomicBoolean;\n+\n import rx.Observable;\n import rx.Producer;\n import rx.Subscriber;\n@@ -63,19 +65,8 @@ public void onNext(T t) {\n \n             @Override\n             public void setProducer(final Producer producer) {\n-                child.setProducer(new Producer() {\n-\n-                    @Override\n-                    public void request(long n) {\n-                        if (n \u003d\u003d Long.MAX_VALUE) {\n-                            // infinite so leave it alone\n-                            producer.request(n);\n-                        } else if (n \u003e 0) {\n-                            // add the skip num to the requested amount, since we\u0027ll skip everything and then emit to the buffer downstream\n-                            producer.request(n + (toSkip - skipped));\n-                        }\n-                    }\n-                });\n+                child.setProducer(producer);\n+                producer.request(toSkip);\n             }\n \n         };"
        },
        {
          "file_name": "src/test/java/rx/internal/operators/OperatorSkipTest.java",
          "patch": "@@ -15,17 +15,23 @@\n  */\n package rx.internal.operators;\n \n+import static org.junit.Assert.assertEquals;\n import static org.mockito.Matchers.any;\n import static org.mockito.Mockito.mock;\n import static org.mockito.Mockito.never;\n import static org.mockito.Mockito.times;\n import static org.mockito.Mockito.verify;\n \n+import java.util.Arrays;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+\n import org.junit.Test;\n \n import rx.Observable;\n import rx.Observer;\n-import rx.internal.operators.OperatorSkip;\n+import rx.functions.Action1;\n+import rx.observers.TestSubscriber;\n \n public class OperatorSkipTest {\n \n@@ -144,4 +150,36 @@ public void testSkipError() {\n         verify(observer, never()).onCompleted();\n \n     }\n+    \n+    @Test\n+    public void testBackpressureMultipleSmallAsyncRequests() throws InterruptedException {\n+        final AtomicLong requests \u003d new AtomicLong(0);\n+        TestSubscriber\u003cLong\u003e ts \u003d new TestSubscriber\u003cLong\u003e(0);\n+        Observable.interval(100, TimeUnit.MILLISECONDS)\n+                .doOnRequest(new Action1\u003cLong\u003e() {\n+                    @Override\n+                    public void call(Long n) {\n+                        requests.addAndGet(n);\n+                    }\n+                }).skip(4).subscribe(ts);\n+        Thread.sleep(100);\n+        ts.requestMore(1);\n+        ts.requestMore(1);\n+        Thread.sleep(100);\n+        ts.unsubscribe();\n+        ts.assertUnsubscribed();\n+        ts.assertNoErrors();\n+        assertEquals(6, requests.get());\n+    }\n+    \n+    @Test\n+    public void testRequestOverflowDoesNotOccur() {\n+        TestSubscriber\u003cInteger\u003e ts \u003d new TestSubscriber\u003cInteger\u003e(Long.MAX_VALUE-1);\n+        Observable.range(1, 10).skip(5).subscribe(ts);\n+        ts.assertTerminalEvent();\n+        ts.assertCompleted();\n+        ts.assertNoErrors();\n+        assertEquals(Arrays.asList(6,7,8,9,10), ts.getOnNextEvents());\n+    }\n+    \n }"
        }
      ]
    }
  },
  {
    "name": "Race condition on diagnostic messages in CameraManager",
    "url": "https://github.com/phrack/ShootOFF/issues/275",
    "description": "We use Platform.runLater to set the labels but this is not thread safe.  If we go to remove the label later but it hasn\u0027t been set yet by the other thread, we fail to remove it and the diagnostic message remains forever.\n\nI know how to fix it.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/phrack/ShootOFF/commit/5284ecc80e4cfcc6c5b28e7f672e283115ad8f20",
      "files": [
        {
          "file_name": "src/main/java/com/shootoff/camera/CameraManager.java",
          "patch": "@@ -600,7 +600,7 @@ private void showFPSWarning(double fps) {\n \t\n \tprivate Label brightnessDiagnosticWarning \u003d null;\n \tprivate final static int brightnessDiagnosticLengthMS \u003d 1000;\n-\tprivate boolean showingBrightnessWarning \u003d false;\n+\tprivate volatile boolean showingBrightnessWarning \u003d false;\n \tpublic void showBrightnessWarning() {\n \t\tif (!showingBrightnessWarning)\n \t\t{\n@@ -660,7 +660,7 @@ public void run() {\n \n \tprivate Label motionDiagnosticWarning \u003d null;\n \tprivate final static int motionDiagnosticLengthMS \u003d 1000;\n-\tprivate boolean showingMotionDiagnosticWarning \u003d false;\n+\tprivate volatile boolean showingMotionDiagnosticWarning \u003d false;\n \tpublic void showMotionWarning() {\n \t\tif (!showingMotionDiagnosticWarning)\n \t\t{"
        },
        {
          "file_name": "src/main/java/com/shootoff/gui/controller/ProjectorArenaController.java",
          "patch": "@@ -348,7 +348,7 @@ public void startCalibration() {\n \t\tarenaStage.getScene().setOnMouseExited(null);\n \t}\n \t\n-\tprivate boolean showingCursorWarning \u003d false;\n+\tprivate volatile boolean showingCursorWarning \u003d false;\n \t@Override\n \tpublic void calibrated(CanvasManager feedCanvasManager) {\n \t\tsetCalibrationMessageVisible(false);"
        },
        {
          "file_name": "src/main/java/com/shootoff/gui/controller/ShootOFFController.java",
          "patch": "@@ -791,7 +791,7 @@ public boolean isCalibrating()\n \t\n \t\n \tprivate Label manualCalibrationRequestMessage \u003d null; \n-\tprivate boolean showingManualCalibrationRequestMessage \u003d false;\n+\tprivate volatile boolean showingManualCalibrationRequestMessage \u003d false;\n \tprivate void showManualCalibrationRequestMessage()\n \t{\n \t\tif (showingManualCalibrationRequestMessage)\n@@ -819,7 +819,7 @@ private void removeManualCalibrationRequestMessage()\n \t}\n \n \tprivate Label fullScreenRequestMessage \u003d null; \n-\tprivate boolean showingFullScreenRequestMessage \u003d false;\n+\tprivate volatile boolean showingFullScreenRequestMessage \u003d false;\n \tprivate void showFullScreenRequest()\n \t{\n \t\tif (showingFullScreenRequestMessage)\n@@ -892,7 +892,7 @@ private void cancelAutoCalibrationTimer()\n \t}\n \t\n \tprivate Label autoCalibrationMessage \u003d null; \n-\tprivate boolean showingAutoCalibrationMessage \u003d false;\n+\tprivate volatile boolean showingAutoCalibrationMessage \u003d false;\n \tprivate void showAutoCalibrationMessage()\n \t{\n \t\tlogger.trace(\"showAutoCalibrationMessage - showingAutoCalibrationMessage {} autoCalibrationMessage {}\", showingAutoCalibrationMessage, autoCalibrationMessage);"
        }
      ]
    }
  },
  {
    "name": "A master node operation can timeout in a rare race condition when a master has a connection issue which is quickly restored",
    "url": "https://github.com/elastic/elasticsearch/pull/5499",
    "description": "If a master node operation comes on immediately after a connection problem to the master node, the operation will be rescheduled. If the connection is quickly restored and the same master is re-elected, a rare race condition can occur causing the operation to unjustly time out.\n",
    "keywords": [
      "node",
      "connection",
      "operation",
      "master"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/elastic/elasticsearch/commit/c650ee47f3737f00fe2f3ddcc1667ab3c8d6f904",
      "files": [
        {
          "file_name": "src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeOperationAction.java",
          "patch": "@@ -157,6 +157,8 @@ public void run() {\n                 if (retrying) {\n                     listener.onFailure(new MasterNotDiscoveredException());\n                 } else {\n+                    logger.debug(\"no known master node, scheduling a retry\");\n+\n                     clusterService.add(request.masterNodeTimeout(), new TimeoutClusterStateListener() {\n                         @Override\n                         public void postAdded() {\n@@ -212,12 +214,14 @@ public String executor() {\n                 public void handleException(final TransportException exp) {\n                     if (exp.unwrapCause() instanceof ConnectTransportException) {\n                         // we want to retry here a bit to see if a new master is elected\n+                        logger.debug(\"connection exception while trying to forward request to master node [{}], scheduling a retry. Error: [{}]\",\n+                                nodes.masterNode(), exp.getDetailedMessage());\n                         clusterService.add(request.masterNodeTimeout(), new TimeoutClusterStateListener() {\n                             @Override\n                             public void postAdded() {\n                                 ClusterState clusterStateV2 \u003d clusterService.state();\n-                                if (!clusterState.nodes().masterNodeId().equals(clusterStateV2.nodes().masterNodeId())) {\n-                                    // master changes while adding the listener, try here\n+                                if (clusterState.version() !\u003d clusterStateV2.version()) {\n+                                    // something changed while adding, try again\n                                     clusterService.remove(this);\n                                     innerExecute(request, listener, false);\n                                 }"
        }
      ]
    }
  },
  {
    "name": "Race condition in processFrame",
    "url": "https://github.com/phrack/ShootOFF/issues/463",
    "description": "Exception in thread \"ShotDetector\" java.util.NoSuchElementException: No value present\n    at java.util.Optional.get(Optional.java:135)\n    at com.shootoff.camera.CameraManager.processFrame(CameraManager.java:551)\n    at com.shootoff.camera.CameraManager.streamCameraFrames(CameraManager.java:485)\n    at com.shootoff.camera.CameraManager.access$0(CameraManager.java:462)\n    at com.shootoff.camera.CameraManager$VideoStreamer.run(CameraManager.java:457)\n    at java.lang.Thread.run(Thread.java:745)\n",
    "keywords": [
      "com",
      "cameramanager",
      "java",
      "com shootoff",
      "thread",
      "shootoff",
      "camera cameramanager",
      "camera"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/phrack/ShootOFF/commit/18b7a901b69dbb1f08a700b2af9d3f4182de42e7",
      "files": [
        {
          "file_name": "src/main/java/com/shootoff/camera/CameraManager.java",
          "patch": "@@ -149,7 +149,7 @@ public CameraManager(Camera webcam, CameraErrorView cameraErrorView, CameraView\n \t\tthis.cameraView.setCameraManager(this);\n \n \t\tinitDetector(new VideoStreamer());\n-\t\t\n+\n \t\tif (NativeShotDetector.loadNativeShotDetector()) {\n \t\t\tlogger.debug(\"Using native shot detection\");\n \n@@ -220,7 +220,7 @@ public void setFeedResolution(int width, int height) {\n \t\tfeedWidth \u003d width;\n \t\tfeedHeight \u003d height;\n \t}\n-\t\n+\n \t// Used by click-to-shoot and tests to inject a shot via the shot detector\n \tpublic void injectShot(Color color, double x, double y, boolean scaleShot) {\n \t\tshotDetector.addShot(color, x, y, scaleShot);\n@@ -273,7 +273,9 @@ public boolean isDetecting() {\n \t}\n \n \tpublic void setProjectionBounds(final Bounds projectionBounds) {\n-\t\tthis.projectionBounds \u003d Optional.ofNullable(projectionBounds);\n+\t\tsynchronized (this.projectionBounds) {\n+\t\t\tthis.projectionBounds \u003d Optional.ofNullable(projectionBounds);\n+\t\t}\n \t}\n \n \tpublic void setCropFeedToProjection(final boolean cropFeed) {\n@@ -484,11 +486,13 @@ private void streamCameraFrames() {\n \t\t\tif (currentFrame \u003d\u003d null) continue;\n \t\t\tcurrentFrame \u003d processFrame(currentFrame);\n \n-\t\t\tif (cropFeedToProjection \u0026\u0026 projectionBounds.isPresent()) {\n-\t\t\t\tBounds b \u003d projectionBounds.get();\n+\t\t\tsynchronized (projectionBounds) {\n+\t\t\t\tif (cropFeedToProjection \u0026\u0026 projectionBounds.isPresent()) {\n+\t\t\t\t\tBounds b \u003d projectionBounds.get();\n \n-\t\t\t\tcurrentFrame \u003d currentFrame.getSubimage((int) b.getMinX(), (int) b.getMinY(), (int) b.getWidth(),\n-\t\t\t\t\t\t(int) b.getHeight());\n+\t\t\t\t\tcurrentFrame \u003d currentFrame.getSubimage((int) b.getMinX(), (int) b.getMinY(), (int) b.getWidth(),\n+\t\t\t\t\t\t\t(int) b.getHeight());\n+\t\t\t\t}\n \t\t\t}\n \n \t\t\tif (recordingShots) {\n@@ -532,25 +536,34 @@ private void streamCameraFrames() {\n \n \tprotected BufferedImage processFrame(BufferedImage currentFrame) {\n \t\tframeCount++;\n-\t\t\n+\n \t\tif (isAutoCalibrating.get() \u0026\u0026 ((getFrameCount() % Math.min(getFPS(), 3)) \u003d\u003d 0)) {\n-\t\t\t\n+\n \t\t\tacm.processFrame(currentFrame);\n \t\t\treturn currentFrame;\n \t\t}\n \n \t\tMat matFrameBGR \u003d Camera.bufferedImageToMat(currentFrame);\n \t\tMat submatFrameBGR \u003d null;\n \n-\t\tif (cameraAutoCalibrated \u0026\u0026 projectionBounds.isPresent()) {\n+\t\tBounds projectionBounds;\n+\n+\t\tsynchronized (this.projectionBounds) {\n+\t\t\tif (this.projectionBounds.isPresent()) {\n+\t\t\t\tprojectionBounds \u003d this.projectionBounds.get();\n+\t\t\t} else {\n+\t\t\t\tprojectionBounds \u003d null;\n+\t\t\t}\n+\t\t}\n+\n+\t\tif (cameraAutoCalibrated \u0026\u0026 projectionBounds !\u003d null) {\n \t\t\tif (acm !\u003d null) {\n \t\t\t\t// MUST BE IN BGR pixel format.\n \t\t\t\tmatFrameBGR \u003d acm.undistortFrame(matFrameBGR);\n \t\t\t}\n \n-\t\t\tsubmatFrameBGR \u003d matFrameBGR.submat((int) projectionBounds.get().getMinY(),\n-\t\t\t\t\t(int) projectionBounds.get().getMaxY(), (int) projectionBounds.get().getMinX(),\n-\t\t\t\t\t(int) projectionBounds.get().getMaxX());\n+\t\t\tsubmatFrameBGR \u003d matFrameBGR.submat((int) projectionBounds.getMinY(), (int) projectionBounds.getMaxY(),\n+\t\t\t\t\t(int) projectionBounds.getMinX(), (int) projectionBounds.getMaxX());\n \n \t\t\tif (recordingCalibratedArea) {\n \t\t\t\tBufferedImage image \u003d ConverterFactory.convertToType(Camera.matToBufferedImage(submatFrameBGR),\n@@ -571,10 +584,10 @@ protected BufferedImage processFrame(BufferedImage currentFrame) {\n \t\t\t}\n \t\t}\n \n-\t\tif ((isLimitingDetectionToProjection() || isCroppingFeedToProjection()) \u0026\u0026 getProjectionBounds().isPresent()) {\n-\t\t\tif (submatFrameBGR \u003d\u003d null) submatFrameBGR \u003d matFrameBGR.submat((int) projectionBounds.get().getMinY(),\n-\t\t\t\t\t(int) projectionBounds.get().getMaxY(), (int) projectionBounds.get().getMinX(),\n-\t\t\t\t\t(int) projectionBounds.get().getMaxX());\n+\t\tif ((isLimitingDetectionToProjection() || isCroppingFeedToProjection()) \u0026\u0026 projectionBounds !\u003d null) {\n+\t\t\tif (submatFrameBGR \u003d\u003d null)\n+\t\t\t\tsubmatFrameBGR \u003d matFrameBGR.submat((int) projectionBounds.getMinY(), (int) projectionBounds.getMaxY(),\n+\t\t\t\t\t\t(int) projectionBounds.getMinX(), (int) projectionBounds.getMaxX());\n \n \t\t\tshotDetector.processFrame(submatFrameBGR, isDetecting.get());\n \t\t} else {\n@@ -683,8 +696,9 @@ protected void autoCalibrateSuccess(Bounds arenaBounds, Optional\u003cDimension2D\u003e pa\n \t\tif (isAutoCalibrating.get() \u0026\u0026 cameraCalibrationListener !\u003d null) {\n \t\t\tisAutoCalibrating.set(false);\n \n-\t\t\tlogger.debug(\"autoCalibrateSuccess {} {} {} {} paper {}\", (int) arenaBounds.getMinX(), (int) arenaBounds.getMinY(),\n-\t\t\t\t\t(int) arenaBounds.getWidth(), (int) arenaBounds.getHeight(), paperDims.isPresent());\n+\t\t\tlogger.debug(\"autoCalibrateSuccess {} {} {} {} paper {}\", (int) arenaBounds.getMinX(),\n+\t\t\t\t\t(int) arenaBounds.getMinY(), (int) arenaBounds.getWidth(), (int) arenaBounds.getHeight(),\n+\t\t\t\t\tpaperDims.isPresent());\n \n \t\t\tcameraAutoCalibrated \u003d true;\n \t\t\tcameraCalibrationListener.calibrate(arenaBounds, paperDims, false);"
        }
      ]
    }
  },
  {
    "name": "race condition in FEB-Generator",
    "url": "https://github.com/cismet/verdis/issues/155",
    "description": "The inner animations (zoom, goto bb, etc) of the mapping component in the FEB genarator seem to cause a race condition.\nThe mapping component should be replaced by the headless mapping provider\n\nsee also: https://github.com/cismet/wupp/issues/919\n",
    "keywords": [
      "mapping"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/cismet/verdis/commit/400cb77f66e69a4209ef7ecaab8ae8fe45298cfb",
      "files": [
        {
          "file_name": "src/main/java/de/cismet/cids/custom/reports/verdis/EBReportBean.java",
          "patch": "@@ -11,6 +11,14 @@\n  */\n package de.cismet.cids.custom.reports.verdis;\n \n+import com.vividsolutions.jts.geom.Geometry;\n+import com.vividsolutions.jts.geom.GeometryCollection;\n+import com.vividsolutions.jts.geom.GeometryFactory;\n+import com.vividsolutions.jts.geom.PrecisionModel;\n+\n+import edu.umd.cs.piccolo.PNode;\n+import edu.umd.cs.piccolo.util.PBounds;\n+\n import org.apache.log4j.Logger;\n \n import org.krysalis.barcode4j.BarcodeDimension;\n@@ -29,11 +37,18 @@\n \n import java.text.NumberFormat;\n \n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n import de.cismet.cids.dynamics.CidsBean;\n \n import de.cismet.cismap.commons.BoundingBox;\n import de.cismet.cismap.commons.Crs;\n+import de.cismet.cismap.commons.CrsTransformer;\n+import de.cismet.cismap.commons.HeadlessMapProvider;\n import de.cismet.cismap.commons.XBoundingBox;\n+import de.cismet.cismap.commons.features.Feature;\n import de.cismet.cismap.commons.gui.MappingComponent;\n import de.cismet.cismap.commons.gui.layerwidget.ActiveLayerModel;\n import de.cismet.cismap.commons.raster.wms.simple.SimpleWMS;\n@@ -198,135 +213,103 @@ public boolean isReadyToProceed() {\n     /**\n      * DOCUMENT ME!\n      *\n-     * @param  map  DOCUMENT ME!\n+     * @return  DOCUMENT ME!\n      */\n-    protected abstract void loadFeaturesInMap(final MappingComponent map);\n+    protected abstract Collection\u003cFeature\u003e createFeatures();\n \n     /**\n      * DOCUMENT ME!\n      */\n     protected void loadMap() {\n-        final SimpleWMS s \u003d new SimpleWMS(new SimpleWmsGetMapUrl(\n+        final SimpleWMS simpleWms \u003d new SimpleWMS(new SimpleWmsGetMapUrl(\n \n                     // \"http://s10221.wuppertal-intra.de:7098/alkis/services?\u0026VERSION\u003d1.1.1\u0026REQUEST\u003dGetMap\u0026BBOX\u003d\u003ccismap:boundingBox\u003e\u0026WIDTH\u003d\u003ccismap:width\u003e\u0026HEIGHT\u003d\u003ccismap:height\u003e\u0026SRS\u003dEPSG:31466\u0026FORMAT\u003dimage/png\u0026TRANSPARENT\u003dTRUE\u0026BGCOLOR\u003d0xF0F0F0\u0026EXCEPTIONS\u003dapplication/vnd.ogc.se_xml\u0026LAYERS\u003dalgw\u0026STYLES\u003ddefault\"));\n                     \"http://S102w484:8399/arcgis/services/WuNDa-ALKIS-Hintergrund/MapServer/WMSServer?\u0026VERSION\u003d1.1.1\u0026REQUEST\u003dGetMap\u0026BBOX\u003d\u003ccismap:boundingBox\u003e\u0026WIDTH\u003d\u003ccismap:width\u003e\u0026HEIGHT\u003d\u003ccismap:height\u003e\u0026SRS\u003dEPSG:31466\u0026FORMAT\u003dimage/png\u0026TRANSPARENT\u003dFALSE\u0026BGCOLOR\u003d0xF0F0F0\u0026EXCEPTIONS\u003dapplication/vnd.ogc.se_xml\u0026LAYERS\u003d2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19\u0026STYLES\u003ddefault,default,default,default,default,default,default,default,default,default,default,default,default,default,default,default,default,default\"));\n-        final MappingComponent map \u003d new MappingComponent(false);\n-\n-        final ActiveLayerModel mappingModel \u003d new ActiveLayerModel();\n-        s.addRetrievalListener(new RetrievalListener() {\n-\n-                @Override\n-                public void retrievalStarted(final RetrievalEvent e) {\n-                    if (LOG.isDebugEnabled()) {\n-                        LOG.debug(\"start map retrieval for feb report\");\n-                    }\n-                }\n-\n-                @Override\n-                public void retrievalProgress(final RetrievalEvent e) {\n-                }\n-\n-                @Override\n-                public void retrievalComplete(final RetrievalEvent e) {\n-                    if (LOG.isDebugEnabled()) {\n-                        LOG.debug(\"map retrieval for feb report complete\");\n+        final HeadlessMapProvider mapProvider \u003d new HeadlessMapProvider();\n+        mapProvider.setCenterMapOnResize(true);\n+        final String crsString \u003d \"EPSG:31466\";\n+        final Crs crs \u003d new Crs(crsString, \"\", \"\", true, true);\n+        mapProvider.setCrs(crs);\n+        mapProvider.addLayer(simpleWms);\n+\n+        final Collection\u003cFeature\u003e features \u003d createFeatures();\n+        int srid \u003d CrsTransformer.extractSridFromCrs(crsString);\n+        boolean first \u003d true;\n+        final List\u003cGeometry\u003e geomList \u003d new ArrayList\u003cGeometry\u003e(features.size());\n+        for (final Feature feature : features) {\n+            Geometry geometry \u003d feature.getGeometry();\n+\n+            if (geometry !\u003d null) {\n+                geometry \u003d geometry.getEnvelope();\n+\n+                if (first) {\n+                    srid \u003d geometry.getSRID();\n+                    first \u003d false;\n+                } else {\n+                    if (geometry.getSRID() !\u003d srid) {\n+                        geometry \u003d CrsTransformer.transformToGivenCrs(geometry, crsString);\n                     }\n-                    new Thread() {\n-\n-                        @Override\n-                        public void run() {\n-                            try {\n-                                try {\n-                                    Thread.sleep(500);\n-                                } catch (InterruptedException ex) {\n-                                }\n-                                final java.awt.Image img \u003d map.getCamera()\n-                                            .toImage(map.getWidth(), map.getHeight(), new Color(255, 255, 255, 0));\n-                                final BufferedImage bi \u003d new BufferedImage(\n-                                        img.getWidth(null),\n-                                        img.getHeight(null),\n-                                        BufferedImage.TYPE_INT_RGB);\n-                                final Graphics2D g2 \u003d bi.createGraphics();\n-                                // Draw img into bi so we can write it to file.\n-                                g2.drawImage(img, 0, 0, null);\n-                                g2.dispose();\n-                                if (LOG.isDebugEnabled()) {\n-                                    LOG.debug(\"bi size (h/w): \" + bi.getHeight() + \"/\" + bi.getWidth());\n-                                }\n-                                mapImage \u003d bi;\n-                            } catch (Exception ex) {\n-                                LOG.error(\"error while creating mapImage\", ex);\n-                            }\n-                        }\n-                    }.start();\n                 }\n \n-                @Override\n-                public void retrievalAborted(final RetrievalEvent e) {\n-                    LOG.fatal(\n-                        \"map retrieval for feb report aborted: \"\n-                                + e.getErrorType() // NOI18N\n-                                + \" Errors: \"      // NOI18N\n-                                + e.getErrors()\n-                                + \" Cause: \"\n-                                + e.getRetrievedObject()); // NOI18N\n-//                    mapError \u003d true;\n+                geomList.add(geometry);\n+            }\n+            mapProvider.addFeature(feature);\n+            if (mapProvider.getMappingComponent().getPFeatureHM().get(feature) !\u003d null) {\n+                final PNode annotationNode \u003d mapProvider.getMappingComponent()\n+                            .getPFeatureHM()\n+                            .get(feature)\n+                            .getPrimaryAnnotationNode();\n+                if (annotationNode !\u003d null) {\n+                    final PBounds bounds \u003d annotationNode.getBounds();\n+                    bounds.x \u003d -bounds.width / 2;\n+                    bounds.y \u003d -bounds.height / 2;\n+                    annotationNode.setBounds(bounds);\n                 }\n+            }\n+        }\n \n-                @Override\n-                public void retrievalError(final RetrievalEvent e) {\n-                    LOG.fatal(\"map retrieval error for feb report: \" + e.getErrorType() + \" \" + e.toString());\n-                    mapError \u003d true;\n-                }\n-            });\n-        // disable internal layer widget\n-        map.setInternalLayerWidgetAvailable(false);\n-        mappingModel.setSrs(new Crs(\"EPSG:31466\", \"\", \"\", true, true));\n-        mappingModel.addHome(new XBoundingBox(\n-                579146.311157169,\n-                5679930.726695932,\n-                2579645.8713909937,\n-                5680274.612347874,\n-                \"EPSG:31466\",\n-                true));\n-        // set the model\n-        map.setMappingModel(mappingModel);\n-        final int mapDPI \u003d Integer.parseInt(NbBundle.getMessage(\n-                    EBReportBean.class,\n-                    \"FEBReportBean.mapDPI\"));\n-        final int factor \u003d mapDPI / 72;\n-        map.setSize(mapWidth * factor, mapHeight * factor);\n-        // initial positioning of the map\n-        map.setAnimationDuration(0);\n-        map.gotoInitialBoundingBox();\n-\n-        map.unlock();\n-\n-        loadFeaturesInMap(map);\n+        final GeometryFactory factory \u003d new GeometryFactory(new PrecisionModel(PrecisionModel.FLOATING), srid);\n+        Geometry union \u003d factory.buildGeometry(geomList);\n+        if (union instanceof GeometryCollection) {\n+            union \u003d ((GeometryCollection)union).union();\n+        }\n+        final XBoundingBox boundingBox \u003d new XBoundingBox(union);\n \n-        final double oldScale \u003d map.getScaleDenominator();\n-        final BoundingBox bbox \u003d map.getBoundingBoxFromScale(oldScale);\n-        final double realWorldWidthInMeter \u003d bbox.getWidth();\n+        final double oldWidth \u003d boundingBox.getWidth();\n+        final double oldHeight \u003d boundingBox.getHeight();\n+        final double centerX \u003d boundingBox.getX1() + (oldWidth / 2);\n+        final double centerY \u003d boundingBox.getY1() + (oldHeight / 2);\n \n-        map.zoomToFeatureCollection();\n+        final double oldScale \u003d getReportScaleDenom(oldWidth);\n         final double newScale;\n-\n         if (scaleDenominator !\u003d null) {\n             newScale \u003d scaleDenominator;\n         } else {\n-            final double roundScale \u003d getReportScaleDenom(map.getBoundingBoxFromScale(map.getScaleDenominator())\n-                            .getWidth());\n-            newScale \u003d Math.round((roundScale / 100) + 0.5d) * 100;\n+            newScale \u003d Math.round((oldScale / 100) + 0.5d) * 100;\n         }\n-        map.gotoBoundingBoxWithHistory(map.getBoundingBoxFromScale(\n-                getMapScaleDenom(newScale, oldScale, realWorldWidthInMeter)));\n \n-        // lets calculate the correct scale for the printed report\n-        final double so \u003d getReportScaleDenom(map.getBoundingBoxFromScale(map.getScaleDenominator()).getWidth());\n-        scale \u003d \"1:\" + NumberFormat.getIntegerInstance().format(so);\n+        final double newWidth \u003d oldWidth * newScale / oldScale;\n+        final double newHeight \u003d newWidth * newScale / oldScale;\n+\n+        boundingBox.setX1(centerX - (newWidth / 2));\n+        boundingBox.setX2(centerX + (newWidth / 2));\n+        boundingBox.setY1(centerY - (newHeight / 2));\n+        boundingBox.setY2(centerY + (newHeight / 2));\n \n-        map.setInteractionMode(MappingComponent.SELECT);\n-        mappingModel.addLayer(s);\n+        mapProvider.setBoundingBox(boundingBox);\n+\n+        final int mapDPI \u003d Integer.parseInt(NbBundle.getMessage(\n+                    EBReportBean.class,\n+                    \"FEBReportBean.mapDPI\"));\n+\n+        mapProvider.setFeatureResolutionFactor(mapDPI);\n+        try {\n+            mapImage \u003d mapProvider.getImageAndWait(72, mapDPI, mapWidth, mapHeight);\n+        } catch (final Exception ex) {\n+            LOG.error(\"error while creating mapImage\", ex);\n+        }\n+        scale \u003d \"1:\"\n+                    + (NumberFormat.getIntegerInstance().format(newScale));\n     }\n \n     /**"
        },
        {
          "file_name": "src/main/java/de/cismet/cids/custom/reports/verdis/FlaechenReportBean.java",
          "patch": "@@ -29,6 +29,8 @@\n import java.awt.geom.Point2D;\n import java.awt.image.BufferedImage;\n \n+import java.util.ArrayList;\n+import java.util.Collection;\n import java.util.Collections;\n import java.util.Comparator;\n import java.util.LinkedList;\n@@ -41,7 +43,9 @@\n \n import de.cismet.cids.dynamics.CidsBean;\n \n+import de.cismet.cismap.commons.HeadlessMapProvider;\n import de.cismet.cismap.commons.features.DefaultXStyledFeature;\n+import de.cismet.cismap.commons.features.Feature;\n import de.cismet.cismap.commons.gui.MappingComponent;\n import de.cismet.cismap.commons.gui.piccolo.CustomFixedWidthStroke;\n import de.cismet.cismap.commons.gui.piccolo.FeatureAnnotationSymbol;\n@@ -179,7 +183,8 @@ public boolean isReadyToProceed() {\n     }\n \n     @Override\n-    protected void loadFeaturesInMap(final MappingComponent map) {\n+    protected Collection\u003cFeature\u003e createFeatures() {\n+        final Collection\u003cFeature\u003e features \u003d new ArrayList\u003cFeature\u003e();\n         final List\u003cCidsBean\u003e flaechen \u003d (List\u003cCidsBean\u003e)getKassenzeichenBean().getProperty(\n                 KassenzeichenPropertyConstants.PROP__FLAECHEN);\n         final FlaecheFeatureRenderer fr \u003d new FlaecheFeatureRenderer();\n@@ -194,20 +199,19 @@ protected void loadFeaturesInMap(final MappingComponent map) {\n             }\n             final Geometry g \u003d (Geometry)b.getProperty(FlaechePropertyConstants.PROP__FLAECHENINFO + \".\"\n                             + FlaecheninfoPropertyConstants.PROP__GEOMETRIE + \".\" + \"geo_field\");\n-            final String flaechenbez \u003d (String)b.getProperty(FlaechePropertyConstants.PROP__FLAECHENBEZEICHNUNG);\n             final DefaultXStyledFeature dsf \u003d new DefaultXStyledFeature(\n                     null,\n                     \"\",\n                     \"\",\n                     null,\n-                    new CustomFixedWidthStroke(2f, map));\n+                    new CustomFixedWidthStroke(2f));\n             dsf.setGeometry(g);\n             final Color c \u003d (Color)fr.getFillingStyle();\n             final Color c2;\n             c2 \u003d new Color(c.getRed(), c.getGreen(), c.getBlue(), FLAECHE_TRANSPARENCY);\n             dsf.setFillingPaint(c2);\n             dsf.setLinePaint(Color.RED);\n-            map.getFeatureCollection().addFeature(dsf);\n+            features.add(dsf);\n         }\n         for (final CidsBean b : flaechen) {\n             try {\n@@ -226,31 +230,24 @@ protected void loadFeaturesInMap(final MappingComponent map) {\n                         \"\",\n                         \"\",\n                         null,\n-                        new CustomFixedWidthStroke(2f, map));\n+                        new CustomFixedWidthStroke(2f));\n                 dsf.setGeometry(xg);\n+                dsf.setAutoScale(true);\n                 dsf.setPrimaryAnnotation(flaechenbez);\n-                dsf.setPrimaryAnnotationJustification(JLabel.RIGHT_ALIGNMENT);\n+                dsf.setPrimaryAnnotationJustification(JLabel.CENTER_ALIGNMENT);\n                 dsf.setPrimaryAnnotationPaint(Color.decode(\"#1a008b\"));\n+                dsf.setPrimaryAnnotationFont(new Font(\"SansSerif\", Font.PLAIN, (int)((fontSize * 0.5) + 0.5)));\n+\n                 final BufferedImage bi \u003d new BufferedImage(10, 10, BufferedImage.TYPE_INT_ARGB);\n-                // final Graphics2D graphics \u003d (Graphics2D)bi.getGraphics();\n-                // graphics.setColor(Color.orange);\n-                // graphics.fillOval(0, 0, 10, 10);\n                 final FeatureAnnotationSymbol symb \u003d new FeatureAnnotationSymbol(bi);\n                 symb.setSweetSpotX(0.5);\n                 symb.setSweetSpotY(0.5);\n                 dsf.setIconImage(new ImageIcon(bi));\n-                dsf.setAutoScale(true);\n-                dsf.setPrimaryAnnotationFont(new Font(\"SansSerif\", Font.PLAIN, (int)((fontSize * 1.5) + 0.5)));\n                 dsf.setFeatureAnnotationSymbol(symb);\n-                map.getFeatureCollection().addFeature(dsf);\n-\n-                final PNode annotationNode \u003d map.getPFeatureHM().get(dsf).getPrimaryAnnotationNode();\n-                final PBounds bounds \u003d annotationNode.getBounds();\n-                bounds.x \u003d -20;\n-                bounds.y \u003d -20;\n-                annotationNode.setBounds(bounds);\n+                features.add(dsf);\n             }\n         }\n+        return features;\n     }\n \n     //~ Inner Classes ----------------------------------------------------------"
        },
        {
          "file_name": "src/main/java/de/cismet/cids/custom/reports/verdis/FrontenReportBean.java",
          "patch": "@@ -23,6 +23,7 @@\n import java.awt.Color;\n import java.awt.Font;\n \n+import java.util.ArrayList;\n import java.util.Collection;\n import java.util.Collections;\n import java.util.Comparator;\n@@ -33,7 +34,9 @@\n \n import de.cismet.cids.dynamics.CidsBean;\n \n+import de.cismet.cismap.commons.HeadlessMapProvider;\n import de.cismet.cismap.commons.features.DefaultXStyledFeature;\n+import de.cismet.cismap.commons.features.Feature;\n import de.cismet.cismap.commons.gui.MappingComponent;\n import de.cismet.cismap.commons.gui.piccolo.CustomFixedWidthStroke;\n \n@@ -93,7 +96,8 @@ public boolean isReadyToProceed() {\n     }\n \n     @Override\n-    protected void loadFeaturesInMap(final MappingComponent map) {\n+    protected Collection\u003cFeature\u003e createFeatures() {\n+        final Collection\u003cFeature\u003e features \u003d new ArrayList\u003cFeature\u003e();\n         final FrontFeatureRenderer fr \u003d new FrontFeatureRenderer();\n         final Collection\u003cCidsBean\u003e fronten \u003d (List\u003cCidsBean\u003e)getKassenzeichenBean().getProperty(\n                 KassenzeichenPropertyConstants.PROP__FRONTEN);\n@@ -123,15 +127,16 @@ protected void loadFeaturesInMap(final MappingComponent map) {\n                 final Color c2;\n                 c2 \u003d new Color(c.getRed(), c.getGreen(), c.getBlue(), FRONT_TRANSPARENCY);\n                 dsf.setLinePaint(c2);\n-                final CustomFixedWidthStroke ls2 \u003d new CustomFixedWidthStroke(25, map);\n+                final CustomFixedWidthStroke ls2 \u003d new CustomFixedWidthStroke(25);\n                 dsf.setLineSytle(ls2);\n                 dsf.setPrimaryAnnotation(Integer.toString(frontNummer));\n                 dsf.setPrimaryAnnotationPaint(Color.RED);\n                 dsf.setAutoScale(true);\n                 dsf.setPrimaryAnnotationFont(new Font(\"SansSerif\", Font.PLAIN, fontSize));\n-                map.getFeatureCollection().addFeature(dsf);\n+                features.add(dsf);\n             }\n         }\n+        return features;\n     }\n \n     /**"
        },
        {
          "file_name": "src/main/java/de/cismet/verdis/gui/Main.java",
          "patch": "@@ -1818,7 +1818,8 @@ private void initComponents() {\n         jPanel1 \u003d new javax.swing.JPanel();\n         jToolBar1 \u003d new javax.swing.JToolBar();\n         cmdMemory \u003d new javax.swing.JButton();\n-        exceptionNotificationStatusPanel \u003d new de.cismet.tools.gui.exceptionnotification.ExceptionNotificationStatusPanel();\n+        exceptionNotificationStatusPanel \u003d\n+            new de.cismet.tools.gui.exceptionnotification.ExceptionNotificationStatusPanel();\n         tobVerdis \u003d new javax.swing.JToolBar();\n         cmdEditMode \u003d new javax.swing.JButton();\n         cmdCancel \u003d new javax.swing.JButton();\n@@ -1893,47 +1894,59 @@ private void initComponents() {\n         cmdTest.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdTest.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdTest.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdTestActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdTestActionPerformed(evt);\n+                }\n+            });\n \n         cmdTest2.setText(\"Test Clipboard Load\");\n         cmdTest2.setFocusable(false);\n         cmdTest2.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdTest2.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdTest2.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdTest2ActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdTest2ActionPerformed(evt);\n+                }\n+            });\n \n         simpleMemoryMonitoringToolbarWidget1.startTimer();\n \n         setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);\n         setTitle(getTitle());\n         addWindowListener(new java.awt.event.WindowAdapter() {\n-            public void windowOpened(java.awt.event.WindowEvent evt) {\n-                formWindowOpened(evt);\n-            }\n-            public void windowClosing(java.awt.event.WindowEvent evt) {\n-                formWindowClosing(evt);\n-            }\n-            public void windowClosed(java.awt.event.WindowEvent evt) {\n-                formWindowClosed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void windowOpened(final java.awt.event.WindowEvent evt) {\n+                    formWindowOpened(evt);\n+                }\n+                @Override\n+                public void windowClosing(final java.awt.event.WindowEvent evt) {\n+                    formWindowClosing(evt);\n+                }\n+                @Override\n+                public void windowClosed(final java.awt.event.WindowEvent evt) {\n+                    formWindowClosed(evt);\n+                }\n+            });\n         addKeyListener(new java.awt.event.KeyAdapter() {\n-            public void keyTyped(java.awt.event.KeyEvent evt) {\n-                formKeyTyped(evt);\n-            }\n-            public void keyPressed(java.awt.event.KeyEvent evt) {\n-                formKeyPressed(evt);\n-            }\n-            public void keyReleased(java.awt.event.KeyEvent evt) {\n-                formKeyReleased(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void keyTyped(final java.awt.event.KeyEvent evt) {\n+                    formKeyTyped(evt);\n+                }\n+                @Override\n+                public void keyPressed(final java.awt.event.KeyEvent evt) {\n+                    formKeyPressed(evt);\n+                }\n+                @Override\n+                public void keyReleased(final java.awt.event.KeyEvent evt) {\n+                    formKeyReleased(evt);\n+                }\n+            });\n \n         jPanel1.setLayout(new java.awt.GridBagLayout());\n \n@@ -1945,10 +1958,12 @@ public void keyReleased(java.awt.event.KeyEvent evt) {\n         cmdMemory.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdMemory.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdMemory.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdMemoryActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdMemoryActionPerformed(evt);\n+                }\n+            });\n         jToolBar1.add(cmdMemory);\n \n         exceptionNotificationStatusPanel.setMaximumSize(new java.awt.Dimension(34, 34));\n@@ -1969,394 +1984,494 @@ public void actionPerformed(java.awt.event.ActionEvent evt) {\n         tobVerdis.setMinimumSize(new java.awt.Dimension(667, 33));\n         tobVerdis.setPreferredSize(new java.awt.Dimension(691, 35));\n \n-        cmdEditMode.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/editmode.png\"))); // NOI18N\n+        cmdEditMode.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/editmode.png\"))); // NOI18N\n         cmdEditMode.setToolTipText(\"Editormodus\");\n         cmdEditMode.setEnabled(false);\n         cmdEditMode.setFocusPainted(false);\n         cmdEditMode.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdEditModeActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdEditModeActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdEditMode);\n \n-        cmdCancel.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/cancel.png\"))); // NOI18N\n+        cmdCancel.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/cancel.png\"))); // NOI18N\n         cmdCancel.setToolTipText(\"Änderungen abbrechen\");\n         cmdCancel.setFocusPainted(false);\n         cmdCancel.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdCancelActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdCancelActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdCancel);\n \n         cmdOk.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/ok.png\"))); // NOI18N\n         cmdOk.setToolTipText(\"Änderungen annehmen\");\n         cmdOk.setFocusPainted(false);\n         cmdOk.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdOkActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdOkActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdOk);\n \n-        cmdDeleteKassenzeichen.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/deleteKassenzeichen.png\"))); // NOI18N\n+        cmdDeleteKassenzeichen.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/deleteKassenzeichen.png\"))); // NOI18N\n         cmdDeleteKassenzeichen.setToolTipText(\"Kassenzeichen löschen\");\n         cmdDeleteKassenzeichen.setEnabled(false);\n         cmdDeleteKassenzeichen.setFocusPainted(false);\n         cmdDeleteKassenzeichen.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdDeleteKassenzeichenActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdDeleteKassenzeichenActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdDeleteKassenzeichen);\n \n-        cmdNewKassenzeichen.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/newKassenzeichen.png\"))); // NOI18N\n+        cmdNewKassenzeichen.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/newKassenzeichen.png\"))); // NOI18N\n         cmdNewKassenzeichen.setToolTipText(\"Neues Kassenzeichen\");\n         cmdNewKassenzeichen.setFocusPainted(false);\n         cmdNewKassenzeichen.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdNewKassenzeichenActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdNewKassenzeichenActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdNewKassenzeichen);\n \n-        cmdNextKassenzeichenWithoutGeom.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/next_kassenzeichen_without_geometries.png\"))); // NOI18N\n+        cmdNextKassenzeichenWithoutGeom.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\n+                    \"/de/cismet/verdis/res/images/toolbar/next_kassenzeichen_without_geometries.png\"))); // NOI18N\n         cmdNextKassenzeichenWithoutGeom.setToolTipText(\"Nächstes Kassenzeichen ohne allgemeine Geometrien\");\n         cmdNextKassenzeichenWithoutGeom.setFocusable(false);\n         cmdNextKassenzeichenWithoutGeom.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdNextKassenzeichenWithoutGeom.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdNextKassenzeichenWithoutGeom.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdNextKassenzeichenWithoutGeomActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdNextKassenzeichenWithoutGeomActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdNextKassenzeichenWithoutGeom);\n \n-        cmdSAPCheck.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/goto_kassenzeichen_sap.png\"))); // NOI18N\n+        cmdSAPCheck.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/goto_kassenzeichen_sap.png\")));          // NOI18N\n         cmdSAPCheck.setToolTipText(\"SAP Check\");\n         cmdSAPCheck.setContentAreaFilled(false);\n         cmdSAPCheck.setFocusable(false);\n         cmdSAPCheck.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n-        cmdSAPCheck.setSelectedIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/goto_kassenzeichen_sap_selected.png\"))); // NOI18N\n+        cmdSAPCheck.setSelectedIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/goto_kassenzeichen_sap_selected.png\"))); // NOI18N\n         cmdSAPCheck.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdSAPCheck.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdSAPCheckActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdSAPCheckActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdSAPCheck);\n \n         jSeparator6.setOrientation(javax.swing.SwingConstants.VERTICAL);\n         jSeparator6.setMaximumSize(new java.awt.Dimension(2, 32767));\n         tobVerdis.add(jSeparator6);\n \n-        cmdCut.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/cutFl.png\"))); // NOI18N\n+        cmdCut.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/cutFl.png\"))); // NOI18N\n         cmdCut.setToolTipText(\"Fläche ausschneiden\");\n         cmdCut.setEnabled(false);\n         cmdCut.setFocusPainted(false);\n         cmdCut.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdCutActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdCutActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdCut);\n \n-        cmdCopy.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/copyFl.png\"))); // NOI18N\n+        cmdCopy.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/copyFl.png\"))); // NOI18N\n         cmdCopy.setToolTipText(\"Fläche kopieren (Teileigentum erzeugen)\");\n         cmdCopy.setEnabled(false);\n         cmdCopy.setFocusPainted(false);\n         cmdCopy.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdCopyActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdCopyActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdCopy);\n \n-        cmdPaste.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/pasteFl.png\"))); // NOI18N\n+        cmdPaste.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/pasteFl.png\"))); // NOI18N\n         cmdPaste.setToolTipText(\"Fläche einfügen\");\n         cmdPaste.setEnabled(false);\n         cmdPaste.setFocusPainted(false);\n         cmdPaste.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdPasteActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdPasteActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdPaste);\n \n         jSeparator4.setOrientation(javax.swing.SwingConstants.VERTICAL);\n         jSeparator4.setMaximumSize(new java.awt.Dimension(2, 32767));\n         tobVerdis.add(jSeparator4);\n \n-        cmdRefreshEnumeration.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/refreshEnum.png\"))); // NOI18N\n+        cmdRefreshEnumeration.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/refreshEnum.png\"))); // NOI18N\n         cmdRefreshEnumeration.setToolTipText(\"Alle Flächen neu nummerieren\");\n         cmdRefreshEnumeration.setEnabled(false);\n         cmdRefreshEnumeration.setFocusPainted(false);\n         cmdRefreshEnumeration.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdRefreshEnumerationActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdRefreshEnumerationActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdRefreshEnumeration);\n \n-        cmdRecalculateArea.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/recalculateArea.png\"))); // NOI18N\n+        cmdRecalculateArea.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/recalculateArea.png\"))); // NOI18N\n         cmdRecalculateArea.setToolTipText(\"Neuberechnung der Flächen\");\n         cmdRecalculateArea.setFocusPainted(false);\n         cmdRecalculateArea.setFocusable(false);\n         cmdRecalculateArea.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdRecalculateArea.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdRecalculateArea.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdRecalculateAreaActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdRecalculateAreaActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdRecalculateArea);\n         tobVerdis.add(jSeparator12);\n \n         jSeparator7.setOrientation(javax.swing.SwingConstants.VERTICAL);\n         jSeparator7.setMaximumSize(new java.awt.Dimension(2, 32767));\n         tobVerdis.add(jSeparator7);\n \n-        cmdAdd.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/add.png\"))); // NOI18N\n+        cmdAdd.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/add.png\")));  // NOI18N\n         cmdAdd.setEnabled(false);\n         cmdAdd.setFocusable(false);\n         cmdAdd.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n-        cmdAdd.setRolloverIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/add2.png\"))); // NOI18N\n+        cmdAdd.setRolloverIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/add2.png\"))); // NOI18N\n         cmdAdd.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdAdd.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdAddActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdAddActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdAdd);\n \n-        cmdRemove.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/remove.png\"))); // NOI18N\n+        cmdRemove.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/remove.png\")));  // NOI18N\n         cmdRemove.setEnabled(false);\n         cmdRemove.setFocusable(false);\n         cmdRemove.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n-        cmdRemove.setRolloverIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/remove2.png\"))); // NOI18N\n+        cmdRemove.setRolloverIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/remove2.png\"))); // NOI18N\n         cmdRemove.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdRemove.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdRemoveActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdRemoveActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdRemove);\n \n-        cmdUndo.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/undo.png\"))); // NOI18N\n+        cmdUndo.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/undo.png\")));  // NOI18N\n         cmdUndo.setEnabled(false);\n         cmdUndo.setFocusable(false);\n         cmdUndo.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n-        cmdUndo.setRolloverIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/undo2.png\"))); // NOI18N\n+        cmdUndo.setRolloverIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/undo2.png\"))); // NOI18N\n         cmdUndo.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdUndo.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdUndoActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdUndoActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdUndo);\n         tobVerdis.add(jSeparator13);\n \n-        cmdPdf.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/pdf.png\"))); // NOI18N\n+        cmdPdf.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/pdf.png\"))); // NOI18N\n         cmdPdf.setToolTipText(\"Drucken\");\n         cmdPdf.setFocusPainted(false);\n         cmdPdf.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdPdfActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdPdfActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdPdf);\n \n-        cmdWorkflow.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/workflow.png\"))); // NOI18N\n+        cmdWorkflow.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/workflow.png\"))); // NOI18N\n         cmdWorkflow.setToolTipText(\"Workflow\");\n         cmdWorkflow.setEnabled(false);\n         cmdWorkflow.setFocusPainted(false);\n         cmdWorkflow.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdWorkflowActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdWorkflowActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdWorkflow);\n \n         jSeparator3.setOrientation(javax.swing.SwingConstants.VERTICAL);\n         jSeparator3.setMaximumSize(new java.awt.Dimension(2, 32767));\n         tobVerdis.add(jSeparator3);\n \n-        cmdInfo.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/info.png\"))); // NOI18N\n+        cmdInfo.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/info.png\"))); // NOI18N\n         cmdInfo.setToolTipText(\"Versionsanzeige\");\n         cmdInfo.setFocusPainted(false);\n         cmdInfo.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdInfoActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdInfoActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdInfo);\n \n         jSeparator8.setOrientation(javax.swing.SwingConstants.VERTICAL);\n         jSeparator8.setMaximumSize(new java.awt.Dimension(2, 32767));\n         tobVerdis.add(jSeparator8);\n \n-        cmdLagisCrossover.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/lagisCrossover.png\"))); // NOI18N\n+        cmdLagisCrossover.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/lagisCrossover.png\"))); // NOI18N\n         cmdLagisCrossover.setToolTipText(\"Öffne zugehöriges Flurstück in LagIS\");\n         cmdLagisCrossover.setFocusPainted(false);\n         cmdLagisCrossover.setFocusable(false);\n         cmdLagisCrossover.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdLagisCrossover.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdLagisCrossover.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdLagisCrossoverActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdLagisCrossoverActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdLagisCrossover);\n \n-        btnHistory.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/history.png\"))); // NOI18N\n+        btnHistory.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/history.png\"))); // NOI18N\n         btnHistory.setToolTipText(\"öffne Kassenzeichen-Verlauf\");\n         btnHistory.setFocusPainted(false);\n         btnHistory.setFocusable(false);\n         btnHistory.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         btnHistory.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         btnHistory.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                btnHistoryActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    btnHistoryActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(btnHistory);\n \n-        btnTimeRecovery.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/recovery.png\"))); // NOI18N\n+        btnTimeRecovery.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/recovery.png\"))); // NOI18N\n         btnTimeRecovery.setToolTipText(\"Kassenzeichen-Wiederherstellung\");\n         btnTimeRecovery.setFocusPainted(false);\n         btnTimeRecovery.setFocusable(false);\n         btnTimeRecovery.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         btnTimeRecovery.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         btnTimeRecovery.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                btnTimeRecoveryActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    btnTimeRecoveryActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(btnTimeRecovery);\n         try {\n-            btnTimeRecovery.setVisible(SessionManager.getConnection().getConfigAttr(SessionManager.getSession().getUser(), \"grundis.timerecovery.dialog\") !\u003d null);\n+            btnTimeRecovery.setVisible(SessionManager.getConnection().getConfigAttr(\n+                    SessionManager.getSession().getUser(),\n+                    \"grundis.timerecovery.dialog\") !\u003d null);\n         } catch (final Exception ex) {\n             LOG.error(\"error while checking for grundis.timerecovery.dialog\", ex);\n             btnTimeRecovery.setVisible(false);\n         }\n \n         cmdDownloads.setAction(new DownloadManagerAction(this));\n-        cmdDownloads.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/download.png\"))); // NOI18N\n+        cmdDownloads.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/download.png\"))); // NOI18N\n         cmdDownloads.setFocusPainted(false);\n         cmdDownloads.setFocusable(false);\n         cmdDownloads.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdDownloads.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         tobVerdis.add(cmdDownloads);\n \n-        cmdFortfuehrung.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/fortfuehrung.png\"))); // NOI18N\n+        cmdFortfuehrung.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/fortfuehrung.png\"))); // NOI18N\n         cmdFortfuehrung.setToolTipText(\"Fortführung\");\n         cmdFortfuehrung.setFocusable(false);\n         cmdFortfuehrung.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdFortfuehrung.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdFortfuehrung.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdFortfuehrungActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdFortfuehrungActionPerformed(evt);\n+                }\n+            });\n         try {\n-            cmdFortfuehrung.setVisible(SessionManager.getConnection().getConfigAttr(SessionManager.getSession().getUser(), \"grundis.fortfuehrungsanlaesse.dialog\") !\u003d null);\n+            cmdFortfuehrung.setVisible(SessionManager.getConnection().getConfigAttr(\n+                    SessionManager.getSession().getUser(),\n+                    \"grundis.fortfuehrungsanlaesse.dialog\") !\u003d null);\n         } catch (final Exception ex) {\n             LOG.error(\"error while checking for grundis.fortfuehrungsanlaesse.dialog\", ex);\n             cmdFortfuehrung.setVisible(false);\n         }\n         tobVerdis.add(cmdFortfuehrung);\n \n-        cmdGrundbuchblattSuche.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/BPlan.png\"))); // NOI18N\n+        cmdGrundbuchblattSuche.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/BPlan.png\"))); // NOI18N\n         cmdGrundbuchblattSuche.setToolTipText(\"Kassenzeichensuche über Buchungsblatt\");\n         cmdGrundbuchblattSuche.setFocusPainted(false);\n         cmdGrundbuchblattSuche.setFocusable(false);\n         cmdGrundbuchblattSuche.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdGrundbuchblattSuche.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdGrundbuchblattSuche.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdGrundbuchblattSucheActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdGrundbuchblattSucheActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdGrundbuchblattSuche);\n \n-        cmdArbeitspakete.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/workdone.png\"))); // NOI18N\n+        cmdArbeitspakete.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/workdone.png\"))); // NOI18N\n         cmdArbeitspakete.setToolTipText(\"Arbeitspakete verwalten\");\n         cmdArbeitspakete.setFocusable(false);\n         cmdArbeitspakete.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdArbeitspakete.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdArbeitspakete.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdArbeitspaketeActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdArbeitspaketeActionPerformed(evt);\n+                }\n+            });\n         try {\n-            cmdFortfuehrung.setVisible(SessionManager.getConnection().getConfigAttr(SessionManager.getSession().getUser(), \"grundis.fortfuehrungsanlaesse.dialog\") !\u003d null);\n+            cmdFortfuehrung.setVisible(SessionManager.getConnection().getConfigAttr(\n+                    SessionManager.getSession().getUser(),\n+                    \"grundis.fortfuehrungsanlaesse.dialog\") !\u003d null);\n         } catch (final Exception ex) {\n             LOG.error(\"error while checking for grundis.fortfuehrungsanlaesse.dialog\", ex);\n             cmdFortfuehrung.setVisible(false);\n         }\n         tobVerdis.add(cmdArbeitspakete);\n         try {\n-            cmdArbeitspakete.setVisible(SessionManager.getConnection().getConfigAttr(SessionManager.getSession().getUser(), \"grundis.arbeitspaketemanager.dialog\") !\u003d null);\n+            cmdArbeitspakete.setVisible(SessionManager.getConnection().getConfigAttr(\n+                    SessionManager.getSession().getUser(),\n+                    \"grundis.arbeitspaketemanager.dialog\") !\u003d null);\n         } catch (final Exception ex) {\n             LOG.error(\"error while checking for grundis.fortfuehrungsanlaesse.dialog\", ex);\n             cmdArbeitspakete.setVisible(false);\n         }\n \n-        cmdAbfrageeditor.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/gui/table-export.png\"))); // NOI18N\n+        cmdAbfrageeditor.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/gui/table-export.png\"))); // NOI18N\n         cmdAbfrageeditor.setToolTipText(\"Abfragen-Export (nach CSV)\");\n         cmdAbfrageeditor.setFocusable(false);\n         cmdAbfrageeditor.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdAbfrageeditor.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdAbfrageeditor.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdAbfrageeditorActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdAbfrageeditorActionPerformed(evt);\n+                }\n+            });\n         try {\n-            cmdFortfuehrung.setVisible(SessionManager.getConnection().getConfigAttr(SessionManager.getSession().getUser(), \"grundis.fortfuehrungsanlaesse.dialog\") !\u003d null);\n+            cmdFortfuehrung.setVisible(SessionManager.getConnection().getConfigAttr(\n+                    SessionManager.getSession().getUser(),\n+                    \"grundis.fortfuehrungsanlaesse.dialog\") !\u003d null);\n         } catch (final Exception ex) {\n             LOG.error(\"error while checking for grundis.abfragennachcsv.dialog\", ex);\n             cmdFortfuehrung.setVisible(false);\n         }\n         tobVerdis.add(cmdAbfrageeditor);\n         try {\n-            cmdAbfrageeditor.setVisible(SessionManager.getConnection().getConfigAttr(SessionManager.getSession().getUser(), \"grundis.arbeitspaketemanager.dialog\") !\u003d null);\n+            cmdAbfrageeditor.setVisible(SessionManager.getConnection().getConfigAttr(\n+                    SessionManager.getSession().getUser(),\n+                    \"grundis.arbeitspaketemanager.dialog\") !\u003d null);\n         } catch (final Exception ex) {\n             LOG.error(\"error while checking for grundis.abfragennachcsv.dialog\", ex);\n             cmdAbfrageeditor.setVisible(false);\n         }\n \n-        cmdVeranlagungsdatei.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/gui/reports-stack.png\"))); // NOI18N\n+        cmdVeranlagungsdatei.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/gui/reports-stack.png\"))); // NOI18N\n         cmdVeranlagungsdatei.setToolTipText(\"Erzeugung Veranlagungsdatei planen\");\n         cmdVeranlagungsdatei.setFocusable(false);\n         cmdVeranlagungsdatei.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdVeranlagungsdatei.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdVeranlagungsdatei.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdVeranlagungsdateiActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdVeranlagungsdateiActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdVeranlagungsdatei);\n         try {\n-            cmdVeranlagungsdatei.setVisible(SessionManager.getConnection().getConfigAttr(SessionManager.getSession().getUser(), \"csa://veranlagungsdatei\") !\u003d null);\n+            cmdVeranlagungsdatei.setVisible(SessionManager.getConnection().getConfigAttr(\n+                    SessionManager.getSession().getUser(),\n+                    \"csa://veranlagungsdatei\") !\u003d null);\n         } catch (final Exception ex) {\n             LOG.error(\"error while checking for csa://veranlagungsdatei\", ex);\n             cmdVeranlagungsdatei.setVisible(false);\n         }\n \n-        cmdOpenInD3.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/d.3.png\"))); // NOI18N\n+        cmdOpenInD3.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/toolbar/d.3.png\"))); // NOI18N\n         cmdOpenInD3.setToolTipText(\"in d.3 öffnen\");\n         cmdOpenInD3.setFocusPainted(false);\n         cmdOpenInD3.setFocusable(false);\n         cmdOpenInD3.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);\n         cmdOpenInD3.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);\n         cmdOpenInD3.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cmdOpenInD3ActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    cmdOpenInD3ActionPerformed(evt);\n+                }\n+            });\n         tobVerdis.add(cmdOpenInD3);\n \n         gridBagConstraints \u003d new java.awt.GridBagConstraints();\n@@ -2376,34 +2491,48 @@ public void actionPerformed(java.awt.event.ActionEvent evt) {\n         menFile.setText(\"Datei\");\n         menFile.add(jSeparator9);\n \n-        mniSaveLayout.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_S, java.awt.event.InputEvent.CTRL_MASK));\n-        mniSaveLayout.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/layout.png\"))); // NOI18N\n+        mniSaveLayout.setAccelerator(javax.swing.KeyStroke.getKeyStroke(\n+                java.awt.event.KeyEvent.VK_S,\n+                java.awt.event.InputEvent.CTRL_MASK));\n+        mniSaveLayout.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/layout.png\"))); // NOI18N\n         mniSaveLayout.setText(\"Aktuelles Layout speichern\");\n         mniSaveLayout.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mniSaveLayoutActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mniSaveLayoutActionPerformed(evt);\n+                }\n+            });\n         menFile.add(mniSaveLayout);\n \n-        mniLoadLayout.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_O, java.awt.event.InputEvent.CTRL_MASK));\n-        mniLoadLayout.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/layout.png\"))); // NOI18N\n+        mniLoadLayout.setAccelerator(javax.swing.KeyStroke.getKeyStroke(\n+                java.awt.event.KeyEvent.VK_O,\n+                java.awt.event.InputEvent.CTRL_MASK));\n+        mniLoadLayout.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/layout.png\"))); // NOI18N\n         mniLoadLayout.setText(\"Layout laden\");\n         mniLoadLayout.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mniLoadLayoutActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mniLoadLayoutActionPerformed(evt);\n+                }\n+            });\n         menFile.add(mniLoadLayout);\n         menFile.add(jSeparator10);\n \n-        mniClose.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_F4, java.awt.event.InputEvent.ALT_MASK));\n+        mniClose.setAccelerator(javax.swing.KeyStroke.getKeyStroke(\n+                java.awt.event.KeyEvent.VK_F4,\n+                java.awt.event.InputEvent.ALT_MASK));\n         mniClose.setText(\"Beenden\");\n         mniClose.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mnuExitActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mnuExitActionPerformed(evt);\n+                }\n+            });\n         menFile.add(mniClose);\n \n         jMenuBar1.add(menFile);\n@@ -2412,165 +2541,222 @@ public void actionPerformed(java.awt.event.ActionEvent evt) {\n \n         mnuEditMode.setText(\"In den Editormodus wechseln\");\n         mnuEditMode.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mnuEditModeActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mnuEditModeActionPerformed(evt);\n+                }\n+            });\n         menEdit.add(mnuEditMode);\n \n         mnuNewKassenzeichen.setText(\"Neues Kassenzeichen\");\n         mnuNewKassenzeichen.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mnuNewKassenzeichenActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mnuNewKassenzeichenActionPerformed(evt);\n+                }\n+            });\n         menEdit.add(mnuNewKassenzeichen);\n \n         mnuRenameCurrentKZ.setText(\"Aktuelles Kassenzeichen umbenennen\");\n         mnuRenameCurrentKZ.setEnabled(false);\n         mnuRenameCurrentKZ.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mnuRenameCurrentKZActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mnuRenameCurrentKZActionPerformed(evt);\n+                }\n+            });\n         menEdit.add(mnuRenameCurrentKZ);\n \n         mnuRenameAnyKZ.setText(\"Beliebiges Kassenzeichen umbenennen\");\n         mnuRenameAnyKZ.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mnuRenameAnyKZActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mnuRenameAnyKZActionPerformed(evt);\n+                }\n+            });\n         menEdit.add(mnuRenameAnyKZ);\n \n         jMenuBar1.add(menEdit);\n \n         menExtras.setMnemonic(\u0027E\u0027);\n         menExtras.setText(\"Extras\");\n \n-        mniOptions.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/tooloptions.png\"))); // NOI18N\n+        mniOptions.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/tooloptions.png\"))); // NOI18N\n         mniOptions.setText(\"Optionen\");\n         mniOptions.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mniOptionsActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mniOptionsActionPerformed(evt);\n+                }\n+            });\n         menExtras.add(mniOptions);\n         menExtras.add(sepOptions);\n \n         mnuChangeUser.setText(\"User wechseln\");\n         mnuChangeUser.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mnuChangeUserActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mnuChangeUserActionPerformed(evt);\n+                }\n+            });\n         menExtras.add(mnuChangeUser);\n \n         jMenuItem1.setText(\"WindowManagementTool\");\n         jMenuItem1.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                jMenuItem1ActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    jMenuItem1ActionPerformed(evt);\n+                }\n+            });\n         menExtras.add(jMenuItem1);\n \n         jMenuBar1.add(menExtras);\n \n         menWindows.setMnemonic(\u0027F\u0027);\n         menWindows.setText(\"Fenster\");\n         menWindows.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                menWindowsActionPerformed(evt);\n-            }\n-        });\n \n-        mniKassenzeichen.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_1, java.awt.event.InputEvent.CTRL_MASK));\n-        mniKassenzeichen.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/kassenzeichen.png\"))); // NOI18N\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    menWindowsActionPerformed(evt);\n+                }\n+            });\n+\n+        mniKassenzeichen.setAccelerator(javax.swing.KeyStroke.getKeyStroke(\n+                java.awt.event.KeyEvent.VK_1,\n+                java.awt.event.InputEvent.CTRL_MASK));\n+        mniKassenzeichen.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/kassenzeichen.png\"))); // NOI18N\n         mniKassenzeichen.setMnemonic(\u0027L\u0027);\n         mniKassenzeichen.setText(\"Kassenzeichen\");\n         mniKassenzeichen.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mniKassenzeichenActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mniKassenzeichenActionPerformed(evt);\n+                }\n+            });\n         menWindows.add(mniKassenzeichen);\n \n-        mniKassenzeichen1.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_2, java.awt.event.InputEvent.CTRL_MASK));\n-        mniKassenzeichen1.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/kassenzeichen.png\"))); // NOI18N\n+        mniKassenzeichen1.setAccelerator(javax.swing.KeyStroke.getKeyStroke(\n+                java.awt.event.KeyEvent.VK_2,\n+                java.awt.event.InputEvent.CTRL_MASK));\n+        mniKassenzeichen1.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/kassenzeichen.png\"))); // NOI18N\n         mniKassenzeichen1.setMnemonic(\u0027L\u0027);\n         mniKassenzeichen1.setText(\"Kassenzeichen-Liste\");\n         mniKassenzeichen1.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mniKassenzeichen1ActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mniKassenzeichen1ActionPerformed(evt);\n+                }\n+            });\n         menWindows.add(mniKassenzeichen1);\n \n-        mniSummen.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_3, java.awt.event.InputEvent.CTRL_MASK));\n-        mniSummen.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/sum.png\"))); // NOI18N\n+        mniSummen.setAccelerator(javax.swing.KeyStroke.getKeyStroke(\n+                java.awt.event.KeyEvent.VK_3,\n+                java.awt.event.InputEvent.CTRL_MASK));\n+        mniSummen.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/sum.png\"))); // NOI18N\n         mniSummen.setMnemonic(\u0027C\u0027);\n         mniSummen.setText(\"Summen\");\n         mniSummen.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mniSummenActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mniSummenActionPerformed(evt);\n+                }\n+            });\n         menWindows.add(mniSummen);\n \n-        mniKanalanschluss.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_4, java.awt.event.InputEvent.CTRL_MASK));\n-        mniKanalanschluss.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/pipe.png\"))); // NOI18N\n+        mniKanalanschluss.setAccelerator(javax.swing.KeyStroke.getKeyStroke(\n+                java.awt.event.KeyEvent.VK_4,\n+                java.awt.event.InputEvent.CTRL_MASK));\n+        mniKanalanschluss.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/pipe.png\"))); // NOI18N\n         mniKanalanschluss.setMnemonic(\u0027F\u0027);\n         mniKanalanschluss.setText(\"Kanalanschluss\");\n         mniKanalanschluss.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mniKanalanschlussActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mniKanalanschlussActionPerformed(evt);\n+                }\n+            });\n         menWindows.add(mniKanalanschluss);\n         menWindows.add(jSeparator11);\n \n-        mniKarte.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_7, java.awt.event.InputEvent.CTRL_MASK));\n-        mniKarte.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/flaechen.png\"))); // NOI18N\n+        mniKarte.setAccelerator(javax.swing.KeyStroke.getKeyStroke(\n+                java.awt.event.KeyEvent.VK_7,\n+                java.awt.event.InputEvent.CTRL_MASK));\n+        mniKarte.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/flaechen.png\"))); // NOI18N\n         mniKarte.setMnemonic(\u0027S\u0027);\n         mniKarte.setText(\"Karte\");\n         mniKarte.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mniKarteActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mniKarteActionPerformed(evt);\n+                }\n+            });\n         menWindows.add(mniKarte);\n \n-        mniTabelle.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_8, java.awt.event.InputEvent.CTRL_MASK));\n-        mniTabelle.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/flaechen.png\"))); // NOI18N\n+        mniTabelle.setAccelerator(javax.swing.KeyStroke.getKeyStroke(\n+                java.awt.event.KeyEvent.VK_8,\n+                java.awt.event.InputEvent.CTRL_MASK));\n+        mniTabelle.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/flaechen.png\"))); // NOI18N\n         mniTabelle.setMnemonic(\u0027T\u0027);\n         mniTabelle.setText(\"Tabellenansicht\");\n         mniTabelle.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mniTabelleActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mniTabelleActionPerformed(evt);\n+                }\n+            });\n         menWindows.add(mniTabelle);\n \n-        mniDetails.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_9, java.awt.event.InputEvent.CTRL_MASK));\n-        mniDetails.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/flaechen.png\"))); // NOI18N\n+        mniDetails.setAccelerator(javax.swing.KeyStroke.getKeyStroke(\n+                java.awt.event.KeyEvent.VK_9,\n+                java.awt.event.InputEvent.CTRL_MASK));\n+        mniDetails.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/flaechen.png\"))); // NOI18N\n         mniDetails.setMnemonic(\u0027D\u0027);\n         mniDetails.setText(\"Details\");\n         mniDetails.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mniDetailsActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mniDetailsActionPerformed(evt);\n+                }\n+            });\n         menWindows.add(mniDetails);\n \n-        mniResetWindowLayout.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_R, java.awt.event.InputEvent.CTRL_MASK));\n-        mniResetWindowLayout.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/layout.png\"))); // NOI18N\n+        mniResetWindowLayout.setAccelerator(javax.swing.KeyStroke.getKeyStroke(\n+                java.awt.event.KeyEvent.VK_R,\n+                java.awt.event.InputEvent.CTRL_MASK));\n+        mniResetWindowLayout.setIcon(new javax.swing.ImageIcon(\n+                getClass().getResource(\"/de/cismet/verdis/res/images/titlebars/layout.png\"))); // NOI18N\n         mniResetWindowLayout.setText(\"Fensteranordnung zurücksetzen\");\n         mniResetWindowLayout.setToolTipText(\"Standard Fensteranordnung wiederherstellen\");\n         mniResetWindowLayout.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mniResetWindowLayoutActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mniResetWindowLayoutActionPerformed(evt);\n+                }\n+            });\n         menWindows.add(mniResetWindowLayout);\n \n         jMenuBar1.add(menWindows);\n@@ -2586,10 +2772,12 @@ public void actionPerformed(java.awt.event.ActionEvent evt) {\n         mnuInfo.setMnemonic(\u0027I\u0027);\n         mnuInfo.setText(\"Info\");\n         mnuInfo.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                mnuInfoActionPerformed(evt);\n-            }\n-        });\n+\n+                @Override\n+                public void actionPerformed(final java.awt.event.ActionEvent evt) {\n+                    mnuInfoActionPerformed(evt);\n+                }\n+            });\n         menHelp.add(mnuInfo);\n \n         jMenuBar1.add(menHelp);\n@@ -2598,59 +2786,59 @@ public void actionPerformed(java.awt.event.ActionEvent evt) {\n \n         setSize(new java.awt.Dimension(1261, 868));\n         setLocationRelativeTo(null);\n-    }// \u003c/editor-fold\u003e//GEN-END:initComponents\n+    } // \u003c/editor-fold\u003e//GEN-END:initComponents\n \n     /**\n      * Inserting Docking Window functionalty (Sebastian) 24.07.07.\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void menWindowsActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_menWindowsActionPerformed\n+    private void menWindowsActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_menWindowsActionPerformed\n // TODO add your handling code here:\n-    }//GEN-LAST:event_menWindowsActionPerformed\n+    } //GEN-LAST:event_menWindowsActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mniResetWindowLayoutActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mniResetWindowLayoutActionPerformed\n+    private void mniResetWindowLayoutActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mniResetWindowLayoutActionPerformed\n         setupDefaultLayout();\n-    }//GEN-LAST:event_mniResetWindowLayoutActionPerformed\n+    }                                                                                        //GEN-LAST:event_mniResetWindowLayoutActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mniKanalanschlussActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mniKanalanschlussActionPerformed\n+    private void mniKanalanschlussActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mniKanalanschlussActionPerformed\n         showOrHideView(vKanaldaten);\n-    }//GEN-LAST:event_mniKanalanschlussActionPerformed\n+    }                                                                                     //GEN-LAST:event_mniKanalanschlussActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mniSummenActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mniSummenActionPerformed\n+    private void mniSummenActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mniSummenActionPerformed\n         showOrHideView(vSummen);\n-    }//GEN-LAST:event_mniSummenActionPerformed\n+    }                                                                             //GEN-LAST:event_mniSummenActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mniKassenzeichenActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mniKassenzeichenActionPerformed\n+    private void mniKassenzeichenActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mniKassenzeichenActionPerformed\n         showOrHideView(vKassenzeichen);\n-    }//GEN-LAST:event_mniKassenzeichenActionPerformed\n+    }                                                                                    //GEN-LAST:event_mniKassenzeichenActionPerformed\n \n     /**\n      * Inserting Docking Window functionalty (Sebastian) 24.07.07.\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mniLoadLayoutActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mniLoadLayoutActionPerformed\n+    private void mniLoadLayoutActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mniLoadLayoutActionPerformed\n         final JFileChooser fc \u003d new JFileChooser(DIRECTORYPATH_VERDIS);\n         fc.setFileFilter(new FileFilter() {\n \n@@ -2686,14 +2874,14 @@ public String getDescription() {\n                 LOG.error(\"error while loading layout\", ex);\n             }\n         }\n-    }//GEN-LAST:event_mniLoadLayoutActionPerformed\n+    } //GEN-LAST:event_mniLoadLayoutActionPerformed\n \n     /**\n      * Inserting Docking Window functionalty (Sebastian) 24.07.07.\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mniSaveLayoutActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mniSaveLayoutActionPerformed\n+    private void mniSaveLayoutActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mniSaveLayoutActionPerformed\n         final JFileChooser fc \u003d new JFileChooser(DIRECTORYPATH_VERDIS);\n         fc.setFileFilter(new FileFilter() {\n \n@@ -2725,7 +2913,7 @@ public String getDescription() {\n                 saveLayout(name + \".layout\");\n             }\n         }\n-    }//GEN-LAST:event_mniSaveLayoutActionPerformed\n+    } //GEN-LAST:event_mniSaveLayoutActionPerformed\n \n     /**\n      * TODO Bundle Inserting Docking Window functionalty (Sebastian) 24.07.07.\n@@ -2884,44 +3072,44 @@ public void setKanalTitleForeground(final Color foreground) {\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mnuChangeUserActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mnuChangeUserActionPerformed\n+    private void mnuChangeUserActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mnuChangeUserActionPerformed\n         formWindowOpened(null);\n-    }//GEN-LAST:event_mnuChangeUserActionPerformed\n+    }                                                                                 //GEN-LAST:event_mnuChangeUserActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mnuNewKassenzeichenActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mnuNewKassenzeichenActionPerformed\n+    private void mnuNewKassenzeichenActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mnuNewKassenzeichenActionPerformed\n         cmdNewKassenzeichenActionPerformed(null);\n-    }//GEN-LAST:event_mnuNewKassenzeichenActionPerformed\n+    }                                                                                       //GEN-LAST:event_mnuNewKassenzeichenActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mnuEditModeActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mnuEditModeActionPerformed\n+    private void mnuEditModeActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mnuEditModeActionPerformed\n         cmdEditModeActionPerformed(null);\n-    }//GEN-LAST:event_mnuEditModeActionPerformed\n+    }                                                                               //GEN-LAST:event_mnuEditModeActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mnuExitActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mnuExitActionPerformed\n+    private void mnuExitActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mnuExitActionPerformed\n         dispose();\n-    }//GEN-LAST:event_mnuExitActionPerformed\n+    }                                                                           //GEN-LAST:event_mnuExitActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void formWindowOpened(final java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowOpened\n-    }//GEN-LAST:event_formWindowOpened\n+    private void formWindowOpened(final java.awt.event.WindowEvent evt) { //GEN-FIRST:event_formWindowOpened\n+    }                                                                     //GEN-LAST:event_formWindowOpened\n \n     /**\n      * DOCUMENT ME!\n@@ -3004,16 +3192,16 @@ private static boolean handleLoginStatus(final JXLoginPane.Status status,\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdRefreshEnumerationActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdRefreshEnumerationActionPerformed\n+    private void cmdRefreshEnumerationActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdRefreshEnumerationActionPerformed\n         regenFlaechenTabellenPanel.reEnumerateFlaechen();\n-    }//GEN-LAST:event_cmdRefreshEnumerationActionPerformed\n+    }                                                                                         //GEN-LAST:event_cmdRefreshEnumerationActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdPdfActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdPdfActionPerformed\n+    private void cmdPdfActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdPdfActionPerformed\n         if (kassenzeichenBean !\u003d null) {\n             final EBGeneratorDialog.Mode ebMode;\n             if (CidsAppBackend.Mode.SR.equals(CidsAppBackend.getInstance().getMode())) {\n@@ -3031,29 +3219,29 @@ public void run() {\n                     }\n                 });\n         }\n-    }//GEN-LAST:event_cmdPdfActionPerformed\n+    } //GEN-LAST:event_cmdPdfActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdDeleteKassenzeichenActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdDeleteKassenzeichenActionPerformed\n+    private void cmdDeleteKassenzeichenActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdDeleteKassenzeichenActionPerformed\n         deleteKassenzeichen();\n-    }//GEN-LAST:event_cmdDeleteKassenzeichenActionPerformed\n+    }                                                                                          //GEN-LAST:event_cmdDeleteKassenzeichenActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdPasteActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdPasteActionPerformed\n+    private void cmdPasteActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdPasteActionPerformed\n         final AbstractClipboard clipboard \u003d getCurrentClipboard();\n         if (clipboard !\u003d null) {\n             clipboard.storeToFile();\n             clipboard.paste();\n         }\n-    }//GEN-LAST:event_cmdPasteActionPerformed\n+    }                                                                            //GEN-LAST:event_cmdPasteActionPerformed\n \n     /**\n      * DOCUMENT ME!\n@@ -3069,19 +3257,19 @@ public AbstractClipboard getCurrentClipboard() {\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdCutActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdCutActionPerformed\n+    private void cmdCutActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdCutActionPerformed\n         final AbstractClipboard clipboard \u003d getCurrentClipboard();\n         if (clipboard !\u003d null) {\n             clipboard.cut();\n         }\n-    }//GEN-LAST:event_cmdCutActionPerformed\n+    }                                                                          //GEN-LAST:event_cmdCutActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DCUMENT ME!\n      */\n-    private void cmdInfoActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdInfoActionPerformed\n+    private void cmdInfoActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdInfoActionPerformed\n //        String info\u003d\"Verdis Plugin\\n\"\n //                + \"cismet GmbH\\n\\n\"\n //                + de.cismet.verdis.Version.getVersion()+\"\\n\"\n@@ -3105,60 +3293,60 @@ private void cmdInfoActionPerformed(final java.awt.event.ActionEvent evt) {//GEN\n             about \u003d d;\n         }\n         StaticSwingTools.showDialog(about);\n-    }//GEN-LAST:event_cmdInfoActionPerformed\n+    } //GEN-LAST:event_cmdInfoActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mnuInfoActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mnuInfoActionPerformed\n+    private void mnuInfoActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mnuInfoActionPerformed\n         cmdInfoActionPerformed(null);\n-    }//GEN-LAST:event_mnuInfoActionPerformed\n+    }                                                                           //GEN-LAST:event_mnuInfoActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void formKeyReleased(final java.awt.event.KeyEvent evt) {//GEN-FIRST:event_formKeyReleased\n+    private void formKeyReleased(final java.awt.event.KeyEvent evt) { //GEN-FIRST:event_formKeyReleased\n         // TODO add your handling code here:\n-    }//GEN-LAST:event_formKeyReleased\n+    } //GEN-LAST:event_formKeyReleased\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void formKeyPressed(final java.awt.event.KeyEvent evt) {//GEN-FIRST:event_formKeyPressed\n+    private void formKeyPressed(final java.awt.event.KeyEvent evt) { //GEN-FIRST:event_formKeyPressed\n \n         if ((evt.getKeyCode() \u003d\u003d KeyEvent.VK_F1) \u0026\u0026 evt.isControlDown()) {\n         }\n         // TODO add your handling code here:\n-    }//GEN-LAST:event_formKeyPressed\n+    } //GEN-LAST:event_formKeyPressed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void formKeyTyped(final java.awt.event.KeyEvent evt) {//GEN-FIRST:event_formKeyTyped\n-    }//GEN-LAST:event_formKeyTyped\n+    private void formKeyTyped(final java.awt.event.KeyEvent evt) { //GEN-FIRST:event_formKeyTyped\n+    }                                                              //GEN-LAST:event_formKeyTyped\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DCUMENT ME!\n      */\n-    private void cmdWorkflowActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdWorkflowActionPerformed\n-    }//GEN-LAST:event_cmdWorkflowActionPerformed\n+    private void cmdWorkflowActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdWorkflowActionPerformed\n+    }                                                                               //GEN-LAST:event_cmdWorkflowActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void formWindowClosing(final java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosing\n+    private void formWindowClosing(final java.awt.event.WindowEvent evt) { //GEN-FIRST:event_formWindowClosing\n         LOG.info(\"formWindowClosing\");\n         if (editMode \u0026\u0026 !kassenzeichenPanel.isEmpty()) {\n             if (changesPending()) {\n@@ -3177,7 +3365,7 @@ private void formWindowClosing(final java.awt.event.WindowEvent evt) {//GEN-FIRS\n             }\n         }\n         closeAllConnections();\n-    }//GEN-LAST:event_formWindowClosing\n+    }                                                                      //GEN-LAST:event_formWindowClosing\n \n     /**\n      * DOCUMENT ME!\n@@ -3194,15 +3382,15 @@ private void closeAllConnections() {\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void formWindowClosed(final java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosed\n-    }//GEN-LAST:event_formWindowClosed\n+    private void formWindowClosed(final java.awt.event.WindowEvent evt) { //GEN-FIRST:event_formWindowClosed\n+    }                                                                     //GEN-LAST:event_formWindowClosed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdNewKassenzeichenActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdNewKassenzeichenActionPerformed\n+    private void cmdNewKassenzeichenActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdNewKassenzeichenActionPerformed\n         if (!readonly) {\n             if (changesPending()) {\n                 final int answer \u003d JOptionPane.showConfirmDialog(\n@@ -3220,25 +3408,25 @@ private void cmdNewKassenzeichenActionPerformed(final java.awt.event.ActionEvent\n                 newKassenzeichen();\n             }\n         }\n-    }//GEN-LAST:event_cmdNewKassenzeichenActionPerformed\n+    }                                                                                       //GEN-LAST:event_cmdNewKassenzeichenActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdOkActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdOkActionPerformed\n+    private void cmdOkActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdOkActionPerformed\n         if (changesPending()) {\n             saveKassenzeichenAndAssessement();\n         }\n-    }//GEN-LAST:event_cmdOkActionPerformed\n+    }                                                                         //GEN-LAST:event_cmdOkActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdCancelActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdCancelActionPerformed\n+    private void cmdCancelActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdCancelActionPerformed\n         if (changesPending()) {\n             final int answer \u003d JOptionPane.showConfirmDialog(\n                     this,\n@@ -3268,14 +3456,14 @@ protected void done() {\n                     kassenzeichenPanel.refresh();\n                 }\n             }.execute();\n-    }//GEN-LAST:event_cmdCancelActionPerformed\n+    } //GEN-LAST:event_cmdCancelActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdEditModeActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdEditModeActionPerformed\n+    private void cmdEditModeActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdEditModeActionPerformed\n         if (!readonly) {\n             WaitDialog.getInstance().showDialog();\n             new SwingWorker\u003cBoolean, Void\u003e() {\n@@ -3311,7 +3499,7 @@ protected void done() {\n                     }\n                 }.execute();\n         }\n-    }//GEN-LAST:event_cmdEditModeActionPerformed\n+    } //GEN-LAST:event_cmdEditModeActionPerformed\n \n     /**\n      * DOCUMENT ME!\n@@ -3338,36 +3526,36 @@ public boolean acquireLocks() {\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdCopyActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdCopyActionPerformed\n+    private void cmdCopyActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdCopyActionPerformed\n         final AbstractClipboard clipboard \u003d clipboards.get(CidsAppBackend.getInstance().getMode());\n         if (clipboard !\u003d null) {\n             clipboard.storeToFile();\n             clipboard.copy();\n         }\n-    }//GEN-LAST:event_cmdCopyActionPerformed\n+    }                                                                           //GEN-LAST:event_cmdCopyActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdTestActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdTestActionPerformed\n-    }//GEN-LAST:event_cmdTestActionPerformed\n+    private void cmdTestActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdTestActionPerformed\n+    }                                                                           //GEN-LAST:event_cmdTestActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdTest2ActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdTest2ActionPerformed\n-    }//GEN-LAST:event_cmdTest2ActionPerformed\n+    private void cmdTest2ActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdTest2ActionPerformed\n+    }                                                                            //GEN-LAST:event_cmdTest2ActionPerformed\n \n     /**\n      * ToDo Threading and Progressbar.\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdLagisCrossoverActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdLagisCrossoverActionPerformed\n+    private void cmdLagisCrossoverActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdLagisCrossoverActionPerformed\n         try {\n             final JDialog dialog \u003d new JDialog(this, \"\", true);\n             final PopupLagisCrossoverPanel lcp \u003d new PopupLagisCrossoverPanel(CidsAppBackend.getInstance()\n@@ -3383,14 +3571,14 @@ private void cmdLagisCrossoverActionPerformed(final java.awt.event.ActionEvent e\n             LOG.error(\"Crossover: Fehler im LagIS Crossover\", ex);\n             // ToDo Meldung an Benutzer\n         }\n-    }//GEN-LAST:event_cmdLagisCrossoverActionPerformed\n+    }                                                                                     //GEN-LAST:event_cmdLagisCrossoverActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mnuRenameCurrentKZActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mnuRenameCurrentKZActionPerformed\n+    private void mnuRenameCurrentKZActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mnuRenameCurrentKZActionPerformed\n         if (!readonly) {\n             if (editMode) {\n                 if (changesPending()) {\n@@ -3430,7 +3618,7 @@ protected void done() {\n                 renameCurrentKassenzeichen();\n             }\n         }\n-    }//GEN-LAST:event_mnuRenameCurrentKZActionPerformed\n+    } //GEN-LAST:event_mnuRenameCurrentKZActionPerformed\n \n     /**\n      * DOCUMENT ME!\n@@ -3453,16 +3641,16 @@ public void releaseLocks() {\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mniKarteActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mniKarteActionPerformed\n+    private void mniKarteActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mniKarteActionPerformed\n         showOrHideView(vKarte);\n-    }//GEN-LAST:event_mniKarteActionPerformed\n+    }                                                                            //GEN-LAST:event_mniKarteActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mniTabelleActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mniTabelleActionPerformed\n+    private void mniTabelleActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mniTabelleActionPerformed\n         switch (CidsAppBackend.getInstance().getMode()) {\n             case REGEN: {\n                 showOrHideView(vTabelleRegen);\n@@ -3473,14 +3661,14 @@ private void mniTabelleActionPerformed(final java.awt.event.ActionEvent evt) {//\n             }\n             break;\n         }\n-    }//GEN-LAST:event_mniTabelleActionPerformed\n+    }                                                                              //GEN-LAST:event_mniTabelleActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mniDetailsActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mniDetailsActionPerformed\n+    private void mniDetailsActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mniDetailsActionPerformed\n         switch (CidsAppBackend.getInstance().getMode()) {\n             case REGEN: {\n                 showOrHideView(vDetailsRegen);\n@@ -3494,23 +3682,23 @@ private void mniDetailsActionPerformed(final java.awt.event.ActionEvent evt) {//\n             }\n             break;\n         }\n-    }//GEN-LAST:event_mniDetailsActionPerformed\n+    }                                                                              //GEN-LAST:event_mniDetailsActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void jMenuItem1ActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem1ActionPerformed\n+    private void jMenuItem1ActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_jMenuItem1ActionPerformed\n         DeveloperUtil.createWindowLayoutFrame(\"Momentanes Layout\", rootWindow).setVisible(true);\n-    }//GEN-LAST:event_jMenuItem1ActionPerformed\n+    }                                                                              //GEN-LAST:event_jMenuItem1ActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void btnHistoryActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnHistoryActionPerformed\n+    private void btnHistoryActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_btnHistoryActionPerformed\n         final HistoryPanel historyPan \u003d new HistoryPanel();\n         historyPan.setCidsBean(kassenzeichenBean);\n \n@@ -3519,7 +3707,7 @@ private void btnHistoryActionPerformed(final java.awt.event.ActionEvent evt) {//\n         dial.setContentPane(historyPan);\n         dial.setSize(800, 600);\n         StaticSwingTools.showDialog(dial);\n-    }//GEN-LAST:event_btnHistoryActionPerformed\n+    } //GEN-LAST:event_btnHistoryActionPerformed\n \n     /**\n      * DOCUMENT ME!\n@@ -3580,66 +3768,66 @@ public static void transformToDefaultCrsNeeded(Geometry geom) {\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdAddActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdAddActionPerformed\n+    private void cmdAddActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdAddActionPerformed\n         if (!CidsAppBackend.getInstance().getMode().equals(CidsAppBackend.Mode.ALLGEMEIN)) {\n             final CidsBeanTable cidsBeanTable \u003d getCurrentCidsbeanTable();\n             if (cidsBeanTable !\u003d null) {\n                 cidsBeanTable.addNewBean();\n             }\n         }\n-    }//GEN-LAST:event_cmdAddActionPerformed\n+    }                                                                          //GEN-LAST:event_cmdAddActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdRemoveActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdRemoveActionPerformed\n+    private void cmdRemoveActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdRemoveActionPerformed\n         if (!CidsAppBackend.getInstance().getMode().equals(CidsAppBackend.Mode.ALLGEMEIN)) {\n             final CidsBeanTable cidsBeanTable \u003d getCurrentCidsbeanTable();\n             if (cidsBeanTable !\u003d null) {\n                 cidsBeanTable.removeSelectedBeans();\n             }\n         }\n-    }//GEN-LAST:event_cmdRemoveActionPerformed\n+    }                                                                             //GEN-LAST:event_cmdRemoveActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdUndoActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdUndoActionPerformed\n+    private void cmdUndoActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdUndoActionPerformed\n         final CidsBeanTable cidsBeanTable \u003d getCurrentCidsbeanTable();\n         if (cidsBeanTable !\u003d null) {\n             cidsBeanTable.restoreSelectedBeans();\n         }\n-    }//GEN-LAST:event_cmdUndoActionPerformed\n+    }                                                                           //GEN-LAST:event_cmdUndoActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DCUMENT ME!\n      */\n-    private void mniOptionsActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mniOptionsActionPerformed\n+    private void mniOptionsActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mniOptionsActionPerformed\n         final OptionsDialog od \u003d new OptionsDialog(this, true);\n         StaticSwingTools.showDialog(od);\n-    }//GEN-LAST:event_mniOptionsActionPerformed\n+    }                                                                              //GEN-LAST:event_mniOptionsActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCMENT ME!\n      */\n-    private void cmdFortfuehrungActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdFortfuehrungActionPerformed\n+    private void cmdFortfuehrungActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdFortfuehrungActionPerformed\n         StaticSwingTools.showDialog(FortfuehrungsanlaesseDialog.getInstance());\n-    }//GEN-LAST:event_cmdFortfuehrungActionPerformed\n+    }                                                                                   //GEN-LAST:event_cmdFortfuehrungActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DCUMENT ME!\n      */\n-    private void cmdNextKassenzeichenWithoutGeomActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdNextKassenzeichenWithoutGeomActionPerformed\n+    private void cmdNextKassenzeichenWithoutGeomActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdNextKassenzeichenWithoutGeomActionPerformed\n         final Integer kassenzeichennummer8;\n         if (getCidsBean() !\u003d null) {\n             kassenzeichennummer8 \u003d (Integer)getCidsBean().getProperty(\n@@ -3660,92 +3848,92 @@ private void cmdNextKassenzeichenWithoutGeomActionPerformed(final java.awt.event\n         } catch (final ConnectionException ex) {\n             LOG.error(\"error while executing next kassenzeichensearch\", ex);\n         }\n-    }//GEN-LAST:event_cmdNextKassenzeichenWithoutGeomActionPerformed\n+    } //GEN-LAST:event_cmdNextKassenzeichenWithoutGeomActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdGrundbuchblattSucheActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdGrundbuchblattSucheActionPerformed\n+    private void cmdGrundbuchblattSucheActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdGrundbuchblattSucheActionPerformed\n         StaticSwingTools.showDialog(GrundbuchblattSucheDialog.getInstance());\n-    }//GEN-LAST:event_cmdGrundbuchblattSucheActionPerformed\n+    }                                                                                          //GEN-LAST:event_cmdGrundbuchblattSucheActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mniKassenzeichen1ActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mniKassenzeichen1ActionPerformed\n+    private void mniKassenzeichen1ActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mniKassenzeichen1ActionPerformed\n         showOrHideView(vKassenzeichenList);\n-    }//GEN-LAST:event_mniKassenzeichen1ActionPerformed\n+    }                                                                                     //GEN-LAST:event_mniKassenzeichen1ActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdSAPCheckActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdSAPCheckActionPerformed\n+    private void cmdSAPCheckActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdSAPCheckActionPerformed\n         if (cmdSAPCheck.isSelected()) {\n             sapClipboardListener.gainOwnership();\n         }\n-    }//GEN-LAST:event_cmdSAPCheckActionPerformed\n+    }                                                                               //GEN-LAST:event_cmdSAPCheckActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdMemoryActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdMemoryActionPerformed\n+    private void cmdMemoryActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdMemoryActionPerformed\n         // TODO add your handling code here:\n-    }//GEN-LAST:event_cmdMemoryActionPerformed\n+    } //GEN-LAST:event_cmdMemoryActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdRecalculateAreaActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdRecalculateAreaActionPerformed\n+    private void cmdRecalculateAreaActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdRecalculateAreaActionPerformed\n         if (isInEditMode()) {\n             regenFlaechenTabellenPanel.recalculateAreaOfFlaechen();\n         }\n-    }//GEN-LAST:event_cmdRecalculateAreaActionPerformed\n+    }                                                                                      //GEN-LAST:event_cmdRecalculateAreaActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdArbeitspaketeActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdArbeitspaketeActionPerformed\n+    private void cmdArbeitspaketeActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdArbeitspaketeActionPerformed\n         ArbeitspaketeManagerPanel.getInstance().loadArbeitspakete();\n         StaticSwingTools.showDialog(ArbeitspaketeManagerPanel.getInstance().getDialog());\n-    }//GEN-LAST:event_cmdArbeitspaketeActionPerformed\n+    }                                                                                    //GEN-LAST:event_cmdArbeitspaketeActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdAbfrageeditorActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdAbfrageeditorActionPerformed\n+    private void cmdAbfrageeditorActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdAbfrageeditorActionPerformed\n         StaticSwingTools.showDialog(abfrageDialog);\n-    }//GEN-LAST:event_cmdAbfrageeditorActionPerformed\n+    }                                                                                    //GEN-LAST:event_cmdAbfrageeditorActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdVeranlagungsdateiActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdVeranlagungsdateiActionPerformed\n+    private void cmdVeranlagungsdateiActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdVeranlagungsdateiActionPerformed\n         VeranlagungsdateiScheduleDialog.getInstance().pack();\n         StaticSwingTools.showDialog(VeranlagungsdateiScheduleDialog.getInstance());\n-    }//GEN-LAST:event_cmdVeranlagungsdateiActionPerformed\n+    }                                                                                        //GEN-LAST:event_cmdVeranlagungsdateiActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void btnTimeRecoveryActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTimeRecoveryActionPerformed\n+    private void btnTimeRecoveryActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_btnTimeRecoveryActionPerformed\n         if (editMode) {\n             StaticSwingTools.showDialog(timeRecoveryPanel.getDialog());\n         } else {\n@@ -3815,14 +4003,14 @@ protected void done() {\n                     }.execute();\n             }\n         }\n-    }//GEN-LAST:event_btnTimeRecoveryActionPerformed\n+    } //GEN-LAST:event_btnTimeRecoveryActionPerformed\n \n     /**\n      * DOCUMENT ME!\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void cmdOpenInD3ActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdOpenInD3ActionPerformed\n+    private void cmdOpenInD3ActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_cmdOpenInD3ActionPerformed\n         if (kassenzeichenBean !\u003d null) {\n             final String kz \u003d getCidsBean().getProperty(\n                     KassenzeichenPropertyConstants.PROP__KASSENZEICHENNUMMER).toString();\n@@ -3839,7 +4027,7 @@ private void cmdOpenInD3ActionPerformed(final java.awt.event.ActionEvent evt) {/\n                             e);\n             }\n         }\n-    }//GEN-LAST:event_cmdOpenInD3ActionPerformed\n+    }                                                                               //GEN-LAST:event_cmdOpenInD3ActionPerformed\n \n     /**\n      * DOCUMENT ME!\n@@ -4004,9 +4192,9 @@ protected void done() {\n      *\n      * @param  evt  DOCUMENT ME!\n      */\n-    private void mnuRenameAnyKZActionPerformed(final java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mnuRenameAnyKZActionPerformed\n+    private void mnuRenameAnyKZActionPerformed(final java.awt.event.ActionEvent evt) { //GEN-FIRST:event_mnuRenameAnyKZActionPerformed\n         showRenameKassenzeichen(false);\n-    }//GEN-LAST:event_mnuRenameAnyKZActionPerformed\n+    }                                                                                  //GEN-LAST:event_mnuRenameAnyKZActionPerformed\n \n     /**\n      * DOCUMENT ME!"
        }
      ]
    }
  },
  {
    "name": "Ridicolous race condition",
    "url": "https://github.com/kontalk/androidclient/issues/773",
    "description": "MessagingNotification.sPaused becomes null inside the if (sPaused !\u003d null). Wow...\n\n```\njava.lang.IllegalArgumentException: the bind value at index 1 is null\n       at android.database.sqlite.SQLiteProgram.bindString(SQLiteProgram.java:164)\n       at android.database.sqlite.SQLiteProgram.bindAllArgsAsStrings(SQLiteProgram.java:200)\n       at android.database.sqlite.SQLiteDirectCursorDriver.query(SQLiteDirectCursorDriver.java:47)\n       at android.database.sqlite.SQLiteDatabase.rawQueryWithFactory(SQLiteDatabase.java:1316)\n       at android.database.sqlite.SQLiteQueryBuilder.query(SQLiteQueryBuilder.java:400)\n       at android.database.sqlite.SQLiteQueryBuilder.query(SQLiteQueryBuilder.java:294)\n       at org.kontalk.provider.MessagesProvider.query(MessagesProvider.java:413)\n       at android.content.ContentProvider.query(ContentProvider.java:1000)\n       at android.content.ContentProvider$Transport.query(ContentProvider.java:214)\n       at android.content.ContentResolver.query(ContentResolver.java:482)\n       at android.content.ContentResolver.query(ContentResolver.java:426)\n       at org.kontalk.ui.MessagingNotification.updateMessagesNotification(MessagingNotification.java:208)\n       at org.kontalk.data.Conversation$1.run(Conversation.java:255)\n       at java.lang.Thread.run(Thread.java:818)\n```\n",
    "keywords": [
      "sqlite",
      "org",
      "android",
      "query",
      "content",
      "sqlitequerybuilder",
      "android database",
      "org kontalk",
      "sqliteprogram",
      "database",
      "null",
      "contentprovider",
      "messagingnotification",
      "contentresolver",
      "kontalk"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/kontalk/androidclient/commit/2efcdb9aa43f56a21d7ae6a57d455022bcbf6e07",
      "files": [
        {
          "file_name": "app/src/main/java/org/kontalk/ui/MessagingNotification.java",
          "patch": "@@ -206,10 +206,11 @@ public static void updateMessagesNotification(Context context, boolean isNew) {\n         }\n \n         // is there a peer to not notify for?\n-        if (sPaused !\u003d null) {\n+        final String paused \u003d sPaused;\n+        if (paused !\u003d null) {\n             query +\u003d \" AND \" + CommonColumns.PEER + \" \u003c\u003e ? AND \" +\n                 Groups.GROUP_JID + \" \u003c\u003e ?\";\n-            args \u003d new String[] { sPaused, sPaused };\n+            args \u003d new String[] { paused, paused };\n         }\n \n         // TODO we need the group subject to correctly notify group messages (e.g. alice @ team: hey buddy!)"
        }
      ]
    }
  },
  {
    "name": "Potenial race condition in Document.update",
    "url": "https://github.com/couchbase/couchbase-lite-java-core/issues/472",
    "description": "Two key lines were not ported from the iOS codebase into the Java `Document` class. These were fixed in couchbase/couchbase-lite-net#389 and couchbase/couchbase-lite-net#390 as part of couchbase/couchbase-lite-net#388.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/couchbase/couchbase-lite-java-core/commit/990ec08da30a34f6f2d6037c8cd6ef876ea7aae0",
      "files": [
        {
          "file_name": "src/main/java/com/couchbase/lite/Document.java",
          "patch": "@@ -269,6 +269,10 @@ public SavedRevision update(DocumentUpdater updater) throws CouchbaseLiteExcepti\n \n         int lastErrorCode \u003d Status.UNKNOWN;\n         do {\n+            // if there is a conflict error, get the latest revision from db instead of cache\n+            if (lastErrorCode \u003d\u003d Status.CONFLICT) {\n+                currentRevision \u003d null;\n+            }\n             UnsavedRevision newRev \u003d createRevision();\n             if (updater.update(newRev) \u003d\u003d false) {\n                 break;\n@@ -284,7 +288,6 @@ public SavedRevision update(DocumentUpdater updater) throws CouchbaseLiteExcepti\n \n         } while (lastErrorCode \u003d\u003d Status.CONFLICT);\n         return null;\n-\n     }\n \n \n@@ -464,13 +467,14 @@ else if (currentRevision !\u003d null \u0026\u0026 internalRevision.getRevId().equals(currentRe\n         }\n         String revId \u003d row.getDocumentRevisionId();\n         if (currentRevision \u003d\u003d null || revIdGreaterThanCurrent(revId)) {\n+            currentRevision \u003d null;\n             Map\u003cString, Object\u003e properties \u003d row.getDocumentProperties();\n             if (properties !\u003d null) {\n                 RevisionInternal rev \u003d new RevisionInternal(properties);\n                 currentRevision \u003d new SavedRevision(this, rev);\n             }\n         }\n-     }\n+    }\n \n     /**\n      * @exclude"
        }
      ]
    }
  },
  {
    "name": "Auto-calibration race condition leads to CvException as soon as arena is calibrated",
    "url": "https://github.com/phrack/ShootOFF/issues/430",
    "description": "Exception in thread \"ShotDetector\" CvException [org.opencv.core.CvException: cv::Exception: /home/jason/opencv/opencv-2.4.11/modules/core/src/matrix.cpp:269: error: (-215) m.dims \u003e\u003d 2 in function Mat\n]\n    at org.opencv.core.Mat.n_submat_rr(Native Method)\n    at org.opencv.core.Mat.submat(Mat.java:2270)\n    at com.shootoff.camera.shotdetection.ShotDetectionManager.processFrame(ShotDetectionManager.java:228)\n    at com.shootoff.camera.CameraManager.processFrame(CameraManager.java:570)\n    at com.shootoff.camera.CameraManager.streamCameraFrames(CameraManager.java:470)\n    at com.shootoff.camera.CameraManager.access$0(CameraManager.java:448)\n    at com.shootoff.camera.CameraManager$Detector.run(CameraManager.java:443)\n    at java.lang.Thread.run(Thread.java:745)\n",
    "keywords": [
      "opencv core",
      "com",
      "mat",
      "core",
      "cameramanager",
      "com shootoff",
      "cvexception",
      "thread",
      "shootoff",
      "camera",
      "camera cameramanager",
      "opencv"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/phrack/ShootOFF/commit/a311d34ff0fa4ecc61d1f2477704487d1a0c57b2",
      "files": [
        {
          "file_name": "src/main/java/com/shootoff/camera/CameraManager.java",
          "patch": "@@ -90,12 +90,12 @@\n \tprotected final Configuration config;\n \tprotected Optional\u003cBounds\u003e projectionBounds \u003d Optional.empty();\n \n-\tprotected AtomicBoolean isStreaming \u003d new AtomicBoolean(true);\n-\tprotected AtomicBoolean isDetecting \u003d new AtomicBoolean(true);\n-\tprotected AtomicBoolean isCalibrating \u003d new AtomicBoolean(false);\n-\tprotected boolean shownBrightnessWarning \u003d false;\n-\tprotected boolean cropFeedToProjection \u003d false;\n-\tprotected boolean limitDetectProjection \u003d false;\n+\tprivate final AtomicBoolean isStreaming \u003d new AtomicBoolean(true);\n+\tprivate final AtomicBoolean isDetecting \u003d new AtomicBoolean(true);\n+\tprivate final AtomicBoolean isCalibrating \u003d new AtomicBoolean(false);\n+\tprivate boolean shownBrightnessWarning \u003d false;\n+\tprivate boolean cropFeedToProjection \u003d false;\n+\tprivate boolean limitDetectProjection \u003d false;\n \n \tprotected Optional\u003cInteger\u003e minimumShotDimension \u003d Optional.empty();\n \n@@ -122,9 +122,9 @@ public long getCurrentFrameTimestamp() {\n \tprivate double webcamFPS \u003d DEFAULT_FPS;\n \tprivate boolean showedFPSWarning \u003d false;\n \n-\tprotected AutoCalibrationManager acm \u003d null;\n-\tprotected boolean isAutoCalibrating \u003d false;\n-\tpublic boolean cameraAutoCalibrated \u003d false;\n+\tprivate AutoCalibrationManager acm \u003d null;\n+\tprivate final AtomicBoolean isAutoCalibrating \u003d new AtomicBoolean(false);\n+\tprotected boolean cameraAutoCalibrated \u003d false;\n \n \tprotected final DeduplicationProcessor deduplicationProcessor \u003d new DeduplicationProcessor(this);\n \tprotected final ArenaMaskManager arenaMaskManager;\n@@ -421,7 +421,6 @@ public void stopRecordingCalibratedArea() {\n \t}\n \n \tprotected class Detector extends MediaListenerAdapter implements Runnable {\n-\n \t\t@Override\n \t\tpublic void run() {\n \t\t\tif (webcam.isPresent()) {\n@@ -521,13 +520,13 @@ private void streamCameraFrames() {\n \tprotected BufferedImage processFrame(BufferedImage currentFrame) {\n \t\tframeCount++;\n \n-\t\tif (isAutoCalibrating) {\n+\t\tif (isAutoCalibrating.get()) {\n \t\t\tacm.processFrame(currentFrame);\n \t\t\treturn currentFrame;\n \t\t}\n \n \t\tMat matFrameBGR \u003d Camera.bufferedImageToMat(currentFrame);\n-\t\tMat matFrameHSV \u003d new Mat();\n+\t\tfinal Mat matFrameHSV \u003d new Mat();\n \n \t\tif (cameraAutoCalibrated \u0026\u0026 projectionBounds.isPresent()) {\n \t\t\tif (acm !\u003d null) {\n@@ -553,7 +552,7 @@ protected BufferedImage processFrame(BufferedImage currentFrame) {\n \t\t\t\tvideoWriterCalibratedArea.encodeVideo(0, frame);\n \t\t\t}\n \n-\t\t\tif (isAutoCalibrating || isDetecting()) Imgproc.cvtColor(matFrameBGR, matFrameHSV, Imgproc.COLOR_BGR2HSV);\n+\t\t\tImgproc.cvtColor(matFrameBGR, matFrameHSV, Imgproc.COLOR_BGR2HSV);\n \n \t\t\tif (Configuration.USE_ARENA_MASK) arenaMaskManager.updateAvgLums(submatFrame);\n \n@@ -562,7 +561,8 @@ protected BufferedImage processFrame(BufferedImage currentFrame) {\n \t\t\t}\n \n \t\t} else {\n-\t\t\tif (isAutoCalibrating || isDetecting()) Imgproc.cvtColor(matFrameBGR, matFrameHSV, Imgproc.COLOR_BGR2HSV);\n+\t\t\tif (isAutoCalibrating.get() || isDetecting())\n+\t\t\t\tImgproc.cvtColor(matFrameBGR, matFrameHSV, Imgproc.COLOR_BGR2HSV);\n \t\t}\n \n \t\tshotDetectionManager.processFrame(matFrameHSV, matFrameBGR, isDetecting.get());\n@@ -668,7 +668,6 @@ public void showMotionWarning() {\n \tprivate void fireAutoCalibration() {\n \t\tacm.reset();\n \t\tacm.setCallback(new Callback\u003cVoid, Void\u003e() {\n-\n \t\t\t@Override\n \t\t\tpublic Void call(Void param) {\n \t\t\t\tautoCalibrateSuccess(acm.getBoundsResult(), acm.getFrameDelayResult());\n@@ -678,8 +677,8 @@ public Void call(Void param) {\n \t}\n \n \tprotected void autoCalibrateSuccess(Bounds bounds, long delay) {\n-\t\tif (isAutoCalibrating \u0026\u0026 cameraCalibrationListener !\u003d null) {\n-\t\t\tisAutoCalibrating \u003d false;\n+\t\tif (isAutoCalibrating.get() \u0026\u0026 cameraCalibrationListener !\u003d null) {\n+\t\t\tisAutoCalibrating.set(false);\n \n \t\t\tlogger.debug(\"autoCalibrateSuccess {} {} {} {}\", (int) bounds.getMinX(), (int) bounds.getMinY(),\n \t\t\t\t\t(int) bounds.getWidth(), (int) bounds.getHeight());\n@@ -705,7 +704,7 @@ protected void autoCalibrateSuccess(Bounds bounds, long delay) {\n \n \tpublic void enableAutoCalibration(boolean calculateFrameDelay) {\n \t\tacm \u003d new AutoCalibrationManager(this, calculateFrameDelay);\n-\t\tisAutoCalibrating \u003d true;\n+\t\tisAutoCalibrating.set(true);\n \t\tcameraAutoCalibrated \u003d false;\n \t\t// Turns off using mask\n \t\tshotDetectionManager.setArenaMaskManager(null);\n@@ -714,7 +713,7 @@ public void enableAutoCalibration(boolean calculateFrameDelay) {\n \t}\n \n \tpublic void disableAutoCalibration() {\n-\t\tisAutoCalibrating \u003d false;\n+\t\tisAutoCalibrating.set(false);\n \t}\n \n \tpublic void setArenaBackground(String resourceFilename) {"
        }
      ]
    }
  },
  {
    "name": "Fix race condition in ExponentiallyDecayingReservoir\u0027s rescale method",
    "url": "https://github.com/dropwizard/metrics/pull/1033",
    "description": "Fixes issues #1005 and #793 - note that in #793 the `longPeriodsOfInactivityShouldNotCorruptSamplingState` test did not cover multiple concurrent requests after a long idle period.\r\n\r\nThe race condition currently occurs when two threads update the reservoir concurrently - after the first thread has successfully updated `nextScaleTime` (line 162) but before the write lock is obtained (line 163) a second thread updates the reservoir (line 95+).  With several threads pushing updates concurrently this presents a narrow window during which the second thread may obtain the lock before the first resulting in a corrupt reservoir state.  Note, however, that if a snapshot is requested just prior to the two concurrent updates the read lock will already be active when the two threads enter `rescaleIfNeeded`, resulting in a much larger window for this race condition.",
    "keywords": [
      "condition",
      "race",
      "line",
      "threads",
      "lock",
      "reservoir",
      "thread",
      "updates",
      "two"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/dropwizard/metrics/commit/4abcd4d95ff5fbdfc03544b72598030c3a8ea967",
      "files": [
        {
          "file_name": "metrics-core/src/main/java/com/codahale/metrics/ExponentiallyDecayingReservoir.java",
          "patch": "@@ -159,9 +159,9 @@ private double weight(long t) {\n      * a linear pass over whatever data structure is being used.\"\n      */\n     private void rescale(long now, long next) {\n-        if (nextScaleTime.compareAndSet(next, now + RESCALE_THRESHOLD)) {\n-            lockForRescale();\n-            try {\n+        lockForRescale();\n+        try {\n+            if (nextScaleTime.compareAndSet(next, now + RESCALE_THRESHOLD)) {\n                 final long oldStartTime \u003d startTime;\n                 this.startTime \u003d currentTimeInSeconds();\n                 final double scalingFactor \u003d exp(-alpha * (startTime - oldStartTime));\n@@ -175,9 +175,9 @@ private void rescale(long now, long next) {\n \n                 // make sure the counter is in sync with the number of stored samples.\n                 count.set(values.size());\n-            } finally {\n-                unlockForRescale();\n             }\n+        } finally {\n+            unlockForRescale();\n         }\n     }\n "
        },
        {
          "file_name": "metrics-core/src/test/java/com/codahale/metrics/ExponentiallyDecayingReservoirTest.java",
          "patch": "@@ -1,7 +1,10 @@\n package com.codahale.metrics;\n \n import org.junit.Test;\n+\n import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n \n import static org.assertj.core.api.Assertions.assertThat;\n \n@@ -99,6 +102,101 @@ public void longPeriodsOfInactivityShouldNotCorruptSamplingState() {\n     }\n \n     @Test\n+    public void multipleUpdatesAfterlongPeriodsOfInactivityShouldNotCorruptSamplingState () throws Exception {\n+        // This test illustrates the potential race condition in rescale that\n+        // can lead to a corrupt state.  Note that while this test uses updates\n+        // exclusively to trigger the race condition, two concurrent updates\n+        // may be made much more likely to trigger this behavior if executed\n+        // while another thread is constructing a snapshot of the reservoir;\n+        // that thread then holds the read lock when the two competing updates\n+        // are executed and the race condition\u0027s window is substantially\n+        // expanded.\n+\n+        // Run the test several times.\n+        for (int attempt\u003d0; attempt \u003c 10; attempt++) {\n+            final ManualClock clock \u003d new ManualClock();\n+            final ExponentiallyDecayingReservoir reservoir \u003d new ExponentiallyDecayingReservoir(10,\n+                    0.015,\n+                    clock);\n+\n+            // Various atomics used to communicate between this thread and the\n+            // thread created below.\n+            final AtomicBoolean running \u003d new AtomicBoolean(true);\n+            final AtomicInteger threadUpdates \u003d new AtomicInteger(0);\n+            final AtomicInteger testUpdates \u003d new AtomicInteger(0);\n+\n+            final Thread thread \u003d new Thread(new Runnable() {\n+                @Override\n+                public void run() {\n+                    int previous \u003d 0;\n+                    while (running.get()) {\n+                        // Wait for the test thread to update it\u0027s counter\n+                        // before updaing the reservoir.\n+                        int next;\n+                        while (previous \u003e\u003d (next \u003d testUpdates.get()))\n+                            ; // spin lock\n+\n+                        previous \u003d next;\n+\n+                        // Update the reservoir.  This needs to occur at the\n+                        // same time as the test thread\u0027s update.\n+                        reservoir.update(1000);\n+\n+                        // Signal the main thread; allows the next update\n+                        // attempt to begin.\n+                        threadUpdates.incrementAndGet();\n+                    }\n+                }\n+            });\n+\n+            thread.start();\n+\n+            int sum \u003d 0;\n+            int previous \u003d -1;\n+            for (int i \u003d 0; i \u003c 100; i++) {\n+                // Wait for 24 hours before attempting the next concurrent\n+                // update.  The delay here needs to be sufficiently long to\n+                // overflow if an update attempt is allowed to add a value to\n+                // the reservoir without rescaling.  Note that:\n+                // e(alpha*(15*60*60)) \u003d~ 10^351 \u003e\u003e Double.MAX_VALUE \u003d~ 1.8*10^308.\n+                clock.addHours(15);\n+\n+                // Signal the other thread; asynchronously updates the reservoir.\n+                testUpdates.incrementAndGet();\n+\n+                // Delay a variable length of time.  Without a delay here this\n+                // thread is heavily favored and the race condition is almost\n+                // never observed.\n+                for (int j \u003d 0; j \u003c i; j++)\n+                    sum +\u003d j;\n+\n+                // Competing reservoir update.\n+                reservoir.update(1000);\n+\n+                // Wait for the other thread to finish it\u0027s update.\n+                int next;\n+                while (previous \u003e\u003d (next \u003d threadUpdates.get()))\n+                    ; // spin lock\n+\n+                previous \u003d next;\n+            }\n+\n+            // Terminate the thread.\n+            running.set(false);\n+            testUpdates.incrementAndGet();\n+            thread.join();\n+\n+            // Test failures will result in normWeights that are not finite;\n+            // checking the mean value here is sufficient.\n+            assertThat(reservoir.getSnapshot().getMean()).isBetween(0.0, Double.MAX_VALUE);\n+\n+            // Check the value of sum; should prevent the JVM from optimizing\n+            // out the delay loop entirely.\n+            assertThat(sum).isEqualTo(161700);\n+        }\n+    }\n+\n+    @Test\n     public void spotLift() {\n         final ManualClock clock \u003d new ManualClock();\n         final ExponentiallyDecayingReservoir reservoir \u003d new ExponentiallyDecayingReservoir(1000,"
        }
      ]
    }
  },
  {
    "name": "Race condition when loading ServiceTypes",
    "url": "https://github.com/vert-x3/vertx-service-discovery/issues/37",
    "description": "When 2 users try to load the service types, one may get an empty list, while the other one is loading the full list.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/vert-x3/vertx-service-discovery/commit/1ec0cc583536db353bd105b2a23a2c9ced2bfd0b",
      "files": [
        {
          "file_name": "vertx-service-discovery/src/main/java/io/vertx/servicediscovery/impl/ServiceTypes.java",
          "patch": "@@ -30,7 +30,7 @@\n  */\n public class ServiceTypes {\n \n-  public static ServiceType get(Record record) {\n+  public synchronized static ServiceType get(Record record) {\n     load();\n \n     String type \u003d record.getType();\n@@ -44,22 +44,20 @@ public static ServiceType get(Record record) {\n     }\n   }\n \n-  private static void load() {\n-    synchronized (ServiceTypes.class) {\n-      if (types \u003d\u003d null || !types.iterator().hasNext()) {\n-        types \u003d ServiceLoader.load(ServiceType.class);\n-      }\n+  private synchronized static void load() {\n+    if (types \u003d\u003d null || !types.iterator().hasNext()) {\n+      types \u003d ServiceLoader.load(ServiceType.class);\n     }\n   }\n \n-  public static Iterator\u003cServiceType\u003e all() {\n+  public synchronized static Iterator\u003cServiceType\u003e all() {\n     load();\n     return types.iterator();\n   }\n \n   private static ServiceLoader\u003cServiceType\u003e types;\n \n-  public static ServiceType get(String type) {\n+  public synchronized static ServiceType get(String type) {\n     load();\n     for (ServiceType next : types) {\n       if (next.name().equalsIgnoreCase(type)) {"
        }
      ]
    }
  },
  {
    "name": "Race condition with ChildContainerProvider",
    "url": "https://github.com/fabric8io/fabric8/issues/1911",
    "description": "There is a cyclic dependency chain\n\nFabricService \u003d\u003e ChildContainerProvider(opt,mult)\nChildContainerProvider \u003d\u003e FabricService,ProcessControllerFactory(opt)\nProcessControllerFactory \u003d\u003e FabricService\n\nVarious injection points use optional injection. This may lead to \n\n```\nCaused by: io.fabric8.api.FabricException: Unable to find a container provider supporting \u0027child\u0027\n    at io.fabric8.service.FabricServiceImpl.createContainers(FabricServiceImpl.java:407)\n    at io.fabric8.service.FabricServiceImpl.createContainers(FabricServiceImpl.java:398)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n```\n",
    "keywords": [
      "\u003d\u003e",
      "io",
      "childcontainerprovider",
      "fabricservice",
      "nativemethodaccessorimpl",
      "fabric8",
      "fabricserviceimpl"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/fabric8io/fabric8/commit/b104910a6ebb528a5f42984f3d58cd175173e529",
      "files": [
        {
          "file_name": "fabric/fabric-api/src/main/java/io/fabric8/api/BootstrapComplete.java",
          "patch": "@@ -18,6 +18,7 @@\n \n /**\n  * Service that marks the completion of the bootstrap process\n+ * before the fabric is created.\n  */\n public interface BootstrapComplete {\n "
        },
        {
          "file_name": "fabric/fabric-api/src/main/java/io/fabric8/api/ContainerProvider.java",
          "patch": "@@ -24,28 +24,21 @@\n      * Creates a container using a set of arguments\n      * @param options   The {@link CreateContainerOptions} that will be used to build the container.\n      * @return          A set of {@link CreateContainerMetadata}, which contains information about the created container.\n-     * @throws Exception\n      */\n     M create(O options, CreationStateListener listener) throws Exception;\n \n     /**\n      * Start the container\n-     * @param container\n-     * @throws Exception\n      */\n     void start(Container container);\n \n     /**\n      * Stop the container\n-     * @param container\n-     * @throws Exception\n      */\n     void stop(Container container);\n \n     /**\n      * Destroy the container\n-     * @param container\n-     * @throws Exception\n      */\n     void destroy(Container container);\n \n@@ -54,9 +47,9 @@\n \n     /**\n      * Returns the options\n-     * @return\n      */\n     Class\u003cO\u003e getOptionsType();\n+    \n     Class\u003cM\u003e getMetadataType();\n \n "
        },
        {
          "file_name": "fabric/fabric-api/src/main/java/io/fabric8/api/FabricComplete.java",
          "patch": "@@ -0,0 +1,24 @@\n+/**\n+ *  Copyright 2005-2014 Red Hat, Inc.\n+ *\n+ *  Red Hat licenses this file to you under the Apache License, version\n+ *  2.0 (the \"License\"); you may not use this file except in compliance\n+ *  with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ *  implied.  See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+package io.fabric8.api;\n+\n+\n+/**\n+ * Service that marks the completion of the fabric create process\n+ */\n+public interface FabricComplete {\n+\n+}"
        },
        {
          "file_name": "fabric/fabric-boot-commands/src/main/java/io/fabric8/boot/BootstrapCompleteService.java",
          "patch": "@@ -28,6 +28,9 @@\n import org.apache.felix.scr.annotations.Reference;\n import org.apache.felix.scr.annotations.Service;\n \n+/**\n+ * Indicates the completion of the bootstrap process before the fabric is created.\n+ */\n @Component(immediate \u003d true)\n @Service({ BootstrapComplete.class })\n public final class BootstrapCompleteService extends AbstractComponent implements BootstrapComplete {"
        },
        {
          "file_name": "fabric/fabric-core/pom.xml",
          "patch": "@@ -67,6 +67,7 @@\n             OSGI-INF/io.fabric8.service.ContainerPlaceholderResolver.xml,\n             OSGI-INF/io.fabric8.service.EncryptedPropertyResolver.xml,\n             OSGI-INF/io.fabric8.service.EnvPlaceholderResolver.xml,\n+            OSGI-INF/io.fabric8.service.FabricCompleteService.xml,\n             OSGI-INF/io.fabric8.service.FabricMBeanRegistrationListener.xml,\n             OSGI-INF/io.fabric8.service.FabricServiceImpl.xml,\n             OSGI-INF/io.fabric8.service.PortPlaceholderResolver.xml,\n@@ -131,6 +132,10 @@\n             \u003cartifactId\u003ejasypt\u003c/artifactId\u003e\n         \u003c/dependency\u003e\n         \u003cdependency\u003e\n+            \u003cgroupId\u003eorg.jboss.gravia\u003c/groupId\u003e\n+            \u003cartifactId\u003egravia-runtime-api\u003c/artifactId\u003e\n+        \u003c/dependency\u003e\n+        \u003cdependency\u003e\n             \u003cgroupId\u003eorg.mvel\u003c/groupId\u003e\n             \u003cartifactId\u003emvel2\u003c/artifactId\u003e\n         \u003c/dependency\u003e"
        },
        {
          "file_name": "fabric/fabric-core/src/main/java/io/fabric8/internal/ZooKeeperClusterBootstrapImpl.java",
          "patch": "@@ -19,9 +19,9 @@\n import io.fabric8.api.Container;\n import io.fabric8.api.CreateEnsembleOptions;\n import io.fabric8.api.DataStoreRegistrationHandler;\n+import io.fabric8.api.FabricComplete;\n import io.fabric8.api.FabricException;\n import io.fabric8.api.FabricService;\n-import io.fabric8.api.ServiceLocator;\n import io.fabric8.api.ZooKeeperClusterBootstrap;\n import io.fabric8.api.jcip.ThreadSafe;\n import io.fabric8.api.scr.AbstractComponent;\n@@ -46,6 +46,7 @@\n import org.apache.felix.scr.annotations.Property;\n import org.apache.felix.scr.annotations.Reference;\n import org.apache.felix.scr.annotations.Service;\n+import org.jboss.gravia.runtime.ServiceLocator;\n import org.osgi.framework.Bundle;\n import org.osgi.framework.BundleContext;\n import org.osgi.framework.BundleException;\n@@ -113,7 +114,7 @@ public void create(CreateEnsembleOptions options) {\n         assertValid();\n         try {\n             // Wait for bootstrap to be complete\n-            ServiceLocator.awaitService(bundleContext, BootstrapComplete.class);\n+            ServiceLocator.awaitService(BootstrapComplete.class);\n \n             LOGGER.info(\"Create fabric with: {}\", options);\n \n@@ -132,11 +133,15 @@ public void create(CreateEnsembleOptions options) {\n             startBundles(options);\n \n             long startTime \u003d System.currentTimeMillis();\n-            createHandler.waitForContainerAlive(name, syscontext, options.getBootstrapTimeout());\n+            long bootstrapTimeout \u003d options.getBootstrapTimeout();\n+            ServiceLocator.awaitService(FabricComplete.class, bootstrapTimeout, TimeUnit.MILLISECONDS);\n+            \n+            long timeDiff \u003d System.currentTimeMillis() - startTime; \n+\t\t\tcreateHandler.waitForContainerAlive(name, syscontext, bootstrapTimeout - timeDiff);\n \n             if (options.isWaitForProvision() \u0026\u0026 options.isAgentEnabled()) {\n                 long currentTime \u003d System.currentTimeMillis();\n-                createHandler.waitForSuccessfulDeploymentOf(name, syscontext, options.getBootstrapTimeout() - (currentTime - startTime));\n+                createHandler.waitForSuccessfulDeploymentOf(name, syscontext, bootstrapTimeout - (currentTime - startTime));\n             }\n         } catch (RuntimeException rte) {\n             throw rte;\n@@ -332,16 +337,17 @@ private void waitForContainerAlive(String containerName, BundleContext syscontex\n             System.out.println(String.format(\"Waiting for container: %s\", containerName));\n \n             Exception lastException \u003d null;\n-            long startedAt \u003d System.currentTimeMillis();\n-            while (!Thread.interrupted() \u0026\u0026 System.currentTimeMillis() \u003c startedAt + timeout) {\n-                ServiceReference\u003cFabricService\u003e sref \u003d syscontext.getServiceReference(FabricService.class);\n-                FabricService fabricService \u003d sref !\u003d null ? syscontext.getService(sref) : null;\n+            long now \u003d System.currentTimeMillis();\n+            long end \u003d now + timeout;\n+            while (!Thread.interrupted() \u0026\u0026 now \u003c end) {\n+                FabricService fabricService \u003d ServiceLocator.getRequiredService(FabricService.class);\n                 try {\n-                    Container container \u003d fabricService !\u003d null ? fabricService.getContainer(containerName) : null;\n+                    Container container \u003d fabricService.getContainer(containerName);\n                     if (container !\u003d null \u0026\u0026 container.isAlive()) {\n                         return;\n                     } else {\n                         Thread.sleep(500);\n+                        now \u003d System.currentTimeMillis();\n                     }\n                 } catch (InterruptedException ex) {\n                     Thread.currentThread().interrupt();"
        },
        {
          "file_name": "fabric/fabric-core/src/main/java/io/fabric8/service/ComponentConfigurer.java",
          "patch": "@@ -19,6 +19,7 @@\n import io.fabric8.api.scr.Configurer;\n import io.fabric8.api.scr.ValidatingReference;\n import io.fabric8.api.scr.support.ConfigInjection;\n+\n import org.apache.felix.scr.annotations.Activate;\n import org.apache.felix.scr.annotations.Component;\n import org.apache.felix.scr.annotations.Deactivate;\n@@ -31,6 +32,7 @@\n import org.jboss.gravia.runtime.spi.PropertiesProvider;\n import org.jboss.gravia.runtime.spi.SubstitutionPropertiesProvider;\n import org.jboss.gravia.runtime.spi.SystemPropertiesProvider;\n+import org.jboss.gravia.utils.IllegalStateAssertion;\n \n import java.util.Dictionary;\n import java.util.Enumeration;\n@@ -85,6 +87,13 @@ public Object getProperty(String key) {\n             }\n \n             @Override\n+        \tpublic Object getRequiredProperty(String key) {\n+                Object value \u003d getProperty(key, null);\n+                IllegalStateAssertion.assertNotNull(value, \"Cannot obtain property: \" + key);\n+        \t\treturn value;\n+        \t}\n+            \n+            @Override\n             public Object getProperty(String key, Object defaultValue) {\n                 Object value \u003d null;\n                 for (PropertiesProvider p : propertiesProviders) {"
        },
        {
          "file_name": "fabric/fabric-core/src/main/java/io/fabric8/service/FabricCompleteService.java",
          "patch": "@@ -0,0 +1,50 @@\n+/**\n+ *  Copyright 2005-2014 Red Hat, Inc.\n+ *\n+ *  Red Hat licenses this file to you under the Apache License, version\n+ *  2.0 (the \"License\"); you may not use this file except in compliance\n+ *  with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ *  implied.  See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+package io.fabric8.service;\n+\n+import io.fabric8.api.FabricComplete;\n+import io.fabric8.api.FabricService;\n+import io.fabric8.api.scr.AbstractComponent;\n+import io.fabric8.service.child.ChildContainerProvider;\n+\n+import org.apache.felix.scr.annotations.Activate;\n+import org.apache.felix.scr.annotations.Component;\n+import org.apache.felix.scr.annotations.Deactivate;\n+import org.apache.felix.scr.annotations.Reference;\n+import org.apache.felix.scr.annotations.Service;\n+\n+/**\n+ * Indicates the completion of the fabric create process.\n+ */\n+@Component(immediate \u003d true)\n+@Service( FabricComplete.class )\n+public final class FabricCompleteService extends AbstractComponent implements FabricComplete {\n+\n+    @Reference\n+    private FabricService fabricService;\n+    @Reference\n+    private ChildContainerProvider childContainerProvider;\n+\n+    @Activate\n+    void activate() {\n+        activateComponent();\n+    }\n+\n+    @Deactivate\n+    void deactivate() {\n+        deactivateComponent();\n+    }\n+}"
        },
        {
          "file_name": "fabric/fabric-core/src/main/java/io/fabric8/service/child/ChildContainerProvider.java",
          "patch": "@@ -15,6 +15,7 @@\n  */\n package io.fabric8.service.child;\n \n+import static io.fabric8.utils.Ports.mapPortToRange;\n import io.fabric8.api.Constants;\n import io.fabric8.api.Container;\n import io.fabric8.api.ContainerAutoScaler;\n@@ -37,6 +38,13 @@\n import io.fabric8.utils.AuthenticationUtils;\n import io.fabric8.utils.Ports;\n import io.fabric8.zookeeper.ZkDefs;\n+\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.LinkedHashSet;\n+import java.util.Map;\n+import java.util.Set;\n+\n import org.apache.felix.scr.annotations.Activate;\n import org.apache.felix.scr.annotations.Component;\n import org.apache.felix.scr.annotations.Deactivate;\n@@ -50,17 +58,9 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import java.util.Collection;\n-import java.util.HashMap;\n-import java.util.LinkedHashSet;\n-import java.util.Map;\n-import java.util.Set;\n-\n-import static io.fabric8.utils.Ports.mapPortToRange;\n-\n @ThreadSafe\n @Component(name \u003d \"io.fabric8.container.provider.child\", label \u003d \"Fabric8 Child Container Provider\", immediate \u003d true, metatype \u003d false)\n-@Service(ContainerProvider.class)\n+@Service({ ContainerProvider.class, ChildContainerProvider.class })\n @Properties(\n         @Property(name \u003d \"fabric.container.protocol\", value \u003d ChildContainerProvider.SCHEME)\n )\n@@ -70,11 +70,10 @@\n     static final String SCHEME \u003d \"child\";\n \n     @Reference(referenceInterface \u003d FabricService.class)\n-    private final ValidatingReference\u003cFabricService\u003e fabricService \u003d new ValidatingReference\u003cFabricService\u003e();\n-\n-    @Reference(referenceInterface \u003d ProcessControllerFactory.class, cardinality \u003d ReferenceCardinality.OPTIONAL_UNARY,\n-            policy \u003d ReferencePolicy.DYNAMIC, bind \u003d \"bindProcessControllerFactory\", unbind \u003d \"unbindProcessControllerFactory\")\n-    private ProcessControllerFactory processControllerFactory;\n+    private final ValidatingReference\u003cFabricService\u003e fabricService \u003d new ValidatingReference\u003c\u003e();\n+    // [TODO] #1916 Migrate process-manager to SCR\n+    @Reference(referenceInterface \u003d ProcessControllerFactory.class, cardinality \u003d ReferenceCardinality.OPTIONAL_UNARY, policy \u003d ReferencePolicy.DYNAMIC, bind \u003d \"bindProcessControllerFactory\", unbind \u003d \"unbindProcessControllerFactory\")\n+    private final ValidatingReference\u003cProcessControllerFactory\u003e processControllerFactory \u003d new ValidatingReference\u003c\u003e();\n \n     @Activate\n     void activate() {\n@@ -89,29 +88,32 @@ void deactivate() {\n \n     @Override\n     public CreateChildContainerOptions.Builder newBuilder() {\n+        assertValid();\n         return CreateChildContainerOptions.builder();\n     }\n \n     @Override\n     public CreateChildContainerMetadata create(final CreateChildContainerOptions options, final CreationStateListener listener) throws Exception {\n         assertValid();\n-\n         ChildContainerController controller \u003d createController(options);\n         return controller.create(options, listener);\n     }\n \n     @Override\n     public void start(final Container container) {\n+        assertValid();\n         getContainerController(container).start(container);\n     }\n \n     @Override\n     public void stop(final Container container) {\n+        assertValid();\n         getContainerController(container).stop(container);\n     }\n \n     @Override\n     public void destroy(final Container container) {\n+        assertValid();\n         getContainerController(container).destroy(container);\n     }\n \n@@ -122,24 +124,27 @@ public String getScheme() {\n \n     @Override\n     public Class\u003cCreateChildContainerOptions\u003e getOptionsType() {\n+        assertValid();\n         return CreateChildContainerOptions.class;\n     }\n \n     @Override\n     public Class\u003cCreateChildContainerMetadata\u003e getMetadataType() {\n+        assertValid();\n         return CreateChildContainerMetadata.class;\n     }\n \n     @Override\n     public ContainerAutoScaler createAutoScaler() {\n+        assertValid();\n         return new ChildAutoScaler(this);\n     }\n \n-    protected ChildContainerController createController(CreateChildContainerOptions options) throws Exception {\n+    private ChildContainerController createController(CreateChildContainerOptions options) throws Exception {\n         ChildContainerController answer \u003d null;\n         boolean isJavaContainer \u003d ChildContainers.isJavaContainer(getFabricService(), options);\n         boolean isProcessContainer \u003d ChildContainers.isProcessContainer(getFabricService(), options);\n-        ProcessControllerFactory factory \u003d processControllerFactory;\n+        ProcessControllerFactory factory \u003d processControllerFactory.getOptional();\n         if (factory !\u003d null) {\n             answer \u003d factory.createController(options);\n         } else if (isJavaContainer || isProcessContainer) {\n@@ -152,11 +157,11 @@ protected ChildContainerController createController(CreateChildContainerOptions\n         return answer;\n     }\n \n-    protected ChildContainerController getContainerController(Container container) {\n+    private ChildContainerController getContainerController(Container container) {\n         assertValid();\n         ChildContainerController answer \u003d null;\n         try {\n-            ProcessControllerFactory factory \u003d processControllerFactory;\n+            ProcessControllerFactory factory \u003d processControllerFactory.getOptional();\n             if (factory !\u003d null) {\n                 answer \u003d factory.getControllerForContainer(container);\n             }\n@@ -171,7 +176,7 @@ protected ChildContainerController getContainerController(Container container) {\n         return answer;\n     }\n \n-    protected ChildContainerController createKarafContainerController() {\n+    private ChildContainerController createKarafContainerController() {\n         return new ChildContainerController() {\n             @Override\n             public CreateChildContainerMetadata create(final CreateChildContainerOptions options, final CreationStateListener listener) {\n@@ -396,20 +401,20 @@ private static String collectionAsString(Collection\u003cString\u003e value) {\n         return sb.toString();\n     }\n \n-    void bindFabricService(FabricService fabricService) {\n-        this.fabricService.bind(fabricService);\n+    void bindFabricService(FabricService service) {\n+        fabricService.bind(service);\n     }\n \n-    void unbindFabricService(FabricService fabricService) {\n-        this.fabricService.unbind(fabricService);\n+    void unbindFabricService(FabricService service) {\n+        fabricService.unbind(service);\n     }\n \n \n-    void bindProcessControllerFactory(ProcessControllerFactory processControllerFactory) {\n-        this.processControllerFactory \u003d processControllerFactory;\n+    void bindProcessControllerFactory(ProcessControllerFactory service) {\n+        processControllerFactory.bind(service);\n     }\n \n-    void unbindProcessControllerFactory(ProcessControllerFactory processControllerFactory) {\n-        this.processControllerFactory \u003d null;\n+    void unbindProcessControllerFactory(ProcessControllerFactory service) {\n+        processControllerFactory.unbind(service);\n     }\n }"
        },
        {
          "file_name": "pom.xml",
          "patch": "@@ -202,7 +202,7 @@\n         \u003cgeronimo-ws-metadata.version\u003e1.1.3\u003c/geronimo-ws-metadata.version\u003e\n         \u003cgeronimo-atinject.version\u003e1.0\u003c/geronimo-atinject.version\u003e\n         \u003cgitective-version\u003e0.9.9\u003c/gitective-version\u003e\n-        \u003cgravia-version\u003e1.1.0.Beta34\u003c/gravia-version\u003e\n+        \u003cgravia-version\u003e1.1.0.Beta36\u003c/gravia-version\u003e\n         \u003cgroovy-version\u003e2.3.3\u003c/groovy-version\u003e\n         \u003cguava-version\u003e15.0\u003c/guava-version\u003e\n         \u003cguava.osgi.version.clean\u003e15.0\u003c/guava.osgi.version.clean\u003e"
        },
        {
          "file_name": "runtime/container/tomcat/webapp/src/main/java/io/fabric8/portable/runtime/tomcat/FabricPropertiesProvider.java",
          "patch": "@@ -16,39 +16,36 @@\n package io.fabric8.portable.runtime.tomcat;\n \n import io.fabric8.api.RuntimeProperties;\n-import org.jboss.gravia.container.tomcat.support.TomcatPropertiesProvider;\n+\n+import javax.servlet.ServletContext;\n+\n+import org.jboss.gravia.container.tomcat.support.ServletContextPropertiesProvider;\n+import org.jboss.gravia.runtime.spi.AbstractPropertiesProvider;\n import org.jboss.gravia.runtime.spi.CompositePropertiesProvider;\n import org.jboss.gravia.runtime.spi.EnvPropertiesProvider;\n import org.jboss.gravia.runtime.spi.PropertiesProvider;\n import org.jboss.gravia.runtime.spi.SubstitutionPropertiesProvider;\n import org.jboss.gravia.runtime.spi.SystemPropertiesProvider;\n \n-import javax.servlet.ServletContext;\n-\n /**\n  * The Fabric {@link PropertiesProvider}\n  */\n-public class FabricPropertiesProvider  implements PropertiesProvider {\n+public class FabricPropertiesProvider extends AbstractPropertiesProvider {\n \n \n     private final PropertiesProvider delegate;\n \n     public FabricPropertiesProvider(ServletContext servletContext) {\n         delegate \u003d new SubstitutionPropertiesProvider(\n                 new CompositePropertiesProvider(\n-                        new TomcatPropertiesProvider(servletContext),\n+                        new ServletContextPropertiesProvider(servletContext),\n                         new SystemPropertiesProvider(),\n                         new EnvPropertiesProvider(RuntimeProperties.DEFAULT_ENV_PREFIX)\n                 )\n         );\n     }\n \n     @Override\n-    public Object getProperty(String key) {\n-        return delegate.getProperty(key);\n-    }\n-\n-    @Override\n     public Object getProperty(String key, Object defaultValue) {\n         return delegate.getProperty(key, defaultValue);\n     }"
        },
        {
          "file_name": "runtime/embedded/pom.xml",
          "patch": "@@ -27,7 +27,7 @@\n     \u003cmodelVersion\u003e4.0.0\u003c/modelVersion\u003e\n \n     \u003cgroupId\u003eio.fabric8.runtime\u003c/groupId\u003e\n-    \u003cartifactId\u003eembedded\u003c/artifactId\u003e\n+    \u003cartifactId\u003efabric-runtime-embedded\u003c/artifactId\u003e\n     \u003cname\u003eFabric8 :: Runtime :: Embedded\u003c/name\u003e\n     \u003cpackaging\u003ebundle\u003c/packaging\u003e\n \n@@ -39,7 +39,6 @@\n             io.fabric8.runtime.embedded.registration,\n             io.fabric8.utils;-split-package:\u003dfirst\n         \u003c/fuse.osgi.private.pkg\u003e\n-\n         \u003cfuse.osgi.service.component\u003e\n             \u003c!-- Use explicit file locations because there is no support for wildcard resource discovery in non-osgi environments --\u003e\n             OSGI-INF/io.fabric8.runtime.embedded.registration.EmbeddedContainerRegistration.xml,"
        },
        {
          "file_name": "runtime/itests/common/src/main/java/io/fabric8/runtime/itests/BootstrapServiceTest.java",
          "patch": "@@ -18,22 +18,22 @@\n import io.fabric8.api.FabricService;\n import io.fabric8.api.ZooKeeperClusterBootstrap;\n import io.fabric8.runtime.itests.support.CommandSupport;\n-import io.fabric8.runtime.itests.support.ServiceLocator;\n \n import java.io.InputStream;\n \n import org.jboss.arquillian.container.test.api.Deployment;\n import org.jboss.arquillian.junit.Arquillian;\n import org.jboss.arquillian.osgi.StartLevelAware;\n import org.jboss.gravia.Constants;\n+import org.jboss.gravia.itests.support.AnnotatedContextListener;\n+import org.jboss.gravia.itests.support.ArchiveBuilder;\n import org.jboss.gravia.resource.ManifestBuilder;\n import org.jboss.gravia.runtime.RuntimeLocator;\n import org.jboss.gravia.runtime.RuntimeType;\n+import org.jboss.gravia.runtime.ServiceLocator;\n import org.jboss.osgi.metadata.OSGiManifestBuilder;\n import org.jboss.shrinkwrap.api.Archive;\n import org.jboss.shrinkwrap.api.asset.Asset;\n-import org.jboss.gravia.itests.support.AnnotatedContextListener;\n-import org.jboss.gravia.itests.support.ArchiveBuilder;\n import org.junit.Assert;\n import org.junit.Test;\n import org.junit.runner.RunWith;"
        },
        {
          "file_name": "runtime/itests/common/src/main/java/io/fabric8/runtime/itests/ContainerStartupTest.java",
          "patch": "@@ -22,7 +22,6 @@\n import io.fabric8.api.FabricService;\n import io.fabric8.api.ZooKeeperClusterBootstrap;\n import io.fabric8.runtime.itests.support.CommandSupport;\n-import io.fabric8.runtime.itests.support.ServiceLocator;\n import io.fabric8.utils.Base64Encoder;\n import io.fabric8.utils.PasswordEncoder;\n \n@@ -38,6 +37,7 @@\n import org.jboss.gravia.resource.ManifestBuilder;\n import org.jboss.gravia.runtime.RuntimeLocator;\n import org.jboss.gravia.runtime.RuntimeType;\n+import org.jboss.gravia.runtime.ServiceLocator;\n import org.jboss.osgi.metadata.OSGiManifestBuilder;\n import org.jboss.shrinkwrap.api.Archive;\n import org.jboss.shrinkwrap.api.asset.Asset;"
        },
        {
          "file_name": "runtime/itests/common/src/main/java/io/fabric8/runtime/itests/FabricCreateCommandTest.java",
          "patch": "@@ -19,7 +19,6 @@\n import io.fabric8.api.Container;\n import io.fabric8.api.FabricService;\n import io.fabric8.runtime.itests.support.CommandSupport;\n-import io.fabric8.runtime.itests.support.ServiceLocator;\n import io.fabric8.utils.Base64Encoder;\n import io.fabric8.utils.PasswordEncoder;\n \n@@ -32,14 +31,15 @@\n import org.jboss.arquillian.junit.Arquillian;\n import org.jboss.arquillian.osgi.StartLevelAware;\n import org.jboss.gravia.Constants;\n+import org.jboss.gravia.itests.support.AnnotatedContextListener;\n+import org.jboss.gravia.itests.support.ArchiveBuilder;\n import org.jboss.gravia.resource.ManifestBuilder;\n import org.jboss.gravia.runtime.RuntimeLocator;\n import org.jboss.gravia.runtime.RuntimeType;\n+import org.jboss.gravia.runtime.ServiceLocator;\n import org.jboss.osgi.metadata.OSGiManifestBuilder;\n import org.jboss.shrinkwrap.api.Archive;\n import org.jboss.shrinkwrap.api.asset.Asset;\n-import org.jboss.gravia.itests.support.AnnotatedContextListener;\n-import org.jboss.gravia.itests.support.ArchiveBuilder;\n import org.junit.Assert;\n import org.junit.Test;\n import org.junit.runner.RunWith;"
        },
        {
          "file_name": "runtime/itests/common/src/main/java/io/fabric8/runtime/itests/support/CommandSupport.java",
          "patch": "@@ -31,6 +31,7 @@\n import org.jboss.gravia.runtime.ModuleContext;\n import org.jboss.gravia.runtime.RuntimeLocator;\n import org.jboss.gravia.runtime.RuntimeType;\n+import org.jboss.gravia.runtime.ServiceLocator;\n import org.junit.Assert;\n \n /**"
        },
        {
          "file_name": "runtime/itests/common/src/main/java/io/fabric8/runtime/itests/support/ContainerBuilder.java",
          "patch": "@@ -35,6 +35,7 @@\n \n import org.jboss.gravia.runtime.ModuleContext;\n import org.jboss.gravia.runtime.RuntimeLocator;\n+import org.jboss.gravia.runtime.ServiceLocator;\n \n public abstract class ContainerBuilder\u003cT extends ContainerBuilder, B extends CreateContainerBasicOptions.Builder\u003e {\n "
        },
        {
          "file_name": "runtime/itests/common/src/main/java/io/fabric8/runtime/itests/support/CreateContainerTask.java",
          "patch": "@@ -15,7 +15,11 @@\n  */\n package io.fabric8.runtime.itests.support;\n \n-import io.fabric8.api.*;\n+import io.fabric8.api.Container;\n+import io.fabric8.api.CreateContainerBasicOptions;\n+import io.fabric8.api.CreateContainerMetadata;\n+import io.fabric8.api.FabricException;\n+import io.fabric8.api.FabricService;\n \n import java.util.HashSet;\n import java.util.Set;"
        },
        {
          "file_name": "runtime/itests/common/src/main/java/io/fabric8/runtime/itests/support/Provision.java",
          "patch": "@@ -40,6 +40,7 @@\n \n import org.jboss.gravia.runtime.ModuleContext;\n import org.jboss.gravia.runtime.RuntimeLocator;\n+import org.jboss.gravia.runtime.ServiceLocator;\n \n public class Provision {\n "
        },
        {
          "file_name": "runtime/itests/common/src/main/java/io/fabric8/runtime/itests/support/ServiceLocator.java",
          "patch": "@@ -1,107 +0,0 @@\n-/**\n- *  Copyright 2005-2014 Red Hat, Inc.\n- *\n- *  Red Hat licenses this file to you under the Apache License, version\n- *  2.0 (the \"License\"); you may not use this file except in compliance\n- *  with the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- *  Unless required by applicable law or agreed to in writing, software\n- *  distributed under the License is distributed on an \"AS IS\" BASIS,\n- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n- *  implied.  See the License for the specific language governing\n- *  permissions and limitations under the License.\n- */\n-package io.fabric8.runtime.itests.support;\n-\n-import java.util.concurrent.CountDownLatch;\n-import java.util.concurrent.TimeUnit;\n-import java.util.concurrent.atomic.AtomicReference;\n-\n-import org.jboss.gravia.runtime.Filter;\n-import org.jboss.gravia.runtime.ModuleContext;\n-import org.jboss.gravia.runtime.RuntimeLocator;\n-import org.jboss.gravia.runtime.ServiceReference;\n-import org.jboss.gravia.runtime.ServiceTracker;\n-import org.junit.Assert;\n-\n-public final class ServiceLocator {\n-\n-\tpublic static final Long DEFAULT_TIMEOUT \u003d 60000L;\n-\n-\tprivate ServiceLocator() {\n-\t\t//Utility Class\n-\t}\n-\n-    public static \u003cT\u003e T getService(Class\u003cT\u003e type) {\n-        ModuleContext moduleContext \u003d RuntimeLocator.getRequiredRuntime().getModuleContext();\n-        ServiceReference\u003cT\u003e sref \u003d moduleContext.getServiceReference(type);\n-        return sref !\u003d null ? moduleContext.getService(sref) : null;\n-    }\n-\n-    public static \u003cT\u003e T getService(ModuleContext moduleContext, Class\u003cT\u003e type) {\n-        ServiceReference\u003cT\u003e sref \u003d moduleContext.getServiceReference(type);\n-        return sref !\u003d null ? moduleContext.getService(sref) : null;\n-    }\n-\n-    public static \u003cT\u003e T getRequiredService(Class\u003cT\u003e type) {\n-        T service \u003d getService(RuntimeLocator.getRequiredRuntime().getModuleContext(), type);\n-        Assert.assertNotNull(\"Service available: \" + type.getName(), service);\n-        return service;\n-    }\n-\n-    public static \u003cT\u003e T getRequiredService(ModuleContext moduleContext, Class\u003cT\u003e type) {\n-        T service \u003d getService(moduleContext, type);\n-        Assert.assertNotNull(\"Service available: \" + type.getName(), service);\n-        return service;\n-    }\n-\n-    public static \u003cT\u003e T awaitService(Class\u003cT\u003e type) {\n-        ModuleContext moduleContext \u003d RuntimeLocator.getRequiredRuntime().getModuleContext();\n-        return awaitService(moduleContext, type, null, DEFAULT_TIMEOUT, TimeUnit.MILLISECONDS);\n-    }\n-\n-    public static \u003cT\u003e T awaitService(ModuleContext moduleContext, Class\u003cT\u003e type) {\n-        return awaitService(moduleContext, type, null, DEFAULT_TIMEOUT, TimeUnit.MILLISECONDS);\n-    }\n-\n-    public static \u003cT\u003e T awaitService(Class\u003cT\u003e type, String filterspec) {\n-        ModuleContext moduleContext \u003d RuntimeLocator.getRequiredRuntime().getModuleContext();\n-        return awaitService(moduleContext, type, filterspec, DEFAULT_TIMEOUT, TimeUnit.MILLISECONDS);\n-    }\n-\n-    public static \u003cT\u003e T awaitService(Class\u003cT\u003e type, String filterspec, long timeout, TimeUnit unit) {\n-        ModuleContext moduleContext \u003d RuntimeLocator.getRequiredRuntime().getModuleContext();\n-        return awaitService(moduleContext, type, filterspec, timeout, unit);\n-    }\n-\n-    public static \u003cT\u003e T awaitService(final ModuleContext moduleContext, Class\u003cT\u003e type, String filterspec, long timeout, TimeUnit unit) {\n-\n-        final CountDownLatch latch \u003d new CountDownLatch(1);\n-        final AtomicReference\u003cT\u003e serviceRef \u003d new AtomicReference\u003cT\u003e();\n-        final Filter srvfilter \u003d filterspec !\u003d null ? moduleContext.createFilter(filterspec) : null;\n-        ServiceTracker\u003cT, T\u003e tracker \u003d new ServiceTracker\u003cT, T\u003e(moduleContext, type, null) {\n-            @Override\n-            public T addingService(ServiceReference\u003cT\u003e sref) {\n-                T service \u003d super.addingService(sref);\n-                if (srvfilter \u003d\u003d null || srvfilter.match(sref)) {\n-                    serviceRef.set(moduleContext.getService(sref));\n-                    latch.countDown();\n-                }\n-                return service;\n-            }\n-        };\n-        tracker.open();\n-        try {\n-            if (!latch.await(timeout, unit)) {\n-                throw new RuntimeException(\"Cannot obtain service: \" + srvfilter);\n-            }\n-            return serviceRef.get();\n-        } catch (InterruptedException ex) {\n-            throw new IllegalStateException();\n-        } finally {\n-            tracker.close();\n-        }\n-\t}\n-}"
        },
        {
          "file_name": "runtime/itests/common/src/main/java/io/fabric8/runtime/itests/support/WaitForContainerCreationTask.java",
          "patch": "@@ -22,6 +22,7 @@\n \n import org.jboss.gravia.runtime.ModuleContext;\n import org.jboss.gravia.runtime.RuntimeLocator;\n+import org.jboss.gravia.runtime.ServiceLocator;\n \n /**\n  * A {@link java.util.concurrent.Callable} that waits for the {@link io.fabric8.api.Container} to get created."
        },
        {
          "file_name": "runtime/itests/common/src/main/java/io/fabric8/runtime/itests/support/WaitForInstanceStartedTask.java",
          "patch": "@@ -21,6 +21,7 @@\n import org.apache.karaf.admin.Instance;\n import org.jboss.gravia.runtime.ModuleContext;\n import org.jboss.gravia.runtime.RuntimeLocator;\n+import org.jboss.gravia.runtime.ServiceLocator;\n \n /**\n  * A {@link java.util.concurrent.Callable} that waits for the {@link io.fabric8.api.Container} to get created."
        },
        {
          "file_name": "runtime/itests/embedded/pom.xml",
          "patch": "@@ -35,15 +35,13 @@\n     \u003cname\u003eFabric8 :: Runtime :: Integration Tests :: Embedded\u003c/name\u003e\n \n     \u003cproperties\u003e\n-        \u003cruntime.id\u003eroot\u003c/runtime.id\u003e\n-        \u003cruntime.home\u003e${project.build.directory}/home\u003c/runtime.home\u003e\n+        \u003cruntime.home\u003e${project.build.directory}/runtime\u003c/runtime.home\u003e\n     \u003c/properties\u003e\n     \n     \u003cdependencies\u003e\n         \u003cdependency\u003e\n             \u003cgroupId\u003eio.fabric8\u003c/groupId\u003e\n             \u003cartifactId\u003efabric-api\u003c/artifactId\u003e\n-            \u003cversion\u003e${project.version}\u003c/version\u003e\n         \u003c/dependency\u003e\n         \u003cdependency\u003e\n             \u003cgroupId\u003eio.fabric8.runtime\u003c/groupId\u003e\n@@ -52,7 +50,7 @@\n         \u003c/dependency\u003e\n         \u003cdependency\u003e\n             \u003cgroupId\u003eio.fabric8.runtime\u003c/groupId\u003e\n-            \u003cartifactId\u003eembedded\u003c/artifactId\u003e\n+            \u003cartifactId\u003efabric-runtime-embedded\u003c/artifactId\u003e\n             \u003cversion\u003e${project.version}\u003c/version\u003e\n         \u003c/dependency\u003e\n         \u003cdependency\u003e\n@@ -85,6 +83,12 @@\n         \u003c/dependency\u003e\n         \u003cdependency\u003e\n             \u003cgroupId\u003eio.fabric8\u003c/groupId\u003e\n+            \u003cartifactId\u003efabric-process-container\u003c/artifactId\u003e\n+            \u003cversion\u003e${project.version}\u003c/version\u003e\n+            \u003cscope\u003eprovided\u003c/scope\u003e\n+        \u003c/dependency\u003e\n+        \u003cdependency\u003e\n+            \u003cgroupId\u003eio.fabric8\u003c/groupId\u003e\n             \u003cartifactId\u003efabric-zookeeper\u003c/artifactId\u003e\n             \u003cversion\u003e${project.version}\u003c/version\u003e\n             \u003cscope\u003eprovided\u003c/scope\u003e\n@@ -130,7 +134,7 @@\n                             \u003ctarget\u003e\n                                 \u003cmkdir dir\u003d\"${runtime.home}\"/\u003e\n                                 \u003ccopy todir\u003d\"${runtime.home}\" overwrite\u003d\"true\"\u003e\n-                                    \u003cfileset dir\u003d\"${basedir}/src/test/etc/home\" /\u003e\n+                                    \u003cfileset dir\u003d\"${basedir}/src/test/etc/runtime\" /\u003e\n                                 \u003c/copy\u003e\n                             \u003c/target\u003e\n                         \u003c/configuration\u003e\n@@ -170,8 +174,13 @@\n                                     \u003cversion\u003e${project.version}\u003c/version\u003e\n                                 \u003c/artifactItem\u003e\n                                 \u003cartifactItem\u003e\n+                                    \u003cgroupId\u003eio.fabric8\u003c/groupId\u003e\n+                                    \u003cartifactId\u003efabric-process-container\u003c/artifactId\u003e\n+                                    \u003cversion\u003e${project.version}\u003c/version\u003e\n+                                \u003c/artifactItem\u003e\n+                                \u003cartifactItem\u003e\n                                     \u003cgroupId\u003eio.fabric8.runtime\u003c/groupId\u003e\n-                                    \u003cartifactId\u003eembedded\u003c/artifactId\u003e\n+                                    \u003cartifactId\u003efabric-runtime-embedded\u003c/artifactId\u003e\n                                     \u003cversion\u003e${project.version}\u003c/version\u003e\n                                 \u003c/artifactItem\u003e\n                             \u003c/artifactItems\u003e\n@@ -184,17 +193,9 @@\n                 \u003cconfiguration\u003e\n                     \u003cargLine\u003e${surefire.system.args}\u003c/argLine\u003e\n                     \u003cfailIfNoTests\u003efalse\u003c/failIfNoTests\u003e\n-                    \u003cworkingDirectory\u003e${runtime.home}\u003c/workingDirectory\u003e\n                     \u003csystemPropertyVariables\u003e\n-                        \u003c!--felix.cm.loglevel\u003e3\u003c/felix.cm.loglevel--\u003e\n-                        \u003cbasedir\u003e${basedir}\u003c/basedir\u003e\n+                        \u003c!-- felix.cm.loglevel\u003e3\u003c/felix.cm.loglevel --\u003e\n                         \u003clog4j.configuration\u003efile://${basedir}/src/test/resources/logging.properties\u003c/log4j.configuration\u003e\n-                        \u003cruntime.home\u003e${runtime.home}\u003c/runtime.home\u003e\n-                        \u003cruntime.home\u003e${runtime.home}\u003c/runtime.home\u003e\n-                        \u003cruntime.data\u003e${runtime.home}/data\u003c/runtime.data\u003e\n-                        \u003cruntime.conf\u003e${runtime.home}/conf\u003c/runtime.conf\u003e\n-                        \u003cruntime.id\u003e${runtime.id}\u003c/runtime.id\u003e\n-                        \u003cprofiles.auto.import.path\u003e${runtime.home}/fabric/import\u003c/profiles.auto.import.path\u003e\n                     \u003c/systemPropertyVariables\u003e\n                 \u003c/configuration\u003e\n             \u003c/plugin\u003e"
        },
        {
          "file_name": "runtime/itests/embedded/src/test/etc/runtime/conf/io.fabric8.datastore.cfg"
        },
        {
          "file_name": "runtime/itests/embedded/src/test/etc/runtime/conf/org.apache.felix.scr.ScrService.cfg",
          "patch": "@@ -20,4 +20,4 @@\n # #L%\n ###\n \n-ds.loglevel\u003d4\n\\ No newline at end of file\n+#ds.loglevel\u003d4\n\\ No newline at end of file"
        },
        {
          "file_name": "runtime/itests/embedded/src/test/etc/runtime/conf/system.properties"
        },
        {
          "file_name": "runtime/itests/embedded/src/test/etc/runtime/conf/users.properties"
        },
        {
          "file_name": "runtime/itests/embedded/src/test/etc/runtime/fabric/import/fabric/profiles/default/io.fabric8.fabric.version.properties"
        },
        {
          "file_name": "runtime/itests/embedded/src/test/etc/runtime/fabric/readme.txt"
        },
        {
          "file_name": "runtime/itests/embedded/src/test/java/io/fabric8/test/fabric/runtime/embedded/BootstrapCompleteTest.java",
          "patch": "@@ -17,11 +17,11 @@\n \n import io.fabric8.api.CreateEnsembleOptions;\n import io.fabric8.git.GitService;\n-import io.fabric8.runtime.itests.support.ServiceLocator;\n+import io.fabric8.test.fabric.runtime.embedded.support.AbstractEmbeddedTest;\n import io.fabric8.zookeeper.bootstrap.BootstrapConfiguration;\n \n-import io.fabric8.test.fabric.runtime.embedded.support.AbstractEmbeddedTest;\n import org.jboss.arquillian.junit.Arquillian;\n+import org.jboss.gravia.runtime.ServiceLocator;\n import org.junit.Assert;\n import org.junit.Test;\n import org.junit.runner.RunWith;"
        },
        {
          "file_name": "runtime/itests/embedded/src/test/java/io/fabric8/test/fabric/runtime/embedded/FabricBootstrapTest.java",
          "patch": "@@ -17,22 +17,21 @@\n \n import io.fabric8.api.Constants;\n import io.fabric8.api.Container;\n-import io.fabric8.api.ContainerProvider;\n import io.fabric8.api.CreateEnsembleOptions;\n import io.fabric8.api.CreateEnsembleOptions.Builder;\n import io.fabric8.api.DataStore;\n import io.fabric8.api.FabricService;\n import io.fabric8.api.PortService;\n import io.fabric8.api.ZooKeeperClusterBootstrap;\n import io.fabric8.git.GitService;\n-import io.fabric8.runtime.itests.support.ServiceLocator;\n+import io.fabric8.test.fabric.runtime.embedded.support.AbstractEmbeddedTest;\n import io.fabric8.utils.PasswordEncoder;\n \n import java.util.Dictionary;\n \n import org.apache.curator.framework.CuratorFramework;\n-import io.fabric8.test.fabric.runtime.embedded.support.AbstractEmbeddedTest;\n import org.jboss.arquillian.junit.Arquillian;\n+import org.jboss.gravia.runtime.ServiceLocator;\n import org.junit.Assert;\n import org.junit.Test;\n import org.junit.runner.RunWith;"
        },
        {
          "file_name": "runtime/itests/embedded/src/test/java/io/fabric8/test/fabric/runtime/embedded/support/AbstractEmbeddedTest.java",
          "patch": "@@ -32,8 +32,14 @@\n  */\n public abstract class AbstractEmbeddedTest {\n \n-    private static String[] moduleNames \u003d new String[] { \"fabric-boot-commands\",\n-            \"fabric-core\", \"fabric-git\", \"fabric-zookeeper\", \"embedded\" };\n+    private static String[] moduleNames \u003d new String[] { \n+    \t\"fabric-boot-commands\",\n+        \"fabric-core\", \n+        \"fabric-git\", \n+        \"fabric-zookeeper\", \n+        \"fabric-process-container\", \n+        \"fabric-runtime-embedded\"\n+    };\n \n     @BeforeClass\n     public static void beforeClass() throws Exception {"
        },
        {
          "file_name": "runtime/itests/embedded/src/test/java/io/fabric8/test/fabric/runtime/embedded/support/EmbeddedUtils.java",
          "patch": "@@ -110,6 +110,6 @@ public static Module installAndStartModule(ClassLoader classLoader, Resource res\n     }\n \n     private static File getModuleFile(String modname) {\n-        return new File(\"system/modules/\" + modname + \".jar\").getAbsoluteFile();\n+        return new File(\"target/runtime/system/modules/\" + modname + \".jar\").getAbsoluteFile();\n     }\n }"
        },
        {
          "file_name": "runtime/itests/embedded/src/test/resources/gravia.properties",
          "patch": "@@ -14,8 +14,14 @@\n #  permissions and limitations under the License.\n #\n \n-org.jboss.gravia.runtime.storage\u003dtarget/runtime\n+org.jboss.gravia.runtime.configurations.dir\u003dtarget/runtime/conf\n+org.jboss.gravia.runtime.storage.dir\u003dtarget/runtime/data/storage\n org.jboss.gravia.runtime.storage.clean\u003donFirstInit\n-\n-org.jboss.gravia.runtime.configurations.dir\u003d${basedir}/target/home/conf/\n  \n+runtime.home\u003dtarget/runtime\n+runtime.conf\u003dtarget/runtime/conf\n+runtime.data\u003dtarget/runtime/data\n+runtime.id\u003dembedded\n+\n+profiles.auto.import.path\u003dtarget/runtime/fabric/import\n+"
        },
        {
          "file_name": "runtime/itests/embedded/src/test/resources/logging.properties",
          "patch": "@@ -17,13 +17,16 @@\n # Root logger option\n log4j.rootLogger\u003dDEBUG, file, console\n  \n+# Set specific logger levels\n+log4j.logger.org.apache.zookeeper\u003dinfo\n+\n # Direct log messages to a log file\n log4j.appender.file\u003dorg.apache.log4j.FileAppender\n-log4j.appender.file.File\u003ddata/log/gravia.log\n-log4j.appender.file.append\u003dfalse\n+log4j.appender.file.File\u003dtarget/runtime/data/log/gravia.log\n log4j.appender.file.layout\u003dorg.apache.log4j.PatternLayout\n log4j.appender.file.layout.ConversionPattern\u003d%d{yyyy-MM-dd HH:mm:ss} %-5p [%c] (%t) - %m%n\n log4j.appender.file.Threshold\u003dDEBUG\n+log4j.appender.file.append\u003dfalse\n  \n # Direct log messages to console\n log4j.appender.console\u003dorg.apache.log4j.ConsoleAppender"
        },
        {
          "file_name": "runtime/itests/karaf/src/test/java/io/fabric8/runtime/itests/karaf/EnsembleTest.java",
          "patch": "@@ -23,7 +23,6 @@\n import io.fabric8.runtime.itests.support.ContainerBuilder;\n import io.fabric8.runtime.itests.support.FabricEnsembleSupport;\n import io.fabric8.runtime.itests.support.Provision;\n-import io.fabric8.runtime.itests.support.ServiceLocator;\n import io.fabric8.runtime.itests.support.ServiceProxy;\n \n import java.io.InputStream;\n@@ -39,15 +38,16 @@\n import org.jboss.arquillian.junit.Arquillian;\n import org.jboss.arquillian.osgi.StartLevelAware;\n import org.jboss.gravia.Constants;\n+import org.jboss.gravia.itests.support.AnnotatedContextListener;\n+import org.jboss.gravia.itests.support.ArchiveBuilder;\n import org.jboss.gravia.resource.ManifestBuilder;\n import org.jboss.gravia.runtime.ModuleContext;\n import org.jboss.gravia.runtime.RuntimeLocator;\n import org.jboss.gravia.runtime.RuntimeType;\n+import org.jboss.gravia.runtime.ServiceLocator;\n import org.jboss.osgi.metadata.OSGiManifestBuilder;\n import org.jboss.shrinkwrap.api.Archive;\n import org.jboss.shrinkwrap.api.asset.Asset;\n-import org.jboss.gravia.itests.support.AnnotatedContextListener;\n-import org.jboss.gravia.itests.support.ArchiveBuilder;\n import org.junit.Assert;\n import org.junit.Test;\n import org.junit.runner.RunWith;"
        },
        {
          "file_name": "runtime/itests/karaf/src/test/java/io/fabric8/runtime/itests/karaf/JoinTest.java",
          "patch": "@@ -21,7 +21,6 @@\n import io.fabric8.runtime.itests.support.CommandSupport;\n import io.fabric8.runtime.itests.support.FabricEnsembleSupport;\n import io.fabric8.runtime.itests.support.Provision;\n-import io.fabric8.runtime.itests.support.ServiceLocator;\n import io.fabric8.runtime.itests.support.ServiceProxy;\n \n import java.io.InputStream;\n@@ -34,15 +33,16 @@\n import org.jboss.arquillian.junit.Arquillian;\n import org.jboss.arquillian.osgi.StartLevelAware;\n import org.jboss.gravia.Constants;\n+import org.jboss.gravia.itests.support.AnnotatedContextListener;\n+import org.jboss.gravia.itests.support.ArchiveBuilder;\n import org.jboss.gravia.resource.ManifestBuilder;\n import org.jboss.gravia.runtime.ModuleContext;\n import org.jboss.gravia.runtime.RuntimeLocator;\n import org.jboss.gravia.runtime.RuntimeType;\n+import org.jboss.gravia.runtime.ServiceLocator;\n import org.jboss.osgi.metadata.OSGiManifestBuilder;\n import org.jboss.shrinkwrap.api.Archive;\n import org.jboss.shrinkwrap.api.asset.Asset;\n-import org.jboss.gravia.itests.support.AnnotatedContextListener;\n-import org.jboss.gravia.itests.support.ArchiveBuilder;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.osgi.service.cm.ConfigurationAdmin;"
        }
      ]
    }
  },
  {
    "name": "NPE on improbable race condition",
    "url": "https://github.com/kontalk/androidclient/issues/432",
    "description": "It happens when delivering MSG_IDLE to the (supposedly dead) idle handler, which calls setWakeupAlarm, realizing that mAlarmManager is null because the service has already been destroyed.\n\nStacktrace is from 3.0-rc3.\n\n```\njava.lang.NullPointerException\nat org.kontalk.service.msgcenter.MessageCenterService.setWakeupAlarm(MessageCenterService.java:2295)\nat org.kontalk.service.msgcenter.MessageCenterService.access$100(MessageCenterService.java:138)\nat org.kontalk.service.msgcenter.MessageCenterService$IdleConnectionHandler.handleMessage(MessageCenterService.java:412)\nat org.kontalk.service.msgcenter.MessageCenterService$IdleConnectionHandler.handleMessage(MessageCenterService.java:402)\nat android.os.Handler.dispatchMessage(Handler.java:99)\nat android.os.Looper.loop(Looper.java:137)\nat android.os.HandlerThread.run(HandlerThread.java:60)\n```\n",
    "keywords": [
      "handler",
      "os",
      "messagecenterservice",
      "org",
      "service",
      "android",
      "msgcenter",
      "kontalk"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/kontalk/androidclient/commit/2ce9c0eb394f00a5c41540431aa296d18fc8c0ab",
      "files": [
        {
          "file_name": "app/src/main/java/org/kontalk/service/msgcenter/MessageCenterService.java",
          "patch": "@@ -2425,7 +2425,10 @@ private void setWakeupAlarm() {\n             getApplicationContext(), 0, getStartIntent(this),\n             PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_ONE_SHOT);\n \n-        mAlarmManager.set(AlarmManager.ELAPSED_REALTIME_WAKEUP,\n+        // we don\u0027t use the shared alarm manager instance here\n+        // since this can happen after the service has begun to stop\n+        AlarmManager am \u003d (AlarmManager) getSystemService(Context.ALARM_SERVICE);\n+        am.set(AlarmManager.ELAPSED_REALTIME_WAKEUP,\n                 SystemClock.elapsedRealtime() + delay, pi);\n     }\n "
        }
      ]
    }
  },
  {
    "name": "Race Condition Results in Incorrect Title in Missions",
    "url": "https://github.com/inaturalist/iNaturalistAndroid/issues/342",
    "description": "Really bad internet out here so sorry if there\u0027s a duplicate issue, but it helped find this bug. If you click the Missions icons too quickly before it loads, I think there\u0027s a possible race condition of the first ajax call returning after the second since presumably theres no cancelling. Alternatively numbering the requests could ensure it doesnt matter what order they return if using same endpoint.\r\n\r\nIt results in the Plant title on the Bird section for example. I\u0027ll upload a screenshot when I have ok signal again.\r\n\r\nAlso a suggestion, if I open one Mission section such as Fungi, then Birds, then return to Fungi, it would be nice to not need to make a request again if I havent travelled far.",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/inaturalist/iNaturalistAndroid/commit/f57a853b5eeef1ef4dedffecb508c8c9a63e2c43",
      "files": [
        {
          "file_name": "iNaturalist/src/main/java/org/inaturalist/android/INaturalistService.java",
          "patch": "@@ -498,6 +498,7 @@ public void onLocation(Location location) {\n                             Intent reply \u003d new Intent(MISSIONS_BY_TAXON_RESULT);\n                             mApp.setServiceResult(MISSIONS_BY_TAXON_RESULT, null);\n                             reply.putExtra(IS_SHARED_ON_APP, true);\n+                            reply.putExtra(TAXON_ID, taxonId);\n                             sendBroadcast(reply);\n                             return;\n                         }\n@@ -507,6 +508,7 @@ public void onLocation(Location location) {\n                         Intent reply \u003d new Intent(MISSIONS_BY_TAXON_RESULT);\n                         mApp.setServiceResult(MISSIONS_BY_TAXON_RESULT, missions);\n                         reply.putExtra(IS_SHARED_ON_APP, true);\n+                        reply.putExtra(TAXON_ID, taxonId);\n                         sendBroadcast(reply);\n                     }\n                 });"
        },
        {
          "file_name": "iNaturalist/src/main/java/org/inaturalist/android/MissionsGridActivity.java",
          "patch": "@@ -279,6 +279,13 @@ public void onReceive(Context context, Intent intent) {\n                 return;\r\n             }\r\n \r\n+            int taxonId \u003d extras.getInt(INaturalistService.TAXON_ID, 0);\r\n+            if (mTaxonId !\u003d taxonId) {\r\n+                // Result returned for other taxon - don\u0027t show it (could happen when switching quickly\r\n+                // between taxon-mission screens)\r\n+                return;\r\n+            }\r\n+\r\n             loadMissions(INaturalistService.MISSIONS_BY_TAXON_RESULT);\r\n             refreshViewState();\r\n         }\r"
        }
      ]
    }
  },
  {
    "name": "Race condition setting timer column text during reset",
    "url": "https://github.com/phrack/ShootOFF/issues/550",
    "description": "Exception in thread \"JavaFX Application Thread\" java.lang.ArrayIndexOutOfBoundsException: -1\n    at java.util.ArrayList.elementData(ArrayList.java:418)\n    at java.util.ArrayList.get(ArrayList.java:431)\n    at com.sun.javafx.collections.ObservableListWrapper.get(ObservableListWrapper.java:89)\n    at com.shootoff.plugins.TrainingExerciseBase.lambda$0(TrainingExerciseBase.java:342)\n",
    "keywords": [
      "java",
      "arraylist"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/phrack/ShootOFF/commit/d334c43ebf5541230deb6e3b1d3526b9d3c73f3c",
      "files": [
        {
          "file_name": "src/main/java/com/shootoff/gui/controller/ShootOFFController.java",
          "patch": "@@ -349,6 +349,10 @@ public VBox getButtonsPane() {\n \t\treturn buttonsContainer;\n \t}\n \t\n+\tpublic ObservableList\u003cShotEntry\u003e getShotTimerModel() {\n+\t\treturn shotEntries;\n+\t}\n+\t\n \tpublic void selectCameraView(CameraView cameraView) {\n \t\tcameraTabPane.getSelectionModel().select(camerasSupervisor.getCameraViews().indexOf(cameraView));\n \t}"
        },
        {
          "file_name": "src/main/java/com/shootoff/gui/pane/ProjectorArenaPane.java",
          "patch": "@@ -38,6 +38,7 @@\n import com.shootoff.gui.LocatedImage;\n import com.shootoff.gui.MirroredCanvasManager;\n import com.shootoff.gui.Resetter;\n+import com.shootoff.gui.ShotEntry;\n import com.shootoff.gui.controller.ShootOFFController;\n import com.shootoff.targets.Target;\n import com.shootoff.util.TimerPool;\n@@ -101,7 +102,7 @@ public ProjectorArenaPane(Configuration config, CanvasManager canvasManager) {\n \t}\n \n \tpublic ProjectorArenaPane(Stage arenaStage, Stage shootOffStage, Pane trainingExerciseContainer,\n-\t\t\tConfiguration config, Resetter resetter) {\n+\t\t\tConfiguration config, Resetter resetter, ObservableList\u003cShotEntry\u003e shotTimerModel) {\n \t\tthis.config \u003d config;\n \n \t\tarenaCanvasGroup \u003d new Group();\n@@ -119,7 +120,12 @@ public ProjectorArenaPane(Stage arenaStage, Stage shootOffStage, Pane trainingEx\n \t\tthis.arenaStage \u003d arenaStage;\n \t\tthis.trainingExerciseContainer \u003d trainingExerciseContainer;\n \t\t\n-\t\tcanvasManager \u003d new MirroredCanvasManager(arenaCanvasGroup, config, resetter, \"arena\", null, this);\n+\t\tif (shotTimerModel \u003d\u003d null) {\n+\t\t\tcanvasManager \u003d new MirroredCanvasManager(arenaCanvasGroup, config, resetter, \"arena\", null, this);\n+\t\t} else {\n+\t\t\tcanvasManager \u003d new MirroredCanvasManager(arenaCanvasGroup, config, resetter, \"arena\",\n+\t\t\t\t\tshotTimerModel, this);\n+\t\t}\n \n \t\tthis.setPrefSize(640, 480);\n \t\t"
        },
        {
          "file_name": "src/main/java/com/shootoff/gui/pane/ProjectorSlide.java",
          "patch": "@@ -119,7 +119,7 @@ public void startArena() {\n \t\tif (arenaPane \u003d\u003d null) {\n \t\t\tfinal Stage arenaStage \u003d new Stage();\n \n-\t\t\tarenaPane \u003d new ProjectorArenaPane(arenaStage, shootOffStage, trainingExerciseContainer, config, resetter);\n+\t\t\tarenaPane \u003d new ProjectorArenaPane(arenaStage, shootOffStage, trainingExerciseContainer, config, resetter, null);\n \t\t\t\n \t\t\t// Prepare calibrating manager up front so that we can switch\n \t\t\t// to the arena tab when it\u0027s ready (otherwise\n@@ -129,7 +129,7 @@ public void startArena() {\n \t\t\t// Mirror panes so that anything that happens to one also\n \t\t\t// happens to the other\n \t\t\tfinal ProjectorArenaPane arenaTabPane \u003d new ProjectorArenaPane(arenaStage, shootOffStage, trainingExerciseContainer,\n-\t\t\t\t\tconfig, resetter); \n+\t\t\t\t\tconfig, resetter, cameraViews.getShotTimerModel()); \n \t\t\tcameraViews.addCameraView(\"Arena\", new ScrollPane(arenaTabPane), arenaTabPane.getCanvasManager(), true);\n \t\t\t\n \t\t\tarenaTabPane.prefWidthProperty().bind(arenaPane.prefWidthProperty());"
        },
        {
          "file_name": "src/main/java/com/shootoff/plugins/TrainingExerciseBase.java",
          "patch": "@@ -339,6 +339,12 @@ public void addShotTimerColumn(String name, int width) {\n \tpublic void setShotTimerColumnText(final String name, final String value) {\n \t\tif (shotTimerTable !\u003d null \u0026\u0026 shotTimerTable.getItems() !\u003d null) {\n \t\t\tRunnable shotTimerColumnTextSetter \u003d () -\u003e {\n+\t\t\t\tif (shotTimerTable.getItems().size() \u003d\u003d 0) {\n+\t\t\t\t\tlogger.error(\"Trying to set shot timer column text on an empty shot timer list\", \n+\t\t\t\t\t\t\tnew AssertionError(\"Shot timer table is empty\"));\n+\t\t\t\t\treturn;\n+\t\t\t\t}\n+\t\t\t\t\n \t\t\t\tshotTimerTable.getItems().get(shotTimerTable.getItems().size() - 1).setExerciseValue(name, value);\n \t\t\t};\n \t\t\t"
        },
        {
          "file_name": "src/main/java/com/shootoff/targets/CameraViews.java",
          "patch": "@@ -5,7 +5,9 @@\n import com.shootoff.camera.CameraManager;\n import com.shootoff.camera.CameraView;\n import com.shootoff.gui.CanvasManager;\n+import com.shootoff.gui.ShotEntry;\n \n+import javafx.collections.ObservableList;\n import javafx.scene.Node;\n \n public interface CameraViews {\n@@ -22,4 +24,6 @@\n \tNode getSelectedCameraContainer();\n \t\n \tvoid selectCameraView(CameraView cameraView);\n+\t\n+\tObservableList\u003cShotEntry\u003e getShotTimerModel();\n }"
        }
      ]
    }
  },
  {
    "name": "Race condition with loading Endpoint and restoring session",
    "url": "https://github.com/krico/jas/issues/187",
    "description": "The web app seems to never receive the callback from google client\n![image](https://cloud.githubusercontent.com/assets/6952185/6769935/11f9c69e-d0b0-11e4-8650-8dcaf8bf0418.png)\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/krico/jas/commit/c2115d1aa953ad11742794bf0ce2f059a70c6cb6",
      "files": [
        {
          "file_name": "schedule/schedule-appengine/src/main/client/jasify/jasify.global.js",
          "patch": "@@ -10,7 +10,39 @@ var jas \u003d jas || {};\n  * This is the function called by the google api client when gapi is loaded\n  */\n function initializeEndpoint() {\n-    if (window.endpointInitialize) window.endpointInitialize();\n+    var attempts \u003d 0;\n+    var timerRegistration \u003d null;\n+    if (window.endpointInitialize) {\n+        window.endpointInitialize();\n+    } else {\n+        //This happens if \"client.js\" finishes loading before our own files.\n+        //In this case we have to try later...\n+        console.log(\u0027window.endpointInitialize not defined yet\u0027);\n+        waitForLoad();\n+    }\n+\n+    function waitForLoad() {\n+        ++attempts;\n+        console.log(\u0027waitForLoad(\u0027 + attempts + \u0027)\u0027);\n+        if (timerRegistration \u003d\u003d\u003d null) {\n+            timerRegistration \u003d window.setInterval(waitForLoad, 500);\n+            return;\n+        }\n+\n+        if (window.endpointInitialize) {\n+            console.log(\u0027window.endpointInitialize is available now!\u0027);\n+            window.clearInterval(timerRegistration);\n+            window.endpointInitialize();\n+            return;\n+        }\n+\n+        if (attempts \u003e 60) {\n+            //After 60 seconds we give up\n+            window.clearInterval(timerRegistration);\n+            console.error(\u0027Load not yet finished after 60 attempts, giving up!\u0027);\n+            return;\n+        }\n+    }\n }\n \n (function (j) {"
        }
      ]
    }
  },
  {
    "name": "Race condition in radio when loading persisted inputs",
    "url": "https://github.com/Graylog2/graylog2-server/issues/637",
    "description": "When a radio node starts, there is a race condition between registering the node and loading its inputs.\n\nThe two threads run in parallel and if the request to load persisted inputs is faster then the node ping thread, no inputs will be started at all.\n",
    "keywords": [
      "node",
      "inputs"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/Graylog2/graylog2-server/commit/813518d584a6ce7317ec34f72439b96de70f5d78",
      "files": [
        {
          "file_name": "graylog2-radio/src/main/java/org/graylog2/radio/Main.java",
          "patch": "@@ -40,6 +40,7 @@\n import org.graylog2.plugin.lifecycles.Lifecycle;\n import org.graylog2.radio.bindings.RadioBindings;\n import org.graylog2.radio.bindings.RadioInitializerBindings;\n+import org.graylog2.radio.cluster.Ping;\n import org.graylog2.shared.NodeRunner;\n import org.graylog2.shared.ServerStatus;\n import org.graylog2.shared.bindings.GuiceInstantiationService;\n@@ -136,6 +137,10 @@ public static void main(String[] args) {\n \n         serverStatus.setLifecycle(Lifecycle.STARTING);\n \n+        // register node by initiating first ping. if the node isn\u0027t registered, loading persisted inputs will fail silently, for example\n+        Ping.Pinger pinger \u003d injector.getInstance(Ping.Pinger.class);\n+        pinger.ping();\n+\n         final ServiceManager serviceManager \u003d injector.getInstance(ServiceManager.class);\n         final ServiceManagerListener serviceManagerListener \u003d injector.getInstance(ServiceManagerListener.class);\n         serviceManager.addListener(serviceManagerListener, MoreExecutors.sameThreadExecutor());"
        },
        {
          "file_name": "graylog2-radio/src/main/java/org/graylog2/radio/bindings/RadioBindings.java",
          "patch": "@@ -21,9 +21,11 @@\n \n import com.fasterxml.jackson.databind.ObjectMapper;\n import com.google.inject.AbstractModule;\n+import com.google.inject.Scopes;\n import com.google.inject.TypeLiteral;\n import com.google.inject.assistedinject.FactoryModuleBuilder;\n import com.google.inject.multibindings.Multibinder;\n+import com.google.inject.name.Names;\n import com.google.inject.util.Providers;\n import com.ning.http.client.AsyncHttpClient;\n import org.graylog2.jersey.container.netty.SecurityContextFactory;\n@@ -42,6 +44,7 @@\n import javax.ws.rs.container.ContainerResponseFilter;\n import javax.ws.rs.container.DynamicFeature;\n import javax.ws.rs.ext.ExceptionMapper;\n+import java.net.URI;\n \n /**\n  * @author Dennis Oelkers \u003cdennis@torch.sh\u003e\n@@ -74,6 +77,9 @@ private void bindSingletons() {\n         serverStatus.addCapability(ServerStatus.Capability.RADIO);\n         bind(ServerStatus.class).toInstance(serverStatus);\n         bind(InputRegistry.class).toProvider(RadioInputRegistryProvider.class);\n+\n+        bind(URI.class).annotatedWith(Names.named(\"ServerUri\")).toInstance(configuration.getGraylog2ServerUri());\n+        bind(URI.class).annotatedWith(Names.named(\"OurRadioUri\")).toInstance(configuration.getRestTransportUri());\n     }\n \n     private void bindProviders() {"
        },
        {
          "file_name": "graylog2-radio/src/main/java/org/graylog2/radio/cluster/Ping.java",
          "patch": "@@ -21,8 +21,11 @@\n \n import com.fasterxml.jackson.databind.ObjectMapper;\n import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.google.inject.Inject;\n+import com.google.inject.name.Named;\n import com.ning.http.client.AsyncHttpClient;\n import com.ning.http.client.Response;\n+import org.graylog2.shared.ServerStatus;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n@@ -71,9 +74,10 @@ public static void ping(AsyncHttpClient client, URI server, URI ourUri, String r\n         private final URI serverUri;\n         private final URI ourUri;\n \n-        public Pinger(AsyncHttpClient httpClient, String nodeId, URI ourUri, URI serverUri) {\n+        @Inject\n+        public Pinger(AsyncHttpClient httpClient, @Named(\"OurRadioUri\") URI ourUri, @Named(\"ServerUri\") URI serverUri, ServerStatus serverStatus) {\n             this.httpClient \u003d httpClient;\n-            this.nodeId \u003d nodeId;\n+            this.nodeId \u003d serverStatus.getNodeId().toString();\n             this.ourUri \u003d ourUri;\n             this.serverUri \u003d serverUri;\n         }"
        },
        {
          "file_name": "graylog2-radio/src/main/java/org/graylog2/radio/inputs/RadioInputRegistry.java",
          "patch": "@@ -22,6 +22,7 @@\n import com.beust.jcommander.internal.Lists;\n import com.fasterxml.jackson.databind.ObjectMapper;\n import com.ning.http.client.AsyncHttpClient;\n+import com.ning.http.client.Request;\n import com.ning.http.client.Response;\n import org.graylog2.plugin.configuration.Configuration;\n import org.graylog2.plugin.configuration.ConfigurationException;\n@@ -37,6 +38,8 @@\n import org.graylog2.shared.inputs.NoSuchInputTypeException;\n import org.graylog2.shared.rest.resources.system.inputs.requests.RegisterInputRequest;\n import org.joda.time.DateTime;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n import javax.ws.rs.core.UriBuilder;\n import java.io.IOException;\n@@ -49,6 +52,8 @@\n  * @author Lennart Koopmann \u003clennart@torch.sh\u003e\n  */\n public class RadioInputRegistry extends InputRegistry {\n+    private static final Logger log \u003d LoggerFactory.getLogger(RadioInputRegistry.class);\n+\n     protected final ObjectMapper mapper \u003d new ObjectMapper();\n     protected final AsyncHttpClient httpclient;\n     protected final URI serverUrl;\n@@ -70,15 +75,17 @@ protected MessageInput getMessageInput(InputSummaryResponse isr) {\n         try {\n             input \u003d this.create(isr.type);\n \n+            Configuration inputConfig \u003d new Configuration(isr.configuration);\n             // Add all standard fields.\n-            input.initialize(new Configuration(isr.configuration));\n             input.setTitle(isr.title);\n             input.setCreatorUserId(isr.creatorUserId);\n             input.setPersistId(isr.id);\n             input.setCreatedAt(new DateTime(isr.createdAt));\n             input.setGlobal(isr.global);\n \n-            input.checkConfiguration();\n+            input.checkConfiguration(inputConfig);\n+            // initialize must run after all fields have been set. Why oh why isn\u0027t this done in the constructor/factory method?\n+            input.initialize(inputConfig);\n         } catch (NoSuchInputTypeException e) {\n             LOG.warn(\"Cannot launch persisted input. No such type [{}]. Error: {}\", isr.type, e);\n             return null;\n@@ -142,14 +149,19 @@ public void unregisterInCluster(MessageInput input) throws ExecutionException, I\n \n         List\u003cInputSummaryResponse\u003e response;\n         try {\n-            Future\u003cResponse\u003e f \u003d httpclient.prepareGet(uriBuilder.build().toString()).execute();\n+            Request request \u003d httpclient.prepareGet(uriBuilder.build().toString()).build();\n+            log.debug(\"API Request {} {}\", request.getMethod(), request.getUrl());\n+            Future\u003cResponse\u003e f \u003d httpclient.executeRequest(request);\n \n             Response r \u003d f.get();\n \n             if (r.getStatusCode() !\u003d 200) {\n                 throw new RuntimeException(\"Expected HTTP response [200] for list of persisted input but got [\" + r.getStatusCode() + \"].\");\n             }\n-            response \u003d mapper.readValue(r.getResponseBody(), PersistedInputsResponse.class).inputs;\n+            String responseBody \u003d r.getResponseBody();\n+            PersistedInputsResponse persistedInputsResponse \u003d mapper.readValue(responseBody,\n+                                                                               PersistedInputsResponse.class);\n+            response \u003d persistedInputsResponse.inputs;\n         } catch (IOException e) {\n             LOG.error(\"Unable to get persisted inputs: \", e);\n             return result;\n@@ -164,7 +176,7 @@ public void unregisterInCluster(MessageInput input) throws ExecutionException, I\n         for (InputSummaryResponse isr : response) {\n             final MessageInput messageInput \u003d getMessageInput(isr);\n             if (messageInput !\u003d null) {\n-                messageInput.setPersistId(isr.id);\n+                log.debug(\"Loaded message input {}\", messageInput);\n                 result.add(messageInput);\n             }\n         }"
        }
      ]
    }
  },
  {
    "name": "Possible race condition in the execution of the plugin",
    "url": "https://github.com/dcabasson/cucumber-maven-plugin/issues/2",
    "description": "Theoritical scenario :\n- Hudson checks out the project at version n\n- Somebody update a feature file to version n+1\n- The plugin runs a svn log on the file, and gets the log up to n+1, but the content is still at n\n- The plugins update the confluence page to tag it with the n+1 version, while still using the n content\n",
    "keywords": [
      "n+1",
      "version",
      "n"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/dcabasson/cucumber-maven-plugin/commit/67bc7c681aa0e8e8ea5ccbbfee0e917514bb6119",
      "files": [
        {
          "file_name": "src/main/java/org/codehaus/mojo/cucumber/FeaturesReport.java",
          "patch": "@@ -48,6 +48,8 @@\n import org.codehaus.plexus.util.FileUtils;\n import org.codehaus.plexus.util.IOUtil;\n \n+import confluence.rpc.soap_axis.confluenceservice.ConfluenceServiceProxy;\n+\n /**\n  * @author Denis Cabasson\n  * @modifiedBy Qiuliang Tang\n@@ -136,6 +138,13 @@\n      */\n     private String password;\n \n+    /**\n+     * The upper limit for the SVN revision to be used by this plugin\n+     * \n+     * @parameter\n+     */\n+    private Integer topSvnRevision;\n+\n     static class CapabilityDirectory {\n         public String name;\n \n@@ -193,7 +202,7 @@ public void directoryWalkFinished() {\n                             final StringBuilder builder \u003d new StringBuilder();\n                             try {\n                                 final ChangeLogScmResult clScmResult \u003d FeaturesReport.this.log(useCase.packageFile,\n-                                        null);\n+                                        null, toVersion);\n                                 for (final ChangeSet aChangeSet : clScmResult.getChangeLog().getChangeSets()) {\n                                     builder.append(\"\\n\");\n                                     builder.append(\"Updated from revision \");\n@@ -1012,12 +1021,6 @@ public void verbatim_() {\n     private File featuresDirectory;\n \n     /**\n-     * @parameter expression\u003d\"${project.build.directory}/generated-site/apt\"\n-     * @required\n-     */\n-    private File generatedSiteDirectory;\n-\n-    /**\n      * @parameter expression\u003d\"${basedir}\"\n      * @required\n      * @readonly\n@@ -1026,7 +1029,14 @@ public void verbatim_() {\n \n     private final Map\u003cString, String\u003e personas \u003d new HashMap\u003cString, String\u003e();\n \n-    private ConfluenceSoapClient confluenceClient;\n+    private ConfluenceSoapClient\u003c? extends ConfluenceServiceProxy\u003e confluenceClient;\n+\n+    /**\n+     * The upper limit of the SVN revision to consider. This is intended to prevent race conditions\n+     * where a newer version might be available at svn log time as opposed to the initial checkout\n+     * of the code.\n+     */\n+    private ScmVersion toVersion;\n \n     @Override\n     protected void executeReport(final Locale locale) throws MavenReportException {\n@@ -1039,6 +1049,14 @@ protected void executeReport(final Locale locale) throws MavenReportException {\n                     confluenceSpaceKey, confluenceUrl);\n         }\n \n+        if (topSvnRevision !\u003d null) { // there is an upper bound to what we are supposed to log\n+            this.toVersion \u003d new ScmRevision(topSvnRevision.toString());\n+            this.getLog().info(\"The top revision has been set to \" + topSvnRevision.toString());\n+        } else {\n+            this.toVersion \u003d null;\n+            this.getLog().info(\"No top revision available, will use HEAD\");\n+        }\n+\n         if (this.featuresDirectory.exists() \u0026\u0026 this.featuresDirectory.isDirectory()) {\n             final List\u003cString\u003e allIncludes \u003d new ArrayList\u003cString\u003e();\n             allIncludes.add(\"**/package.apt\");\n@@ -1099,7 +1117,7 @@ protected Boolean generateFeaturePage(final String parentPageTitle, final File f\n             }\n \n             // Add revision information\n-            final ChangeLogScmResult clScmResult \u003d this.log(featureFile, fromVersion);\n+            final ChangeLogScmResult clScmResult \u003d this.log(featureFile, fromVersion, toVersion);\n             if (!clScmResult.getChangeLog().getChangeSets().isEmpty()) { // we have changes\n                                                                          // since last version!\n                 this.getLog().debug(\"Changes have occured since last Scm Revision\");\n@@ -1213,15 +1231,16 @@ private ScmRepository getScmRepository(final File file) throws ScmException {\n         return repository;\n     }\n \n-    private ChangeLogScmResult log(final File file, final ScmVersion fromVersion) throws MojoExecutionException {\n+    private ChangeLogScmResult log(final File file, final ScmVersion fromVersion, final ScmVersion toVersion)\n+            throws MojoExecutionException {\n         final ChangeLogScmResult changeLog;\n         try {\n             this.getLog().debug(\"File to generate the changeset : \" + file);\n             this.getLog().debug(\"From version : \" + fromVersion);\n             final ScmRepository repository \u003d this.getScmRepository(file);\n \n             changeLog \u003d this.scmManager.changeLog(repository,\n-                    new ScmFileSet(new File(file.getParent()), new File(file.getName())), fromVersion, null);\n+                    new ScmFileSet(new File(file.getParent()), new File(file.getName())), fromVersion, toVersion);\n         } catch (final Exception e) {\n             throw new MojoExecutionException(\"Cannot get the branch information from the scm repository : \\n\"\n                     + e.getLocalizedMessage(), e);"
        }
      ]
    }
  },
  {
    "name": "Race condition on new user reg (Facebook auth)",
    "url": "https://github.com/storyroll/storyroll-android/issues/209",
    "description": "RC due to BasicAuth being enabled with a lag after a user is created using addProfile\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/storyroll/storyroll-android/commit/9e284746d2f40734128f27517335774f7f13753e",
      "files": [
        {
          "file_name": "src/co/storyroll/activity/LoginActivity.java",
          "patch": "@@ -7,7 +7,6 @@\n import android.view.KeyEvent;\n import android.view.View;\n import android.widget.Toast;\n-import co.storyroll.MainApplication;\n import co.storyroll.R;\n import co.storyroll.base.GcmActivity;\n import co.storyroll.model.Profile;\n@@ -17,11 +16,9 @@\n import co.storyroll.util.ServerUtility;\n import com.androidquery.auth.BasicHandle;\n import com.androidquery.auth.FacebookHandle;\n-import com.androidquery.callback.AbstractAjaxCallback;\n import com.androidquery.callback.AjaxStatus;\n import com.google.analytics.tracking.android.Fields;\n import com.google.android.gms.gcm.GoogleCloudMessaging;\n-import org.apache.http.conn.ssl.SSLSocketFactory;\n import org.json.JSONException;\n import org.json.JSONObject;\n \n@@ -72,7 +69,7 @@ public void authFacebookSSO(){\n \n         // TODO: refactor\n         // hack here\n-        AbstractAjaxCallback.setSSF( SSLSocketFactory.getSocketFactory() );\n+//        AbstractAjaxCallback.setSSF( SSLSocketFactory.getSocketFactory() );\n \t\taq.auth(facebookHandle).progress(R.id.progress).ajax(facebookGraphUrl, JSONObject.class, this, \"facebookProfileCb\");\n \t}\n \t\n@@ -163,7 +160,7 @@ public void facebookProfileCb(String url, JSONObject json, AjaxStatus status) {\n \n         // TODO: refactor\n         // hack pt2: restore SSL Factory\n-        AbstractAjaxCallback.setSSF(MainApplication.getSocketFactory());\n+//        AbstractAjaxCallback.setSSF(MainApplication.getSocketFactory());\n \n     \tif (isAjaxErrorThenReport(status)) return;\n             "
        },
        {
          "file_name": "src/co/storyroll/activity/ProfileActivity.java",
          "patch": "@@ -1,6 +1,7 @@\n package co.storyroll.activity;\n \n import android.content.ComponentName;\n+import android.content.Context;\n import android.content.Intent;\n import android.content.pm.PackageManager;\n import android.content.pm.ResolveInfo;\n@@ -14,7 +15,6 @@\n import android.util.Log;\n import android.view.View;\n import android.widget.Toast;\n-import co.storyroll.MainApplication;\n import co.storyroll.R;\n import co.storyroll.base.MenuActivity;\n import co.storyroll.model.Profile;\n@@ -23,13 +23,12 @@\n import co.storyroll.util.PrefUtility;\n import co.storyroll.util.ServerUtility;\n import com.androidquery.auth.FacebookHandle;\n-import com.androidquery.callback.AbstractAjaxCallback;\n import com.androidquery.callback.AjaxCallback;\n import com.androidquery.callback.AjaxStatus;\n+import com.androidquery.util.AQUtility;\n import com.bugsense.trace.BugSenseHandler;\n import com.google.analytics.tracking.android.Fields;\n import org.apache.http.HttpEntity;\n-import org.apache.http.conn.ssl.SSLSocketFactory;\n import org.apache.http.entity.ContentType;\n import org.apache.http.entity.mime.MultipartEntityBuilder;\n import org.json.JSONException;\n@@ -76,7 +75,6 @@ protected void onCreate(Bundle state) {\n \t\t\n \t\tLog.v(LOGTAG, \"onCreate\");\n \t\tsetContentView(R.layout.activity_profile);\n-\t\t\n \t\t// Fields set on a tracker persist for all hits, until they are\n \t    // overridden or cleared by assignment to null.\n \t    getGTracker().set(Fields.SCREEN_NAME, SCREEN_NAME);\n@@ -184,9 +182,9 @@ public void initAvatar() {\n \t\tif (!avatarChangeStarted \u0026\u0026 !avatarChangeCompleted) \n \t\t{\n \t\t\t// do we have SR avatar?\n-\t\t\tif (!TextUtils.isEmpty(profile.getAvatarUrl())) {\n+\t\t\tif (!TextUtils.isEmpty(profile.getAvatarUrl()))\n+            {\n \t\t\t\tLog.v(LOGTAG, \"loading avatar from SR\");\n-\n \t\t\t\taq.id(R.id.avatar).image(profile.getAvatarUrl(),\n \t\t\t\t\t\tfalse, false, 0, R.drawable.ic_avatar_default);\n \n@@ -198,14 +196,15 @@ else if (profile.isAuthFacebook())\n \n                 // TODO: refactor\n                 // hack here\n-                AbstractAjaxCallback.setSSF(SSLSocketFactory.getSocketFactory());\n+//                AbstractAjaxCallback.setSSF(SSLSocketFactory.getSocketFactory());\n \n \t\t\t\tString tb \u003d ImageUtility.getFbProfileTb(handle);\n+                // todo: clear cached image, which is sometimes picked up here\n \t\t\t\taq.id(R.id.avatar).image(tb);\n \n                 // TODO: refactor\n                 // hack pt2: restore SSL Factory\n-                AbstractAjaxCallback.setSSF(MainApplication.getSocketFactory());\n+//                AbstractAjaxCallback.setSSF(MainApplication.getSocketFactory());\n \t\t\t}\n \t\t}\n \t\t\n@@ -336,8 +335,9 @@ protected boolean updateProfileGeneral(String url, JSONObject json, AjaxStatus s\n         \t// upload avatar\n     \t\tif (avatarChangeCompleted) \n     \t\t{\n-                doUploadAvatar(profile.email);\n-    \t        \n+                // delay to avoid race conditions, see https://github.com/storyroll/storyroll-android/issues/209\n+                Log.v(LOGTAG, \"postDelayed:AvatarUpdater\");\n+                AQUtility.postDelayed(new AvatarUpdater(getApplicationContext()), 2000);\n     \t\t}\n     \t\telse {\n     \t\t\tnextActivity();\n@@ -349,28 +349,37 @@ protected boolean updateProfileGeneral(String url, JSONObject json, AjaxStatus s\n         return true;\n \t}\n \n-    private void doUploadAvatar(String email){\n-        File file \u003d new File(AppUtility.getAppWorkingDir(this)+File.separator+\"avatar.jpg\");\n+    private class AvatarUpdater implements Runnable {\n+        Context ctx;\n+        public AvatarUpdater(Context c) {\n+            ctx \u003d c;\n+        }\n+        @Override\n+        public void run() {\n+            doUploadAvatar(ctx, profile.email);\n+        }\n+    }\n \n-//        Map params \u003d new HashMap();\n-//        params.put(\"file\", file);\n-//        params.put(\"uuid\", email);\n-//        aq.progress(R.id.progress).ajax(\n-//                PrefUtility.getApiUrl(ServerUtility.API_AVATAR_SET, null),\n-//                params, JSONObject.class, this, \"setAvatarCb\");\n+    private void doUploadAvatar(Context ctx, String email){\n+        File file \u003d new File(AppUtility.getAppWorkingDir(ctx)+File.separator+\"avatar.jpg\");\n \n         HttpEntity reqEntity \u003d MultipartEntityBuilder.create()\n                 .addBinaryBody(\"file\", file, APPLICATION_OCTET_STREAM, \"avatar.jpg\")\n                 .addTextBody(\"uuid\", email, ContentType.TEXT_PLAIN).build();\n \n-\n         aq.auth(basicHandle).progress(R.id.progress).post(PrefUtility.getApiUrl(ServerUtility.API_AVATAR_SET),\n                 reqEntity, JSONObject.class, new AjaxCallback\u003cJSONObject\u003e() {\n \n                     @Override\n                     public void callback(String url, JSONObject json, AjaxStatus status) {\n-                        Log.v(LOGTAG, \"callback: json\u003d\" + json \u003d\u003d null ? \"null\" : json.toString());\n-                        setAvatarCb(url, json, status);\n+                        Log.v(LOGTAG, \"API_AVATAR_SET callback: json\u003d\" + (json \u003d\u003d null ? \"null\" : json.toString()));\n+                        if (json!\u003dnull)\n+                        {\n+                            setAvatarCb(url, json, status);\n+                        }\n+                        else {\n+                            apiError(LOGTAG, \"Error uploading avatar image on registration: \"+registration, status, false, Log.ERROR);\n+                        }\n                     }\n                 });\n     }"
        }
      ]
    }
  },
  {
    "name": "IndexRange calculation race condition after deflector cycle",
    "url": "https://github.com/Graylog2/graylog2-server/issues/1217",
    "description": "When `disable_index_range_calculation \u003d true` is set, which became the default in 1.1.0, the deflector range wasn\u0027t properly stored in the database, if the deflector didn\u0027t contain any new messages at that point.\n\nThis could lead to empty search results for absolute time ranges (compare Graylog2/graylog2-web-interface#1266) and to search results which were missing recently received messages on relative time ranges.\n",
    "keywords": [
      "deflector"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/Graylog2/graylog2-server/commit/f5524cdb989b89fe2283c5ba647c4137c4a0bedb",
      "files": [
        {
          "file_name": "graylog2-server/src/main/java/org/graylog2/indexer/ranges/CreateNewSingleIndexRangeJob.java",
          "patch": "@@ -61,10 +61,11 @@ public void execute() {\n         LOG.info(\"Calculating ranges for index {}.\", indexName);\n         try {\n             final Map\u003cString, Object\u003e range;\n-            if (deflector.getCurrentActualTargetIndex().equals(indexName))\n-                range \u003d calculateRange(indexName);\n-            else\n+            if (deflector.getCurrentActualTargetIndex().equals(indexName)) {\n                 range \u003d getDeflectorIndexRange(indexName);\n+            } else {\n+                range \u003d calculateRange(indexName);\n+            }\n \n             final IndexRange indexRange \u003d indexRangeService.create(range);\n             indexRangeService.destroy(indexName);"
        }
      ]
    }
  },
  {
    "name": "Fixed race condition in GUI::renderFruits method",
    "url": "https://github.com/dalderliesten/Scrumbledore/pull/68",
    "description": "",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/dalderliesten/Scrumbledore/commit/1b7e66615acac5d27564e1b9720800658f135dca",
      "files": [
        {
          "file_name": "src/main/java/nl/tudelft/scrumbledore/GUI.java",
          "patch": "@@ -296,7 +296,13 @@ private void renderPlatforms(GraphicsContext painter) {\n   }\n   \n   private void renderFruits(GraphicsContext painter) {\n-    for (Fruit current : game.getCurrentLevel().getFruits()) {\n+    ArrayList\u003cFruit\u003e fruits \u003d new ArrayList\u003cFruit\u003e();\n+    \n+    for (Fruit fruit : game.getCurrentLevel().getFruits()) {\n+      fruits.add(fruit);\n+    }\n+    \n+    for (Fruit current : fruits) {\n       painter.drawImage(new Image(Constants.FRUIT_SPRITE),  current.getPosition().getX(),\n           current.getPosition().getY());\n     }"
        }
      ]
    }
  },
  {
    "name": "Race condition in network startup",
    "url": "https://github.com/kuujo/vertigo/issues/30",
    "description": "When running some multi-instance component tests repeatedly, I noted a potential race condition that seems to prevent some component instances from starting up properly. For instance, in the worker many-to-many or many-to-one tests, every now and then a fourth instance of the four worker instances will not properly begin emitting messages, likely indicating that the start `AsyncResultHandler` is never called.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/kuujo/vertigo/commit/ef4402b1a59742616e530c413fecf914a06cf781",
      "files": [
        {
          "file_name": "src/main/java/net/kuujo/vertigo/component/impl/AbstractComponent.java",
          "patch": "@@ -16,9 +16,10 @@\n package net.kuujo.vertigo.component.impl;\n \n import java.util.ArrayList;\n+import java.util.HashSet;\n import java.util.List;\n+import java.util.Set;\n \n-import net.kuujo.vertigo.VertigoException;\n import net.kuujo.vertigo.message.MessageId;\n import net.kuujo.vertigo.output.OutputCollector;\n import net.kuujo.vertigo.output.impl.DefaultOutputCollector;\n@@ -29,8 +30,6 @@\n import net.kuujo.vertigo.context.ComponentContext;\n import net.kuujo.vertigo.context.InstanceContext;\n import net.kuujo.vertigo.context.NetworkContext;\n-import net.kuujo.vertigo.coordinator.heartbeat.HeartbeatEmitter;\n-import net.kuujo.vertigo.coordinator.heartbeat.impl.DefaultHeartbeatEmitter;\n import net.kuujo.vertigo.hooks.ComponentHook;\n import net.kuujo.vertigo.hooks.InputHook;\n import net.kuujo.vertigo.hooks.OutputHook;\n@@ -44,6 +43,7 @@\n import org.vertx.java.core.eventbus.EventBus;\n import org.vertx.java.core.eventbus.Message;\n import org.vertx.java.core.impl.DefaultFutureResult;\n+import org.vertx.java.core.json.JsonArray;\n import org.vertx.java.core.json.JsonObject;\n import org.vertx.java.core.logging.Logger;\n import org.vertx.java.core.logging.impl.LoggerFactory;\n@@ -64,10 +64,10 @@\n   protected final String instanceId;\n   protected final String address;\n   protected final String networkAddress;\n-  protected final HeartbeatEmitter heartbeat;\n   protected final InputCollector input;\n   protected final OutputCollector output;\n   protected final List\u003cComponentHook\u003e hooks \u003d new ArrayList\u003c\u003e();\n+  private boolean started;\n \n   private InputHook inputHook \u003d new InputHook() {\n     @Override\n@@ -144,7 +144,6 @@ protected AbstractComponent(Vertx vertx, Container container, InstanceContext\u003cT\u003e\n     this.address \u003d context.componentContext().address();\n     NetworkContext networkContext \u003d context.componentContext().networkContext();\n     networkAddress \u003d networkContext.address();\n-    heartbeat \u003d new DefaultHeartbeatEmitter(vertx);\n     input \u003d new DefaultInputCollector(vertx, container, context, acker);\n     output \u003d new DefaultOutputCollector(vertx, container, context, acker);\n     for (ComponentHook hook : context.\u003cComponentContext\u003c?\u003e\u003ecomponentContext().hooks()) {\n@@ -227,6 +226,15 @@ private void hookStart() {\n     }\n   }\n \n+  /**\n+   * Calls stop hooks\n+   */\n+  private void hookStop() {\n+    for (ComponentHook hook : hooks) {\n+      hook.handleStop(this);\n+    }\n+  }\n+\n   @Override\n   @SuppressWarnings(\"unchecked\")\n   public T declareSchema(MessageSchema schema) {\n@@ -243,45 +251,35 @@ private void setup(Handler\u003cAsyncResult\u003cVoid\u003e\u003e doneHandler) {\n       future.setHandler(doneHandler);\n     }\n \n-    setupHeartbeat(new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n+    acker.start(new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n       @Override\n       public void handle(AsyncResult\u003cVoid\u003e result) {\n         if (result.failed()) {\n           future.setFailure(result.cause());\n         }\n         else {\n-          acker.start(new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n+          output.start(new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n             @Override\n             public void handle(AsyncResult\u003cVoid\u003e result) {\n               if (result.failed()) {\n                 future.setFailure(result.cause());\n               }\n               else {\n-                output.start(new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n+                input.start(new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n                   @Override\n                   public void handle(AsyncResult\u003cVoid\u003e result) {\n                     if (result.failed()) {\n                       future.setFailure(result.cause());\n                     }\n                     else {\n-                      input.start(new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n+                      ready(new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n                         @Override\n                         public void handle(AsyncResult\u003cVoid\u003e result) {\n                           if (result.failed()) {\n                             future.setFailure(result.cause());\n                           }\n                           else {\n-                            ready(new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n-                              @Override\n-                              public void handle(AsyncResult\u003cVoid\u003e result) {\n-                                if (result.failed()) {\n-                                  future.setFailure(result.cause());\n-                                }\n-                                else {\n-                                  future.setResult(null);\n-                                }\n-                              }\n-                            });\n+                            future.setResult((Void) null);\n                           }\n                         }\n                       });\n@@ -297,44 +295,89 @@ public void handle(AsyncResult\u003cVoid\u003e result) {\n   }\n \n   /**\n-   * Sets up the heartbeat.\n+   * Indicates to the network that the component is ready.\n    */\n-  private void setupHeartbeat(Handler\u003cAsyncResult\u003cVoid\u003e\u003e doneHandler) {\n-    final Future\u003cVoid\u003e future \u003d new DefaultFutureResult\u003cVoid\u003e();\n-    if (doneHandler !\u003d null) {\n-      future.setHandler(doneHandler);\n+  private void ready(Handler\u003cAsyncResult\u003cVoid\u003e\u003e doneHandler) {\n+    final Future\u003cVoid\u003e future \u003d new DefaultFutureResult\u003cVoid\u003e().setHandler(doneHandler);\n+\n+    // Register an event bus handler for this component. Once the handler is\n+    // registered, send a message to a random component instance to check if\n+    // it\u0027s ready. The first complete list of components to be received indicates\n+    // that the network has started.\n+    final Set\u003cString\u003e instances \u003d new HashSet\u003c\u003e();\n+    for (ComponentContext\u003c?\u003e component : context.componentContext().networkContext().componentContexts()) {\n+      for (InstanceContext\u003c?\u003e instance : component.instanceContexts()) {\n+        instances.add(instance.id());\n+      }\n     }\n \n-    eventBus.sendWithTimeout(networkAddress, new JsonObject().putString(\"action\", \"register\").putString(\"address\", address), 10000, new Handler\u003cAsyncResult\u003cMessage\u003cString\u003e\u003e\u003e() {\n+    vertx.eventBus().registerHandler(context.id(), new Handler\u003cMessage\u003cJsonObject\u003e\u003e() {\n       @Override\n-      public void handle(AsyncResult\u003cMessage\u003cString\u003e\u003e result) {\n-        if (result.succeeded()) {\n-          String heartbeatAddress \u003d result.result().body();\n-          heartbeat.setAddress(heartbeatAddress);\n-          heartbeat.setInterval(context.componentContext().heartbeatInterval());\n-          heartbeat.start();\n-          future.setResult(null);\n-        }\n-        else {\n-          future.setFailure(new VertigoException(\"Failed to fetch heartbeat address from network.\"));\n+      public void handle(Message\u003cJsonObject\u003e message) {\n+        final String action \u003d message.body().getString(\"action\");\n+        if (action \u003d\u003d null) return;\n+        switch (action) {\n+          case \"ready\":\n+            // If the ready action has touched all component instances, start\n+            // the network.\n+            JsonArray touched \u003d message.body().getArray(\"instances\");\n+            if (touched.size() \u003d\u003d instances.size()) {\n+              for (String instanceID : instances) {\n+                eventBus.send(instanceID, new JsonObject().putString(\"action\", \"start\").putString(\"source\", context.id()));\n+              }\n+            }\n+            // Otherwise, add this instance to the touched list and pass it to the next instance.\n+            else {\n+              for (String instanceID : instances) {\n+                if (!touched.contains(instanceID)) {\n+                  touched.add(instanceID);\n+                  eventBus.send(instanceID, new JsonObject().putString(\"action\", \"ready\").putArray(\"instances\", touched));\n+                }\n+              }\n+            }\n+            break;\n+          case \"start\":\n+            // All the component instances in the network have been started.\n+            // Forward the start on to all visible components.\n+            if (!started \u0026\u0026 !message.body().getString(\"source\").equals(context.id())) {\n+              for (String instanceID : instances) {\n+                eventBus.send(instanceID, new JsonObject().putString(\"action\", \"start\").putString(\"source\", context.id()));\n+              }\n+              started \u003d true;\n+              future.setResult((Void) null);\n+            }\n+            break;\n+          case \"shutdown\":\n+            message.reply(new JsonObject().putString(\"status\", \"ok\"));\n+            hookStop();\n+            container.exit();\n+            break;\n+          default:\n+            message.reply(new JsonObject().putString(\"status\", \"error\").putString(\"message\", \"Invalid action \" + action));\n+            break;\n         }\n       }\n+    }, new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n+      @Override\n+      public void handle(AsyncResult\u003cVoid\u003e result) {\n+        vertx.setPeriodic(2000, new Handler\u003cLong\u003e() {\n+          @Override\n+          public void handle(Long timerID) {\n+            if (started) {\n+              vertx.cancelTimer(timerID);\n+            }\n+            else {\n+              eventBus.send(instances.iterator().next(), new JsonObject().putString(\"action\", \"ready\")\n+                  .putArray(\"instances\", new JsonArray().add(context.id())));\n+            }\n+          }\n+        });\n+      }\n     });\n-  }\n-\n-  /**\n-   * Indicates to the network that the component is ready.\n-   */\n-  private void ready(Handler\u003cAsyncResult\u003cVoid\u003e\u003e doneHandler) {\n-    final Future\u003cVoid\u003e future \u003d new DefaultFutureResult\u003cVoid\u003e();\n-    if (doneHandler !\u003d null) {\n-      future.setHandler(doneHandler);\n-    }\n-\n-    eventBus.send(networkAddress, new JsonObject().putString(\"action\", \"ready\").putString(\"id\", instanceId), new Handler\u003cMessage\u003cVoid\u003e\u003e() {\n+    vertx.setPeriodic(5000, new Handler\u003cLong\u003e() {\n       @Override\n-      public void handle(Message\u003cVoid\u003e message) {\n-        future.setResult(null);\n+      public void handle(Long timerID) {\n+        vertx.eventBus().publish(context.componentContext().networkContext().address(), new JsonObject().putString(\"id\", context.id()));\n       }\n     });\n   }"
        },
        {
          "file_name": "src/main/java/net/kuujo/vertigo/coordinator/AbstractCoordinator.java",
          "patch": "@@ -23,16 +23,13 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Set;\n-import java.util.UUID;\n \n import net.kuujo.vertigo.auditor.AuditorVerticle;\n import net.kuujo.vertigo.context.ComponentContext;\n import net.kuujo.vertigo.context.InstanceContext;\n import net.kuujo.vertigo.context.ModuleContext;\n import net.kuujo.vertigo.context.NetworkContext;\n import net.kuujo.vertigo.context.VerticleContext;\n-import net.kuujo.vertigo.coordinator.heartbeat.HeartbeatMonitor;\n-import net.kuujo.vertigo.coordinator.heartbeat.impl.DefaultHeartbeatMonitor;\n import net.kuujo.vertigo.events.Events;\n import net.kuujo.vertigo.serializer.SerializationException;\n \n@@ -58,9 +55,7 @@\n   protected Events events;\n   protected Map\u003cString, String\u003e deploymentMap \u003d new HashMap\u003c\u003e();\n   protected Map\u003cString, InstanceContext\u003c?\u003e\u003e contextMap \u003d new HashMap\u003c\u003e();\n-  protected Map\u003cString, HeartbeatMonitor\u003e heartbeats \u003d new HashMap\u003c\u003e();\n   protected Set\u003cString\u003e instances \u003d new HashSet\u003c\u003e();\n-  protected Map\u003cString, Message\u003cJsonObject\u003e\u003e ready \u003d new HashMap\u003c\u003e();\n   protected Set\u003cString\u003e auditorDeploymentIds \u003d new HashSet\u003c\u003e();\n \n   @Override\n@@ -184,21 +179,9 @@ public void handle(Message\u003cJsonObject\u003e message) {\n     String action \u003d getMandatoryString(\"action\", message);\n     if (action !\u003d null) {\n       switch (action) {\n-        case \"register\":\n-          doRegister(message);\n-          break;\n-        case \"unregister\":\n-          doUnregister(message);\n-          break;\n         case \"shutdown\":\n           doShutdown(message);\n           break;\n-        case \"redeploy\":\n-          doRedeployAll(message);\n-          break;\n-        case \"ready\":\n-          doReady(message);\n-          break;\n         default:\n           sendError(message, String.format(\"Invalid action %s.\", action));\n           break;\n@@ -296,124 +279,6 @@ public void handle(AsyncResult\u003cString\u003e result) {\n   }\n \n   /**\n-   * Creates a unique heartbeat address.\n-   */\n-  private String createHeartbeatAddress() {\n-    return UUID.randomUUID().toString();\n-  }\n-\n-  /**\n-   * Registers a heartbeat.\n-   */\n-  private void doRegister(Message\u003cJsonObject\u003e message) {\n-    final String address \u003d getMandatoryString(\"address\", message);\n-    if (logger.isDebugEnabled()) {\n-      logger.debug(String.format(\"Registering heartbeat: %s\", address));\n-    }\n-    String heartbeatAddress \u003d createHeartbeatAddress();\n-    HeartbeatMonitor monitor \u003d new DefaultHeartbeatMonitor(heartbeatAddress, vertx);\n-    monitor.listen(new Handler\u003cString\u003e() {\n-      @Override\n-      public void handle(String heartbeatAddress) {\n-        if (heartbeats.containsKey(address)) {\n-          heartbeats.remove(address);\n-          doRedeploy(address);\n-        }\n-      }\n-    });\n-    heartbeats.put(address, monitor);\n-    message.reply(heartbeatAddress);\n-  }\n-\n-  /**\n-   * Unregisters a heartbeat.\n-   */\n-  private void doUnregister(Message\u003cJsonObject\u003e message) {\n-    final String address \u003d getMandatoryString(\"address\", message);\n-    if (logger.isDebugEnabled()) {\n-      logger.debug(String.format(\"Unregistering heartbeat: %s\", address));\n-    }\n-    if (heartbeats.containsKey(address)) {\n-      HeartbeatMonitor monitor \u003d heartbeats.get(address);\n-      monitor.unlisten();\n-      heartbeats.remove(address);\n-    }\n-    doRedeploy(address);\n-  }\n-\n-  /**\n-   * Redeploys a worker.\n-   */\n-  private void doRedeploy(final String id) {\n-    if (deploymentMap.containsKey(id)) {\n-      if (logger.isDebugEnabled()) {\n-        logger.debug(String.format(\"Redeploying %s\", id));\n-      }\n-      String deploymentID \u003d deploymentMap.get(id);\n-      undeployVerticle(deploymentID, new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n-        @Override\n-        public void handle(AsyncResult\u003cVoid\u003e result) {\n-          deploymentMap.remove(id);\n-          if (contextMap.containsKey(id)) {\n-            final InstanceContext\u003c?\u003e context \u003d contextMap.get(id);\n-\n-            JsonObject config;\n-            try {\n-              config \u003d InstanceContext.toJson(context);\n-            }\n-            catch (SerializationException e) {\n-              logger.error(String.format(\"Failed to deploy %s instance %s.\", context.componentContext().address(), context.address()));\n-              return;\n-            }\n-\n-            if (context.componentContext().isModule()) {\n-              deployModule(context.\u003cModuleContext\u003ecomponentContext().module(), config, new Handler\u003cAsyncResult\u003cString\u003e\u003e() {\n-                @Override\n-                public void handle(AsyncResult\u003cString\u003e result) {\n-                  if (result.succeeded()) {\n-                    deploymentMap.put(context.address(), result.result());\n-                  }\n-                  else {\n-                    logger.error(String.format(\"Failed to deploy %s instance %s.\", context.componentContext().address(), context.address()));\n-                  }\n-                }\n-              });\n-            }\n-            else if (context.componentContext().isVerticle()) {\n-              if (context.\u003cVerticleContext\u003ecomponentContext().isWorker()) {\n-                deployWorkerVerticle(context.\u003cVerticleContext\u003ecomponentContext().main(), config, context.\u003cVerticleContext\u003ecomponentContext().isMultiThreaded(), new Handler\u003cAsyncResult\u003cString\u003e\u003e() {\n-                  @Override\n-                  public void handle(AsyncResult\u003cString\u003e result) {\n-                    if (result.succeeded()) {\n-                      deploymentMap.put(context.address(), result.result());\n-                    }\n-                    else {\n-                      logger.error(String.format(\"Failed to deploy %s instance %s.\", context.componentContext().address(), context.address()));\n-                    }\n-                  }\n-                });\n-              }\n-              else {\n-                deployVerticle(context.\u003cVerticleContext\u003ecomponentContext().main(), config, new Handler\u003cAsyncResult\u003cString\u003e\u003e() {\n-                  @Override\n-                  public void handle(AsyncResult\u003cString\u003e result) {\n-                    if (result.succeeded()) {\n-                      deploymentMap.put(context.address(), result.result());\n-                    }\n-                    else {\n-                      logger.error(String.format(\"Failed to deploy %s instance %s.\", context.componentContext().address(), context.address()));\n-                    }\n-                  }\n-                });\n-              }\n-            }\n-          }\n-        }\n-      });\n-    }\n-  }\n-\n-  /**\n    * Shuts down the network.\n    */\n   private void doShutdown(final Message\u003cJsonObject\u003e message) {\n@@ -430,47 +295,6 @@ public void handle(AsyncResult\u003cVoid\u003e result) {\n   }\n \n   /**\n-   * Redeploys the entire network.\n-   */\n-  private void doRedeployAll(final Message\u003cJsonObject\u003e message) {\n-    new RecursiveDeployer(context).undeploy(new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n-      @Override\n-      public void handle(AsyncResult\u003cVoid\u003e result) {\n-        new RecursiveDeployer(context).deploy(new Handler\u003cAsyncResult\u003cVoid\u003e\u003e() {\n-          @Override\n-          public void handle(AsyncResult\u003cVoid\u003e result) {\n-            message.reply(result.succeeded());\n-          }\n-        });\n-      }\n-    });\n-  }\n-\n-  /**\n-   * Indicates that a component instance is ready.\n-   */\n-  private void doReady(Message\u003cJsonObject\u003e message) {\n-    String id \u003d getMandatoryString(\"id\", message);\n-    if (id !\u003d null) {\n-      ready.put(id, message);\n-      if (logger.isDebugEnabled()) {\n-        logger.debug(String.format(\"%s is ready\", id));\n-      }\n-      InstanceContext\u003c?\u003e context \u003d contextMap.get(id);\n-      events.trigger(Events.Component.Start.class, context.componentContext().address(), context);\n-      if (ready.size() \u003d\u003d instances.size()) {\n-        if (logger.isInfoEnabled()) {\n-          logger.info(\"Starting components\");\n-        }\n-        events.trigger(Events.Network.Start.class, this.context.address(), this.context);\n-        for (Message\u003cJsonObject\u003e replyMessage : ready.values()) {\n-          replyMessage.reply();\n-        }\n-      }\n-    }\n-  }\n-\n-  /**\n    * Recursively deploys all network components.\n    *\n    * @author Jordan Halterman"
        },
        {
          "file_name": "src/main/java/net/kuujo/vertigo/coordinator/heartbeat/HeartbeatEmitter.java",
          "patch": "@@ -1,72 +0,0 @@\n-/*\n- * Copyright 2013 the original author or authors.\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- * http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package net.kuujo.vertigo.coordinator.heartbeat;\n-\n-/**\n- * A heartbeat emitter.\n- *\n- * @author Jordan Halterman\n- */\n-public interface HeartbeatEmitter {\n-\n-  /**\n-   * Sets the heartbeat emitter address.\n-   *\n-   * @param address\n-   *   The address to which to emit heartbeats.\n-   * @return\n-   *   The heartbeat emitter instance.\n-   */\n-  HeartbeatEmitter setAddress(String address);\n-\n-  /**\n-   * Gets the heartbeat address.\n-   *\n-   * @return\n-   *   The heartbeat address.\n-   */\n-  String getAddress();\n-\n-  /**\n-   * Sets the heartbeat interval.\n-   *\n-   * @param interval\n-   *   The heartbeat interval. This is the interval at which heartbeats will\n-   *   be emitted.\n-   * @return\n-   *   The heartbeat emitter instance.\n-   */\n-  HeartbeatEmitter setInterval(long interval);\n-\n-  /**\n-   * Gets the heartbeat interval.\n-   *\n-   * @return\n-   *   The heartbeat interval.\n-   */\n-  long getInterval();\n-\n-  /**\n-   * Starts emitting heartbeats at an address.\n-   */\n-  void start();\n-\n-  /**\n-   * Stops emitting heartbeats to an address.\n-   */\n-  void stop();\n-\n-}\n\\ No newline at end of file"
        },
        {
          "file_name": "src/main/java/net/kuujo/vertigo/coordinator/heartbeat/HeartbeatMonitor.java",
          "patch": "@@ -1,77 +0,0 @@\n-/*\n- * Copyright 2013 the original author or authors.\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- * http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package net.kuujo.vertigo.coordinator.heartbeat;\n-\n-import org.vertx.java.core.Handler;\n-\n-/**\n- * A heartbeat monitor.\n- *\n- * @author Jordan Halterman\n- */\n-public interface HeartbeatMonitor {\n-\n-  /**\n-   * Sets the heartbeat monitor address.\n-   *\n-   * @param address\n-   *   The address at which to monitor for heartbeats.\n-   * @return\n-   *   The called monitor instance.\n-   */\n-  HeartbeatMonitor setAddress(String address);\n-\n-  /**\n-   * Gets the heartbeat monitor address.\n-   *\n-   * @return\n-   *   The heartbeat monitor address.\n-   */\n-  String getAddress();\n-\n-  /**\n-   * Sets the required heartbeat interval.\n-   *\n-   * @param interval\n-   *   The required heartbeat interval. If this interval is reached between any\n-   *   heartbeat then the heartbeat will be considered failed.\n-   * @return\n-   *   The called monitor instance.\n-   */\n-  HeartbeatMonitor setRequiredInterval(long interval);\n-\n-  /**\n-   * Returns the required heartbeat interval.\n-   *\n-   * @return\n-   *   The required heartbeat interval.\n-   */\n-  long getRequiredInterval();\n-\n-  /**\n-   * Starts monitoring heartbeats at the given address.\n-   *\n-   * @param failHandler\n-   *   A handler to be invoked if heartbeats fail.\n-   */\n-  void listen(Handler\u003cString\u003e failHandler);\n-\n-  /**\n-   * Stops monitoring heartbeats at the given address.\n-   */\n-  void unlisten();\n-\n-}\n\\ No newline at end of file"
        },
        {
          "file_name": "src/main/java/net/kuujo/vertigo/coordinator/heartbeat/impl/DefaultHeartbeatEmitter.java",
          "patch": "@@ -1,86 +0,0 @@\n-/*\n- * Copyright 2013 the original author or authors.\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- * http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package net.kuujo.vertigo.coordinator.heartbeat.impl;\n-\n-import net.kuujo.vertigo.coordinator.heartbeat.HeartbeatEmitter;\n-\n-import org.vertx.java.core.Handler;\n-import org.vertx.java.core.Vertx;\n-import org.vertx.java.core.eventbus.EventBus;\n-\n-/**\n- * Default heartbeat emitter implementation.\n- *\n- * @author Jordan Halterman\n- */\n-public class DefaultHeartbeatEmitter implements HeartbeatEmitter {\n-  private String address;\n-  private Vertx vertx;\n-  private EventBus eventBus;\n-  private long interval \u003d 1000;\n-  private long timerID;\n-\n-  public DefaultHeartbeatEmitter(Vertx vertx) {\n-    this.vertx \u003d vertx;\n-    this.eventBus \u003d vertx.eventBus();\n-  }\n-\n-  public DefaultHeartbeatEmitter(String address, Vertx vertx) {\n-    this.address \u003d address;\n-    this.vertx \u003d vertx;\n-    this.eventBus \u003d vertx.eventBus();\n-  }\n-\n-  @Override\n-  public HeartbeatEmitter setAddress(String address) {\n-    this.address \u003d address;\n-    return this;\n-  }\n-\n-  @Override\n-  public String getAddress() {\n-    return address;\n-  }\n-\n-  @Override\n-  public HeartbeatEmitter setInterval(long interval) {\n-    this.interval \u003d interval;\n-    return this;\n-  }\n-\n-  @Override\n-  public long getInterval() {\n-    return interval;\n-  }\n-\n-  @Override\n-  public void start() {\n-    timerID \u003d vertx.setPeriodic(interval, new Handler\u003cLong\u003e() {\n-      @Override\n-      public void handle(Long event) {\n-        eventBus.send(address, true);\n-      }\n-    });\n-  }\n-\n-  @Override\n-  public void stop() {\n-    if (timerID !\u003d 0) {\n-      vertx.cancelTimer(timerID);\n-    }\n-  }\n-\n-}\n\\ No newline at end of file"
        },
        {
          "file_name": "src/main/java/net/kuujo/vertigo/coordinator/heartbeat/impl/DefaultHeartbeatMonitor.java",
          "patch": "@@ -1,143 +0,0 @@\n-/*\n- * Copyright 2013 the original author or authors.\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- * http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package net.kuujo.vertigo.coordinator.heartbeat.impl;\n-\n-import net.kuujo.vertigo.coordinator.heartbeat.HeartbeatMonitor;\n-\n-import org.vertx.java.core.Handler;\n-import org.vertx.java.core.Vertx;\n-import org.vertx.java.core.eventbus.EventBus;\n-import org.vertx.java.core.eventbus.Message;\n-\n-/**\n- * Default heartbeat monitor implementation.\n- *\n- * @author Jordan Halterman\n- */\n-public class DefaultHeartbeatMonitor implements HeartbeatMonitor {\n-  private String address;\n-  private Vertx vertx;\n-  private EventBus eventBus;\n-  private long interval \u003d 5000;\n-  private AddressMonitor currentMonitor;\n-\n-  public DefaultHeartbeatMonitor(Vertx vertx) {\n-    this.vertx \u003d vertx;\n-    this.eventBus \u003d vertx.eventBus();\n-  }\n-\n-  public DefaultHeartbeatMonitor(String address, Vertx vertx) {\n-    this.address \u003d address;\n-    this.vertx \u003d vertx;\n-    this.eventBus \u003d vertx.eventBus();\n-  }\n-\n-  @Override\n-  public HeartbeatMonitor setAddress(String address) {\n-    this.address \u003d address;\n-    return this;\n-  }\n-\n-  @Override\n-  public String getAddress() {\n-    return address;\n-  }\n-\n-  @Override\n-  public HeartbeatMonitor setRequiredInterval(long interval) {\n-    this.interval \u003d interval;\n-    return this;\n-  }\n-\n-  @Override\n-  public long getRequiredInterval() {\n-    return interval;\n-  }\n-\n-  @Override\n-  public void listen(Handler\u003cString\u003e timeoutHandler) {\n-    if (currentMonitor !\u003d null) {\n-      currentMonitor.stop();\n-    }\n-    currentMonitor \u003d new AddressMonitor(address, timeoutHandler);\n-    currentMonitor.start();\n-  }\n-\n-  @Override\n-  public void unlisten() {\n-    if (currentMonitor !\u003d null) {\n-      currentMonitor.stop();\n-      currentMonitor \u003d null;\n-    }\n-  }\n-\n-  /**\n-  * A monitor on a single address.\n-  */\n-  private class AddressMonitor {\n-    private String address;\n-    private Handler\u003cString\u003e timeoutHandler;\n-    private long timerID;\n-\n-    private Handler\u003cMessage\u003cBoolean\u003e\u003e handler \u003d new Handler\u003cMessage\u003cBoolean\u003e\u003e() {\n-      @Override\n-      public void handle(Message\u003cBoolean\u003e message) {\n-        resetTimer();\n-      }\n-    };\n-\n-    public AddressMonitor(String address, Handler\u003cString\u003e timeoutHandler) {\n-      this.address \u003d address;\n-      this.timeoutHandler \u003d timeoutHandler;\n-    }\n-\n-    /**\n-    * Starts the monitor.\n-    */\n-    private void start() {\n-      eventBus.registerHandler(address, handler);\n-    }\n-\n-    /**\n-    * Stops the monitor.\n-    */\n-    private void stop() {\n-      eventBus.unregisterHandler(address, handler);\n-      if (timerID !\u003d 0) {\n-        vertx.cancelTimer(timerID);\n-      }\n-    }\n-\n-    /**\n-    * Resets the monitor timer.\n-    */\n-    private void resetTimer() {\n-      // First, cancel the old timer.\n-      if (timerID !\u003d 0) {\n-        vertx.cancelTimer(timerID);\n-      }\n-      // Then, create a new timer that triggers the timeoutHandler if called.\n-      timerID \u003d vertx.setTimer(interval, new Handler\u003cLong\u003e() {\n-        @Override\n-        public void handle(Long event) {\n-          eventBus.unregisterHandler(address, handler);\n-          timeoutHandler.handle(address);\n-        }\n-      });\n-    }\n-  }\n-\n-}"
        }
      ]
    }
  },
  {
    "name": "(CDAP-1402) Temporary fix for the stream config update race condition",
    "url": "https://github.com/caskdata/cdap/pull/1225",
    "description": "",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/caskdata/cdap/commit/22378910e3c9104c00bb69758e92d6dc6af55018",
      "files": [
        {
          "file_name": "cdap-data-fabric/src/main/java/co/cask/cdap/data/stream/AbstractStreamCoordinatorClient.java",
          "patch": "@@ -24,17 +24,14 @@\n import co.cask.cdap.common.conf.PropertyUpdater;\n import co.cask.cdap.common.io.Codec;\n import co.cask.cdap.common.io.Locations;\n-import co.cask.cdap.data2.transaction.stream.AbstractStreamFileAdmin;\n import co.cask.cdap.data2.transaction.stream.StreamAdmin;\n import co.cask.cdap.data2.transaction.stream.StreamConfig;\n import co.cask.cdap.internal.io.SchemaTypeAdapter;\n import com.google.common.base.Charsets;\n import com.google.common.base.Function;\n import com.google.common.base.Objects;\n-import com.google.common.base.Preconditions;\n import com.google.common.base.Supplier;\n import com.google.common.base.Suppliers;\n-import com.google.common.io.CharStreams;\n import com.google.common.util.concurrent.AbstractIdleService;\n import com.google.common.util.concurrent.Futures;\n import com.google.common.util.concurrent.ListenableFuture;\n@@ -43,7 +40,6 @@\n import com.google.gson.GsonBuilder;\n import org.apache.twill.common.Cancellable;\n import org.apache.twill.common.Threads;\n-import org.apache.twill.filesystem.Location;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n@@ -127,8 +123,8 @@ public Integer apply(StreamProperty property) {\n   }\n \n   @Override\n-  public ListenableFuture\u003cLong\u003e changeTTL(final StreamConfig streamConfig, final long newTTL) {\n-    return Futures.transform(propertyStore.get().update(streamConfig.getName(), new PropertyUpdater\u003cStreamProperty\u003e() {\n+  public ListenableFuture\u003cLong\u003e changeTTL(final String streamName, final long newTTL) {\n+    return Futures.transform(propertyStore.get().update(streamName, new PropertyUpdater\u003cStreamProperty\u003e() {\n       @Override\n       public ListenableFuture\u003cStreamProperty\u003e apply(@Nullable final StreamProperty property) {\n         final SettableFuture\u003cStreamProperty\u003e resultFuture \u003d SettableFuture.create();\n@@ -137,19 +133,13 @@ public Integer apply(StreamProperty property) {\n           @Override\n           public void run() {\n             try {\n+              StreamConfig streamConfig \u003d streamAdmin.getConfig(streamName);\n               int currentGeneration \u003d (property \u003d\u003d null) ?\n                 StreamUtils.getGeneration(streamConfig) :\n                 property.getGeneration();\n               int currentThreshold \u003d (property \u003d\u003d null) ?\n                 streamConfig.getNotificationThresholdMB() :\n                 property.getThreshold();\n-\n-              StreamConfig newConfig \u003d new StreamConfig(streamConfig.getName(), streamConfig.getPartitionDuration(),\n-                                                        streamConfig.getIndexInterval(), newTTL,\n-                                                        streamConfig.getLocation(),\n-                                                        streamConfig.getFormat(),\n-                                                        currentThreshold);\n-              saveConfig(newConfig);\n               resultFuture.set(new StreamProperty(currentGeneration, newTTL, currentThreshold));\n             } catch (IOException e) {\n               resultFuture.setException(e);\n@@ -167,8 +157,8 @@ public Long apply(StreamProperty property) {\n   }\n \n   @Override\n-  public ListenableFuture\u003cInteger\u003e changeThreshold(final StreamConfig streamConfig, final int newThreshold) {\n-    return Futures.transform(propertyStore.get().update(streamConfig.getName(), new PropertyUpdater\u003cStreamProperty\u003e() {\n+  public ListenableFuture\u003cInteger\u003e changeThreshold(final String streamName, final int newThreshold) {\n+    return Futures.transform(propertyStore.get().update(streamName, new PropertyUpdater\u003cStreamProperty\u003e() {\n       @Override\n       public ListenableFuture\u003cStreamProperty\u003e apply(@Nullable final StreamProperty property) {\n         final SettableFuture\u003cStreamProperty\u003e resultFuture \u003d SettableFuture.create();\n@@ -177,19 +167,13 @@ public Long apply(StreamProperty property) {\n           @Override\n           public void run() {\n             try {\n+              StreamConfig streamConfig \u003d streamAdmin.getConfig(streamName);\n               int currentGeneration \u003d (property \u003d\u003d null) ?\n                 StreamUtils.getGeneration(streamConfig) :\n                 property.getGeneration();\n               long currentTTL \u003d (property \u003d\u003d null) ?\n                 streamConfig.getTTL() :\n                 property.getTTL();\n-\n-              StreamConfig newConfig \u003d new StreamConfig(streamConfig.getName(), streamConfig.getPartitionDuration(),\n-                                                        streamConfig.getIndexInterval(), currentTTL,\n-                                                        streamConfig.getLocation(),\n-                                                        streamConfig.getFormat(),\n-                                                        newThreshold);\n-              saveConfig(newConfig);\n               resultFuture.set(new StreamProperty(currentGeneration, currentTTL, newThreshold));\n             } catch (IOException e) {\n               resultFuture.setException(e);\n@@ -226,27 +210,6 @@ protected final void shutDown() throws Exception {\n   protected abstract void doShutDown() throws Exception;\n \n   /**\n-   * Overwrites a stream config file.\n-   *\n-   * @param config The new configuration.\n-   */\n-  private void saveConfig(StreamConfig config) throws IOException {\n-    Location configLocation \u003d config.getLocation().append(AbstractStreamFileAdmin.CONFIG_FILE_NAME);\n-    Location tempLocation \u003d configLocation.getTempFile(\"tmp\");\n-    try {\n-      CharStreams.write(GSON.toJson(config), CharStreams.newWriterSupplier(\n-        Locations.newOutputSupplier(tempLocation), Charsets.UTF_8));\n-\n-      Preconditions.checkState(tempLocation.renameTo(configLocation) !\u003d null,\n-                               \"Rename {} to {} failed\", tempLocation, configLocation);\n-    } finally {\n-      if (tempLocation.exists()) {\n-        tempLocation.delete();\n-      }\n-    }\n-  }\n-\n-  /**\n    * Object for holding property value in the property store.\n    */\n   private static final class StreamProperty {"
        },
        {
          "file_name": "cdap-data-fabric/src/main/java/co/cask/cdap/data/stream/StreamCoordinatorClient.java",
          "patch": "@@ -39,22 +39,22 @@\n   /**\n    * Changes the TTL of the given stream.\n    *\n-   * @param streamConfig stream configuration\n+   * @param streamName name of the stream\n    * @param ttl the new TTL\n    * @return A future that will be completed when the update of TTL is done. The future result will carry\n    *         the TTL updated by this method.\n    */\n-  ListenableFuture\u003cLong\u003e changeTTL(StreamConfig streamConfig, long ttl);\n+  ListenableFuture\u003cLong\u003e changeTTL(String streamName, long ttl);\n \n   /**\n    * Changes the notification threshold of the given stream.\n    *\n-   * @param streamConfig stream configuration\n+   * @param streamName name of the stream\n    * @param threshold the new notification threshold\n    * @return A future that will be completed when the update of threshold is done. The future result will carry\n    *         the threshold updated by this method.\n    */\n-  ListenableFuture\u003cInteger\u003e changeThreshold(StreamConfig streamConfig, int threshold);\n+  ListenableFuture\u003cInteger\u003e changeThreshold(String streamName, int threshold);\n \n   /**\n    * Receives event for changes in stream properties."
        },
        {
          "file_name": "cdap-data-fabric/src/main/java/co/cask/cdap/data2/transaction/stream/AbstractStreamFileAdmin.java",
          "patch": "@@ -234,16 +234,22 @@ public void updateConfig(StreamConfig config) throws IOException {\n                                   \"(can only update ttl, format or threshold)\",\n                                 config.getName());\n \n-    if (originalConfig.getTTL() !\u003d config.getTTL()) {\n-      // This call will also save the config\n-      streamCoordinatorClient.changeTTL(originalConfig, config.getTTL());\n+    // It\u0027s a temp fix to avoid async update (through stream coordinator client overwrites changes in here.\n+    // It works only if there is no concurrent updates from multiple clients\n+    // A proper fix needs to be done to make concurrent updates from multiple threads/processes safe.\n+    boolean formatChanged \u003d !originalConfig.getFormat().equals(config.getFormat());\n+    boolean ttlChanged \u003d originalConfig.getTTL() !\u003d config.getTTL();\n+    boolean thresholdChanged \u003d !originalConfig.getNotificationThresholdMB().equals(config.getNotificationThresholdMB());\n+\n+    if (formatChanged || ttlChanged || thresholdChanged) {\n+      saveConfig(config);\n     }\n-    if (originalConfig.getNotificationThresholdMB() !\u003d config.getNotificationThresholdMB()) {\n-      // This call will also save the config\n-      streamCoordinatorClient.changeThreshold(originalConfig, config.getNotificationThresholdMB());\n+\n+    if (ttlChanged) {\n+      streamCoordinatorClient.changeTTL(originalConfig.getName(), config.getTTL());\n     }\n-    if (!originalConfig.getFormat().equals(config.getFormat())) {\n-      saveConfig(config);\n+    if (thresholdChanged) {\n+      streamCoordinatorClient.changeThreshold(originalConfig.getName(), config.getNotificationThresholdMB());\n     }\n   }\n "
        }
      ]
    }
  },
  {
    "name": "[Scenario 1] Pusher missing docs: Potential race condition when calling PusherInternal.removePending()",
    "url": "https://github.com/couchbase/couchbase-lite-java-core/issues/1129",
    "description": "PusherInternal.removePending() could be called from request workers which could be more than one threads at the same time. This might cause an issue with setting last sequence and result to skipping docs.\n\nhttps://github.com/couchbase/couchbase-lite-java-core/blob/master/src/main/java/com/couchbase/lite/replicator/PusherInternal.java#L393-L492\n\nhttps://github.com/couchbase/couchbase-lite-java-core/blob/master/src/main/java/com/couchbase/lite/replicator/PusherInternal.java#L521-L561\n\nhttps://github.com/couchbase/couchbase-lite-java-core/blob/master/src/main/java/com/couchbase/lite/replicator/PusherInternal.java#L387\n",
    "keywords": [
      "https://github",
      "com/couchbase/couchbase-lite-java-core/blob/master/src/main/java/com/couchbase/lite/replicator/pusherinternal"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/couchbase/couchbase-lite-java-core/commit/f027a06e1a06ed3aa8a035c0e1da796d518a88e4",
      "files": [
        {
          "file_name": "src/main/java/com/couchbase/lite/replicator/PusherInternal.java",
          "patch": "@@ -60,6 +60,7 @@\n     private boolean dontSendMultipart \u003d false;\n     SortedSet\u003cLong\u003e pendingSequences;\n     Long maxPendingSequence;\n+    final Object pendingSequencesLock \u003d new Object();\n     final Object changesLock \u003d new Object();\n     boolean doneBeginReplicating \u003d false;\n     List\u003cRevisionInternal\u003e queueChanges \u003d new ArrayList\u003cRevisionInternal\u003e();\n@@ -264,10 +265,12 @@ protected void goOffline() {\n      */\n     @InterfaceAudience.Private\n     private void addPending(RevisionInternal revisionInternal) {\n-        long seq \u003d revisionInternal.getSequence();\n-        pendingSequences.add(seq);\n-        if (seq \u003e maxPendingSequence) {\n-            maxPendingSequence \u003d seq;\n+        synchronized (pendingSequencesLock) {\n+            long seq \u003d revisionInternal.getSequence();\n+            pendingSequences.add(seq);\n+            if (seq \u003e maxPendingSequence) {\n+                maxPendingSequence \u003d seq;\n+            }\n         }\n     }\n \n@@ -277,33 +280,35 @@ private void addPending(RevisionInternal revisionInternal) {\n      */\n     @InterfaceAudience.Private\n     private void removePending(RevisionInternal revisionInternal) {\n-        long seq \u003d revisionInternal.getSequence();\n-        if (pendingSequences \u003d\u003d null || pendingSequences.isEmpty()) {\n-            Log.w(Log.TAG_SYNC, \"%s: removePending() called w/ rev: %s, but pendingSequences empty\",\n-                    this, revisionInternal);\n-            if(revisionInternal.getBody()!\u003dnull)\n-                revisionInternal.getBody().release();\n-            return;\n-        }\n-        boolean wasFirst \u003d (seq \u003d\u003d pendingSequences.first());\n-        if (!pendingSequences.contains(seq)) {\n-            Log.w(Log.TAG_SYNC, \"%s: removePending: sequence %s not in set, for rev %s\",\n-                    this, seq, revisionInternal);\n-        }\n-        pendingSequences.remove(seq);\n-        if (wasFirst) {\n-            // If I removed the first pending sequence, can advance the checkpoint:\n-            long maxCompleted;\n-            if (pendingSequences.size() \u003d\u003d 0) {\n-                maxCompleted \u003d maxPendingSequence;\n-            } else {\n-                maxCompleted \u003d pendingSequences.first();\n-                --maxCompleted;\n+        synchronized (pendingSequencesLock) {\n+            long seq \u003d revisionInternal.getSequence();\n+            if (pendingSequences \u003d\u003d null || pendingSequences.isEmpty()) {\n+                Log.w(Log.TAG_SYNC, \"%s: removePending() called w/ rev: %s, but pendingSequences empty\",\n+                        this, revisionInternal);\n+                if (revisionInternal.getBody() !\u003d null)\n+                    revisionInternal.getBody().release();\n+                return;\n             }\n-            setLastSequence(Long.toString(maxCompleted));\n+            boolean wasFirst \u003d (seq \u003d\u003d pendingSequences.first());\n+            if (!pendingSequences.contains(seq)) {\n+                Log.w(Log.TAG_SYNC, \"%s: removePending: sequence %s not in set, for rev %s\",\n+                        this, seq, revisionInternal);\n+            }\n+            pendingSequences.remove(seq);\n+            if (wasFirst) {\n+                // If I removed the first pending sequence, can advance the checkpoint:\n+                long maxCompleted;\n+                if (pendingSequences.size() \u003d\u003d 0) {\n+                    maxCompleted \u003d maxPendingSequence;\n+                } else {\n+                    maxCompleted \u003d pendingSequences.first();\n+                    --maxCompleted;\n+                }\n+                setLastSequence(Long.toString(maxCompleted));\n+            }\n+            if (revisionInternal.getBody() !\u003d null)\n+                revisionInternal.getBody().release();\n         }\n-        if (revisionInternal.getBody() !\u003d null)\n-            revisionInternal.getBody().release();\n     }\n \n     /**"
        }
      ]
    }
  },
  {
    "name": "Race condition in JMS example itests",
    "url": "https://github.com/wildfly-extras/wildfly-camel-examples/issues/4",
    "description": "Example test failure here:\n\nhttps://ci.fabric8.io/job/wildfly-camel-examples-pullreq/1/testReport/junit/org.wildfly.camel.test.activemq/ActiveMQExampleTest/testFileToActiveMQRoute\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/wildfly-extras/wildfly-camel-examples/commit/47750d3dc3ded38488a368177bec329f93035e26",
      "files": [
        {
          "file_name": "camel-jms-tx/src/main/java/org/wildfly/camel/examples/jms/transacted/JmsRouteBuilder.java",
          "patch": "@@ -85,8 +85,8 @@ public void configure() throws Exception {\n          * queue.\n          */\n         from(\"jms:queue:OrdersQueue\")\n-                .unmarshal(jaxbDataFormat)\n-                .to(\"jpa:Order\")\n+            .unmarshal(jaxbDataFormat)\n+            .to(\"jpa:Order\")\n                 .choice()\n                 .when(simple(\"${body.quantity} \u003e 10\"))\n                     .log(\"Order quantity is greater than 10 - rolling back transaction!\")"
        },
        {
          "file_name": "camel-jms-tx/src/main/resources/META-INF/persistence.xml",
          "patch": "@@ -25,7 +25,7 @@ limitations under the License.\n         http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd\"\u003e\n     \u003cpersistence-unit name\u003d\"camel\"\u003e\n         \u003cjta-data-source\u003ejava:jboss/datasources/ExampleDS\u003c/jta-data-source\u003e\n-        \u003cclass\u003eorg.wildfly.camel.examples.jms.transacted.model.Order\u003c/class\u003e\n+        \u003cclass\u003eorg.wildfly.camel.examples.jms.tx.model.Order\u003c/class\u003e\n         \u003cproperties\u003e\n             \u003cproperty name\u003d\"hibernate.hbm2ddl.auto\" value\u003d\"create-drop\"/\u003e\n             \u003cproperty name\u003d\"hibernate.show_sql\" value\u003d\"true\"/\u003e"
        },
        {
          "file_name": "itests/src/main/java/org/wildfly/camel/test/activemq/ActiveMQExampleTest.java",
          "patch": "@@ -20,86 +20,43 @@\n package org.wildfly.camel.test.activemq;\n \n import java.io.File;\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.net.MalformedURLException;\n-import java.nio.file.FileVisitResult;\n-import java.nio.file.Files;\n import java.nio.file.Path;\n-import java.nio.file.SimpleFileVisitor;\n-import java.nio.file.attribute.BasicFileAttributes;\n+import java.nio.file.Paths;\n \n import org.jboss.arquillian.container.test.api.Deployment;\n import org.jboss.arquillian.container.test.api.RunAsClient;\n import org.jboss.arquillian.junit.Arquillian;\n import org.jboss.shrinkwrap.api.ShrinkWrap;\n import org.jboss.shrinkwrap.api.spec.WebArchive;\n-import org.junit.After;\n import org.junit.Assert;\n-import org.junit.Before;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n+import org.wildfly.camel.test.common.FileConsumingTestSupport;\n import org.wildfly.camel.test.common.http.HttpRequest;\n import org.wildfly.camel.test.common.http.HttpRequest.HttpResponse;\n \n @RunAsClient\n @RunWith(Arquillian.class)\n-public class ActiveMQExampleTest {\n+public class ActiveMQExampleTest extends FileConsumingTestSupport {\n \n-    private File destination \u003d new File(System.getProperty(\"jboss.home\") + \"/standalone/data/orders\");\n-\n-    @Deployment\n+    @Deployment(testable \u003d false)\n     public static WebArchive createDeployment() {\n         return ShrinkWrap.createFromZipFile(WebArchive.class, new File(\"target/examples/example-camel-activemq.war\"));\n     }\n \n-    @Before\n-    public void setUp() {\n-        destination.toPath().toFile().mkdirs();\n-    }\n-\n-    @After\n-    public void tearDown() throws IOException {\n-        if (destination.toPath().toFile().exists()) {\n-            Files.walkFileTree(destination.toPath(), new SimpleFileVisitor\u003cPath\u003e() {\n-                @Override\n-                public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {\n-                    Files.delete(file);\n-                    return FileVisitResult.CONTINUE;\n-                }\n-\n-                @Override\n-                public FileVisitResult visitFileFailed(Path file, IOException exception) throws IOException {\n-                    exception.printStackTrace();\n-                    return FileVisitResult.CONTINUE;\n-                }\n-\n-                @Override\n-                public FileVisitResult postVisitDirectory(Path dir, IOException exception) throws IOException {\n-                    if (exception \u003d\u003d null) {\n-                        Files.delete(dir);\n-                    }\n-                    return FileVisitResult.CONTINUE;\n-                }\n-            });\n-        }\n-    }\n-\n     @Test\n     public void testFileToActiveMQRoute() throws Exception {\n-        InputStream input \u003d getClass().getResourceAsStream(\"/activemq/order.xml\");\n-        Path targetPath \u003d destination.toPath().resolve(\"order.xml\");\n-        Files.copy(input, targetPath);\n-        input.close();\n-\n-        // Give camel a chance to consume the test order file\n-        Thread.sleep(2000);\n-\n-        HttpResponse result \u003d HttpRequest.get(getEndpointAddress(\"/example-camel-activemq/orders\")).getResponse();\n+        HttpResponse result \u003d HttpRequest.get(\"http://localhost:8080/example-camel-activemq/orders\").getResponse();\n         Assert.assertTrue(result.getBody().contains(\"UK: 1\"));\n     }\n \n-    private String getEndpointAddress(String contextPath) throws MalformedURLException {\n-        return \"http://localhost:8080\" + contextPath;\n+    @Override\n+    protected String sourceFilename() {\n+        return \"order.xml\";\n+    }\n+\n+    @Override\n+    protected Path destinationPath() {\n+        return Paths.get(System.getProperty(\"jboss.home\") + \"/standalone/data/orders\");\n     }\n }"
        },
        {
          "file_name": "itests/src/main/java/org/wildfly/camel/test/common/FileConsumingTestSupport.java",
          "patch": "@@ -0,0 +1,97 @@\n+/*\n+ * #%L\n+ * Wildfly Camel :: Testsuite\n+ * %%\n+ * Copyright (C) 2013 - 2016 RedHat\n+ * %%\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * #L%\n+ */\n+package org.wildfly.camel.test.common;\n+\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+public abstract class FileConsumingTestSupport {\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        String packageName \u003d getClass().getPackage().getName();\n+        String fileLocation \u003d packageName.replace(\"org.wildfly.camel.test.\", \"\").replace(\".\", \"/\");\n+        String sourceFileName \u003d sourceFilename();\n+        InputStream input \u003d getClass().getResourceAsStream(\"/\" + fileLocation + \"/\" + sourceFileName);\n+        Files.copy(input, destinationPath().resolve(sourceFileName));\n+        input.close();\n+\n+        CountDownLatch latch \u003d new CountDownLatch(1);\n+        Path processedFile \u003d destinationPath().resolve(\".camel/\" + sourceFilename());\n+\n+        new Thread(() -\u003e {\n+            int count \u003d 0;\n+\n+            while (count \u003c 5) {\n+                count++;\n+                if (Files.exists(processedFile)) {\n+                    latch.countDown();\n+                    return;\n+                }\n+                try {\n+                    Thread.sleep(1000L);\n+                } catch (InterruptedException e) {\n+                }\n+            }\n+        }).start();\n+\n+        boolean await \u003d latch.await(5, TimeUnit.SECONDS);\n+        Assert.assertTrue(\"Gave up waiting for file to be processed\", await);\n+    }\n+\n+    @After\n+    public void tearDown () throws IOException {\n+        Files.walkFileTree(destinationPath(), new SimpleFileVisitor\u003cPath\u003e() {\n+            @Override\n+            public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {\n+                Files.delete(file);\n+                return FileVisitResult.CONTINUE;\n+            }\n+\n+            @Override\n+            public FileVisitResult visitFileFailed(Path file, IOException exception) throws IOException {\n+                exception.printStackTrace();\n+                return FileVisitResult.CONTINUE;\n+            }\n+\n+            @Override\n+            public FileVisitResult postVisitDirectory(Path dir, IOException exception) throws IOException {\n+                if (exception \u003d\u003d null) {\n+                    Files.delete(dir);\n+                }\n+                return FileVisitResult.CONTINUE;\n+            }\n+        });\n+    }\n+\n+    protected abstract String sourceFilename();\n+    protected abstract Path destinationPath();\n+}"
        },
        {
          "file_name": "itests/src/main/java/org/wildfly/camel/test/jms/JMSExampleTest.java",
          "patch": "@@ -20,14 +20,8 @@\n package org.wildfly.camel.test.jms;\n \n import java.io.File;\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.net.MalformedURLException;\n-import java.nio.file.FileVisitResult;\n-import java.nio.file.Files;\n import java.nio.file.Path;\n-import java.nio.file.SimpleFileVisitor;\n-import java.nio.file.attribute.BasicFileAttributes;\n+import java.nio.file.Paths;\n \n import org.jboss.arquillian.container.test.api.Deployment;\n import org.jboss.arquillian.container.test.api.RunAsClient;\n@@ -37,22 +31,21 @@\n import org.jboss.as.arquillian.container.ManagementClient;\n import org.jboss.shrinkwrap.api.ShrinkWrap;\n import org.jboss.shrinkwrap.api.spec.WebArchive;\n-import org.junit.After;\n import org.junit.Assert;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n+import org.wildfly.camel.test.common.FileConsumingTestSupport;\n import org.wildfly.camel.test.common.http.HttpRequest;\n import org.wildfly.camel.test.common.http.HttpRequest.HttpResponse;\n import org.wildfly.camel.test.common.utils.JMSUtils;\n \n @RunAsClient\n @RunWith(Arquillian.class)\n @ServerSetup({ JMSExampleTest.JmsQueueSetup.class })\n-public class JMSExampleTest {\n+public class JMSExampleTest extends FileConsumingTestSupport {\n \n     private static String ORDERS_QUEUE \u003d \"OrdersQueue\";\n     private static String ORDERS_QUEUE_JNDI \u003d \"java:/jms/queue/OrdersQueue\";\n-    private File destination \u003d new File(System.getProperty(\"jboss.home\") + \"/standalone/data/orders\");\n \n     static class JmsQueueSetup implements ServerSetupTask {\n \n@@ -67,50 +60,24 @@ public void tearDown(ManagementClient managementClient, String containerId) thro\n         }\n     }\n \n-    @Deployment\n+    @Deployment(testable \u003d false)\n     public static WebArchive createDeployment() {\n         return ShrinkWrap.createFromZipFile(WebArchive.class, new File(\"target/examples/example-camel-jms.war\"));\n     }\n \n-    @After\n-    public void tearDown () throws IOException {\n-        Files.walkFileTree(destination.toPath(), new SimpleFileVisitor\u003cPath\u003e() {\n-            @Override\n-            public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {\n-                Files.delete(file);\n-                return FileVisitResult.CONTINUE;\n-            }\n-\n-            @Override\n-            public FileVisitResult visitFileFailed(Path file, IOException exception) throws IOException {\n-                exception.printStackTrace();\n-                return FileVisitResult.CONTINUE;\n-            }\n-\n-            @Override\n-            public FileVisitResult postVisitDirectory(Path dir, IOException exception) throws IOException {\n-                if (exception \u003d\u003d null) {\n-                    Files.delete(dir);\n-                }\n-                return FileVisitResult.CONTINUE;\n-            }\n-        });\n-    }\n-\n     @Test\n     public void testFileToJmsRoute() throws Exception {\n-        InputStream input \u003d getClass().getResourceAsStream(\"/jms/order.xml\");\n-        Files.copy(input, destination.toPath().resolve(\"order.xml\"));\n-        input.close();\n-\n-        // Give camel a chance to consume the test order file\n-        Thread.sleep(2000);\n-\n-        HttpResponse result \u003d HttpRequest.get(getEndpointAddress(\"/example-camel-jms/orders\")).getResponse();\n+        HttpResponse result \u003d HttpRequest.get(\"http://localhost:8080/example-camel-jms/orders\").getResponse();\n         Assert.assertTrue(result.getBody().contains(\"UK: 1\"));\n     }\n \n-    private String getEndpointAddress(String contextPath) throws MalformedURLException {\n-        return \"http://localhost:8080\" + contextPath;\n+    @Override\n+    protected String sourceFilename() {\n+        return \"order.xml\";\n+    }\n+\n+    @Override\n+    protected Path destinationPath() {\n+        return Paths.get(System.getProperty(\"jboss.home\") + \"/standalone/data/orders\");\n     }\n }"
        },
        {
          "file_name": "itests/src/main/java/org/wildfly/camel/test/jms/tx/TransactedJMSExampleTest.java",
          "patch": "@@ -17,17 +17,11 @@\n  * limitations under the License.\n  * #L%\n  */\n-package org.wildfly.camel.test.jms;\n+package org.wildfly.camel.test.jms.tx;\n \n import java.io.File;\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.net.MalformedURLException;\n-import java.nio.file.FileVisitResult;\n-import java.nio.file.Files;\n import java.nio.file.Path;\n-import java.nio.file.SimpleFileVisitor;\n-import java.nio.file.attribute.BasicFileAttributes;\n+import java.nio.file.Paths;\n \n import org.jboss.arquillian.container.test.api.Deployment;\n import org.jboss.arquillian.container.test.api.RunAsClient;\n@@ -37,22 +31,21 @@\n import org.jboss.as.arquillian.container.ManagementClient;\n import org.jboss.shrinkwrap.api.ShrinkWrap;\n import org.jboss.shrinkwrap.api.spec.WebArchive;\n-import org.junit.After;\n import org.junit.Assert;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n+import org.wildfly.camel.test.common.FileConsumingTestSupport;\n import org.wildfly.camel.test.common.http.HttpRequest;\n import org.wildfly.camel.test.common.http.HttpRequest.HttpResponse;\n import org.wildfly.camel.test.common.utils.JMSUtils;\n \n @RunAsClient\n @RunWith(Arquillian.class)\n @ServerSetup({ TransactedJMSExampleTest.JmsQueueSetup.class })\n-public class TransactedJMSExampleTest {\n+public class TransactedJMSExampleTest extends FileConsumingTestSupport {\n \n     private static String ORDERS_QUEUE \u003d \"OrdersQueue\";\n     private static String ORDERS_QUEUE_JNDI \u003d \"java:/jms/queue/OrdersQueue\";\n-    private File destination \u003d new File(System.getProperty(\"jboss.home\") + \"/standalone/data/orders\");\n \n     static class JmsQueueSetup implements ServerSetupTask {\n \n@@ -67,51 +60,24 @@ public void tearDown(ManagementClient managementClient, String containerId) thro\n         }\n     }\n \n-    @Deployment\n+    @Deployment(testable \u003d false)\n     public static WebArchive createDeployment() {\n         return ShrinkWrap.createFromZipFile(WebArchive.class, new File(\"target/examples/example-camel-jms-tx.war\"));\n     }\n \n-    @After\n-    public void tearDown () throws IOException {\n-        Files.walkFileTree(destination.toPath(), new SimpleFileVisitor\u003cPath\u003e() {\n-            @Override\n-            public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {\n-                Files.delete(file);\n-                return FileVisitResult.CONTINUE;\n-            }\n-\n-            @Override\n-            public FileVisitResult visitFileFailed(Path file, IOException exception) throws IOException {\n-                exception.printStackTrace();\n-                return FileVisitResult.CONTINUE;\n-            }\n-\n-            @Override\n-            public FileVisitResult postVisitDirectory(Path dir, IOException exception) throws IOException {\n-                if (exception \u003d\u003d null) {\n-                    Files.delete(dir);\n-                }\n-                return FileVisitResult.CONTINUE;\n-            }\n-        });\n-    }\n-\n     @Test\n     public void testFileToJmsRoute() throws Exception {\n-        InputStream input \u003d getClass().getResourceAsStream(\"/jms/transacted/order.xml\");\n-        Files.copy(input, destination.toPath().resolve(\"order.xml\"));\n-        input.close();\n-\n-        // Give camel a chance to consume the test order file\n-        Thread.sleep(2000);\n-\n-        HttpResponse result \u003d HttpRequest.get(getEndpointAddress(\"/example-camel-jms-tx/orders\")).getResponse();\n-\n+        HttpResponse result \u003d HttpRequest.get(\"http://localhost:8080/example-camel-jms-tx/orders\").getResponse();\n         Assert.assertTrue(result.getBody().contains(\"Test Product\"));\n     }\n \n-    private String getEndpointAddress(String contextPath) throws MalformedURLException {\n-        return \"http://localhost:8080\" + contextPath;\n+    @Override\n+    protected String sourceFilename() {\n+        return \"order.xml\";\n+    }\n+\n+    @Override\n+    protected Path destinationPath() {\n+        return Paths.get(System.getProperty(\"jboss.home\") + \"/standalone/data/orders\");\n     }\n }"
        },
        {
          "file_name": "itests/src/main/java/org/wildfly/camel/test/jpa/JPAExampleTest.java",
          "patch": "@@ -20,77 +20,43 @@\n package org.wildfly.camel.test.jpa;\n \n import java.io.File;\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.net.MalformedURLException;\n-import java.nio.file.FileVisitResult;\n-import java.nio.file.Files;\n import java.nio.file.Path;\n-import java.nio.file.SimpleFileVisitor;\n-import java.nio.file.attribute.BasicFileAttributes;\n+import java.nio.file.Paths;\n \n import org.jboss.arquillian.container.test.api.Deployment;\n import org.jboss.arquillian.container.test.api.RunAsClient;\n import org.jboss.arquillian.junit.Arquillian;\n import org.jboss.shrinkwrap.api.ShrinkWrap;\n import org.jboss.shrinkwrap.api.spec.WebArchive;\n-import org.junit.After;\n import org.junit.Assert;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n+import org.wildfly.camel.test.common.FileConsumingTestSupport;\n import org.wildfly.camel.test.common.http.HttpRequest;\n import org.wildfly.camel.test.common.http.HttpRequest.HttpResponse;\n \n @RunAsClient\n @RunWith(Arquillian.class)\n-public class JPAExampleTest {\n+public class JPAExampleTest extends FileConsumingTestSupport {\n \n-    private File destination \u003d new File(System.getProperty(\"jboss.home\") + \"/standalone/data/customers\");\n-\n-    @Deployment\n+    @Deployment(testable \u003d false)\n     public static WebArchive createDeployment() {\n         return ShrinkWrap.createFromZipFile(WebArchive.class, new File(\"target/examples/example-camel-jpa.war\"));\n     }\n \n-    @After\n-    public void tearDown () throws IOException {\n-        Files.walkFileTree(destination.toPath(), new SimpleFileVisitor\u003cPath\u003e() {\n-            @Override\n-            public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {\n-                Files.delete(file);\n-                return FileVisitResult.CONTINUE;\n-            }\n-\n-            @Override\n-            public FileVisitResult visitFileFailed(Path file, IOException exception) throws IOException {\n-                exception.printStackTrace();\n-                return FileVisitResult.CONTINUE;\n-            }\n-\n-            @Override\n-            public FileVisitResult postVisitDirectory(Path dir, IOException exception) throws IOException {\n-                if (exception \u003d\u003d null) {\n-                    Files.delete(dir);\n-                }\n-                return FileVisitResult.CONTINUE;\n-            }\n-        });\n-    }\n-\n     @Test\n-    public void testFileToJpaRoute() throws Exception {\n-        InputStream input \u003d getClass().getResourceAsStream(\"/jpa/customer.xml\");\n-        Files.copy(input, destination.toPath().resolve(\"customer.xml\"));\n-        input.close();\n-\n-        // Give camel a chance to consume the test customer file\n-        Thread.sleep(2000);\n-\n-        HttpResponse result \u003d HttpRequest.get(getEndpointAddress(\"/example-camel-jpa/customers\")).getResponse();\n+    public void testFileToJPARoute() throws Exception {\n+        HttpResponse result \u003d HttpRequest.get(\"http://localhost:8080/example-camel-jpa/customers\").getResponse();\n         Assert.assertTrue(result.getBody().contains(\"John Doe\"));\n     }\n \n-    private String getEndpointAddress(String contextPath) throws MalformedURLException {\n-        return \"http://localhost:8080\" + contextPath;\n+    @Override\n+    protected String sourceFilename() {\n+        return \"customer.xml\";\n+    }\n+\n+    @Override\n+    protected Path destinationPath() {\n+        return Paths.get(System.getProperty(\"jboss.home\") + \"/standalone/data/customers\");\n     }\n }"
        },
        {
          "file_name": "itests/src/main/resources/jms/tx/order.xml",
          "patch": "@@ -5,4 +5,4 @@\n     \u003cord:productName\u003eTest Product\u003c/ord:productName\u003e\n     \u003cord:productSku\u003eTest\u003c/ord:productSku\u003e\n     \u003cord:quantity\u003e1\u003c/ord:quantity\u003e\n-\u003c/ord:order\u003e\n+\u003c/ord:order\u003e\n\\ No newline at end of file"
        }
      ]
    }
  },
  {
    "name": "Race condition while adding threads",
    "url": "https://github.com/brettwooldridge/HikariCP/issues/452",
    "description": "I\u0027m opening issue to notify you about and provide a potential solution for a bug in your code. There is a race condition when 2 threads call `HikariPool.getConnection()` while there are no idle connections available and `minimumIdle` is set to 0. Both threads will go into `ConcurrentBag.borrow(long, TimeUnit)`, see that there are no available threads to borrow, and create new worker threads to add one connection each in `HikariPool.addBagItem()`. The borrowing threads will then wait until signalled, at which point they will wake up and check for available connections again. The workers will execute sequentially and each try to create a new connection. This is the execution that leads to the race condition:\n\nWorker 1 adds a connection as usual, signalling the borrow threads to wake up. \n\nWorker 1 finishes (`isDone()`)\n\nBefore the borrow threads can check for new connections, worker 2 tries to add a new connection.\n\nWorker 2 checks if `getIdleConnections() \u003c\u003d minimumIdle`, sees the connection worker 1 added, and skips the `addConnection` call.\n\nBorrow thread 1 sucessfully borrows a connection.\n\nBorrow thread 2 cannot borrow a connection and goes to sleep waiting for Worker 2 to signal.\n\nWorker 2 finishes (`isDone()`)\n\nI have included a potential solution to this problem (signal at the end of the worker thread no matter what) and a test to reproduce this race condition (`AddConnectionRaceConditionTest`).\n\nI have already sent you a pull here: brettwooldridge#451\n\nLet me know if you have any questions.\n\n(cc @shuyangzhou)\n",
    "keywords": [
      "`",
      "new",
      "no",
      "race",
      "will",
      "available",
      "threads",
      "thread",
      "worker 2",
      "1",
      "condition",
      "2",
      "worker 1",
      "borrow",
      "connection",
      "worker",
      "connections"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/brettwooldridge/HikariCP/commit/33138b18f752e78e81e275175495f9942592a182",
      "files": [
        {
          "file_name": "pom.xml",
          "patch": "@@ -47,6 +47,7 @@\n       \u003cpax.exam.version\u003e4.5.0\u003c/pax.exam.version\u003e\n       \u003cpax.url.version\u003e2.4.1\u003c/pax.url.version\u003e\n       \u003cslf4j.version\u003e1.7.12\u003c/slf4j.version\u003e\n+      \u003clog4j.version\u003e2.4.1\u003c/log4j.version\u003e\n       \u003cfelix.bundle.plugin.version\u003e2.5.3\u003c/felix.bundle.plugin.version\u003e\n       \u003cfelix.version\u003e5.0.0\u003c/felix.version\u003e\n    \u003c/properties\u003e\n@@ -64,10 +65,28 @@\n          \u003cversion\u003e${slf4j.version}\u003c/version\u003e\n       \u003c/dependency\u003e\n       \u003cdependency\u003e\n-         \u003cgroupId\u003eorg.slf4j\u003c/groupId\u003e\n-         \u003cartifactId\u003eslf4j-simple\u003c/artifactId\u003e\n-         \u003cversion\u003e${slf4j.version}\u003c/version\u003e\n-         \u003coptional\u003etrue\u003c/optional\u003e\n+         \u003cgroupId\u003eorg.apache.logging.log4j\u003c/groupId\u003e\n+         \u003cartifactId\u003elog4j-slf4j-impl\u003c/artifactId\u003e\n+         \u003cversion\u003e${log4j.version}\u003c/version\u003e\n+         \u003cscope\u003etest\u003c/scope\u003e\n+      \u003c/dependency\u003e\n+      \u003cdependency\u003e\n+         \u003cgroupId\u003eorg.apache.logging.log4j\u003c/groupId\u003e\n+         \u003cartifactId\u003elog4j-api\u003c/artifactId\u003e\n+         \u003cversion\u003e${log4j.version}\u003c/version\u003e\n+         \u003cscope\u003etest\u003c/scope\u003e\n+      \u003c/dependency\u003e\n+      \u003cdependency\u003e\n+         \u003cgroupId\u003eorg.apache.logging.log4j\u003c/groupId\u003e\n+         \u003cartifactId\u003elog4j-core\u003c/artifactId\u003e\n+         \u003cversion\u003e${log4j.version}\u003c/version\u003e\n+         \u003cscope\u003etest\u003c/scope\u003e\n+      \u003c/dependency\u003e\n+      \u003cdependency\u003e\n+         \u003cgroupId\u003eorg.apache.commons\u003c/groupId\u003e\n+         \u003cartifactId\u003ecommons-csv\u003c/artifactId\u003e\n+         \u003cversion\u003e1.2\u003c/version\u003e\n+         \u003cscope\u003etest\u003c/scope\u003e\n       \u003c/dependency\u003e\n       \u003cdependency\u003e\n          \u003cgroupId\u003eorg.mockito\u003c/groupId\u003e\n@@ -87,6 +106,16 @@\n          \u003cversion\u003e${hibernate.version}\u003c/version\u003e\n          \u003cscope\u003eprovided\u003c/scope\u003e\n          \u003coptional\u003etrue\u003c/optional\u003e\n+         \u003cexclusions\u003e\n+            \u003cexclusion\u003e\n+               \u003cartifactId\u003ejboss-logging\u003c/artifactId\u003e\n+               \u003cgroupId\u003eorg.jboss.logging\u003c/groupId\u003e\n+            \u003c/exclusion\u003e\n+            \u003cexclusion\u003e\n+               \u003cartifactId\u003ejboss-logging-annotations\u003c/artifactId\u003e\n+               \u003cgroupId\u003eorg.jboss.logging\u003c/groupId\u003e\n+            \u003c/exclusion\u003e\n+         \u003c/exclusions\u003e\n       \u003c/dependency\u003e\n       \u003cdependency\u003e\n          \u003cgroupId\u003eio.dropwizard.metrics\u003c/groupId\u003e\n@@ -300,6 +329,7 @@\n                   \u003cargLine\u003e${surefireArgLine}\u003c/argLine\u003e\n                   \u003c!-- Skips unit tests if the value of skip.unit.tests property is true --\u003e\n                   \u003cskipTests\u003e${skip.unit.tests}\u003c/skipTests\u003e\n+                  \u003creuseForks\u003efalse\u003c/reuseForks\u003e\n                \u003c/configuration\u003e\n             \u003c/plugin\u003e\n "
        },
        {
          "file_name": "src/main/java/com/zaxxer/hikari/pool/HikariPool.java",
          "patch": "@@ -16,21 +16,15 @@\n \n package com.zaxxer.hikari.pool;\n \n-import static com.zaxxer.hikari.util.ConcurrentBag.IConcurrentBagEntry.STATE_IN_USE;\n-import static com.zaxxer.hikari.util.ConcurrentBag.IConcurrentBagEntry.STATE_NOT_IN_USE;\n-import static com.zaxxer.hikari.util.ConcurrentBag.IConcurrentBagEntry.STATE_REMOVED;\n-import static com.zaxxer.hikari.util.UtilityElf.createThreadPoolExecutor;\n-import static com.zaxxer.hikari.util.UtilityElf.quietlySleep;\n-\n import java.sql.Connection;\n import java.sql.SQLException;\n import java.sql.SQLTransientConnectionException;\n import java.util.Collections;\n import java.util.Iterator;\n import java.util.List;\n+import java.util.concurrent.Callable;\n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.Future;\n-import java.util.concurrent.FutureTask;\n import java.util.concurrent.ScheduledThreadPoolExecutor;\n import java.util.concurrent.ThreadFactory;\n import java.util.concurrent.ThreadLocalRandom;\n@@ -55,6 +49,13 @@\n import com.zaxxer.hikari.util.DefaultThreadFactory;\n import com.zaxxer.hikari.util.SuspendResumeLock;\n \n+import static com.zaxxer.hikari.pool.PoolEntry.MAXED_POOL_MARKER;\n+import static com.zaxxer.hikari.util.ConcurrentBag.IConcurrentBagEntry.STATE_IN_USE;\n+import static com.zaxxer.hikari.util.ConcurrentBag.IConcurrentBagEntry.STATE_NOT_IN_USE;\n+import static com.zaxxer.hikari.util.ConcurrentBag.IConcurrentBagEntry.STATE_REMOVED;\n+import static com.zaxxer.hikari.util.UtilityElf.createThreadPoolExecutor;\n+import static com.zaxxer.hikari.util.UtilityElf.quietlySleep;\n+\n /**\n  * This is the primary connection pool class that provides the basic\n  * pooling behavior for HikariCP.\n@@ -67,8 +68,10 @@\n \n    private static final ClockSource clockSource \u003d ClockSource.INSTANCE;\n \n-   private static final long ALIVE_BYPASS_WINDOW_MS \u003d Long.getLong(\"com.zaxxer.hikari.aliveBypassWindowMs\", TimeUnit.MILLISECONDS.toMillis(500));\n-   private static final long HOUSEKEEPING_PERIOD_MS \u003d Long.getLong(\"com.zaxxer.hikari.housekeeping.periodMs\", TimeUnit.SECONDS.toMillis(30));\n+   private final long ALIVE_BYPASS_WINDOW_MS \u003d Long.getLong(\"com.zaxxer.hikari.aliveBypassWindowMs\", TimeUnit.MILLISECONDS.toMillis(500));\n+   private final long HOUSEKEEPING_PERIOD_MS \u003d Long.getLong(\"com.zaxxer.hikari.housekeeping.periodMs\", TimeUnit.SECONDS.toMillis(30));\n+\n+   private final AddPoolEntryCallable ADD_POOLENTRY_CALLABLE \u003d new AddPoolEntryCallable();\n \n    private static final int POOL_NORMAL \u003d 0;\n    private static final int POOL_SUSPENDED \u003d 1;\n@@ -105,6 +108,7 @@ public HikariPool(final HikariConfig config)\n       this.addConnectionExecutor \u003d createThreadPoolExecutor(config.getMaximumPoolSize(), \"Hikari connection filler (pool \" + poolName + \")\", config.getThreadFactory(), new ThreadPoolExecutor.DiscardPolicy());\n       this.closeConnectionExecutor \u003d createThreadPoolExecutor(4, \"Hikari connection closer (pool \" + poolName + \")\", config.getThreadFactory(), new ThreadPoolExecutor.CallerRunsPolicy());\n \n+\n       if (config.getScheduledExecutorService() \u003d\u003d null) {\n          ThreadFactory threadFactory \u003d config.getThreadFactory() !\u003d null ? config.getThreadFactory() : new DefaultThreadFactory(\"Hikari housekeeper (pool \" + poolName + \")\", true);\n          this.houseKeepingExecutorService \u003d new ScheduledThreadPoolExecutor(1, threadFactory, new ThreadPoolExecutor.DiscardPolicy());\n@@ -292,23 +296,7 @@ public void setHealthCheckRegistry(Object healthCheckRegistry)\n    @Override\n    public Future\u003cBoolean\u003e addBagItem()\n    {\n-      FutureTask\u003cBoolean\u003e future \u003d new FutureTask\u003c\u003e(new Runnable() {\n-         @Override\n-         public void run()\n-         {\n-            long sleepBackoff \u003d 200L;\n-            final int minimumIdle \u003d config.getMinimumIdle();\n-            final int maxPoolSize \u003d config.getMaximumPoolSize();\n-            while (poolState \u003d\u003d POOL_NORMAL \u0026\u0026 totalConnections.get() \u003c maxPoolSize \u0026\u0026 getIdleConnections() \u003c\u003d minimumIdle \u0026\u0026 !addConnection()) {\n-               // If we got into the loop, addConnection() failed, so we sleep and retry\n-               quietlySleep(sleepBackoff);\n-               sleepBackoff \u003d Math.min(connectionTimeout / 2, (long) (sleepBackoff * 1.3));\n-            }\n-         }\n-      }, true);\n-\n-      addConnectionExecutor.execute(future);\n-      return future;\n+      return addConnectionExecutor.submit(ADD_POOLENTRY_CALLABLE);\n    }\n \n    // ***********************************************************************\n@@ -399,6 +387,7 @@ final void logPoolState(String... prefix)\n     *\n     * @param poolEntry the PoolBagEntry to release back to the pool\n     */\n+   @Override\n    final void releaseConnection(final PoolEntry poolEntry)\n    {\n       metricsTracker.recordConnectionUsage(poolEntry);\n@@ -437,18 +426,16 @@ public void run() {\n    /**\n     * Create and add a single connection to the pool.\n     */\n-   private boolean addConnection()\n+   private PoolEntry createPoolEntry()\n    {\n       // Speculative increment of totalConnections with expectation of success\n       if (totalConnections.incrementAndGet() \u003e config.getMaximumPoolSize()) {\n          totalConnections.decrementAndGet(); // Pool is maxed out, so undo speculative increment of totalConnections\n-         //LOGGER.debug(\"{} - Cannot exceed maximum connections capacity: {}\", poolName, config.getMaximumPoolSize());\n-         return true;\n+         return PoolEntry.MAXED_POOL_MARKER;\n       }\n \n       try {\n          final PoolEntry poolEntry \u003d newPoolEntry();\n-         connectionBag.add(poolEntry);\n \n          final long maxLifetime \u003d config.getMaxLifetime();\n          if (maxLifetime \u003e 0) {\n@@ -463,14 +450,14 @@ public void run() {\n          }\n \n          LOGGER.debug(\"{} - Added connection {}\", poolName, poolEntry.connection);\n-         return true;\n+         return poolEntry;\n       }\n       catch (Exception e) {\n          totalConnections.decrementAndGet(); // We failed, so undo speculative increment of totalConnections\n          if (poolState \u003d\u003d POOL_NORMAL) {\n             LOGGER.debug(\"{} - Cannot acquire connection from data source\", poolName, e);\n          }\n-         return false;\n+         return null;\n       }\n    }\n \n@@ -522,16 +509,12 @@ private void initializeConnections()\n    {\n       if (config.isInitializationFailFast()) {\n          try {\n-            if (!addConnection()) {\n-               throw getLastConnectionFailure();\n-            }\n-\n-            final PoolEntry poolEntry \u003d connectionBag.borrow(connectionTimeout, TimeUnit.MILLISECONDS);\n+            Connection connection \u003d getConnection();\n             if (config.getMinimumIdle() \u003d\u003d 0) {\n-               closeConnection(poolEntry, \"Closing connection borrowed for validation.\");\n+               evictConnection(connection);\n             }\n             else {\n-               connectionBag.requite(poolEntry);\n+               connection.close();\n             }\n          }\n          catch (Throwable e) {\n@@ -576,6 +559,29 @@ protected void update() {\n    //                      Non-anonymous Inner-classes\n    // ***********************************************************************\n \n+   private class AddPoolEntryCallable implements Callable\u003cBoolean\u003e\n+   {\n+      @Override\n+      public Boolean call() throws Exception\n+      {\n+         long sleepBackoff \u003d 200L;\n+         do {\n+            final PoolEntry poolEntry \u003d createPoolEntry();\n+            if (poolEntry \u003d\u003d MAXED_POOL_MARKER) {\n+               return Boolean.FALSE;\n+            }\n+            else if (poolEntry !\u003d null) {\n+               connectionBag.add(poolEntry);\n+               return Boolean.TRUE;\n+            }\n+\n+            // addConnection() failed, so we sleep and retry\n+            quietlySleep(sleepBackoff);\n+            sleepBackoff \u003d Math.min(connectionTimeout / 2, (long) (sleepBackoff * 1.3));\n+         } while (true);\n+      }\n+   }\n+\n    /**\n     * The house keeping task to retire idle connections.\n     */"
        },
        {
          "file_name": "src/main/java/com/zaxxer/hikari/pool/PoolBase.java",
          "patch": "@@ -1,11 +1,11 @@\n package com.zaxxer.hikari.pool;\n \n-import static com.zaxxer.hikari.util.UtilityElf.createInstance;\n+import static com.zaxxer.hikari.pool.ProxyConnection.DIRTY_BIT_AUTOCOMMIT;\n import static com.zaxxer.hikari.pool.ProxyConnection.DIRTY_BIT_CATALOG;\n-import static com.zaxxer.hikari.pool.ProxyConnection.DIRTY_BIT_READONLY;\n import static com.zaxxer.hikari.pool.ProxyConnection.DIRTY_BIT_ISOLATION;\n-import static com.zaxxer.hikari.pool.ProxyConnection.DIRTY_BIT_AUTOCOMMIT;\n import static com.zaxxer.hikari.pool.ProxyConnection.DIRTY_BIT_NETTIMEOUT;\n+import static com.zaxxer.hikari.pool.ProxyConnection.DIRTY_BIT_READONLY;\n+import static com.zaxxer.hikari.util.UtilityElf.createInstance;\n \n import java.lang.management.ManagementFactory;\n import java.sql.Connection;\n@@ -60,7 +60,7 @@\n    private final boolean isIsolateInternalQueries;\n    private final AtomicReference\u003cThrowable\u003e lastConnectionFailure;\n \n-   private volatile boolean isValidChecked; \n+   private volatile boolean isValidChecked;\n \n    PoolBase(final HikariConfig config)\n    {\n@@ -202,12 +202,12 @@ void resetConnectionState(final Connection connection, final ProxyConnection pro\n          setNetworkTimeout(connection, networkTimeout);\n          resetBits |\u003d DIRTY_BIT_NETTIMEOUT;\n       }\n-      \n+\n       if (LOGGER.isDebugEnabled()) {\n          LOGGER.debug(\"{} - Reset ({}) on connection {}\", poolName, resetBits !\u003d 0 ? stringFromResetBits(resetBits) : \"nothing\", connection);\n       }\n    }\n-   \n+\n    void shutdownNetworkTimeoutExecutor()\n    {\n       if (netTimeoutExecutor !\u003d null \u0026\u0026 netTimeoutExecutor instanceof ThreadPoolExecutor) {\n@@ -494,7 +494,7 @@ private void createNetworkTimeoutExecutor(final DataSource dataSource, final Str\n          ThreadPoolExecutor executor \u003d (ThreadPoolExecutor) Executors.newCachedThreadPool(threadFactory);\n          executor.allowCoreThreadTimeOut(true);\n          executor.setKeepAliveTime(15, TimeUnit.SECONDS);\n-         netTimeoutExecutor \u003d executor; \n+         netTimeoutExecutor \u003d executor;\n       }\n    }\n \n@@ -534,17 +534,17 @@ private void setLoginTimeout(final DataSource dataSource, final long connectionT\n    /**\n     * This will create a string for debug logging. Given a set of \"reset bits\", this\n     * method will return a concatenated string, for example:\n-    * \n+    *\n     * Input : 0b00110\n-    * Output: \"autoCommit, isolation\"  \n+    * Output: \"autoCommit, isolation\"\n     *\n     * @param bits a set of \"reset bits\"\n     * @return a string of which states were reset\n     */\n    private String stringFromResetBits(final int bits)\n    {\n       final StringBuilder sb \u003d new StringBuilder();\n-      for (int ndx \u003d 0; ndx \u003c RESET_STATES.length; ndx++) { \n+      for (int ndx \u003d 0; ndx \u003c RESET_STATES.length; ndx++) {\n          if ( (bits \u0026 (0b1 \u003c\u003c ndx)) !\u003d 0) {\n             sb.append(RESET_STATES[ndx]).append(\", \");\n          }"
        },
        {
          "file_name": "src/main/java/com/zaxxer/hikari/pool/PoolEntry.java",
          "patch": "@@ -39,6 +39,8 @@\n    private static final Logger LOGGER \u003d LoggerFactory.getLogger(PoolEntry.class);\n \n    static final Comparator\u003cPoolEntry\u003e LASTACCESS_COMPARABLE;\n+   static final PoolEntry MAXED_POOL_MARKER \u003d new PoolEntry();\n+\n    Connection connection;\n    long lastAccessed;\n    long lastBorrowed;\n@@ -60,18 +62,27 @@\n          public int compare(final PoolEntry entryOne, final PoolEntry entryTwo) {\n             return Long.compare(entryOne.lastAccessed, entryTwo.lastAccessed);\n          }\n-      };      \n+      };\n+   }\n+\n+   private PoolEntry()\n+   {\n+      this.state \u003d null;\n+      this.openStatements \u003d null;\n+      this.hikariPool \u003d null;\n+      this.isReadOnly \u003d false;\n+      this.isAutoCommit \u003d false;\n    }\n \n    PoolEntry(final Connection connection, final PoolBase pool, final boolean isReadOnly, final boolean isAutoCommit)\n    {\n       this.connection \u003d connection;\n       this.hikariPool \u003d (HikariPool) pool;\n-      this.state \u003d new AtomicInteger(STATE_NOT_IN_USE);\n-      this.lastAccessed \u003d ClockSource.INSTANCE.currentTime();\n-      this.openStatements \u003d new FastList\u003c\u003e(Statement.class, 16);\n       this.isReadOnly \u003d isReadOnly;\n       this.isAutoCommit \u003d isAutoCommit;\n+      this.state \u003d new AtomicInteger();\n+      this.lastAccessed \u003d ClockSource.INSTANCE.currentTime();\n+      this.openStatements \u003d new FastList\u003c\u003e(Statement.class, 16);\n    }\n \n    /**"
        },
        {
          "file_name": "src/main/java/com/zaxxer/hikari/util/ConcurrentBag.java",
          "patch": "@@ -19,16 +19,19 @@\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CopyOnWriteArrayList;\n+import java.util.concurrent.ExecutionException;\n import java.util.concurrent.Future;\n import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+import java.util.concurrent.atomic.AtomicInteger;\n \n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n import com.zaxxer.hikari.util.ConcurrentBag.IConcurrentBagEntry;\n \n-import static com.zaxxer.hikari.util.ConcurrentBag.IConcurrentBagEntry.STATE_NOT_IN_USE;\n import static com.zaxxer.hikari.util.ConcurrentBag.IConcurrentBagEntry.STATE_IN_USE;\n+import static com.zaxxer.hikari.util.ConcurrentBag.IConcurrentBagEntry.STATE_NOT_IN_USE;\n import static com.zaxxer.hikari.util.ConcurrentBag.IConcurrentBagEntry.STATE_REMOVED;\n import static com.zaxxer.hikari.util.ConcurrentBag.IConcurrentBagEntry.STATE_RESERVED;\n \n@@ -63,6 +66,7 @@\n \n    private final ThreadLocal\u003cList\u003e threadList;\n    private final IBagStateListener listener;\n+   private final AtomicInteger waiters;\n    private volatile boolean closed;\n \n    public interface IConcurrentBagEntry\n@@ -87,15 +91,16 @@\n     *\n     * @param listener the IBagStateListener to attach to this bag\n     */\n-   public ConcurrentBag(IBagStateListener listener)\n+   public ConcurrentBag(final IBagStateListener listener)\n    {\n       this.listener \u003d listener;\n       this.weakThreadLocals \u003d useWeakThreadLocals();\n \n+      this.waiters \u003d new AtomicInteger(0);\n       this.sharedList \u003d new CopyOnWriteArrayList\u003c\u003e();\n       this.synchronizer \u003d new QueuedSequenceSynchronizer();\n       if (weakThreadLocals) {\n-         this.threadList \u003d new ThreadLocal\u003c\u003e(); \n+         this.threadList \u003d new ThreadLocal\u003c\u003e();\n       }\n       else {\n          this.threadList \u003d new ThreadLocal\u003cList\u003e() {\n@@ -111,27 +116,20 @@ protected List initialValue()\n    /**\n     * The method will borrow a BagEntry from the bag, blocking for the\n     * specified timeout if none are available.\n-    * \n+    *\n     * @param timeout how long to wait before giving up, in units of unit\n     * @param timeUnit a \u003ccode\u003eTimeUnit\u003c/code\u003e determining how to interpret the timeout parameter\n     * @return a borrowed instance from the bag or null if a timeout occurs\n     * @throws InterruptedException if interrupted while waiting\n+    * @throws ExecutionException\n+    * @throws TimeoutException\n     */\n-   @SuppressWarnings(\"unchecked\")\n    public T borrow(long timeout, final TimeUnit timeUnit) throws InterruptedException\n    {\n-      // Try the thread-local list first, if there are no blocked threads waiting already\n-      List\u003c?\u003e list \u003d threadList.get();\n-      if (weakThreadLocals \u0026\u0026 list \u003d\u003d null) {\n-         list \u003d new ArrayList\u003c\u003e(16);\n-         threadList.set(list);\n-      }\n-\n-      for (int i \u003d list.size() - 1; i \u003e\u003d 0; i--) {\n-         final T bagEntry \u003d (T) (weakThreadLocals ? ((WeakReference) list.remove(i)).get() : list.remove(i));\n-         if (bagEntry !\u003d null \u0026\u0026 bagEntry.compareAndSet(STATE_NOT_IN_USE, STATE_IN_USE)) {\n-            return bagEntry;\n-         }\n+      // Try the thread-local list first\n+      T claimed \u003d claimFromThreadLocal();\n+      if (claimed !\u003d null) {\n+         return claimed;\n       }\n \n       // Otherwise, scan the shared list ... for maximum of timeout\n@@ -140,22 +138,34 @@ public T borrow(long timeout, final TimeUnit timeUnit) throws InterruptedExcepti\n       final long startScan \u003d System.nanoTime();\n       final long originTimeout \u003d timeout;\n       long startSeq;\n-      do {\n+      waiters.incrementAndGet();\n+      try {\n          do {\n-            startSeq \u003d synchronizer.currentSequence();\n-            for (final T bagEntry : sharedList) {\n-               if (bagEntry.compareAndSet(STATE_NOT_IN_USE, STATE_IN_USE)) {\n-                  return bagEntry;\n+            // scan the shared list\n+            do {\n+               startSeq \u003d synchronizer.currentSequence();\n+               for (T bagEntry : sharedList) {\n+                  if (bagEntry.compareAndSet(STATE_NOT_IN_USE, STATE_IN_USE)) {\n+                     // if we might have stolen another thread\u0027s new connection, restart the add...\n+                     if (waiters.get() \u003e 1 \u0026\u0026 addItemFuture \u003d\u003d null) {\n+                        listener.addBagItem();\n+                     }\n+\n+                     return bagEntry;\n+                  }\n                }\n-            }\n-         } while (startSeq \u003c synchronizer.currentSequence());\n+            } while (startSeq \u003c synchronizer.currentSequence());\n \n-         if (addItemFuture \u003d\u003d null || addItemFuture.isDone()) {\n-            addItemFuture \u003d listener.addBagItem();\n-         }\n+            if (addItemFuture \u003d\u003d null || addItemFuture.isDone()) {\n+               addItemFuture \u003d listener.addBagItem();\n+            }\n \n-         timeout \u003d originTimeout - Math.abs(System.nanoTime() - startScan);\n-      } while (timeout \u003e 100_00L \u0026\u0026 synchronizer.waitUntilSequenceExceeded(startSeq, timeout));\n+            timeout \u003d originTimeout - (System.nanoTime() - startScan);\n+         } while (timeout \u003e 10_000L \u0026\u0026 synchronizer.waitUntilSequenceExceeded(startSeq, timeout));\n+      }\n+      finally {\n+         waiters.decrementAndGet();\n+      }\n \n       return null;\n    }\n@@ -218,6 +228,8 @@ public boolean remove(final T bagEntry)\n       if (!removed \u0026\u0026 !closed) {\n          LOGGER.warn(\"Attempt to remove an object from the bag that does not exist: {}\", bagEntry);\n       }\n+\n+      // synchronizer.signal();\n       return removed;\n    }\n \n@@ -329,7 +341,7 @@ public int getCount(final int state)\n    /**\n     * Get the total number of items in the bag.\n     *\n-    * @return the number of items in the bag \n+    * @return the number of items in the bag\n     */\n    public int size()\n    {\n@@ -343,6 +355,25 @@ public void dumpState()\n       }\n    }\n \n+   private T claimFromThreadLocal()\n+   {\n+      List\u003c?\u003e list \u003d threadList.get();\n+      if (weakThreadLocals \u0026\u0026 list \u003d\u003d null) {\n+         list \u003d new ArrayList\u003c\u003e(16);\n+         threadList.set(list);\n+      }\n+\n+      for (int i \u003d list.size() - 1; i \u003e\u003d 0; i--) {\n+         @SuppressWarnings(\"unchecked\")\n+         final T bagEntry \u003d (T) (weakThreadLocals ? ((WeakReference) list.remove(i)).get() : list.remove(i));\n+         if (bagEntry !\u003d null \u0026\u0026 bagEntry.compareAndSet(STATE_NOT_IN_USE, STATE_IN_USE)) {\n+            return bagEntry;\n+         }\n+      }\n+\n+      return null;\n+   }\n+\n    /**\n     * Determine whether to use WeakReferences based on whether there is a\n     * custom ClassLoader implementation sitting between this class and the"
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/ConnectionRaceConditionTest.java",
          "patch": "@@ -1,83 +1,83 @@\n package com.zaxxer.hikari.pool;\n \n import java.sql.Connection;\n-import java.sql.SQLException;\n import java.util.concurrent.Callable;\n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.Executors;\n-import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n \n+import org.apache.logging.log4j.Level;\n+import org.junit.After;\n+import org.junit.Assert;\n import org.junit.Test;\n+import org.slf4j.LoggerFactory;\n \n import com.zaxxer.hikari.HikariConfig;\n import com.zaxxer.hikari.HikariDataSource;\n+import com.zaxxer.hikari.util.ConcurrentBag;\n \n /**\n  * @author Matthew Tambara (matthew.tambara@liferay.com)\n  */\n-public class AddConnectionRaceConditionTest\n+public class ConnectionRaceConditionTest\n {\n-   private HikariPool _hikariPool;\n-\n-   // @Test\n+   @Test\n    public void testRaceCondition() throws Exception\n    {\n       HikariConfig config \u003d new HikariConfig();\n       config.setMinimumIdle(0);\n       config.setMaximumPoolSize(10);\n       config.setInitializationFailFast(false);\n+      config.setConnectionTimeout(2500);\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n+      TestElf.setSlf4jLogLevel(ConcurrentBag.class, Level.INFO);\n+\n+      final AtomicReference\u003cException\u003e ref \u003d new AtomicReference\u003cException\u003e(null);\n+\n       // Initialize HikariPool with no initial connections and room to grow\n       try (final HikariDataSource ds \u003d new HikariDataSource(config)) {\n-         _hikariPool \u003d TestElf.getPool(ds);\n-\n          ExecutorService threadPool \u003d Executors.newFixedThreadPool(2);\n-         for (int i \u003d 0; i \u003c 100000; i++) {\n-            Future\u003cException\u003e submit1 \u003d threadPool.submit(new Callable\u003cException\u003e() {\n+         for (int i \u003d 0; i \u003c 500_000; i++) {\n+            threadPool.submit(new Callable\u003cException\u003e() {\n                /** {@inheritDoc} */\n                @Override\n                public Exception call() throws Exception\n                {\n                   Connection c2;\n                   try {\n-                     c2 \u003d _hikariPool.getConnection(5000);\n+                     c2 \u003d ds.getConnection();\n                      ds.evictConnection(c2);\n                   }\n-                  catch (SQLException e) {\n-                     return e;\n+                  catch (Exception e) {\n+                     ref.set(e);\n                   }\n                   return null;\n                }\n             });\n+         }\n \n-            Future\u003cException\u003e submit2 \u003d threadPool.submit(new Callable\u003cException\u003e() {\n-               /** {@inheritDoc} */\n-               @Override\n-               public Exception call() throws Exception\n-               {\n-                  Connection c2;\n-                  try {\n-                     c2 \u003d _hikariPool.getConnection(5000);\n-                     ds.evictConnection(c2);\n-                  }\n-                  catch (SQLException e) {\n-                     return e;\n-                  }\n-                  return null;\n-               }\n-            });\n+         threadPool.shutdown();\n+         threadPool.awaitTermination(30, TimeUnit.SECONDS);\n \n-            if (submit1.get() !\u003d null) {\n-               throw submit1.get();\n-            }\n-            if (submit2.get() !\u003d null) {\n-               throw submit2.get();\n-            }\n+         if (ref.get() !\u003d null) {\n+            ref.get().fillInStackTrace();\n+            LoggerFactory.getLogger(ConnectionRaceConditionTest.class).error(\"Submit1 task failed\", ref.get());\n+            Assert.fail(\"Task failed\");\n          }\n       }\n       catch (Exception e) {\n          throw e;\n       }\n    }\n+\n+   @After\n+   public void after()\n+   {\n+      System.getProperties().remove(\"com.zaxxer.hikari.housekeeping.periodMs\");\n+\n+      TestElf.setSlf4jLogLevel(HikariPool.class, Level.WARN);\n+      TestElf.setSlf4jLogLevel(ConcurrentBag.class, Level.WARN);\n+   }\n }"
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/ConnectionStateTest.java",
          "patch": "@@ -17,50 +17,44 @@\n    @Test\n    public void testAutoCommit() throws SQLException\n    {\n-      HikariDataSource ds \u003d new HikariDataSource();\n-      ds.setAutoCommit(true);\n-      ds.setMinimumIdle(1);\n-      ds.setMaximumPoolSize(1);\n-      ds.setConnectionTestQuery(\"VALUES 1\");\n-      ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-      ds.addDataSourceProperty(\"user\", \"bar\");\n-      ds.addDataSourceProperty(\"password\", \"secret\");\n-      ds.addDataSourceProperty(\"url\", \"baf\");\n-      ds.addDataSourceProperty(\"loginTimeout\", \"10\");\n-\n-      try {\n-         Connection connection \u003d ds.getConnection();\n-         Connection unwrap \u003d connection.unwrap(Connection.class);\n-         connection.setAutoCommit(false);\n-         connection.close();\n-\n-         Assert.assertTrue(unwrap.getAutoCommit());\n-      }\n-      finally {\n-         ds.close();\n+      try (HikariDataSource ds \u003d new HikariDataSource()) {\n+         ds.setAutoCommit(true);\n+         ds.setMinimumIdle(1);\n+         ds.setMaximumPoolSize(1);\n+         ds.setConnectionTestQuery(\"VALUES 1\");\n+         ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+         ds.addDataSourceProperty(\"user\", \"bar\");\n+         ds.addDataSourceProperty(\"password\", \"secret\");\n+         ds.addDataSourceProperty(\"url\", \"baf\");\n+         ds.addDataSourceProperty(\"loginTimeout\", \"10\");\n+\n+         try (Connection connection \u003d ds.getConnection()) {\n+            Connection unwrap \u003d connection.unwrap(Connection.class);\n+            connection.setAutoCommit(false);\n+            connection.close();\n+\n+            Assert.assertTrue(unwrap.getAutoCommit());\n+         }\n       }\n    }\n \n    @Test\n    public void testTransactionIsolation() throws SQLException\n    {\n-      HikariDataSource ds \u003d new HikariDataSource();\n-      ds.setTransactionIsolation(\"TRANSACTION_READ_COMMITTED\");\n-      ds.setMinimumIdle(1);\n-      ds.setMaximumPoolSize(1);\n-      ds.setConnectionTestQuery(\"VALUES 1\");\n-      ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-      try {\n-         Connection connection \u003d ds.getConnection();\n-         Connection unwrap \u003d connection.unwrap(Connection.class);\n-         connection.setTransactionIsolation(Connection.TRANSACTION_READ_UNCOMMITTED);\n-         connection.close();\n-\n-         Assert.assertEquals(Connection.TRANSACTION_READ_COMMITTED, unwrap.getTransactionIsolation());\n-      }\n-      finally {\n-         ds.close();\n+      try (HikariDataSource ds \u003d new HikariDataSource()) {\n+         ds.setTransactionIsolation(\"TRANSACTION_READ_COMMITTED\");\n+         ds.setMinimumIdle(1);\n+         ds.setMaximumPoolSize(1);\n+         ds.setConnectionTestQuery(\"VALUES 1\");\n+         ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+         try (Connection connection \u003d ds.getConnection()) {\n+            Connection unwrap \u003d connection.unwrap(Connection.class);\n+            connection.setTransactionIsolation(Connection.TRANSACTION_READ_UNCOMMITTED);\n+            connection.close();\n+\n+            Assert.assertEquals(Connection.TRANSACTION_READ_COMMITTED, unwrap.getTransactionIsolation());\n+         }\n       }\n    }\n \n@@ -79,89 +73,76 @@ public void testIsolation() throws Exception\n    @Test\n    public void testReadOnly() throws Exception\n    {\n-      HikariDataSource ds \u003d new HikariDataSource();\n-      ds.setCatalog(\"test\");\n-      ds.setMinimumIdle(1);\n-      ds.setMaximumPoolSize(1);\n-      ds.setConnectionTestQuery(\"VALUES 1\");\n-      ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-      try {\n-         Connection connection \u003d ds.getConnection();\n-         Connection unwrap \u003d connection.unwrap(Connection.class);\n-         connection.setReadOnly(true);\n-         connection.close();\n-\n-         Assert.assertFalse(unwrap.isReadOnly());\n-      }\n-      finally {\n-         ds.close();\n+      try (HikariDataSource ds \u003d new HikariDataSource()) {\n+         ds.setCatalog(\"test\");\n+         ds.setMinimumIdle(1);\n+         ds.setMaximumPoolSize(1);\n+         ds.setConnectionTestQuery(\"VALUES 1\");\n+         ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+         try (Connection connection \u003d ds.getConnection()) {\n+            Connection unwrap \u003d connection.unwrap(Connection.class);\n+            connection.setReadOnly(true);\n+            connection.close();\n+\n+            Assert.assertFalse(unwrap.isReadOnly());\n+         }\n       }\n    }\n \n    @Test\n    public void testCatalog() throws SQLException\n    {\n-      HikariDataSource ds \u003d new HikariDataSource();\n-      ds.setCatalog(\"test\");\n-      ds.setMinimumIdle(1);\n-      ds.setMaximumPoolSize(1);\n-      ds.setConnectionTestQuery(\"VALUES 1\");\n-      ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-      try {\n-         Connection connection \u003d ds.getConnection();\n-         Connection unwrap \u003d connection.unwrap(Connection.class);\n-         connection.setCatalog(\"other\");\n-         connection.close();\n-\n-         Assert.assertEquals(\"test\", unwrap.getCatalog());\n-      }\n-      finally {\n-         ds.close();\n+      try (HikariDataSource ds \u003d new HikariDataSource()) {\n+         ds.setCatalog(\"test\");\n+         ds.setMinimumIdle(1);\n+         ds.setMaximumPoolSize(1);\n+         ds.setConnectionTestQuery(\"VALUES 1\");\n+         ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+         try (Connection connection \u003d ds.getConnection()) {\n+            Connection unwrap \u003d connection.unwrap(Connection.class);\n+            connection.setCatalog(\"other\");\n+            connection.close();\n+\n+            Assert.assertEquals(\"test\", unwrap.getCatalog());\n+         }\n       }\n    }\n \n    @Test\n    public void testCommitTracking() throws SQLException\n    {\n-      HikariDataSource ds \u003d new HikariDataSource();\n-      ds.setAutoCommit(false);\n-      ds.setMinimumIdle(1);\n-      ds.setMaximumPoolSize(1);\n-      ds.setConnectionTestQuery(\"VALUES 1\");\n-      ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+      try (HikariDataSource ds \u003d new HikariDataSource()) {\n+         ds.setAutoCommit(false);\n+         ds.setMinimumIdle(1);\n+         ds.setMaximumPoolSize(1);\n+         ds.setConnectionTestQuery(\"VALUES 1\");\n+         ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n-      try {\n-         Connection connection \u003d ds.getConnection();\n+         try (Connection connection \u003d ds.getConnection()) {\n+            Statement statement \u003d connection.createStatement();\n+            statement.execute(\"SELECT something\");\n+            Assert.assertTrue(TestElf.getConnectionCommitDirtyState(connection));\n \n-         Statement statement \u003d connection.createStatement();\n-         statement.execute(\"SELECT something\");\n-         Assert.assertTrue(TestElf.getConnectionCommitDirtyState(connection));\n+            connection.commit();\n+            Assert.assertFalse(TestElf.getConnectionCommitDirtyState(connection));\n \n-         connection.commit();\n-         Assert.assertFalse(TestElf.getConnectionCommitDirtyState(connection));\n+            statement.execute(\"SELECT something\", Statement.NO_GENERATED_KEYS);\n+            Assert.assertTrue(TestElf.getConnectionCommitDirtyState(connection));\n \n-         statement.execute(\"SELECT something\", Statement.NO_GENERATED_KEYS);\n-         Assert.assertTrue(TestElf.getConnectionCommitDirtyState(connection));\n+            connection.rollback();\n+            Assert.assertFalse(TestElf.getConnectionCommitDirtyState(connection));\n \n-         connection.rollback();\n-         Assert.assertFalse(TestElf.getConnectionCommitDirtyState(connection));\n+            ResultSet resultSet \u003d statement.executeQuery(\"SELECT something\");\n+            Assert.assertTrue(TestElf.getConnectionCommitDirtyState(connection));\n \n-         ResultSet resultSet \u003d statement.executeQuery(\"SELECT something\");\n-         Assert.assertTrue(TestElf.getConnectionCommitDirtyState(connection));\n+            connection.rollback(null);\n+            Assert.assertFalse(TestElf.getConnectionCommitDirtyState(connection));\n \n-         connection.rollback(null);\n-         Assert.assertFalse(TestElf.getConnectionCommitDirtyState(connection));\n-\n-         resultSet.updateRow();\n-         Assert.assertTrue(TestElf.getConnectionCommitDirtyState(connection));\n-\n-         connection.close();\n-      }\n-      finally {\n-         ds.close();\n+            resultSet.updateRow();\n+            Assert.assertTrue(TestElf.getConnectionCommitDirtyState(connection));\n+         }\n       }\n-      \n    }\n }"
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/IsolationTest.java",
          "patch": "@@ -10,54 +10,42 @@\n \n public class IsolationTest\n {\n-    @Test\n-    public void testIsolation() throws SQLException\n-    {\n-        HikariDataSource ds \u003d new HikariDataSource();\n-        ds.setMinimumIdle(1);\n-        ds.setMaximumPoolSize(1);\n-        ds.setIsolateInternalQueries(true);\n-        ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-        try\n-        {\n-            Connection connection \u003d ds.getConnection();\n-            connection.close();\n-\n-            Connection connection2 \u003d ds.getConnection();\n-            connection2.close();\n-\n-            Assert.assertNotSame(connection, connection2);\n-            Assert.assertSame(connection.unwrap(Connection.class), connection2.unwrap(Connection.class));\n-        }\n-        finally\n-        {\n-            ds.close();\n-        }\n-    }\n-\n-    @Test\n-    public void testNonIsolation() throws SQLException\n-    {\n-        HikariDataSource ds \u003d new HikariDataSource();\n-        ds.setMinimumIdle(1);\n-        ds.setMaximumPoolSize(1);\n-        ds.setIsolateInternalQueries(false);\n-        ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-        try\n-        {\n-            Connection connection \u003d ds.getConnection();\n-            connection.close();\n-\n-            Connection connection2 \u003d ds.getConnection();\n-            connection2.close();\n-\n-            Assert.assertSame(connection.unwrap(Connection.class), connection2.unwrap(Connection.class));\n-        }\n-        finally\n-        {\n-            ds.close();\n-        }\n-    }\n+   @Test\n+   public void testIsolation() throws SQLException\n+   {\n+      try (HikariDataSource ds \u003d new HikariDataSource()) {\n+         ds.setMinimumIdle(1);\n+         ds.setMaximumPoolSize(1);\n+         ds.setIsolateInternalQueries(true);\n+         ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+         Connection connection \u003d ds.getConnection();\n+         connection.close();\n+\n+         Connection connection2 \u003d ds.getConnection();\n+         connection2.close();\n+\n+         Assert.assertNotSame(connection, connection2);\n+         Assert.assertSame(connection.unwrap(Connection.class), connection2.unwrap(Connection.class));\n+      }\n+   }\n+\n+   @Test\n+   public void testNonIsolation() throws SQLException\n+   {\n+      try (HikariDataSource ds \u003d new HikariDataSource()) {\n+         ds.setMinimumIdle(1);\n+         ds.setMaximumPoolSize(1);\n+         ds.setIsolateInternalQueries(false);\n+         ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+         Connection connection \u003d ds.getConnection();\n+         connection.close();\n+\n+         Connection connection2 \u003d ds.getConnection();\n+         connection2.close();\n+\n+         Assert.assertSame(connection.unwrap(Connection.class), connection2.unwrap(Connection.class));\n+      }\n+   }\n }"
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/MiscTest.java",
          "patch": "@@ -24,13 +24,12 @@\n import java.util.concurrent.Executors;\n import java.util.concurrent.TimeUnit;\n \n+import org.apache.logging.log4j.Level;\n import org.junit.Assert;\n import org.junit.Test;\n-import org.slf4j.spi.LocationAwareLogger;\n \n import com.zaxxer.hikari.HikariConfig;\n import com.zaxxer.hikari.HikariDataSource;\n-import com.zaxxer.hikari.pool.HikariPool;\n import com.zaxxer.hikari.util.UtilityElf;\n \n /**\n@@ -105,7 +104,7 @@ public void testLeakDetection() throws Exception\n \n       final HikariDataSource ds \u003d new HikariDataSource(config);\n       try {\n-         TestElf.setSlf4jLogLevel(HikariPool.class, LocationAwareLogger.DEBUG_INT);\n+         TestElf.setSlf4jLogLevel(HikariPool.class, Level.DEBUG);\n          TestElf.getPool(ds).logPoolState();\n \n          Connection connection \u003d ds.getConnection();\n@@ -115,7 +114,7 @@ public void testLeakDetection() throws Exception\n          ps.close();\n          String s \u003d new String(baos.toByteArray());\n          Assert.assertNotNull(\"Exception string was null\", s);\n-         Assert.assertTrue(\"Expected exception to contain \u0027Apparent connection leak detected\u0027 but contains *\" + s + \"*\", s.contains(\"Apparent connection leak detected\"));\n+         Assert.assertTrue(\"Expected exception to contain \u0027Connection leak detection\u0027 but contains *\" + s + \"*\", s.contains(\"Connection leak detection\"));\n       }\n       finally\n       {"
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/RampUpDown.java",
          "patch": "@@ -23,28 +23,27 @@ public void rampUpDownTest() throws SQLException, InterruptedException\n \n         System.setProperty(\"com.zaxxer.hikari.housekeeping.periodMs\", \"250\");\n \n-        HikariDataSource ds \u003d new HikariDataSource(config);\n-        ds.setIdleTimeout(1000);\n+        try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n+           ds.setIdleTimeout(1000);\n \n-        Assert.assertSame(\"Totals connections not as expected\", 5, TestElf.getPool(ds).getTotalConnections());\n+           Assert.assertSame(\"Totals connections not as expected\", 5, TestElf.getPool(ds).getTotalConnections());\n \n-        Connection[] connections \u003d new Connection[ds.getMaximumPoolSize()];\n-        for (int i \u003d 0; i \u003c connections.length; i++)\n-        {\n-            connections[i] \u003d ds.getConnection();\n-        }\n-\n-        Assert.assertSame(\"Totals connections not as expected\", 60, TestElf.getPool(ds).getTotalConnections());\n+           Connection[] connections \u003d new Connection[ds.getMaximumPoolSize()];\n+           for (int i \u003d 0; i \u003c connections.length; i++)\n+           {\n+               connections[i] \u003d ds.getConnection();\n+           }\n \n-        for (Connection connection : connections)\n-        {\n-            connection.close();\n-        }\n+           Assert.assertSame(\"Totals connections not as expected\", 60, TestElf.getPool(ds).getTotalConnections());\n \n-        Thread.sleep(2500);\n+           for (Connection connection : connections)\n+           {\n+               connection.close();\n+           }\n \n-        Assert.assertSame(\"Totals connections not as expected\", 5, TestElf.getPool(ds).getTotalConnections());\n+           Thread.sleep(2500);\n \n-        ds.close();\n+           Assert.assertSame(\"Totals connections not as expected\", 5, TestElf.getPool(ds).getTotalConnections());\n+        }\n     }\n }"
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/ShutdownTest.java",
          "patch": "@@ -29,7 +29,6 @@\n import com.zaxxer.hikari.HikariConfig;\n import com.zaxxer.hikari.HikariDataSource;\n import com.zaxxer.hikari.mocks.StubConnection;\n-import com.zaxxer.hikari.pool.HikariPool;\n import com.zaxxer.hikari.util.ClockSource;\n import com.zaxxer.hikari.util.UtilityElf;\n \n@@ -70,6 +69,7 @@ public void testShutdown1() throws SQLException\n       Thread[] threads \u003d new Thread[10];\n       for (int i \u003d 0; i \u003c 10; i++) {\n          threads[i] \u003d new Thread() {\n+            @Override\n             public void run()\n             {\n                try {\n@@ -132,7 +132,7 @@ public void testShutdown3() throws SQLException\n       Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n \n       StubConnection.slowCreate \u003d false;\n-      \n+\n       HikariConfig config \u003d new HikariConfig();\n       config.setMinimumIdle(5);\n       config.setMaximumPoolSize(5);\n@@ -263,6 +263,7 @@ public void testThreadedShutdown() throws Exception\n       for (int i \u003d 0; i \u003c 4; i++) {\n          final HikariDataSource ds \u003d new HikariDataSource(config);\n          Thread t \u003d new Thread() {\n+            @Override\n             public void run() {\n                Connection connection \u003d null;\n                try {\n@@ -299,8 +300,9 @@ public void run() {\n             };\n          };\n          t.start();\n-   \n+\n          Thread t2 \u003d new Thread() {\n+            @Override\n             public void run() {\n                UtilityElf.quietlySleep(100);\n                try {"
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/TestConcurrentBag.java",
          "patch": "@@ -18,10 +18,8 @@\n \n import java.io.ByteArrayOutputStream;\n import java.io.PrintStream;\n-import java.util.concurrent.ExecutionException;\n import java.util.concurrent.Future;\n import java.util.concurrent.TimeUnit;\n-import java.util.concurrent.TimeoutException;\n \n import org.junit.AfterClass;\n import org.junit.Assert;\n@@ -30,8 +28,6 @@\n \n import com.zaxxer.hikari.HikariConfig;\n import com.zaxxer.hikari.HikariDataSource;\n-import com.zaxxer.hikari.pool.HikariPool;\n-import com.zaxxer.hikari.pool.PoolEntry;\n import com.zaxxer.hikari.util.ConcurrentBag;\n import com.zaxxer.hikari.util.ConcurrentBag.IBagStateListener;\n \n@@ -54,7 +50,7 @@ public static void setup()\n       config.setConnectionTestQuery(\"VALUES 1\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n-      ds \u003d new HikariDataSource(config);      \n+      ds \u003d new HikariDataSource(config);\n       pool \u003d TestElf.getPool(ds);\n    }\n \n@@ -67,41 +63,11 @@ public static void teardown()\n    @Test\n    public void testConcurrentBag() throws Exception\n    {\n-      ConcurrentBag\u003cPoolEntry\u003e bag \u003d new ConcurrentBag\u003cPoolEntry\u003e(new IBagStateListener() {\n+      ConcurrentBag\u003cPoolEntry\u003e bag \u003d new ConcurrentBag\u003cPoolEntry\u003e( new IBagStateListener() {\n          @Override\n          public Future\u003cBoolean\u003e addBagItem()\n          {\n-            return new Future\u003cBoolean\u003e() {\n-               @Override\n-               public boolean isDone()\n-               {\n-                  return true;\n-               }\n-               \n-               @Override\n-               public boolean isCancelled()\n-               {\n-                  return false;\n-               }\n-               \n-               @Override\n-               public Boolean get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException\n-               {\n-                  return null;\n-               }\n-               \n-               @Override\n-               public Boolean get() throws InterruptedException, ExecutionException\n-               {\n-                  return true;\n-               }\n-               \n-               @Override\n-               public boolean cancel(boolean mayInterruptIfRunning)\n-               {\n-                  return false;\n-               }\n-            };\n+            return null;\n          }\n       });\n       Assert.assertEquals(0, bag.values(8).size());\n@@ -113,7 +79,7 @@ public boolean cancel(boolean mayInterruptIfRunning)\n       PoolEntry inuse \u003d pool.newPoolEntry();\n       bag.add(inuse);\n       bag.borrow(2, TimeUnit.MILLISECONDS); // in use\n-      \n+\n       PoolEntry notinuse \u003d pool.newPoolEntry();\n       bag.add(notinuse); // not in use\n \n@@ -122,7 +88,7 @@ public boolean cancel(boolean mayInterruptIfRunning)\n       ByteArrayOutputStream baos \u003d new ByteArrayOutputStream();\n       PrintStream ps \u003d new PrintStream(baos, true);\n       TestElf.setSlf4jTargetStream(ConcurrentBag.class, ps);\n-      \n+\n       bag.requite(reserved);\n \n       bag.remove(notinuse);"
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/TestConnectionCloseBlocking.java",
          "patch": "@@ -1,5 +1,5 @@\n /**\n- * \n+ *\n  */\n package com.zaxxer.hikari.pool;\n \n@@ -29,7 +29,7 @@\n  *\n  */\n public class TestConnectionCloseBlocking {\n-   private volatile boolean shouldSleep \u003d true;\n+   private volatile boolean shouldSleep \u003d false;\n \n    @Test\n    public void testConnectionCloseBlocking() throws SQLException {\n@@ -39,16 +39,17 @@ public void testConnectionCloseBlocking() throws SQLException {\n       config.setConnectionTimeout(1500);\n       config.setDataSource(new CustomMockDataSource());\n \n-      HikariDataSource ds \u003d new HikariDataSource(config);\n-\n       long start \u003d ClockSource.INSTANCE.currentTime();\n-      try {\n+      try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n          Connection connection \u003d ds.getConnection();\n          connection.close();\n+\n          // Hikari only checks for validity for connections with lastAccess \u003e 1000 ms so we sleep for 1001 ms to force\n          // Hikari to do a connection validation which will fail and will trigger the connection to be closed\n          UtilityElf.quietlySleep(1001);\n          start \u003d ClockSource.INSTANCE.currentTime();\n+\n+         shouldSleep \u003d true;\n          connection \u003d ds.getConnection(); // on physical connection close we sleep 2 seconds\n          Assert.assertTrue(\"Waited longer than timeout\",\n                (ClockSource.INSTANCE.elapsedMillis(start) \u003c config.getConnectionTimeout()));\n@@ -57,7 +58,6 @@ public void testConnectionCloseBlocking() throws SQLException {\n                (ClockSource.INSTANCE.elapsedMillis(start) \u003c config.getConnectionTimeout()));\n       } finally {\n          shouldSleep \u003d false;\n-         ds.close();\n       }\n    }\n "
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/TestConnectionTimeoutRetry.java",
          "patch": "@@ -8,10 +8,12 @@\n import java.util.concurrent.ScheduledExecutorService;\n import java.util.concurrent.TimeUnit;\n \n+import org.apache.logging.log4j.Level;\n+import org.junit.After;\n import org.junit.Assert;\n+import org.junit.Before;\n import org.junit.Test;\n \n-import com.sun.media.jfxmedia.logging.Logger;\n import com.zaxxer.hikari.HikariConfig;\n import com.zaxxer.hikari.HikariDataSource;\n import com.zaxxer.hikari.mocks.StubConnection;\n@@ -66,6 +68,7 @@ public void testConnectionRetries2() throws SQLException\n \n          ScheduledExecutorService scheduler \u003d Executors.newScheduledThreadPool(1);\n          scheduler.schedule(new Runnable() {\n+            @Override\n             public void run()\n             {\n                stubDataSource.setThrowException(null);\n@@ -109,6 +112,7 @@ public void testConnectionRetries3() throws SQLException\n \n          ScheduledExecutorService scheduler \u003d Executors.newScheduledThreadPool(2);\n          scheduler.schedule(new Runnable() {\n+            @Override\n             public void run()\n             {\n                try {\n@@ -183,6 +187,7 @@ public void testConnectionRetries5() throws SQLException\n \n          ScheduledExecutorService scheduler \u003d Executors.newScheduledThreadPool(2);\n          scheduler.schedule(new Runnable() {\n+            @Override\n             public void run()\n             {\n                try {\n@@ -221,8 +226,8 @@ public void testConnectionIdleFill() throws Exception\n       HikariConfig config \u003d new HikariConfig();\n       config.setMinimumIdle(5);\n       config.setMaximumPoolSize(10);\n-      config.setConnectionTimeout(1000);\n-      config.setValidationTimeout(1000);\n+      config.setConnectionTimeout(2000);\n+      config.setValidationTimeout(2000);\n       config.setConnectionTestQuery(\"VALUES 2\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n@@ -231,10 +236,10 @@ public void testConnectionIdleFill() throws Exception\n       ByteArrayOutputStream baos \u003d new ByteArrayOutputStream();\n       PrintStream ps \u003d new PrintStream(baos, true);\n       TestElf.setSlf4jTargetStream(HikariPool.class, ps);\n-      TestElf.setSlf4jLogLevel(HikariPool.class, Logger.DEBUG);\n \n-      boolean success \u003d false;\n       try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n+         TestElf.setSlf4jLogLevel(HikariPool.class, Level.DEBUG);\n+\n          Connection connection1 \u003d ds.getConnection();\n          Connection connection2 \u003d ds.getConnection();\n          Connection connection3 \u003d ds.getConnection();\n@@ -243,7 +248,7 @@ public void testConnectionIdleFill() throws Exception\n          Connection connection6 \u003d ds.getConnection();\n          Connection connection7 \u003d ds.getConnection();\n \n-         Thread.sleep(900);\n+         Thread.sleep(1300);\n \n          Assert.assertSame(\"Total connections not as expected\", 10, TestElf.getPool(ds).getTotalConnections());\n          Assert.assertSame(\"Idle connections not as expected\", 3, TestElf.getPool(ds).getIdleConnections());\n@@ -258,14 +263,19 @@ public void testConnectionIdleFill() throws Exception\n \n          Assert.assertSame(\"Totals connections not as expected\", 10, TestElf.getPool(ds).getTotalConnections());\n          Assert.assertSame(\"Idle connections not as expected\", 10, TestElf.getPool(ds).getIdleConnections());\n-         success \u003d true;\n-      }\n-      finally {\n-         TestElf.setSlf4jLogLevel(HikariPool.class, Logger.INFO);\n-         System.getProperties().remove(\"com.zaxxer.hikari.housekeeping.periodMs\");\n-         if (!success) {\n-            System.err.println(new String(baos.toByteArray()));\n-         }\n       }\n    }\n+\n+   @Before\n+   public void before()\n+   {\n+      TestElf.setSlf4jTargetStream(HikariPool.class, System.err);\n+   }\n+\n+   @After\n+   public void after()\n+   {\n+      System.getProperties().remove(\"com.zaxxer.hikari.housekeeping.periodMs\");\n+      TestElf.setSlf4jLogLevel(HikariPool.class, Level.WARN);\n+   }\n }"
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/TestConnections.java",
          "patch": "@@ -24,30 +24,40 @@\n import java.sql.SQLException;\n import java.sql.Statement;\n import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n \n+import org.apache.logging.log4j.Level;\n+import org.junit.After;\n import org.junit.Assert;\n+import org.junit.Before;\n import org.junit.Test;\n-import org.slf4j.spi.LocationAwareLogger;\n \n import com.zaxxer.hikari.HikariConfig;\n import com.zaxxer.hikari.HikariDataSource;\n import com.zaxxer.hikari.mocks.StubConnection;\n import com.zaxxer.hikari.mocks.StubDataSource;\n import com.zaxxer.hikari.mocks.StubStatement;\n-import com.zaxxer.hikari.pool.HikariPool;\n import com.zaxxer.hikari.pool.HikariPool.PoolInitializationException;\n import com.zaxxer.hikari.util.UtilityElf;\n \n /**\n- * System property testProxy can be one of:\n- *    \"com.zaxxer.hikari.JavaProxyFactory\"\n- *    \"com.zaxxer.hikari.CglibProxyFactory\"\n- *    \"com.zaxxer.hikari.JavassistProxyFactory\"\n- *\n  * @author Brett Wooldridge\n  */\n public class TestConnections\n {\n+   @Before\n+   public void before()\n+   {\n+      TestElf.setSlf4jTargetStream(HikariPool.class, System.err);\n+   }\n+\n+   @After\n+   public void after()\n+   {\n+      System.getProperties().remove(\"com.zaxxer.hikari.housekeeping.periodMs\");\n+      TestElf.setSlf4jLogLevel(HikariPool.class, Level.DEBUG);\n+   }\n+\n    @Test\n    public void testCreate() throws SQLException\n    {\n@@ -57,13 +67,14 @@ public void testCreate() throws SQLException\n       config.setConnectionTestQuery(\"VALUES 1\");\n       config.setConnectionInitSql(\"SELECT 1\");\n       config.setReadOnly(true);\n-      config.setLeakDetectionThreshold(TimeUnit.SECONDS.toMillis(60));\n+      config.setConnectionTimeout(2500);\n+      config.setLeakDetectionThreshold(TimeUnit.SECONDS.toMillis(30));\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n-      HikariDataSource ds \u003d new HikariDataSource(config);\n-      ds.setLoginTimeout(10);\n-      Assert.assertSame(10, ds.getLoginTimeout());\n-      try {\n+      try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n+         ds.setLoginTimeout(10);\n+         Assert.assertSame(10, ds.getLoginTimeout());\n+\n          Assert.assertSame(\"Totals connections not as expected\", 1, TestElf.getPool(ds).getTotalConnections());\n          Assert.assertSame(\"Idle connections not as expected\", 1, TestElf.getPool(ds).getIdleConnections());\n \n@@ -90,9 +101,6 @@ public void testCreate() throws SQLException\n          Assert.assertSame(\"Totals connections not as expected\", 1, TestElf.getPool(ds).getTotalConnections());\n          Assert.assertSame(\"Idle connections not as expected\", 1, TestElf.getPool(ds).getIdleConnections());\n       }\n-      finally {\n-         ds.close();\n-      }\n    }\n \n    @Test\n@@ -101,15 +109,14 @@ public void testMaxLifetime() throws Exception\n       HikariConfig config \u003d new HikariConfig();\n       config.setMinimumIdle(0);\n       config.setMaximumPoolSize(1);\n+      config.setConnectionTimeout(2500);\n       config.setConnectionTestQuery(\"VALUES 1\");\n       config.setInitializationFailFast(false);\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n       System.setProperty(\"com.zaxxer.hikari.housekeeping.periodMs\", \"100\");\n \n-      HikariDataSource ds \u003d new HikariDataSource(config);\n-\n-      try {\n+      try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n          System.clearProperty(\"com.zaxxer.hikari.housekeeping.periodMs\");\n \n          ds.setMaxLifetime(700);\n@@ -144,10 +151,6 @@ public void testMaxLifetime() throws Exception\n          Assert.assertSame(\"Post total connections not as expected\", 1, TestElf.getPool(ds).getTotalConnections());\n          Assert.assertSame(\"Post idle connections not as expected\", 1, TestElf.getPool(ds).getIdleConnections());\n       }\n-      finally {\n-         ds.close();\n-         System.getProperties().remove(\"com.zaxxer.hikari.housekeeping.periodMs\");\n-      }\n    }\n \n    @Test\n@@ -156,12 +159,13 @@ public void testMaxLifetime2() throws Exception\n       HikariConfig config \u003d new HikariConfig();\n       config.setMinimumIdle(0);\n       config.setMaximumPoolSize(1);\n+      config.setConnectionTimeout(2500);\n       config.setConnectionTestQuery(\"VALUES 1\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n-      HikariDataSource ds \u003d new HikariDataSource(config);\n+      System.setProperty(\"com.zaxxer.hikari.housekeeping.periodMs\", \"100\");\n \n-      try {\n+      try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n          ds.setMaxLifetime(700);\n \n          Assert.assertSame(\"Total connections not as expected\", 0, TestElf.getPool(ds).getTotalConnections());\n@@ -194,9 +198,6 @@ public void testMaxLifetime2() throws Exception\n          Assert.assertSame(\"Post total connections not as expected\", 1, TestElf.getPool(ds).getTotalConnections());\n          Assert.assertSame(\"Post idle connections not as expected\", 1, TestElf.getPool(ds).getIdleConnections());\n       }\n-      finally {\n-         ds.close();\n-      }\n    }\n \n    @Test\n@@ -205,11 +206,11 @@ public void testDoubleClose() throws Exception\n       HikariConfig config \u003d new HikariConfig();\n       config.setMinimumIdle(1);\n       config.setMaximumPoolSize(1);\n+      config.setConnectionTimeout(2500);\n       config.setConnectionTestQuery(\"VALUES 1\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n-      HikariDataSource ds \u003d new HikariDataSource(config);\n-      try {\n+      try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n          Connection connection \u003d ds.getConnection();\n          connection.close();\n \n@@ -222,9 +223,6 @@ public void testDoubleClose() throws Exception\n \n          connection.close();\n       }\n-      finally {\n-         ds.close();\n-      }\n    }\n \n    @Test\n@@ -233,20 +231,17 @@ public void testEviction() throws Exception\n       HikariConfig config \u003d new HikariConfig();\n       config.setMinimumIdle(0);\n       config.setMaximumPoolSize(5);\n+      config.setConnectionTimeout(2500);\n       config.setConnectionTestQuery(\"VALUES 1\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n-      HikariDataSource ds \u003d new HikariDataSource(config);\n-      try {\n+      try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n          Connection connection \u003d ds.getConnection();\n \n          Assert.assertEquals(1, TestElf.getPool(ds).getTotalConnections());\n          ds.evictConnection(connection);\n          Assert.assertEquals(0, TestElf.getPool(ds).getTotalConnections());\n       }\n-      finally {\n-         ds.close();\n-      }\n    }\n \n    @Test\n@@ -260,8 +255,10 @@ public void testBackfill() throws Exception\n       config.setConnectionTestQuery(\"VALUES 1\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n-      HikariDataSource ds \u003d new HikariDataSource(config);\n-      try {\n+      try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n+\n+         TestElf.setSlf4jLogLevel(HikariPool.class, Level.DEBUG);\n+\n          UtilityElf.quietlySleep(500);\n \n          Assert.assertSame(\"Totals connections not as expected\", 1, TestElf.getPool(ds).getTotalConnections());\n@@ -288,9 +285,15 @@ public void testBackfill() throws Exception\n             Assert.assertSame(SQLException.class, e.getClass());\n          }\n \n+         TestElf.getPool(ds).logPoolState(\"testBackfill() before close...\");\n+\n          // The connection will be ejected from the pool here\n          connection.close();\n \n+         UtilityElf.quietlySleep(500);\n+\n+         TestElf.getPool(ds).logPoolState(\"testBackfill() after close...\");\n+\n          Assert.assertSame(\"Totals connections not as expected\", 0, TestElf.getPool(ds).getTotalConnections());\n          Assert.assertSame(\"Idle connections not as expected\", 0, TestElf.getPool(ds).getIdleConnections());\n \n@@ -301,9 +304,6 @@ public void testBackfill() throws Exception\n          Assert.assertTrue(\"Totals connections not as expected\", TestElf.getPool(ds).getTotalConnections() \u003e 0);\n          Assert.assertTrue(\"Idle connections not as expected\", TestElf.getPool(ds).getIdleConnections() \u003e 0);\n       }\n-      finally {\n-         ds.close();\n-      }\n    }\n \n    @Test\n@@ -312,27 +312,34 @@ public void testMaximumPoolLimit() throws Exception\n       HikariConfig config \u003d new HikariConfig();\n       config.setMinimumIdle(1);\n       config.setMaximumPoolSize(4);\n-      config.setConnectionTimeout(TimeUnit.MINUTES.toMillis(1));\n+      config.setConnectionTimeout(20000);\n       config.setInitializationFailFast(true);\n       config.setConnectionTestQuery(\"VALUES 1\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n       StubConnection.count.set(0);\n \n-      final HikariDataSource ds \u003d new HikariDataSource(config);\n-      try {\n+      final AtomicReference\u003cException\u003e ref \u003d new AtomicReference\u003c\u003e();\n+\n+      try (final HikariDataSource ds \u003d new HikariDataSource(config)) {\n+         TestElf.setSlf4jLogLevel(HikariPool.class, Level.DEBUG);\n+\n          Thread[] threads \u003d new Thread[20];\n          for (int i \u003d 0; i \u003c threads.length; i++) {\n             threads[i] \u003d new Thread(new Runnable() {\n+               @Override\n                public void run()\n                {\n                   try {\n+                     HikariPool pool \u003d TestElf.getPool(ds);\n+                     pool.logPoolState(\"Before acquire\");\n                      Connection connection \u003d ds.getConnection();\n+                     pool.logPoolState(\"After  acquire\");\n                      quietlySleep(500);\n                      connection.close();\n                   }\n                   catch (Exception e) {\n-                     e.printStackTrace();\n+                     ref.set(e);\n                   }\n                }\n             });\n@@ -346,11 +353,9 @@ public void run()\n             threads[i].join();\n          }\n \n+         Assert.assertNull((ref.get() !\u003d null ? ref.get().toString() : \"\"), ref.get());\n          Assert.assertEquals(4, StubConnection.count.get());\n       }\n-      finally {\n-         ds.close();\n-      }\n    }\n \n    @Test\n@@ -359,13 +364,13 @@ public void testOldDriver() throws Exception\n       HikariConfig config \u003d new HikariConfig();\n       config.setMinimumIdle(1);\n       config.setMaximumPoolSize(1);\n+      config.setConnectionTimeout(2500);\n       config.setConnectionTestQuery(\"VALUES 1\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n       StubConnection.oldDriver \u003d true;\n       StubStatement.oldDriver \u003d true;\n-      HikariDataSource ds \u003d new HikariDataSource(config);\n-      try {\n+      try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n          quietlySleep(500);\n \n          Connection connection \u003d ds.getConnection();\n@@ -377,7 +382,6 @@ public void testOldDriver() throws Exception\n       finally {\n          StubConnection.oldDriver \u003d false;\n          StubStatement.oldDriver \u003d false;\n-         ds.close();\n       }\n    }\n \n@@ -387,20 +391,19 @@ public void testSuspendResume() throws Exception\n       HikariConfig config \u003d new HikariConfig();\n       config.setMinimumIdle(3);\n       config.setMaximumPoolSize(3);\n+      config.setConnectionTimeout(2500);\n       config.setAllowPoolSuspension(true);\n       config.setConnectionTestQuery(\"VALUES 1\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n-      TestElf.setSlf4jLogLevel(HikariPool.class, LocationAwareLogger.DEBUG_INT);\n-\n-      final HikariDataSource ds \u003d new HikariDataSource(config);\n-      try {\n+      try (final HikariDataSource ds \u003d new HikariDataSource(config)) {\n          HikariPool pool \u003d TestElf.getPool(ds);\n          while (pool.getTotalConnections() \u003c 3) {\n             quietlySleep(50);\n          }\n \n          Thread t \u003d new Thread(new Runnable() {\n+            @Override\n             public void run()\n             {\n                try {\n@@ -427,9 +430,6 @@ public void run()\n          quietlySleep(500);\n          Assert.assertEquals(1, pool.getIdleConnections());\n       }\n-      finally {\n-         ds.close();\n-      }\n    }\n \n    @Test\n@@ -438,21 +438,20 @@ public void testInitializationFailure() throws SQLException\n       StubDataSource stubDataSource \u003d new StubDataSource();\n       stubDataSource.setThrowException(new SQLException(\"Connection refused\"));\n \n-      HikariDataSource ds \u003d new HikariDataSource();\n-      ds.setMinimumIdle(3);\n-      ds.setMaximumPoolSize(3);\n-      ds.setAllowPoolSuspension(true);\n-      ds.setConnectionTestQuery(\"VALUES 1\");\n-      ds.setDataSource(stubDataSource);\n+      try (HikariDataSource ds \u003d new HikariDataSource()) {\n+         ds.setMinimumIdle(3);\n+         ds.setMaximumPoolSize(3);\n+         ds.setConnectionTimeout(2500);\n+         ds.setAllowPoolSuspension(true);\n+         ds.setConnectionTestQuery(\"VALUES 1\");\n+         ds.setDataSource(stubDataSource);\n \n-      try (Connection c \u003d ds.getConnection()) {\n-         Assert.fail(\"Initialization should have failed\");\n-      }\n-      catch (PoolInitializationException e) {\n-         // passed\n-      }\n-      finally {\n-         ds.close();\n+         try (Connection c \u003d ds.getConnection()) {\n+            Assert.fail(\"Initialization should have failed\");\n+         }\n+         catch (PoolInitializationException e) {\n+            // passed\n+         }\n       }\n    }\n "
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/TestElf.java",
          "patch": "@@ -21,13 +21,17 @@\n import java.sql.Connection;\n import java.util.HashMap;\n \n+import org.apache.logging.log4j.Level;\n+import org.apache.logging.log4j.core.Appender;\n+import org.apache.logging.log4j.core.LogEvent;\n+import org.apache.logging.log4j.core.Logger;\n+import org.apache.logging.log4j.core.appender.AbstractAppender;\n+import org.apache.logging.log4j.core.layout.CsvLogEventLayout;\n+import org.apache.logging.slf4j.Log4jLogger;\n import org.slf4j.LoggerFactory;\n-import org.slf4j.impl.SimpleLogger;\n \n-import com.zaxxer.hikari.pool.ProxyConnection;\n import com.zaxxer.hikari.HikariConfig;\n import com.zaxxer.hikari.HikariDataSource;\n-import com.zaxxer.hikari.pool.HikariPool;\n \n /**\n  * Utility methods for testing.\n@@ -37,7 +41,7 @@\n public final class TestElf\n {\n    private TestElf() {\n-      // default constructor   \n+      // default constructor\n    }\n \n    public static HikariPool getPool(HikariDataSource ds)\n@@ -74,7 +78,7 @@ public static boolean getConnectionCommitDirtyState(Connection connection)\n       }\n       catch (Exception e) {\n          throw new RuntimeException(e);\n-      }      \n+      }\n    }\n \n    public static void setConfigUnitTest(boolean unitTest)\n@@ -86,32 +90,61 @@ public static void setConfigUnitTest(boolean unitTest)\n       }\n       catch (Exception e) {\n          throw new RuntimeException(e);\n-      }      \n+      }\n    }\n \n    public static void setSlf4jTargetStream(Class\u003c?\u003e clazz, PrintStream stream)\n    {\n-      SimpleLogger simpleLogger \u003d (SimpleLogger) LoggerFactory.getLogger(clazz);\n       try {\n-         Field field \u003d clazz.getClassLoader().loadClass(\"org.slf4j.impl.SimpleLogger\").getDeclaredField(\"TARGET_STREAM\");\n+         Log4jLogger log4Jlogger \u003d (Log4jLogger) LoggerFactory.getLogger(clazz);\n+\n+         Field field \u003d clazz.getClassLoader().loadClass(\"org.apache.logging.slf4j.Log4jLogger\").getDeclaredField(\"logger\");\n          field.setAccessible(true);\n-         field.set(simpleLogger, stream);\n+\n+         Logger logger \u003d (Logger) field.get(log4Jlogger);\n+         if (logger.getAppenders().containsKey(\"string\")) {\n+            Appender appender \u003d logger.getAppenders().get(\"string\");\n+            logger.removeAppender(appender);\n+         }\n+\n+         logger.addAppender(new StringAppender(\"string\", stream));\n       }\n       catch (Exception e) {\n          throw new RuntimeException(e);\n       }\n    }\n \n-   public static void setSlf4jLogLevel(Class\u003c?\u003e clazz, int logLevel)\n+   public static void setSlf4jLogLevel(Class\u003c?\u003e clazz, Level logLevel)\n    {\n-      SimpleLogger simpleLogger \u003d (SimpleLogger) LoggerFactory.getLogger(clazz);\n       try {\n-         Field field \u003d clazz.getClassLoader().loadClass(\"org.slf4j.impl.SimpleLogger\").getDeclaredField(\"currentLogLevel\");\n+         Log4jLogger log4Jlogger \u003d (Log4jLogger) LoggerFactory.getLogger(clazz);\n+\n+         Field field \u003d clazz.getClassLoader().loadClass(\"org.apache.logging.slf4j.Log4jLogger\").getDeclaredField(\"logger\");\n          field.setAccessible(true);\n-         field.setInt(simpleLogger, logLevel);\n+\n+         Logger logger \u003d (Logger) field.get(log4Jlogger);\n+         logger.setLevel(logLevel);\n       }\n       catch (Exception e) {\n          throw new RuntimeException(e);\n       }\n    }\n+\n+   private static class StringAppender extends AbstractAppender\n+   {\n+      private static final long serialVersionUID \u003d -1932433845656444920L;\n+      private PrintStream stream;\n+\n+      StringAppender(String name, PrintStream stream)\n+      {\n+         super(name, null, CsvLogEventLayout.createDefaultLayout());\n+         this.stream \u003d stream;\n+      }\n+\n+      @Override\n+      public void append(LogEvent event)\n+      {\n+         stream.println(event.getMessage().getFormattedMessage());\n+      }\n+   }\n }"
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/TestMetrics.java",
          "patch": "@@ -57,8 +57,7 @@ public void testMetricWait() throws SQLException\n       config.setPoolName(\"test\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n-      HikariDataSource ds \u003d new HikariDataSource(config);\n-      try {\n+      try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n          ds.getConnection().close();\n \n          Timer timer \u003d metricRegistry.getTimers(new MetricFilter() {\n@@ -73,9 +72,6 @@ public boolean matches(String name, Metric metric)\n          Assert.assertEquals(1, timer.getCount());\n          Assert.assertTrue(timer.getMeanRate() \u003e 0.0);\n       }\n-      finally {\n-         ds.close();\n-      }\n    }\n \n    @Test\n@@ -91,8 +87,7 @@ public void testMetricUsage() throws SQLException\n       config.setPoolName(\"test\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n \n-      HikariDataSource ds \u003d new HikariDataSource(config);\n-      try {\n+      try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n          Connection connection \u003d ds.getConnection();\n          UtilityElf.quietlySleep(250L);\n          connection.close();\n@@ -110,9 +105,6 @@ public boolean matches(String name, Metric metric)\n          double seventyFifth \u003d histo.getSnapshot().get75thPercentile();\n          Assert.assertTrue(\"Seventy-fith percentile less than 250ms: \" + seventyFifth, seventyFifth \u003e\u003d 250.0);\n       }\n-      finally {\n-         ds.close();\n-      }\n    }\n \n    @Test\n@@ -128,10 +120,9 @@ public void testHealthChecks() throws Exception\n       config.setPoolName(\"test\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n       config.addHealthCheckProperty(\"connectivityCheckTimeoutMs\", \"1000\");\n-      config.addHealthCheckProperty(\"expected99thPercentileMs\", \"10\");\n+      config.addHealthCheckProperty(\"expected99thPercentileMs\", \"100\");\n \n-      HikariDataSource ds \u003d new HikariDataSource(config);\n-      try {\n+      try (HikariDataSource ds \u003d new HikariDataSource(config)) {\n          UtilityElf.quietlySleep(TimeUnit.SECONDS.toMillis(2));\n \n          Connection connection \u003d ds.getConnection();\n@@ -148,9 +139,6 @@ public void testHealthChecks() throws Exception\n          Result slaResult \u003d healthChecks.get(\"test.pool.Connection99Percent\");\n          Assert.assertTrue(slaResult.isHealthy());\n       }\n-      finally {\n-         ds.close();\n-      }\n    }\n \n    @Test\n@@ -159,7 +147,7 @@ public void testSetters1() throws Exception\n       HikariDataSource ds \u003d new HikariDataSource();\n       ds.setMaximumPoolSize(1);\n       ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-      \n+\n       MetricRegistry metricRegistry \u003d new MetricRegistry();\n       HealthCheckRegistry healthRegistry \u003d new HealthCheckRegistry();\n \n@@ -196,7 +184,7 @@ public void testSetters2() throws Exception\n       HikariDataSource ds \u003d new HikariDataSource();\n       ds.setMaximumPoolSize(1);\n       ds.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-      \n+\n       MetricRegistry metricRegistry \u003d new MetricRegistry();\n       HealthCheckRegistry healthRegistry \u003d new HealthCheckRegistry();\n \n@@ -216,7 +204,7 @@ public void testSetters2() throws Exception\n          Assert.fail(\"Should not have been allowed to set registry after pool started\");\n       }\n       catch (IllegalStateException ise) {\n-         \n+         // pass\n       }\n       finally {\n          ds.close();"
        },
        {
          "file_name": "src/test/java/com/zaxxer/hikari/pool/TestValidation.java",
          "patch": "@@ -144,7 +144,9 @@ public void validateIdleTimeoutExceedsLifetime()\n       config.setMaxLifetime(TimeUnit.MINUTES.toMillis(2));\n       config.setIdleTimeout(TimeUnit.MINUTES.toMillis(3));\n       config.validate();\n-      Assert.assertTrue(new String(baos.toByteArray()).contains(\"greater than maxLifetime\"));\n+\n+      String s \u003d new String(baos.toByteArray());\n+      Assert.assertTrue(\"Expected exception to contain \u0027greater than maxLifetime\u0027 but contains *\" + s + \"*\", s.contains(\"greater than maxLifetime\"));\n    }\n \n    @Test\n@@ -202,7 +204,9 @@ public void validateBothDSAndDSName()\n          config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n          config.setDataSource(new StubDataSource());\n          config.validate();\n-         Assert.assertTrue(new String(baos.toByteArray()).contains(\"using dataSource\"));\n+\n+         String s \u003d new String(baos.toByteArray());\n+         Assert.assertTrue(\"Expected exception to contain \u0027using dataSource\u0027 but contains *\" + s + \"*\", s.contains(\"using dataSource\"));\n       }\n       catch (IllegalStateException ise) {\n          Assert.fail();"
        },
        {
          "file_name": "src/test/resources/log4j2-test.xml",
          "patch": "@@ -0,0 +1,13 @@\n+\u003c?xml version\u003d\"1.0\" encoding\u003d\"UTF-8\"?\u003e\n+\u003cconfiguration status\u003d\"OFF\"\u003e\n+  \u003cappenders\u003e\n+    \u003cConsole name\u003d\"Console\" target\u003d\"SYSTEM_ERR\"\u003e\n+      \u003cPatternLayout pattern\u003d\"%6sn [%-26.26t] %-5level %-20c{1} - %msg%n\" /\u003e\n+    \u003c/Console\u003e\n+  \u003c/appenders\u003e\n+  \u003cLoggers\u003e\n+    \u003cRoot level\u003d\"info\"\u003e\n+      \u003cAppenderRef ref\u003d\"Console\" /\u003e\n+    \u003c/Root\u003e\n+  \u003c/Loggers\u003e\n+\u003c/configuration\u003e"
        }
      ]
    }
  },
  {
    "name": "Race condition: BouncyCastle does not get registered as JCE provider the first time Karaf starts",
    "url": "https://github.com/axemblr/axemblr-provisionr/pull/80",
    "description": "The first time we start Karaf distribution, cloudstack:\\* commands fail to run because jclouds can not find Hmac256. BouncyCastle does not get registered as a JCE provider. \n\nRestarting Karaf seems to fix the issue. \n",
    "keywords": [
      "karaf",
      "not"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/axemblr/axemblr-provisionr/commit/bf543323ad4adfabdd65ef956fc3b3703a34e52d",
      "files": [
        {
          "file_name": "activiti/commands/src/main/java/org/activiti/karaf/commands/InfoActivitiCommand.java",
          "patch": "@@ -120,7 +120,7 @@ protected Object executeCommand() throws Exception {\n     }\n \n     protected ActivitiPrintHandler findBPMPrintHandler() {\n-        ActivitiPrintHandler handler \u003d null;\n+        ActivitiPrintHandler handler;\n         List\u003cActivitiPrintHandler\u003e hList \u003d null;\n         try {\n             String filter \u003d null; // add the filter here per process."
        },
        {
          "file_name": "api/src/main/java/com/axemblr/provisionr/api/network/NetworkBuilder.java",
          "patch": "@@ -25,7 +25,7 @@\n public class NetworkBuilder extends BuilderWithOptions\u003cNetworkBuilder\u003e {\n \n     private String type \u003d \"default\";\n-    private ImmutableSet.Builder\u003cRule\u003e ingress \u003d ImmutableSet.\u003cRule\u003ebuilder();\n+    private ImmutableSet.Builder\u003cRule\u003e ingress \u003d ImmutableSet.builder();\n \n     @Override\n     protected NetworkBuilder getThis() {"
        },
        {
          "file_name": "core/src/main/resources/OSGI-INF/blueprint/context.xml",
          "patch": "@@ -80,5 +80,9 @@\n     \u003c/bean\u003e\n     \u003cservice ref\u003d\"checkSshPortIsOpen\" auto-export\u003d\"interfaces\"/\u003e\n \n+    \u003c!-- force registration of Bouncy Castle as JCE provider - needed for jclouds --\u003e\n+    \u003cbean id\u003d\"bouncyCastleAsJceProviderRegistration\" class\u003d\"net.schmizz.sshj.common.SecurityUtils\"\n+          factory-method\u003d\"getSecurityProvider\"/\u003e\n+\n \u003c/blueprint\u003e\n "
        },
        {
          "file_name": "providers/cloudstack/src/main/java/com/axemblr/provisionr/cloudstack/DefaultProviderConfig.java",
          "patch": "@@ -49,9 +49,9 @@ public DefaultProviderConfig(\n             .endpoint(endpoint)\n             .accessKey(accessKey)\n             .secretKey(secretKey)\n-            .option(ProviderOptions.CLOUDSTACK_ZONE_ID_OPTION, zoneId)\n-            .option(ProviderOptions.CLOUDSTACK_TEMPLATE_ID_OPTION, templateId)\n-            .option(ProviderOptions.CLOUDSTACK_SERVICE_OFFERING_OPTION, serviceOffering)\n+            .option(ProviderOptions.ZONE_ID, zoneId)\n+            .option(ProviderOptions.TEMPLATE_ID, templateId)\n+            .option(ProviderOptions.SERVICE_OFFERING, serviceOffering)\n             .createProvider());\n     }\n }"
        },
        {
          "file_name": "providers/cloudstack/src/main/java/com/axemblr/provisionr/cloudstack/ProviderOptions.java",
          "patch": "@@ -22,7 +22,7 @@ private ProviderOptions() {\n         throw new RuntimeException(ProviderOptions.class.getName() + \" should not be instantiated\");\n     }\n \n-    public static final String CLOUDSTACK_ZONE_ID_OPTION \u003d \"zoneId\";\n-    public static final String CLOUDSTACK_TEMPLATE_ID_OPTION \u003d \"templateId\";\n-    public static final String CLOUDSTACK_SERVICE_OFFERING_OPTION \u003d \"serviceOffering\";\n+    public static final String ZONE_ID \u003d \"zoneId\";\n+    public static final String TEMPLATE_ID \u003d \"templateId\";\n+    public static final String SERVICE_OFFERING \u003d \"serviceOffering\";\n }"
        },
        {
          "file_name": "providers/cloudstack/src/main/java/com/axemblr/provisionr/cloudstack/activities/EnsureSecurityGroupExists.java",
          "patch": "@@ -38,7 +38,7 @@\n     public void execute(CloudStackClient cloudStackClient, Pool pool, DelegateExecution execution) {\n         Network network \u003d checkNotNull(pool.getNetwork(), \"Please configure a network for the pool\");\n         String securityGroupName \u003d SecurityGroups.formatNameFromBusinessKey(execution.getProcessBusinessKey());\n-        SecurityGroup securityGroup \u003d null;\n+        SecurityGroup securityGroup;\n         try {\n             LOG.info(\"Creating SecurityGroup {}\", securityGroupName);\n             securityGroup \u003d SecurityGroups.createSecurityGroup(cloudStackClient, securityGroupName);"
        },
        {
          "file_name": "providers/cloudstack/src/test/resources/logback.xml",
          "patch": "@@ -70,7 +70,7 @@\n \n     \u003clogger name\u003d\"jclouds.headers\"\u003e\n         \u003clevel value\u003d\"DEBUG\" /\u003e\n-        \u003cappender-ref ref\u003d\"STDOUT\" /\u003e\n+        \u003cappender-ref ref\u003d\"FILE\" /\u003e\n     \u003c/logger\u003e\n \n     \u003clogger name\u003d\"jclouds.compute\"\u003e"
        }
      ]
    }
  },
  {
    "name": "Fix a race condition in the shell unit test",
    "url": "https://github.com/rapid7/metasploit-javapayload/pull/30",
    "description": "The shell unit test was failing for me randomly, more often on my test build machine than on my laptop. I tracked it down to a missing bit of synchronization between starting a shell command and checking the output.\n\nThis change waits up to 5 seconds for shell output before checking the result. I have not had a failure since. I\u0027m sure there is a more elegant way to wait for the ready condition, but I tried a few other more complex things that had inconsistent results.\n# Verification\n\nRun \u0027mvn package\u0027 on a relatively fast machine and observe that the build always succeeds. This is a bit of a heisenbug. If you never had the issue before this change, you should at least continue not seeing it.\n",
    "keywords": [
      "test",
      "shell"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/rapid7/metasploit-javapayload/commit/0180a9dbd209fdafcff99f192751ea3697cf0ba9",
      "files": [
        {
          "file_name": "javapayload/src/test/java/javapayload/stage/ShellTest.java",
          "patch": "@@ -15,6 +15,11 @@ public void testShellStage() throws Exception {\n \t\tDataInputStream in \u003d new DataInputStream(new ByteArrayInputStream(commands.getBytes(\"ISO-8859-1\")));\n \t\tByteArrayOutputStream out \u003d new ByteArrayOutputStream();\n \t\tshell.start(in, out, new String[] {\"Payload\", \"--\", \"Shell\"});\n+\t\tint timeout \u003d 5000;\n+\t\twhile (out.size() \u003d\u003d 0 \u0026\u0026 timeout \u003e 0) {\n+\t\t\tThread.sleep(100);\n+\t\t\ttimeout -\u003d 100;\n+\t\t}\n \t\tString shellOutput \u003d new String(out.toByteArray(), \"ISO-8859-1\");\n \t\tAssert.assertTrue(\"MagicToken missing in shell output: \"+shellOutput, shellOutput.contains(\"MagicToken\"));\n \t\tAssert.assertEquals(-1, in.read());"
        }
      ]
    }
  },
  {
    "name": "switchOnNext() - fix lost requests race condition ",
    "url": "https://github.com/ReactiveX/RxJava/pull/3078",
    "description": "As per #3073 a race condition in `OperatorSwitch` means that requests can be lost. This PR uses `ProducerArbiter` to ensure all unfulfilled requests are carried through to the next `Observable`.\n\nI also changed `InnerSubscriber` to be a static class as opposed to an inner class just to decouple it from surrounding state. \n",
    "keywords": [
      "requests"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/ReactiveX/RxJava/commit/9a84006dd8f480a48e479259aecf79ab285f6c31",
      "files": [
        {
          "file_name": "src/main/java/rx/internal/operators/OperatorSwitch.java",
          "patch": "@@ -22,6 +22,7 @@\n import rx.Observable.Operator;\n import rx.Producer;\n import rx.Subscriber;\n+import rx.internal.producers.ProducerArbiter;\n import rx.observers.SerializedSubscriber;\n import rx.subscriptions.SerialSubscription;\n \n@@ -46,7 +47,9 @@\n     public static \u003cT\u003e OperatorSwitch\u003cT\u003e instance() {\n         return (OperatorSwitch\u003cT\u003e)Holder.INSTANCE;\n     }\n+    \n     private OperatorSwitch() { }\n+    \n     @Override\n     public Subscriber\u003c? super Observable\u003c? extends T\u003e\u003e call(final Subscriber\u003c? super T\u003e child) {\n         SwitchSubscriber\u003cT\u003e sws \u003d new SwitchSubscriber\u003cT\u003e(child);\n@@ -55,10 +58,12 @@ private OperatorSwitch() { }\n     }\n \n     private static final class SwitchSubscriber\u003cT\u003e extends Subscriber\u003cObservable\u003c? extends T\u003e\u003e {\n-        final SerializedSubscriber\u003cT\u003e s;\n+        final SerializedSubscriber\u003cT\u003e serializedChild;\n         final SerialSubscription ssub;\n         final Object guard \u003d new Object();\n         final NotificationLite\u003c?\u003e nl \u003d NotificationLite.instance();\n+        final ProducerArbiter arbiter;\n+        \n         /** Guarded by guard. */\n         int index;\n         /** Guarded by guard. */\n@@ -70,50 +75,19 @@ private OperatorSwitch() { }\n         /** Guarded by guard. */\n         boolean emitting;\n         /** Guarded by guard. */\n-        InnerSubscriber currentSubscriber;\n-        /** Guarded by guard. */\n-        long initialRequested;\n-\n-        volatile boolean infinite \u003d false;\n+        InnerSubscriber\u003cT\u003e currentSubscriber;\n \n-        public SwitchSubscriber(Subscriber\u003c? super T\u003e child) {\n-            s \u003d new SerializedSubscriber\u003cT\u003e(child);\n+        SwitchSubscriber(Subscriber\u003c? super T\u003e child) {\n+            serializedChild \u003d new SerializedSubscriber\u003cT\u003e(child);\n+            arbiter \u003d new ProducerArbiter();\n             ssub \u003d new SerialSubscription();\n             child.add(ssub);\n             child.setProducer(new Producer(){\n \n                 @Override\n                 public void request(long n) {\n-                    if (infinite) {\n-                        return;\n-                    }\n-                    if(n \u003d\u003d Long.MAX_VALUE) {\n-                        infinite \u003d true;\n-                    }\n-                    InnerSubscriber localSubscriber;\n-                    synchronized (guard) {\n-                        localSubscriber \u003d currentSubscriber;\n-                        if (currentSubscriber \u003d\u003d null) {\n-                            long r \u003d initialRequested + n;\n-                            if (r \u003c 0) {\n-                                infinite \u003d true;\n-                            } else {\n-                                initialRequested \u003d r;\n-                            }\n-                        } else {\n-                            long r \u003d currentSubscriber.requested + n;\n-                            if (r \u003c 0) {\n-                                infinite \u003d true;\n-                            } else {\n-                                currentSubscriber.requested \u003d r;\n-                            }\n-                        }\n-                    }\n-                    if (localSubscriber !\u003d null) {\n-                        if (infinite)\n-                            localSubscriber.requestMore(Long.MAX_VALUE);\n-                        else \n-                            localSubscriber.requestMore(n);\n+                    if (n \u003e 0) {\n+                        arbiter.request(n);\n                     }\n                 }\n             });\n@@ -122,26 +96,18 @@ public void request(long n) {\n         @Override\n         public void onNext(Observable\u003c? extends T\u003e t) {\n             final int id;\n-            long remainingRequest;\n             synchronized (guard) {\n                 id \u003d ++index;\n                 active \u003d true;\n-                if (infinite) {\n-                    remainingRequest \u003d Long.MAX_VALUE;\n-                } else {\n-                    remainingRequest \u003d currentSubscriber \u003d\u003d null ? initialRequested : currentSubscriber.requested;\n-                }\n-                currentSubscriber \u003d new InnerSubscriber(id, remainingRequest);\n-                currentSubscriber.requested \u003d remainingRequest;\n+                currentSubscriber \u003d new InnerSubscriber\u003cT\u003e(id, arbiter, this);\n             }\n             ssub.set(currentSubscriber);\n-\n             t.unsafeSubscribe(currentSubscriber);\n         }\n \n         @Override\n         public void onError(Throwable e) {\n-            s.onError(e);\n+            serializedChild.onError(e);\n             unsubscribe();\n         }\n \n@@ -165,10 +131,10 @@ public void onCompleted() {\n                 emitting \u003d true;\n             }\n             drain(localQueue);\n-            s.onCompleted();\n+            serializedChild.onCompleted();\n             unsubscribe();\n         }\n-        void emit(T value, int id, InnerSubscriber innerSubscriber) {\n+        void emit(T value, int id, InnerSubscriber\u003cT\u003e innerSubscriber) {\n             List\u003cObject\u003e localQueue;\n             synchronized (guard) {\n                 if (id !\u003d index) {\n@@ -178,8 +144,6 @@ void emit(T value, int id, InnerSubscriber innerSubscriber) {\n                     if (queue \u003d\u003d null) {\n                         queue \u003d new ArrayList\u003cObject\u003e();\n                     }\n-                    if (innerSubscriber.requested !\u003d Long.MAX_VALUE)\n-                        innerSubscriber.requested--;\n                     queue.add(value);\n                     return;\n                 }\n@@ -194,11 +158,8 @@ void emit(T value, int id, InnerSubscriber innerSubscriber) {\n                     drain(localQueue);\n                     if (once) {\n                         once \u003d false;\n-                        synchronized (guard) {\n-                            if (innerSubscriber.requested !\u003d Long.MAX_VALUE)\n-                                innerSubscriber.requested--;\n-                        }\n-                        s.onNext(value);\n+                        serializedChild.onNext(value);\n+                        arbiter.produced(1);                        \n                     }\n                     synchronized (guard) {\n                         localQueue \u003d queue;\n@@ -209,7 +170,7 @@ void emit(T value, int id, InnerSubscriber innerSubscriber) {\n                             break;\n                         }\n                     }\n-                } while (!s.isUnsubscribed());\n+                } while (!serializedChild.isUnsubscribed());\n             } finally {\n                 if (!skipFinal) {\n                     synchronized (guard) {\n@@ -224,16 +185,17 @@ void drain(List\u003cObject\u003e localQueue) {\n             }\n             for (Object o : localQueue) {\n                 if (nl.isCompleted(o)) {\n-                    s.onCompleted();\n+                    serializedChild.onCompleted();\n                     break;\n                 } else\n                 if (nl.isError(o)) {\n-                    s.onError(nl.getError(o));\n+                    serializedChild.onError(nl.getError(o));\n                     break;\n                 } else {\n                     @SuppressWarnings(\"unchecked\")\n                     T t \u003d (T)o;\n-                    s.onNext(t);\n+                    serializedChild.onNext(t);\n+                    arbiter.produced(1);\n                 }\n             }\n         }\n@@ -258,7 +220,7 @@ void error(Throwable e, int id) {\n             }\n \n             drain(localQueue);\n-            s.onError(e);\n+            serializedChild.onError(e);\n             unsubscribe();\n         }\n         void complete(int id) {\n@@ -285,51 +247,45 @@ void complete(int id) {\n             }\n \n             drain(localQueue);\n-            s.onCompleted();\n+            serializedChild.onCompleted();\n             unsubscribe();\n         }\n \n-        final class InnerSubscriber extends Subscriber\u003cT\u003e {\n-\n-            /**\n-             * The number of request that is not acknowledged.\n-             *\n-             * Guarded by guard.\n-             */\n-            private long requested \u003d 0;\n-\n-            private final int id;\n+    }\n+    \n+    private static final class InnerSubscriber\u003cT\u003e extends Subscriber\u003cT\u003e {\n \n-            private final long initialRequested;\n+        private final int id;\n \n-            public InnerSubscriber(int id, long initialRequested) {\n-                this.id \u003d id;\n-                this.initialRequested \u003d initialRequested;\n-            }\n+        private final ProducerArbiter arbiter;\n \n-            @Override\n-            public void onStart() {\n-                requestMore(initialRequested);\n-            }\n+        private final SwitchSubscriber\u003cT\u003e parent;\n \n-            public void requestMore(long n) {\n-                request(n);\n-            }\n+        InnerSubscriber(int id, ProducerArbiter arbiter, SwitchSubscriber\u003cT\u003e parent) {\n+            this.id \u003d id;\n+            this.arbiter \u003d arbiter;\n+            this.parent \u003d parent;\n+        }\n+        \n+        @Override\n+        public void setProducer(Producer p) {\n+            arbiter.setProducer(p);\n+        }\n \n-            @Override\n-            public void onNext(T t) {\n-                emit(t, id, this);\n-            }\n+        @Override\n+        public void onNext(T t) {\n+            parent.emit(t, id, this);\n+        }\n \n-            @Override\n-            public void onError(Throwable e) {\n-                error(e, id);\n-            }\n+        @Override\n+        public void onError(Throwable e) {\n+            parent.error(e, id);\n+        }\n \n-            @Override\n-            public void onCompleted() {\n-                complete(id);\n-            }\n+        @Override\n+        public void onCompleted() {\n+            parent.complete(id);\n         }\n     }\n+\n }"
        },
        {
          "file_name": "src/test/java/rx/internal/operators/OperatorSwitchIfEmptyTest.java",
          "patch": "@@ -27,7 +27,6 @@\n import rx.Observable;\n import rx.Observable.OnSubscribe;\n import rx.functions.Action0;\n-import rx.functions.Action1;\n import rx.observers.TestSubscriber;\n import rx.schedulers.Schedulers;\n import rx.subscriptions.Subscriptions;"
        },
        {
          "file_name": "src/test/java/rx/internal/operators/OperatorSwitchTest.java",
          "patch": "@@ -25,7 +25,6 @@\n import static org.mockito.Mockito.times;\n import static org.mockito.Mockito.verify;\n \n-import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n import java.util.concurrent.CopyOnWriteArrayList;\n@@ -642,32 +641,34 @@ public void testSecondaryRequestsDontOverflow() throws InterruptedException {\n     }\n     \n     @Test(timeout \u003d 10000)\n-    public void testSecondaryRequestsAdditivelyAreMoreThanLongMaxValueInducesMaxValueRequestFromUpstream() throws InterruptedException {\n+    public void testSecondaryRequestsAdditivelyAreMoreThanLongMaxValueInducesMaxValueRequestFromUpstream()\n+            throws InterruptedException {\n         final List\u003cLong\u003e requests \u003d new CopyOnWriteArrayList\u003cLong\u003e();\n         final Action1\u003cLong\u003e addRequest \u003d new Action1\u003cLong\u003e() {\n \n             @Override\n             public void call(Long n) {\n                 requests.add(n);\n-            }};\n-        TestSubscriber\u003cLong\u003e ts \u003d new TestSubscriber\u003cLong\u003e(0);\n+            }\n+        };\n+        TestSubscriber\u003cLong\u003e ts \u003d new TestSubscriber\u003cLong\u003e(1);\n         Observable.switchOnNext(\n                 Observable.interval(100, TimeUnit.MILLISECONDS)\n                         .map(new Func1\u003cLong, Observable\u003cLong\u003e\u003e() {\n                             @Override\n                             public Observable\u003cLong\u003e call(Long t) {\n-                                return Observable.from(Arrays.asList(1L, 2L, 3L)).doOnRequest(addRequest);\n+                                return Observable.from(Arrays.asList(1L, 2L, 3L)).doOnRequest(\n+                                        addRequest);\n                             }\n                         }).take(3)).subscribe(ts);\n-        ts.requestMore(1);\n-        //we will miss two of the first observable\n+        // we will miss two of the first observables\n         Thread.sleep(250);\n         ts.requestMore(Long.MAX_VALUE - 1);\n         ts.requestMore(Long.MAX_VALUE - 1);\n         ts.awaitTerminalEvent();\n         assertTrue(ts.getOnNextEvents().size() \u003e 0);\n         assertEquals(5, (int) requests.size());\n-        assertEquals(Long.MAX_VALUE, (long) requests.get(3));\n-        assertEquals(Long.MAX_VALUE, (long) requests.get(4));\n+        assertEquals(Long.MAX_VALUE, (long) requests.get(requests.size()-1));\n     }\n+\n }"
        }
      ]
    }
  },
  {
    "name": "PriorityScheduler: Fix shutdown and pool size decrease race condition",
    "url": "https://github.com/threadly/threadly/pull/204",
    "description": "This was a regresion from 4.4.0 when we changed how we poll tasks in `PriorityScheduler`.\n\nA very small race condition existed that was thankfully reported to me.  In workerIdle we have two while loops, the inner loop is used as a minor optimization to avoid re-checking the pool logic that rarely changes.  We use this loop for the double check strategy when parking a thread, so that we can park more efficiently.  This introduced the following condition:\n\nWorker thread A is done with a task, it has not queued yet, but already has seen the pool is still running\nThread B issues a shutdown, when it checks if there is a parked thread to wake up, it does NOT see thread A yet\nThread A finds no tasks, and then parks (possibly forever).\n\nThere were two possible solutions I saw to this problem:\n1) We remove the inner loop optimization.  If we went to the top loop on every try, we would have seen the pool state transitioned before parking.  Or if we already parked then the shutdown would have been for sure able to unpark us.\n2) We find another way to indicate when a worker thread needs to re-check the pool state.\n\nIn this commit I choose option 2, but it was not an easy decision.  While #1 makes things simpler, and #2 adds additional complexity, it was hard to give up any performance gains in favor of option #1 (even if they are super minor).\n\nIn this commit we actually do remove the pool state checking from the task polling loop.  Instead it is checked at the start of workerIdle, then never checked again.  This means that the only way for us to get a thread to exit the task polling loop is to give it a task.\n\nWhen the pool state changes (ie shutdown or size decreased), we ensure that we are able to get the threads out of the polling loop by adding a task that will continue to keep adding itself until the state has been achieved (ie pool size has reached desired levels, or in the case of shutdown until all threads are shutdown).\n\nI don\u0027t particularly like this complexity, as we have to be sure the task keeps re-adding itself (otherwise we can\u0027t be sure all threads have been removed from this loop).  But from a performance side, we have reduced the checking of this state which rarely changes even more than ever before (though you could argue that when these states do change it is now more expensive).\n\n@lwahlmeier and @blendmaster I would like your opinion.  I don\u0027t take adding complexity in this area lightly, and I am sure this is easier for me to reason about since I originally wrote it.  For contrast if we were to take the simpler road we would remove this while loop:\nhttps://github.com/threadly/threadly/blob/master/src/main/java/org/threadly/concurrent/PriorityScheduler.java#L729-L730\n\nIn which case this logic is what would end up being hit much more frequently:\nhttps://github.com/threadly/threadly/blob/master/src/main/java/org/threadly/concurrent/PriorityScheduler.java#L718-L727\n",
    "keywords": [
      "complexity",
      "sure",
      "changes",
      "pool",
      "threads",
      "thread",
      "polling",
      "remove",
      "condition",
      "not",
      "task",
      "size",
      "loop",
      "adding",
      "state",
      "shutdown"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/threadly/threadly/commit/c73d2e58ee9067c1ac179358fb480800e2cbf4eb",
      "files": [
        {
          "file_name": "gradle.properties",
          "patch": "@@ -1,3 +1,3 @@\n group \u003d org.threadly\n-version \u003d 4.6.1\n+version \u003d 4.6.2\n org.gradle.daemon \u003d false"
        },
        {
          "file_name": "pom.xml",
          "patch": "@@ -2,7 +2,7 @@\n   \u003cmodelVersion\u003e4.0.0\u003c/modelVersion\u003e\n   \u003cgroupId\u003eorg.threadly\u003c/groupId\u003e\n   \u003cartifactId\u003ethreadly\u003c/artifactId\u003e\n-  \u003cversion\u003e4.6.0\u003c/version\u003e\n+  \u003cversion\u003e4.6.2\u003c/version\u003e\n   \u003cpackaging\u003ejar\u003c/packaging\u003e\n \n   \u003cname\u003eThreadly\u003c/name\u003e"
        },
        {
          "file_name": "src/main/java/org/threadly/concurrent/PriorityScheduler.java",
          "patch": "@@ -518,13 +518,33 @@ public boolean isShutdownFinished() {\n     public void finishShutdown() {\n       shutdownFinishing \u003d true;\n \n-      /* we only need to wake up the head worker, it will shut itself down.  As the worker \n-       * finishes it will wake up additional idle workers until all idle workers are dead.\n-       */\n-      Worker w \u003d idleWorker.get();\n-      if (w !\u003d null) {\n-        LockSupport.unpark(w.thread);\n-      }\n+      addPoolStateChangeTask(new InternalRunnable() {\n+        @Override\n+        public void run() {\n+          /* as long as we are continuing to run, we need to re-add ourself to ensure \n+           * all threads are able to break out of task poll logic (once shutdown we stay shutdown)\n+           */\n+          addPoolStateChangeTask(this);\n+        }\n+      });\n+    }\n+    \n+    /**\n+     * When ever pool state is changed that is not checked in the pollTask loop (ie shutdown state, \n+     * pool size), a task must be added that is continually added till the desired state is reached.\n+     * \n+     * The purpose of this task is to break worker threads out of the tight loop for polling tasks, \n+     * and instead get them to check the initial logic in {@link #workerIdle(Worker)} again.  This \n+     * is in contrast to putting the logic in the poll task loop, which only incurs a performance \n+     * penalty.\n+     */\n+    private void addPoolStateChangeTask(InternalRunnable task) {\n+      // add to starvable queue, since we only need these tasks to be consumed and ran when there \n+      // is nothing else to run.\n+      queueManager.starvablePriorityQueueSet\n+                  .addExecute(new OneTimeTaskWrapper(task, \n+                                                     queueManager.starvablePriorityQueueSet.executeQueue, \n+                                                     Clock.lastKnownForwardProgressingMillis()));\n     }\n \n     /**\n@@ -587,14 +607,17 @@ public void setPoolSize(int newPoolSize) {\n           // now that pool size increased, start a worker so workers we can for the waiting tasks\n           handleQueueUpdate();\n         } else {\n-          /* we only need to wake up the head worker, it will shut itself down.  As the worker \n-           * finishes it will wake up additional idle workers, and shut down as needed until \n-           * the desired pool size is reached, or until all idle workers are gone.\n-           */\n-          Worker w \u003d idleWorker.get();\n-          if (w !\u003d null) {\n-            LockSupport.unpark(w.thread);\n-          }\n+          addPoolStateChangeTask(new InternalRunnable() {\n+            @Override\n+            public void run() {\n+              /* until the pool has reduced in size, we need to continue to add this task to \n+               * wake threads out of the poll task loop\n+               */\n+              if (currentPoolSize.get() \u003e maxPoolSize) {\n+                addPoolStateChangeTask(this);\n+              }\n+            }\n+          });\n         }\n       }\n     }\n@@ -711,89 +734,94 @@ protected void removeWorkerFromIdleChain(Worker worker) {\n      * @return Task that is ready for immediate execution\n      */\n     public TaskWrapper workerIdle(Worker worker) {\n+      /* pool state checks, if any of these change we need a dummy task added to the queue to \n+       * break out of the task polling loop below.  This is done as an optimization, to avoid \n+       * needing to check these on every loop (since they rarely change)\n+       */\n+      while (true) {\n+        int casPoolSize;\n+        if (shutdownFinishing) {\n+          currentPoolSize.decrementAndGet();\n+          worker.stopIfRunning();\n+          return null;\n+        } else if ((casPoolSize \u003d currentPoolSize.get()) \u003e maxPoolSize) {\n+          if (currentPoolSize.compareAndSet(casPoolSize, casPoolSize - 1)) {\n+            worker.stopIfRunning();\n+            return null;\n+          }\n+        }\n+        // pool state is consistent, we should keep running\n+        break;\n+      }\n+      \n       boolean interruptedChecked \u003d false;\n       boolean queued \u003d false;\n       try {\n-        idle: while (true) {\n-          int casPoolSize;\n-          if (shutdownFinishing) {\n-            currentPoolSize.decrementAndGet();\n-            worker.stopIfRunning();\n-            return null;\n-          } else if ((casPoolSize \u003d currentPoolSize.get()) \u003e maxPoolSize) {\n-            if (currentPoolSize.compareAndSet(casPoolSize, casPoolSize - 1)) {\n-              worker.stopIfRunning();\n-              return null;\n+        while (true) {\n+          TaskWrapper nextTask \u003d queueManager.getNextTask();\n+          if (nextTask \u003d\u003d null) {\n+            if (queued) {\n+              // we can only park after we have queued, then checked again for a result\n+              LockSupport.park();\n+              continue;\n+            } else {\n+              addWorkerToIdleChain(worker);\n+              queued \u003d true;\n             }\n           } else {\n-            // ready to poll task, we loop here to avoid pool state recheck logic unless we have to block\n-            while (true) {\n-              TaskWrapper nextTask \u003d queueManager.getNextTask();\n-              if (nextTask \u003d\u003d null) {\n-                if (queued) {\n+            /* TODO - right now this has a a deficiency where a recurring period task can cut in \n+             * the queue line.  The condition would be as follows:\n+             * \n+             * * Thread 1 gets task to run...task is behind execution schedule, likely due to large queue\n+             * * Thread 2 gets same task\n+             * * Thread 1 gets reference, executes, task execution completes\n+             * * Thread 2 now gets the reference, and execution check and time check pass fine\n+             * * End result is that task has executed twice (on expected schedule), the second \n+             *     execution was unfair since it was done without respects to queue order and \n+             *     other tasks which are also likely behind execution schedule in this example\n+             *     \n+             * This should be very rare, but is possible.  The only way I see to solve this right \n+             * now is to introduce locking.\n+             */\n+            // must get executeReference before time is checked\n+            short executeReference \u003d nextTask.getExecuteReference();\n+            long taskDelay \u003d nextTask.getScheduleDelay();\n+            if (taskDelay \u003e 0) {\n+              if (taskDelay \u003d\u003d Long.MAX_VALUE) {\n+                // the hack at construction/start is to avoid this from causing us to spin here \n+                // if only one recurring task is scheduled (otherwise we would keep pulling \n+                // that task while it\u0027s running)\n+                continue;\n+              }\n+              if (queued) {\n+                if (nextTask.getPureRunTime() \u003c workerTimedParkRunTime) {\n                   // we can only park after we have queued, then checked again for a result\n-                  LockSupport.park();\n-                  continue idle;\n+                  workerTimedParkRunTime \u003d nextTask.getPureRunTime();\n+                  LockSupport.parkNanos(Clock.NANOS_IN_MILLISECOND * taskDelay);\n+                  workerTimedParkRunTime \u003d Long.MAX_VALUE;\n+                  continue;\n                 } else {\n-                  addWorkerToIdleChain(worker);\n-                  queued \u003d true;\n+                  // there is another worker already doing a timed park, so we can wait till woken up\n+                  LockSupport.park();\n+                  continue;\n                 }\n               } else {\n-                /* TODO - right now this has a a deficiency where a recurring period task can cut in \n-                 * the queue line.  The condition would be as follows:\n-                 * \n-                 * * Thread 1 gets task to run...task is behind execution schedule, likely due to large queue\n-                 * * Thread 2 gets same task\n-                 * * Thread 1 gets reference, executes, task execution completes\n-                 * * Thread 2 now gets the reference, and execution check and time check pass fine\n-                 * * End result is that task has executed twice (on expected schedule), the second \n-                 *     execution was unfair since it was done without respects to queue order and \n-                 *     other tasks which are also likely behind execution schedule in this example\n-                 *     \n-                 * This should be very rare, but is possible.  The only way I see to solve this right \n-                 * now is to introduce locking.\n-                 */\n-                // must get executeReference before time is checked\n-                short executeReference \u003d nextTask.getExecuteReference();\n-                long taskDelay \u003d nextTask.getScheduleDelay();\n-                if (taskDelay \u003e 0) {\n-                  if (taskDelay \u003d\u003d Long.MAX_VALUE) {\n-                    // the hack at construction/start is to avoid this from causing us to spin here \n-                    // if only one recurring task is scheduled (otherwise we would keep pulling \n-                    // that task while it\u0027s running)\n-                    continue;\n-                  }\n-                  if (queued) {\n-                    if (nextTask.getPureRunTime() \u003c workerTimedParkRunTime) {\n-                      // we can only park after we have queued, then checked again for a result\n-                      workerTimedParkRunTime \u003d nextTask.getPureRunTime();\n-                      LockSupport.parkNanos(Clock.NANOS_IN_MILLISECOND * taskDelay);\n-                      workerTimedParkRunTime \u003d Long.MAX_VALUE;\n-                      continue idle;\n-                    } else {\n-                      // there is another worker already doing a timed park, so we can wait till woken up\n-                      LockSupport.park();\n-                      continue idle;\n-                    }\n-                  } else {\n-                    addWorkerToIdleChain(worker);\n-                    queued \u003d true;\n-                  }\n-                } else if (nextTask.canExecute(executeReference)) {\n-                  return nextTask;\n-                }\n+                addWorkerToIdleChain(worker);\n+                queued \u003d true;\n               }\n-              // reset interrupted status if we may block and have not checked\n-              if (queued \u0026\u0026 ! interruptedChecked) {\n-                interruptedChecked \u003d true;\n-                if (Thread.interrupted()) {\n-                  // verify we were not interrupted due to pool shutdown\n-                  continue idle;\n-                }\n-              }\n-            } // end pollTask loop\n+            } else if (nextTask.canExecute(executeReference)) {\n+              return nextTask;\n+            }\n+          }\n+          // reset interrupted status if we may block and have not checked\n+          if (queued \u0026\u0026 ! interruptedChecked) {\n+            interruptedChecked \u003d true;\n+            if (Thread.interrupted()) {\n+              // verify we were not interrupted due to pool shutdown\n+              continue;\n+            }\n           }\n-        } // end idle loop\n+        } // end pollTask loop\n       } finally {\n         // if queued, we must now remove ourselves, since worker is about to either shutdown or become active\n         if (queued) {"
        }
      ]
    }
  },
  {
    "name": "Fixed race condition in audio sending causing audio to speed up",
    "url": "https://github.com/DV8FromTheWorld/JDA/pull/388",
    "description": "This should resolve #360 and #357 \r\n\r\nI have asked @Frederikam to test these changes in production.",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/DV8FromTheWorld/JDA/commit/e5f023df8464ba8b3d0c233f7cd8e94c400523ab",
      "files": [
        {
          "file_name": "src/main/java/net/dv8tion/jda/core/audio/AudioConnection.java",
          "patch": "@@ -30,6 +30,7 @@\n import net.dv8tion.jda.core.entities.User;\n import net.dv8tion.jda.core.entities.VoiceChannel;\n import net.dv8tion.jda.core.entities.impl.JDAImpl;\n+import net.dv8tion.jda.core.managers.impl.AudioManagerImpl;\n import net.dv8tion.jda.core.utils.SimpleLog;\n import org.apache.commons.lang3.tuple.Pair;\n import org.json.JSONObject;\n@@ -286,7 +287,7 @@ private synchronized void setupReceiveThread()\n     {\n         if (receiveThread \u003d\u003d null)\n         {\n-            receiveThread \u003d new Thread(threadIdentifier + \" Receiving Thread\")\n+            receiveThread \u003d new Thread(AudioManagerImpl.AUDIO_THREADS, threadIdentifier + \" Receiving Thread\")\n             {\n                 @Override\n                 public void run()\n@@ -414,7 +415,8 @@ private synchronized void setupCombinedExecutor()\n     {\n         if (combinedAudioExecutor \u003d\u003d null)\n         {\n-            combinedAudioExecutor \u003d Executors.newSingleThreadScheduledExecutor( r -\u003e new Thread(r, threadIdentifier + \" Combined Thread\"));\n+            combinedAudioExecutor \u003d Executors.newSingleThreadScheduledExecutor( r -\u003e\n+                    new Thread(AudioManagerImpl.AUDIO_THREADS, r, threadIdentifier + \" Combined Thread\"));\n             combinedAudioExecutor.scheduleAtFixedRate(() -\u003e\n             {\n                 try"
        },
        {
          "file_name": "src/main/java/net/dv8tion/jda/core/audio/AudioWebSocket.java",
          "patch": "@@ -103,6 +103,14 @@ public void send(String message)\n     @Override\n     public void onConnected(WebSocket websocket, Map\u003cString, List\u003cString\u003e\u003e headers)\n     {\n+        if (shutdown)\n+        {\n+            //Somehow this AudioWebSocket was shutdown before we finished connecting....\n+            // thus we just disconnect here since we were asked to shutdown\n+            socket.sendClose(1000);\n+            return;\n+        }\n+\n         JSONObject connectObj \u003d new JSONObject()\n                 .put(\"op\", 0)\n                 .put(\"d\", new JSONObject()\n@@ -133,7 +141,7 @@ public void onTextMessage(WebSocket websocket, String message)\n                 int heartbeatInterval \u003d content.getInt(\"heartbeat_interval\");\n \n                 //Find our external IP and Port using Discord\n-                InetSocketAddress externalIpAndPort \u003d null;\n+                InetSocketAddress externalIpAndPort;\n \n                 changeStatus(ConnectionStatus.CONNECTING_ATTEMPTING_UDP_DISCOVERY);\n                 int tries \u003d 0;\n@@ -235,10 +243,13 @@ public void onDisconnected(WebSocket websocket, WebSocketFrame serverCloseFrame,\n             LOG.debug(\"ClientReason: \" + clientCloseFrame.getCloseReason());\n             LOG.debug(\"ClientCode: \" + clientCloseFrame.getCloseCode());\n             if (clientCloseFrame.getCloseCode() !\u003d 1000)\n+            {\n+                // unexpected close -\u003e error\n                 this.close(ConnectionStatus.ERROR_LOST_CONNECTION);\n+                return;\n+            }\n         }\n-        else\n-            this.close(ConnectionStatus.NOT_CONNECTED);\n+        this.close(ConnectionStatus.NOT_CONNECTED);\n     }\n \n     @Override\n@@ -532,6 +543,16 @@ public void setAutoReconnect(boolean shouldReconnect)\n         this.shouldReconnect \u003d shouldReconnect;\n     }\n \n+    @Override\n+    protected void finalize() throws Throwable\n+    {\n+        if (!shutdown)\n+        {\n+            LOG.fatal(\"Finalization hook of AudioWebSocket was triggered without properly shutting down\");\n+            close(ConnectionStatus.ERROR_LOST_CONNECTION);\n+        }\n+    }\n+\n     public static class KeepAliveThreadFactory implements ThreadFactory\n     {\n         final String identifier;\n@@ -545,7 +566,7 @@ public KeepAliveThreadFactory(JDAImpl api)\n         @Override\n         public Thread newThread(Runnable r)\n         {\n-            Thread t \u003d new Thread(r, identifier + \" - Thread \" + threadCount.getAndIncrement());\n+            Thread t \u003d new Thread(AudioManagerImpl.AUDIO_THREADS, r, identifier + \" - Thread \" + threadCount.getAndIncrement());\n             t.setDaemon(true);\n \n             return t;"
        },
        {
          "file_name": "src/main/java/net/dv8tion/jda/core/audio/factory/DefaultSendSystem.java",
          "patch": "@@ -18,6 +18,7 @@\n \n import net.dv8tion.jda.core.audio.AudioConnection;\n import net.dv8tion.jda.core.entities.Guild;\n+import net.dv8tion.jda.core.managers.impl.AudioManagerImpl;\n \n import java.net.DatagramPacket;\n import java.net.DatagramSocket;\n@@ -46,8 +47,7 @@ public void start()\n         final Guild guild \u003d packetProvider.getConnectedChannel().getGuild();\n         final DatagramSocket udpSocket \u003d packetProvider.getUdpSocket();\n \n-\n-        sendThread \u003d new Thread(packetProvider.getIdentifier() + \" Sending Thread\")\n+        sendThread \u003d new Thread(AudioManagerImpl.AUDIO_THREADS, packetProvider.getIdentifier() + \" Sending Thread\")\n         {\n             @Override\n             public void run()"
        },
        {
          "file_name": "src/main/java/net/dv8tion/jda/core/managers/impl/AudioManagerImpl.java",
          "patch": "@@ -41,6 +41,7 @@\n \n public class AudioManagerImpl implements AudioManager\n {\n+    public static final ThreadGroup AUDIO_THREADS \u003d new ThreadGroup(\"jda-audio\");\n     //These values are set at the bottom of this file.\n     public static boolean AUDIO_SUPPORTED;\n     public static String OPUS_LIB_NAME;"
        }
      ]
    }
  },
  {
    "name": "Parking race condition in threaddump",
    "url": "https://github.com/olivergondza/dumpling/issues/43",
    "description": "`java.lang.AssertionError: RUNNABLE thread declares waitingTo lock` in:\n\n```\n\"Thread name\" daemon prio\u003d10 tid\u003d0x00002b318619b000 nid\u003d0x10ba runnable [0x00002b30bffcc000]\n   java.lang.Thread.State: RUNNABLE\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  \u003c0x0000000404e56c88\u003e (a java.util.concurrent.SynchronousQueue$TransferStack)\n    at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:196)\n    at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:424)\n    at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:323)\n    at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:874)\n    at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:955)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:917)\n    at java.lang.Thread.run(Thread.java:662)\n\n   Locked ownable synchronizers:\n    - None\n```\n",
    "keywords": [
      "threadpoolexecutor",
      "synchronousqueue$transferstack",
      "runnable",
      "java",
      "util",
      "synchronousqueue",
      "concurrent",
      "util concurrent",
      "thread",
      "lang"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/olivergondza/dumpling/commit/340b229a0e051eb343ffa5824dd40517d1fedfc7",
      "files": [
        {
          "file_name": "src/main/java/com/github/olivergondza/dumpling/factory/ThreadDumpFactory.java",
          "patch": "@@ -59,17 +59,17 @@\n public class ThreadDumpFactory implements CliRuntimeFactory {\n \n     private static final StackTraceElement WAIT_TRACE_ELEMENT \u003d StackTrace.nativeElement(\"java.lang.Object\", \"wait\");\n+    private static final StackTraceElement PARK_TRACE_ELEMENT \u003d StackTrace.nativeElement(\"sun.misc.Unsafe\", \"park\");\n \n     private static final String NL \u003d \"(?:\\\\r\\\\n|\\\\n)\";\n     private static final String LOCK_SUBPATTERN \u003d \"\u003c0x(\\\\w+)\u003e \\\\(a ([^\\\\)]+)\\\\)\";\n \n     private static final Pattern THREAD_DELIMITER \u003d Pattern.compile(NL + NL + \"(?!\\\\s)\");\n     private static final Pattern STACK_TRACE_ELEMENT_LINE \u003d Pattern.compile(\" *at (\\\\S+)\\\\.(\\\\S+)\\\\(([^:]+?)(\\\\:\\\\d+)?\\\\)\");\n     private static final Pattern ACQUIRED_LINE \u003d Pattern.compile(\"- locked \" + LOCK_SUBPATTERN);\n-    private static final Pattern WAITING_ON_LINE \u003d Pattern.compile(\"- waiting on \" + LOCK_SUBPATTERN); // In Object.wait()\n     // Oracle/OpenJdk puts unnecessary space after \u0027parking to wait for\u0027\n-    // Omit \u0027waiting on\u0027 as it is not a monitor that blocks the thread\n-    private static final Pattern WAITING_TO_LOCK_LINE \u003d Pattern.compile(\"- (?:waiting to lock|parking to wait for ?) \" + LOCK_SUBPATTERN);\n+    private static final Pattern WAITING_ON_LINE \u003d Pattern.compile(\"- (?:waiting on|parking to wait for ?) \" + LOCK_SUBPATTERN);\n+    private static final Pattern WAITING_TO_LOCK_LINE \u003d Pattern.compile(\"- waiting to lock \" + LOCK_SUBPATTERN);\n     private static final Pattern OWNABLE_SYNCHRONIZER_LINE \u003d Pattern.compile(\"- \" + LOCK_SUBPATTERN);\n     private static final Pattern THREAD_HEADER \u003d Pattern.compile(\n             \"^\\\"(.*)\\\" ([^\\\\n\\\\r]+)(?:\" + NL + \"\\\\s+java.lang.Thread.State: ([^\\\\n\\\\r]+)(?:\" + NL + \"(.+))?)?\",\n@@ -206,9 +206,10 @@ private Builder initLocks(Builder builder, String string) {\n         }\n \n         ThreadStatus status \u003d builder.getThreadStatus();\n+        StackTraceElement innerFrame \u003d builder.getStacktrace().getElement(0);\n \n         // Probably a bug in JVM/jstack but let\u0027s see what we can do\n-        if (waitingOnLock \u003d\u003d null \u0026\u0026 !status.isRunnable() \u0026\u0026 WAIT_TRACE_ELEMENT.equals(builder.getStacktrace().getElement(0))) {\n+        if (waitingOnLock \u003d\u003d null \u0026\u0026 !status.isRunnable() \u0026\u0026 WAIT_TRACE_ELEMENT.equals(innerFrame)) {\n             HashSet\u003cThreadLock\u003e acquiredLocks \u003d new HashSet\u003cThreadLock\u003e(monitors.size());\n             for (Monitor m: monitors) {\n                 acquiredLocks.add(m.getLock());\n@@ -230,6 +231,14 @@ private Builder initLocks(Builder builder, String string) {\n             }\n         }\n \n+        // https://github.com/olivergondza/dumpling/issues/43\n+        if (waitingOnLock !\u003d null \u0026\u0026 status.isRunnable() \u0026\u0026 PARK_TRACE_ELEMENT.equals(innerFrame)) {\n+            // Presumably when entering or leaving the parked state.\n+            // Remove the lock instead of fixing the thread status as there is\n+            // no general way to tell PARKED and PARKED_TIMED apart.\n+            waitingOnLock \u003d null;\n+        }\n+\n         if (waitingToLock !\u003d null \u0026\u0026 !status.isBlocked() \u0026\u0026 !status.isParked()) throw new AssertionError(\n                 status + \" thread declares waitingTo lock:\\n\" + string\n         );"
        },
        {
          "file_name": "src/test/java/com/github/olivergondza/dumpling/factory/ThreadDumpFactoryTest.java",
          "patch": "@@ -28,6 +28,7 @@\n import static com.github.olivergondza.dumpling.model.ProcessThread.nameIs;\n import static org.hamcrest.CoreMatchers.equalTo;\n import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.nullValue;\n import static org.junit.Assert.assertEquals;\n \n import java.io.ByteArrayInputStream;\n@@ -694,6 +695,18 @@ public void parseThreadInObjectWaitThatDoesNotDeclareDesiredMonitor() throws Exc\n         assertThat(timedWaiting.getAcquiredLocks(), Matchers.\u003cThreadLock\u003eempty());\n     }\n \n+    // Presumably this is a bug in certain java 6 versions from Oracle\n+    @Test\n+    public void runnableThreadInUnsafePark() throws Exception {\n+        ThreadSet threads \u003d runtimeFrom(\"runnable_in_unsafe_park.log\").getThreads();\n+        ProcessThread runnable \u003d threads.where(nameIs(\"runnable\")).onlyThread();\n+\n+        assertThat(runnable.getStatus(), equalTo(ThreadStatus.RUNNABLE));\n+        assertThat(runnable.getAcquiredLocks(), Matchers.\u003cThreadLock\u003eempty());\n+        assertThat(runnable.getWaitingOnLock(), nullValue());\n+        assertThat(runnable.getWaitingToLock(), nullValue());\n+    }\n+\n     private ProcessRuntime runtimeFrom(String resource) throws IOException, URISyntaxException {\n         return new ThreadDumpFactory().fromFile(Util.resourceFile(getClass(), resource));\n     }"
        },
        {
          "file_name": "src/test/resources/com/github/olivergondza/dumpling/factory/ThreadDumpFactoryTest/runnable_in_unsafe_park.log",
          "patch": "@@ -0,0 +1,15 @@\n+\"runnable\" daemon prio\u003d10 tid\u003d0x00002b318619b000 nid\u003d0x10ba runnable [0x00002b30bffcc000]\n+   java.lang.Thread.State: RUNNABLE\n+\tat sun.misc.Unsafe.park(Native Method)\n+\t- parking to wait for  \u003c0x0000000404e56c88\u003e (a java.util.concurrent.SynchronousQueue$TransferStack)\n+\tat java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:196)\n+\tat java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:424)\n+\tat java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:323)\n+\tat java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:874)\n+\tat java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:955)\n+\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:917)\n+\tat java.lang.Thread.run(Thread.java:662)\n+\n+   Locked ownable synchronizers:\n+\t- None\n+"
        }
      ]
    }
  },
  {
    "name": "Race condition in ReplicatorInstance append path",
    "url": "https://github.com/cloud-software-foundation/c5/issues/204",
    "description": "It\u0027s currently possible for two consecutive AppendEntries RPCs to be processed out of order by a replicator. The first adds a callback to the replicator\u0027s fiber, but the second can be processed before that callback returns.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/cloud-software-foundation/c5/commit/534fbb047584c319ab38e13b0aad2905e6af9f39",
      "files": [
        {
          "file_name": "c5db/src/main/java/c5db/replication/ReplicatorInstance.java",
          "patch": "@@ -618,38 +618,24 @@ private void doAppendMessage(final Request\u003cRpcWireRequest, RpcReply\u003e request) {\n \n     // 6. if existing entries conflict with new entries, delete all\n     // existing entries starting with first conflicting entry (sec 5.3)\n-    // nb: The process in which we fix the local log may involve a async log operation, so that is entirely\n-    // hidden up in this future.  Note that the process can fail, so we handle that as well.\n-    ListenableFuture\u003cArrayList\u003cLogEntry\u003e\u003e entriesToCommitFuture \u003d validateAndFixLocalLog(appendMessage);\n-    // TODO this method of placing callbacks on the replicator\u0027s fiber can cause race conditions\n-    // TODO since later-received messages can be handled prior to the callback on earlier-received messages\n-    C5Futures.addCallback(entriesToCommitFuture,\n-        (entriesToCommit) -\u003e {\n-          // 7. Append any new entries not already in the log.\n-          ListenableFuture\u003cBoolean\u003e logCommitNotification \u003d log.logEntries(entriesToCommit);\n-          refreshQuorumConfigurationFromLog();\n-\n-          // 8. apply newly committed entries to state machine\n-\n-          // wait for the log to commit before returning message.  But do so async.\n-          C5Futures.addCallback(logCommitNotification,\n-              (result) -\u003e {\n-                appendReply(request, true);\n-\n-                // Notify and mark the last committed index.\n-                long newCommitIndex \u003d Math.min(appendMessage.getCommitIndex(), log.getLastIndex());\n-                setLastCommittedIndex(newCommitIndex);\n-              },\n-              (Throwable t) -\u003e {\n-                // TODO A log commit failure is probably a fatal error. Quit the instance?\n-                // TODO better error reporting. A log commit failure will be a serious issue.\n-                logger.error(\"failure appending new entries to log\", t);\n-                appendReply(request, false);\n-              }, fiber);\n-\n+    // nb: The process in which we fix the local log may involve several async log operations, so that is entirely\n+    // hidden up in these futures.  Note that the process can fail, so we handle that as well.\n+    List\u003cListenableFuture\u003cBoolean\u003e\u003e logOperationFutures \u003d reconcileAppendMessageWithLocalLog(appendMessage);\n+    ListenableFuture\u003cList\u003cBoolean\u003e\u003e bundledLogFuture \u003d Futures.allAsList(logOperationFutures);\n+\n+    // wait for the log to commit before returning message.  But do so async.\n+    C5Futures.addCallback(bundledLogFuture,\n+        (resultList) -\u003e {\n+          appendReply(request, true);\n+\n+          // 8. Signal the client of the Replicator that it can apply newly committed entries to state machine\n+          long newCommitIndex \u003d Math.min(appendMessage.getCommitIndex(), log.getLastIndex());\n+          setLastCommittedIndex(newCommitIndex);\n         },\n         (Throwable t) -\u003e {\n-          logger.error(\"failure validating and fixing local log\", t);\n+          // TODO A log commit failure is probably a fatal error. Quit the instance?\n+          // TODO better error reporting. A log commit failure will be a serious issue.\n+          logger.error(\"failure reconciling received entries with the local log\", t);\n           appendReply(request, false);\n         }, fiber);\n   }\n@@ -676,73 +662,55 @@ private void acknowledgeNewLeader(long theLeader) {\n     );\n   }\n \n-  private ListenableFuture\u003cArrayList\u003cLogEntry\u003e\u003e validateAndFixLocalLog(AppendEntries appendMessage) {\n-    final SettableFuture\u003cArrayList\u003cLogEntry\u003e\u003e future \u003d SettableFuture.create();\n-\n-    validateAndFixLocalLog0(appendMessage, future);\n-    return future;\n-  }\n-\n-  private void validateAndFixLocalLog0(final AppendEntries appendMessage,\n-                                       final SettableFuture\u003cArrayList\u003cLogEntry\u003e\u003e future) {\n+  private List\u003cListenableFuture\u003cBoolean\u003e\u003e reconcileAppendMessageWithLocalLog(AppendEntries appendMessage) {\n+    List\u003cListenableFuture\u003cBoolean\u003e\u003e logOperationFutures \u003d new ArrayList\u003c\u003e();\n \n     // 6. if existing entries conflict with new entries, delete all\n     // existing entries starting with first conflicting entry (sec 5.3)\n \n     long nextIndex \u003d log.getLastIndex() + 1;\n \n-    List\u003cLogEntry\u003e entries \u003d appendMessage.getEntriesList();\n-    ArrayList\u003cLogEntry\u003e entriesToCommit \u003d new ArrayList\u003c\u003e(entries.size());\n-    for (LogEntry entry : entries) {\n+    List\u003cLogEntry\u003e entriesFromMessage \u003d appendMessage.getEntriesList();\n+    List\u003cLogEntry\u003e entriesToCommit \u003d new ArrayList\u003c\u003e(entriesFromMessage.size());\n+\n+    for (LogEntry entry : entriesFromMessage) {\n       long entryIndex \u003d entry.getIndex();\n \n       if (entryIndex \u003d\u003d nextIndex) {\n-        logger.debug(\"new log entry for idx {} term {}\", entryIndex, entry.getTerm());\n-\n         entriesToCommit.add(entry);\n-\n         nextIndex++;\n         continue;\n       }\n \n       if (entryIndex \u003e nextIndex) {\n         // ok this entry is still beyond the LAST entry, so we have a problem:\n-        logger.error(\"log entry missing, I expected {} and the next in the message is {}\",\n-            nextIndex, entryIndex);\n-\n-        future.setException(new Exception(\"Log entry missing\"));\n-        return;\n+        logger.error(\"log entry missing, I expected {} and the next in the message is {}\", nextIndex, entryIndex);\n+        logOperationFutures.add(Futures.immediateFailedFuture(\n+            new Exception(\"Log entry missing from received entries\")));\n+        return logOperationFutures;\n       }\n \n       // at this point entryIndex should be \u003c\u003d log.getLastIndex\n       assert entryIndex \u003c nextIndex;\n \n       if (log.getLogTerm(entryIndex) !\u003d entry.getTerm()) {\n-        // This is generally expected to be fairly uncommon.  To prevent busywaiting on the truncate,\n-        // we basically just redo some work (that ideally shouldn\u0027t be too expensive).\n-\n-        // So after this point, we basically return immediately, with a callback schedule.\n-\n+        // This is generally expected to be fairly uncommon.\n         // conflict:\n         logger.debug(\"log conflict at idx {} my term: {} term from leader: {}, truncating log after this point\",\n             entryIndex, log.getLogTerm(entryIndex), entry.getTerm());\n \n-        // delete this and all subsequent entries:\n-        ListenableFuture\u003cBoolean\u003e truncateResult \u003d log.truncateLog(entryIndex);\n-        C5Futures.addCallback(truncateResult,\n-            (result) -\u003e\n-                // Recurse, which involved a little redo work, but at makes this code easier to reason about.\n-                validateAndFixLocalLog0(appendMessage, future),\n-\n-            (Throwable t) -\u003e {\n-              failReplicatorInstance(t);\n-              future.setException(t); // TODO determine if this is the proper thing to do here?\n-            }, fiber);\n+        // delete this and all subsequent entries from the local log.\n+        logOperationFutures.add(log.truncateLog(entryIndex));\n \n-        return;\n+        entriesToCommit.add(entry);\n+        nextIndex \u003d entryIndex + 1;\n       }\n     }\n-    future.set(entriesToCommit);\n+\n+    // 7. Append any new entries not already in the log.\n+    logOperationFutures.add(log.logEntries(entriesToCommit));\n+    refreshQuorumConfigurationFromLog();\n+    return logOperationFutures;\n   }\n \n   @FiberOnly"
        }
      ]
    }
  },
  {
    "name": "Scheduled delivery count race condition fix",
    "url": "https://github.com/wso2/andes/pull/254",
    "description": "The reason was decrementing scheduled delivery count before sending the message to subscription. After moving the decrement call to finally block in the DeliveryEventHandler#onEvent we did not observe the null pointer exception.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/wso2/andes/commit/dbf7d12b13f199c236e44244a459e9db57e5da8f",
      "files": [
        {
          "file_name": "modules/andes-core/broker/src/main/java/org/wso2/andes/kernel/FlowControlledQueueMessageDeliveryImpl.java",
          "patch": "@@ -91,6 +91,7 @@ public int deliverMessageToSubscriptions(String destination, Set\u003cAndesMessageMet\n                             message.setDestination(localSubscription.getSubscribedDestination());\n                         }\n \n+                        OnflightMessageTracker.getInstance().incrementNumberOfScheduledDeliveries(message.getMessageID());\n                         MessageFlusher.getInstance().deliverMessageAsynchronously(localSubscription, message);\n                         numOfCurrentMsgDeliverySchedules++;\n "
        },
        {
          "file_name": "modules/andes-core/broker/src/main/java/org/wso2/andes/kernel/MessageFlusher.java",
          "patch": "@@ -383,6 +383,7 @@ public int sendMessagesToSubscriptions(String destination, Set\u003cAndesMessageMetad\n      */\n     public void scheduleMessageForSubscription(LocalSubscription subscription,\n                                                final AndesMessageMetadata message) {\n+        OnflightMessageTracker.getInstance().incrementNumberOfScheduledDeliveries(message.getMessageID());\n         deliverMessageAsynchronously(subscription, message);\n     }\n \n@@ -396,7 +397,6 @@ public void deliverMessageAsynchronously(LocalSubscription subscription, AndesMe\n         if(log.isDebugEnabled()) {\n             log.debug(\"Scheduled message id\u003d \" + message.getMessageID() + \" to be sent to subscription\u003d \" + subscription);\n         }\n-        OnflightMessageTracker.getInstance().incrementNumberOfScheduledDeliveries(message.getMessageID());\n         flusherExecutor.submit(subscription, message);\n     }\n "
        },
        {
          "file_name": "modules/andes-core/broker/src/main/java/org/wso2/andes/kernel/NoLossBurstTopicMessageDeliveryImpl.java",
          "patch": "@@ -116,6 +116,7 @@ public int deliverMessageToSubscriptions(String destination, Set\u003cAndesMessageMet\n                     break;\n                 }\n \n+                OnflightMessageTracker.getInstance().incrementNumberOfScheduledDeliveries(message.getMessageID(), subscriptions4Queue.size());\n                 for (int j \u003d 0; j \u003c subscriptions4Queue.size(); j++) {\n                     LocalSubscription localSubscription \u003d MessageFlusher.getInstance()\n                             .findNextSubscriptionToSent(destination, subscriptions4Queue);"
        },
        {
          "file_name": "modules/andes-core/broker/src/main/java/org/wso2/andes/kernel/OnflightMessageTracker.java",
          "patch": "@@ -30,11 +30,13 @@\n import java.io.FileNotFoundException;\n import java.io.FileWriter;\n import java.io.IOException;\n-import java.util.*;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.UUID;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n import java.util.concurrent.atomic.AtomicInteger;\n-import java.util.concurrent.locks.ReentrantReadWriteLock;\n \n /**\n  * This class will track message delivery by broker\n@@ -521,6 +523,28 @@ public int incrementNumberOfScheduledDeliveries(long messageID) {\n     }\n \n     /**\n+     * Increment number of times this message is scheduled to be delivered\n+     * to different subscribers. This value will be equal to the number\n+     * of subscribers expecting the message at that instance.\n+     *\n+     * @param messageID identifier of the message\n+     * @return num of scheduled times after increment\n+     */\n+    public int incrementNumberOfScheduledDeliveries(long messageID ,int count) {\n+        MessageData trackingData \u003d getTrackingData(messageID);\n+        int numOfSchedules \u003d 0;\n+        if (trackingData !\u003d null) {\n+            trackingData.addMessageStatus(MessageStatus.SCHEDULED_TO_SEND);\n+            numOfSchedules \u003d trackingData.numberOfScheduledDeliveries.addAndGet(count);\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"message id\u003d \" + messageID + \" scheduled. Pending to execute\u003d \" + numOfSchedules);\n+            }\n+        }\n+        return numOfSchedules;\n+    }\n+\n+\n+    /**\n      * Decrement number of times this message is scheduled to be delivered.\n      * If message is actually sent to the subscriber this is decreased.\n      *"
        },
        {
          "file_name": "modules/andes-core/broker/src/main/java/org/wso2/andes/kernel/SlowestSubscriberTopicMessageDeliveryImpl.java",
          "patch": "@@ -117,6 +117,8 @@ public int deliverMessageToSubscriptions(String destination, Set\u003cAndesMessageMet\n                     }\n                 }\n                 if (allTopicSubscriptionsHasRoom) {\n+                    OnflightMessageTracker.getInstance().incrementNumberOfScheduledDeliveries(message.getMessageID(), subscriptions4Queue.size());\n+\n                     //schedule message to all subscribers\n                     for (int j \u003d 0; j \u003c subscriptions4Queue.size(); j++) {\n                         LocalSubscription localSubscription \u003d MessageFlusher.getInstance()."
        },
        {
          "file_name": "modules/andes-core/broker/src/main/java/org/wso2/andes/kernel/disruptor/delivery/DeliveryEventHandler.java",
          "patch": "@@ -83,8 +83,6 @@ public void onEvent(DeliveryEventData deliveryEventData, long sequence, boolean\n             AndesMessageMetadata message \u003d deliveryEventData.getMetadata();\n \n             try {\n-                //decrement number of schedule deliveries before send to subscriber to avoid parallel status update issues\n-                OnflightMessageTracker.getInstance().decrementNumberOfScheduledDeliveries(message.getMessageID());\n                 if (deliveryEventData.isErrorOccurred()) {\n                     handleSendError(message);\n                     return;\n@@ -110,10 +108,9 @@ public void onEvent(DeliveryEventData deliveryEventData, long sequence, boolean\n                 }\n             } catch (Throwable e) {\n                 log.error(\"Error while delivering message. Message id \" + message.getMessageID(), e);\n-                //increment above schedule count because exception occurred while send message to subscriber\n-                OnflightMessageTracker.getInstance().incrementNumberOfScheduledDeliveries(message.getMessageID());\n                 handleSendError(message);\n             } finally {\n+                OnflightMessageTracker.getInstance().decrementNumberOfScheduledDeliveries(message.getMessageID());\n                 deliveryEventData.clearData();\n             }\n         }"
        }
      ]
    }
  },
  {
    "name": "System.out tests a running in a race condition",
    "url": "https://github.com/zalando/logbook/issues/29",
    "description": "```\nUsing worker: worker-linux-docker-ba099943.prod.travis-ci.org:travis-linux-1\n\ntravis_fold:start:system_info\n\u001b[0K\u001b[33;1mBuild system information\u001b[0m\nBuild language: java\nBuild group: stable\nBuild dist: precise\n\u001b[34m\u001b[1mBuild image provisioning date and time\u001b[0m\nThu Feb  5 15:09:33 UTC 2015\n\u001b[34m\u001b[1mOperating System Details\u001b[0m\nDistributor ID: Ubuntu\nDescription:    Ubuntu 12.04.5 LTS\nRelease:    12.04\nCodename:   precise\n\u001b[34m\u001b[1mLinux Version\u001b[0m\n3.13.0-29-generic\n\u001b[34m\u001b[1mCookbooks Version\u001b[0m\na68419e https://github.com/travis-ci/travis-cookbooks/tree/a68419e\n\u001b[34m\u001b[1mGCC version\u001b[0m\ngcc (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3\nCopyright (C) 2011 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\n\u001b[34m\u001b[1mLLVM version\u001b[0m\nclang version 3.4 (tags/RELEASE_34/final)\nTarget: x86_64-unknown-linux-gnu\nThread model: posix\n\u001b[34m\u001b[1mPre-installed Ruby versions\u001b[0m\nruby-1.9.3-p551\n\u001b[34m\u001b[1mPre-installed Node.js versions\u001b[0m\nv0.10.36\n\u001b[34m\u001b[1mPre-installed Go versions\u001b[0m\n1.4.1\n\u001b[34m\u001b[1mRedis version\u001b[0m\nredis-server 2.8.19\n\u001b[34m\u001b[1mriak version\u001b[0m\n2.0.2\n\u001b[34m\u001b[1mMongoDB version\u001b[0m\nMongoDB 2.4.12\n\u001b[34m\u001b[1mCouchDB version\u001b[0m\ncouchdb 1.6.1\n\u001b[34m\u001b[1mNeo4j version\u001b[0m\n1.9.4\n\u001b[34m\u001b[1mRabbitMQ Version\u001b[0m\n3.4.3\n\u001b[34m\u001b[1mElasticSearch version\u001b[0m\n1.4.0\n\u001b[34m\u001b[1mInstalled Sphinx versions\u001b[0m\n2.0.10\n2.1.9\n2.2.6\n\u001b[34m\u001b[1mDefault Sphinx version\u001b[0m\n2.2.6\n\u001b[34m\u001b[1mInstalled Firefox version\u001b[0m\nfirefox 31.0esr\n\u001b[34m\u001b[1mPhantomJS version\u001b[0m\n1.9.8\n\u001b[34m\u001b[1mant -version\u001b[0m\nApache Ant(TM) version 1.8.2 compiled on December 3 2011\n\u001b[34m\u001b[1mmvn -version\u001b[0m\nApache Maven 3.2.5 (12a6b3acb947671f09b81f49094c53f426d8cea1; 2014-12-14T17:29:23+00:00)\nMaven home: /usr/local/maven\nJava version: 1.7.0_76, vendor: Oracle Corporation\nJava home: /usr/lib/jvm/java-7-oracle/jre\nDefault locale: en_US, platform encoding: ANSI_X3.4-1968\nOS name: \"linux\", version: \"3.13.0-29-generic\", arch: \"amd64\", family: \"unix\"\ntravis_fold:end:system_info\n\u001b[0K\ntravis_fold:start:git.checkout\n\u001b[0Ktravis_time:start:10220887\n\u001b[0K$ git clone --depth\u003d50 --branch\u003dmaster https://github.com/zalando/logbook.git zalando/logbook\nCloning into \u0027zalando/logbook\u0027...\nremote: Counting objects: 1141, done.\u001b[K\nremote: Compressing objects:   0% (1/353)   \u001b[K\nremote: Compressing objects:   1% (4/353)   \u001b[K\nremote: Compressing objects:   2% (8/353)   \u001b[K\nremote: Compressing objects:   3% (11/353)   \u001b[K\nremote: Compressing objects:   4% (15/353)   \u001b[K\nremote: Compressing objects:   5% (18/353)   \u001b[K\nremote: Compressing objects:   6% (22/353)   \u001b[K\nremote: Compressing objects:   7% (25/353)   \u001b[K\nremote: Compressing objects:   8% (29/353)   \u001b[K\nremote: Compressing objects:   9% (32/353)   \u001b[K\nremote: Compressing objects:  10% (36/353)   \u001b[K\nremote: Compressing objects:  11% (39/353)   \u001b[K\nremote: Compressing objects:  12% (43/353)   \u001b[K\nremote: Compressing objects:  13% (46/353)   \u001b[K\nremote: Compressing objects:  14% (50/353)   \u001b[K\nremote: Compressing objects:  15% (53/353)   \u001b[K\nremote: Compressing objects:  16% (57/353)   \u001b[K\nremote: Compressing objects:  17% (61/353)   \u001b[K\nremote: Compressing objects:  18% (64/353)   \u001b[K\nremote: Compressing objects:  19% (68/353)   \u001b[K\nremote: Compressing objects:  20% (71/353)   \u001b[K\nremote: Compressing objects:  21% (75/353)   \u001b[K\nremote: Compressing objects:  22% (78/353)   \u001b[K\nremote: Compressing objects:  23% (82/353)   \u001b[K\nremote: Compressing objects:  24% (85/353)   \u001b[K\nremote: Compressing objects:  25% (89/353)   \u001b[K\nremote: Compressing objects:  26% (92/353)   \u001b[K\nremote: Compressing objects:  27% (96/353)   \u001b[K\nremote: Compressing objects:  28% (99/353)   \u001b[K\nremote: Compressing objects:  29% (103/353)   \u001b[K\nremote: Compressing objects:  30% (106/353)   \u001b[K\nremote: Compressing objects:  31% (110/353)   \u001b[K\nremote: Compressing objects:  32% (113/353)   \u001b[K\nremote: Compressing objects:  33% (117/353)   \u001b[K\nremote: Compressing objects:  34% (121/353)   \u001b[K\nremote: Compressing objects:  35% (124/353)   \u001b[K\nremote: Compressing objects:  36% (128/353)   \u001b[K\nremote: Compressing objects:  37% (131/353)   \u001b[K\nremote: Compressing objects:  38% (135/353)   \u001b[K\nremote: Compressing objects:  39% (138/353)   \u001b[K\nremote: Compressing objects:  40% (142/353)   \u001b[K\nremote: Compressing objects:  41% (145/353)   \u001b[K\nremote: Compressing objects:  42% (149/353)   \u001b[K\nremote: Compressing objects:  43% (152/353)   \u001b[K\nremote: Compressing objects:  44% (156/353)   \u001b[K\nremote: Compressing objects:  45% (159/353)   \u001b[K\nremote: Compressing objects:  46% (163/353)   \u001b[K\nremote: Compressing objects:  47% (166/353)   \u001b[K\nremote: Compressing objects:  48% (170/353)   \u001b[K\nremote: Compressing objects:  49% (173/353)   \u001b[K\nremote: Compressing objects:  50% (177/353)   \u001b[K\nremote: Compressing objects:  51% (181/353)   \u001b[K\nremote: Compressing objects:  52% (184/353)   \u001b[K\nremote: Compressing objects:  53% (188/353)   \u001b[K\nremote: Compressing objects:  54% (191/353)   \u001b[K\nremote: Compressing objects:  55% (195/353)   \u001b[K\nremote: Compressing objects:  56% (198/353)   \u001b[K\nremote: Compressing objects:  57% (202/353)   \u001b[K\nremote: Compressing objects:  58% (205/353)   \u001b[K\nremote: Compressing objects:  59% (209/353)   \u001b[K\nremote: Compressing objects:  60% (212/353)   \u001b[K\nremote: Compressing objects:  61% (216/353)   \u001b[K\nremote: Compressing objects:  62% (219/353)   \u001b[K\nremote: Compressing objects:  63% (223/353)   \u001b[K\nremote: Compressing objects:  64% (226/353)   \u001b[K\nremote: Compressing objects:  65% (230/353)   \u001b[K\nremote: Compressing objects:  66% (233/353)   \u001b[K\nremote: Compressing objects:  67% (237/353)   \u001b[K\nremote: Compressing objects:  68% (241/353)   \u001b[K\nremote: Compressing objects:  69% (244/353)   \u001b[K\nremote: Compressing objects:  70% (248/353)   \u001b[K\nremote: Compressing objects:  71% (251/353)   \u001b[K\nremote: Compressing objects:  72% (255/353)   \u001b[K\nremote: Compressing objects:  73% (258/353)   \u001b[K\nremote: Compressing objects:  74% (262/353)   \u001b[K\nremote: Compressing objects:  75% (265/353)   \u001b[K\nremote: Compressing objects:  76% (269/353)   \u001b[K\nremote: Compressing objects:  77% (272/353)   \u001b[K\nremote: Compressing objects:  78% (276/353)   \u001b[K\nremote: Compressing objects:  79% (279/353)   \u001b[K\nremote: Compressing objects:  80% (283/353)   \u001b[K\nremote: Compressing objects:  81% (286/353)   \u001b[K\nremote: Compressing objects:  82% (290/353)   \u001b[K\nremote: Compressing objects:  83% (293/353)   \u001b[K\nremote: Compressing objects:  84% (297/353)   \u001b[K\nremote: Compressing objects:  85% (301/353)   \u001b[K\nremote: Compressing objects:  86% (304/353)   \u001b[K\nremote: Compressing objects:  87% (308/353)   \u001b[K\nremote: Compressing objects:  88% (311/353)   \u001b[K\nremote: Compressing objects:  89% (315/353)   \u001b[K\nremote: Compressing objects:  90% (318/353)   \u001b[K\nremote: Compressing objects:  91% (322/353)   \u001b[K\nremote: Compressing objects:  92% (325/353)   \u001b[K\nremote: Compressing objects:  93% (329/353)   \u001b[K\nremote: Compressing objects:  94% (332/353)   \u001b[K\nremote: Compressing objects:  95% (336/353)   \u001b[K\nremote: Compressing objects:  96% (339/353)   \u001b[K\nremote: Compressing objects:  97% (343/353)   \u001b[K\nremote: Compressing objects:  98% (346/353)   \u001b[K\nremote: Compressing objects:  99% (350/353)   \u001b[K\nremote: Compressing objects: 100% (353/353)   \u001b[K\nremote: Compressing objects: 100% (353/353), done.\u001b[K\nReceiving objects:   0% (1/1141)   \nReceiving objects:   1% (12/1141)   \nReceiving objects:   2% (23/1141)   \nReceiving objects:   3% (35/1141)   \nReceiving objects:   4% (46/1141)   \nReceiving objects:   5% (58/1141)   \nReceiving objects:   6% (69/1141)   \nReceiving objects:   7% (80/1141)   \nReceiving objects:   8% (92/1141)   \nReceiving objects:   9% (103/1141)   \nReceiving objects:  10% (115/1141)   \nReceiving objects:  11% (126/1141)   \nReceiving objects:  12% (137/1141)   \nReceiving objects:  13% (149/1141)   \nReceiving objects:  14% (160/1141)   \nReceiving objects:  15% (172/1141)   \nReceiving objects:  16% (183/1141)   \nReceiving objects:  17% (194/1141)   \nReceiving objects:  18% (206/1141)   \nReceiving objects:  19% (217/1141)   \nReceiving objects:  20% (229/1141)   \nReceiving objects:  21% (240/1141)   \nReceiving objects:  22% (252/1141)   \nReceiving objects:  23% (263/1141)   \nReceiving objects:  24% (274/1141)   \nReceiving objects:  25% (286/1141)   \nReceiving objects:  26% (297/1141)   \nReceiving objects:  27% (309/1141)   \nReceiving objects:  28% (320/1141)   \nReceiving objects:  29% (331/1141)   \nReceiving objects:  30% (343/1141)   \nReceiving objects:  31% (354/1141)   \nReceiving objects:  32% (366/1141)   \nReceiving objects:  33% (377/1141)   \nReceiving objects:  34% (388/1141)   \nReceiving objects:  35% (400/1141)   \nReceiving objects:  36% (411/1141)   \nReceiving objects:  37% (423/1141)   \nReceiving objects:  38% (434/1141)   \nReceiving objects:  39% (445/1141)   \nReceiving objects:  40% (457/1141)   \nReceiving objects:  41% (468/1141)   \nReceiving objects:  42% (480/1141)   \nReceiving objects:  43% (491/1141)   \nReceiving objects:  44% (503/1141)   \nReceiving objects:  45% (514/1141)   \nremote: Total 1141 (delta 499), reused 1115 (delta 473), pack-reused 0\u001b[K\nReceiving objects:  46% (525/1141)   \nReceiving objects:  47% (537/1141)   \nReceiving objects:  48% (548/1141)   \nReceiving objects:  49% (560/1141)   \nReceiving objects:  50% (571/1141)   \nReceiving objects:  51% (582/1141)   \nReceiving objects:  52% (594/1141)   \nReceiving objects:  53% (605/1141)   \nReceiving objects:  54% (617/1141)   \nReceiving objects:  55% (628/1141)   \nReceiving objects:  56% (639/1141)   \nReceiving objects:  57% (651/1141)   \nReceiving objects:  58% (662/1141)   \nReceiving objects:  59% (674/1141)   \nReceiving objects:  60% (685/1141)   \nReceiving objects:  61% (697/1141)   \nReceiving objects:  62% (708/1141)   \nReceiving objects:  63% (719/1141)   \nReceiving objects:  64% (731/1141)   \nReceiving objects:  65% (742/1141)   \nReceiving objects:  66% (754/1141)   \nReceiving objects:  67% (765/1141)   \nReceiving objects:  68% (776/1141)   \nReceiving objects:  69% (788/1141)   \nReceiving objects:  70% (799/1141)   \nReceiving objects:  71% (811/1141)   \nReceiving objects:  72% (822/1141)   \nReceiving objects:  73% (833/1141)   \nReceiving objects:  74% (845/1141)   \nReceiving objects:  75% (856/1141)   \nReceiving objects:  76% (868/1141)   \nReceiving objects:  77% (879/1141)   \nReceiving objects:  78% (890/1141)   \nReceiving objects:  79% (902/1141)   \nReceiving objects:  80% (913/1141)   \nReceiving objects:  81% (925/1141)   \nReceiving objects:  82% (936/1141)   \nReceiving objects:  83% (948/1141)   \nReceiving objects:  84% (959/1141)   \nReceiving objects:  85% (970/1141)   \nReceiving objects:  86% (982/1141)   \nReceiving objects:  87% (993/1141)   \nReceiving objects:  88% (1005/1141)   \nReceiving objects:  89% (1016/1141)   \nReceiving objects:  90% (1027/1141)   \nReceiving objects:  91% (1039/1141)   \nReceiving objects:  92% (1050/1141)   \nReceiving objects:  93% (1062/1141)   \nReceiving objects:  94% (1073/1141)   \nReceiving objects:  95% (1084/1141)   \nReceiving objects:  96% (1096/1141)   \nReceiving objects:  97% (1107/1141)   \nReceiving objects:  98% (1119/1141)   \nReceiving objects:  99% (1130/1141)   \nReceiving objects: 100% (1141/1141)   \nReceiving objects: 100% (1141/1141), 264.16 KiB | 0 bytes/s, done.\nResolving deltas:   0% (0/499)   \nResolving deltas:   3% (17/499)   \nResolving deltas:  14% (73/499)   \nResolving deltas:  16% (84/499)   \nResolving deltas:  19% (95/499)   \nResolving deltas:  22% (110/499)   \nResolving deltas:  32% (162/499)   \nResolving deltas:  35% (176/499)   \nResolving deltas:  37% (186/499)   \nResolving deltas:  40% (200/499)   \nResolving deltas:  42% (211/499)   \nResolving deltas:  43% (215/499)   \nResolving deltas:  46% (230/499)   \nResolving deltas:  48% (243/499)   \nResolving deltas:  50% (252/499)   \nResolving deltas:  51% (259/499)   \nResolving deltas:  52% (262/499)   \nResolving deltas:  53% (265/499)   \nResolving deltas:  54% (270/499)   \nResolving deltas:  56% (283/499)   \nResolving deltas:  58% (293/499)   \nResolving deltas:  62% (310/499)   \nResolving deltas:  64% (320/499)   \nResolving deltas:  66% (332/499)   \nResolving deltas:  67% (338/499)   \nResolving deltas:  68% (342/499)   \nResolving deltas:  74% (372/499)   \nResolving deltas:  76% (380/499)   \nResolving deltas:  77% (387/499)   \nResolving deltas:  79% (398/499)   \nResolving deltas:  84% (422/499)   \nResolving deltas:  85% (425/499)   \nResolving deltas:  89% (449/499)   \nResolving deltas:  91% (455/499)   \nResolving deltas:  92% (463/499)   \nResolving deltas:  95% (475/499)   \nResolving deltas:  96% (480/499)   \nResolving deltas:  97% (486/499)   \nResolving deltas:  98% (490/499)   \nResolving deltas: 100% (499/499)   \nResolving deltas: 100% (499/499), done.\nChecking connectivity... done.\ntravis_time:end:10220887:start\u003d1449060473944796183,finish\u003d1449060475166910738,duration\u003d1222114555\n\u001b[0K$ cd zalando/logbook\n$ git checkout -qf 6715757950130814000a6f0293772096b4c7e669\ntravis_fold:end:git.checkout\n\u001b[0K\n\u001b[33;1mThis job is running on container-based infrastructure, which does not allow use of \u0027sudo\u0027, setuid and setguid executables.\u001b[0m\n\u001b[33;1mIf you require sudo, add \u0027sudo: required\u0027 to your .travis.yml\u001b[0m\n\u001b[33;1mSee http://docs.travis-ci.com/user/workers/container-based-infrastructure/ for details.\u001b[0m\n$ jdk_switcher use oraclejdk8\nSwitching to Oracle JDK8 (java-8-oracle), JAVA_HOME will be set to /usr/lib/jvm/java-8-oracle\n$ java -Xmx32m -version\njava version \"1.8.0_31\"\nJava(TM) SE Runtime Environment (build 1.8.0_31-b13)\nJava HotSpot(TM) 64-Bit Server VM (build 25.31-b07, mixed mode)\n$ javac -J-Xmx32m -version\njavac 1.8.0_31\ntravis_fold:start:install\n\u001b[0Ktravis_time:start:067e08bb\n\u001b[0K$ mvn install -DskipTests\u003dtrue -Dmaven.javadoc.skip\u003dtrue -B -V\nJava HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize\u003d192m; support was removed in 8.0\nApache Maven 3.2.5 (12a6b3acb947671f09b81f49094c53f426d8cea1; 2014-12-14T17:29:23+00:00)\nMaven home: /usr/local/maven\nJava version: 1.8.0_31, vendor: Oracle Corporation\nJava home: /usr/lib/jvm/java-8-oracle/jre\nDefault locale: en_US, platform encoding: UTF-8\nOS name: \"linux\", version: \"3.13.0-40-generic\", arch: \"amd64\", family: \"unix\"\n[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO] \n[INFO] Logbook\n[INFO] Logbook: Core\n[INFO] Logbook: HTTP Client\n[INFO] Logbook: Servlet\n[INFO]                                                                         \n[INFO] ------------------------------------------------------------------------\n[INFO] Building Logbook 0.10.0-SNAPSHOT\n[INFO] ------------------------------------------------------------------------\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-install-plugin/2.4/maven-install-plugin-2.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-install-plugin/2.4/maven-install-plugin-2.4.pom (7 KB at 2.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-plugins/23/maven-plugins-23.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-plugins/23/maven-plugins-23.pom (9 KB at 90.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/22/maven-parent-22.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/22/maven-parent-22.pom (30 KB at 468.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/apache/11/apache-11.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/apache/11/apache-11.pom (15 KB at 425.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-install-plugin/2.4/maven-install-plugin-2.4.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-install-plugin/2.4/maven-install-plugin-2.4.jar (27 KB at 774.1 KB/sec)\n[INFO] \n[INFO] --- maven-install-plugin:2.4:install (default-install) @ logbook-parent ---\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-api/2.0.6/maven-plugin-api-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-api/2.0.6/maven-plugin-api-2.0.6.pom (2 KB at 8.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven/2.0.6/maven-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven/2.0.6/maven-2.0.6.pom (9 KB at 276.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/5/maven-parent-5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/5/maven-parent-5.pom (15 KB at 275.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/apache/3/apache-3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/apache/3/apache-3.pom (4 KB at 128.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-project/2.0.6/maven-project-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-project/2.0.6/maven-project-2.0.6.pom (3 KB at 78.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-settings/2.0.6/maven-settings-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-settings/2.0.6/maven-settings-2.0.6.pom (2 KB at 81.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-model/2.0.6/maven-model-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-model/2.0.6/maven-model-2.0.6.pom (3 KB at 124.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.4.1/plexus-utils-1.4.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.4.1/plexus-utils-1.4.1.pom (2 KB at 60.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/1.0.11/plexus-1.0.11.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/1.0.11/plexus-1.0.11.pom (9 KB at 336.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-container-default/1.0-alpha-9-stable-1/plexus-container-default-1.0-alpha-9-stable-1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-container-default/1.0-alpha-9-stable-1/plexus-container-default-1.0-alpha-9-stable-1.pom (4 KB at 154.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-containers/1.0.3/plexus-containers-1.0.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-containers/1.0.3/plexus-containers-1.0.3.pom (492 B at 13.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/1.0.4/plexus-1.0.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/1.0.4/plexus-1.0.4.pom (6 KB at 243.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/junit/junit/3.8.1/junit-3.8.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/junit/junit/3.8.1/junit-3.8.1.pom (998 B at 46.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.0.4/plexus-utils-1.0.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.0.4/plexus-utils-1.0.4.pom (7 KB at 186.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/classworlds/classworlds/1.1-alpha-2/classworlds-1.1-alpha-2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/classworlds/classworlds/1.1-alpha-2/classworlds-1.1-alpha-2.pom (4 KB at 132.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-profile/2.0.6/maven-profile-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-profile/2.0.6/maven-profile-2.0.6.pom (2 KB at 80.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact-manager/2.0.6/maven-artifact-manager-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact-manager/2.0.6/maven-artifact-manager-2.0.6.pom (3 KB at 67.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-repository-metadata/2.0.6/maven-repository-metadata-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-repository-metadata/2.0.6/maven-repository-metadata-2.0.6.pom (2 KB at 86.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact/2.0.6/maven-artifact-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact/2.0.6/maven-artifact-2.0.6.pom (2 KB at 67.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-registry/2.0.6/maven-plugin-registry-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-registry/2.0.6/maven-plugin-registry-2.0.6.pom (2 KB at 44.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0.5/plexus-utils-3.0.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0.5/plexus-utils-3.0.5.pom (3 KB at 87.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/3.1/plexus-3.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/3.1/plexus-3.1.pom (19 KB at 586.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/spice/spice-parent/17/spice-parent-17.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/spice/spice-parent/17/spice-parent-17.pom (7 KB at 235.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/forge/forge-parent/10/forge-parent-10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/forge/forge-parent/10/forge-parent-10.pom (14 KB at 456.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-digest/1.0/plexus-digest-1.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-digest/1.0/plexus-digest-1.0.pom (2 KB at 45.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-components/1.1.7/plexus-components-1.1.7.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-components/1.1.7/plexus-components-1.1.7.pom (5 KB at 211.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/1.0.8/plexus-1.0.8.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/1.0.8/plexus-1.0.8.pom (8 KB at 261.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-container-default/1.0-alpha-8/plexus-container-default-1.0-alpha-8.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-container-default/1.0-alpha-8/plexus-container-default-1.0-alpha-8.pom (8 KB at 221.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/junit/junit/3.8.1/junit-3.8.1.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0.5/plexus-utils-3.0.5.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-digest/1.0/plexus-digest-1.0.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/junit/junit/3.8.1/junit-3.8.1.jar (119 KB at 1170.6 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-digest/1.0/plexus-digest-1.0.jar (12 KB at 115.8 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0.5/plexus-utils-3.0.5.jar (226 KB at 1148.2 KB/sec)\n[INFO] Installing /home/travis/build/zalando/logbook/pom.xml to /home/travis/.m2/repository/org/zalando/logbook-parent/0.10.0-SNAPSHOT/logbook-parent-0.10.0-SNAPSHOT.pom\n[INFO]                                                                         \n[INFO] ------------------------------------------------------------------------\n[INFO] Building Logbook: Core 0.10.0-SNAPSHOT\n[INFO] ------------------------------------------------------------------------\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/jacoco/jacoco-maven-plugin/0.7.5.201505241946/jacoco-maven-plugin-0.7.5.201505241946.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/jacoco/jacoco-maven-plugin/0.7.5.201505241946/jacoco-maven-plugin-0.7.5.201505241946.pom (4 KB at 154.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.build/0.7.5.201505241946/org.jacoco.build-0.7.5.201505241946.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.build/0.7.5.201505241946/org.jacoco.build-0.7.5.201505241946.pom (36 KB at 1046.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/jacoco/jacoco-maven-plugin/0.7.5.201505241946/jacoco-maven-plugin-0.7.5.201505241946.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/jacoco/jacoco-maven-plugin/0.7.5.201505241946/jacoco-maven-plugin-0.7.5.201505241946.jar (50 KB at 1246.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/mojo/license-maven-plugin/1.8/license-maven-plugin-1.8.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/mojo/license-maven-plugin/1.8/license-maven-plugin-1.8.pom (18 KB at 590.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/mojo/mojo-parent/33/mojo-parent-33.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/mojo/mojo-parent/33/mojo-parent-33.pom (26 KB at 711.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/codehaus-parent/4/codehaus-parent-4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/codehaus-parent/4/codehaus-parent-4.pom (5 KB at 162.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/mojo/license-maven-plugin/1.8/license-maven-plugin-1.8.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/mojo/license-maven-plugin/1.8/license-maven-plugin-1.8.jar (260 KB at 2340.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-resources-plugin/2.7/maven-resources-plugin-2.7.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-resources-plugin/2.7/maven-resources-plugin-2.7.pom (8 KB at 327.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-plugins/25/maven-plugins-25.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-plugins/25/maven-plugins-25.pom (10 KB at 358.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/24/maven-parent-24.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/24/maven-parent-24.pom (37 KB at 343.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/apache/14/apache-14.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/apache/14/apache-14.pom (15 KB at 341.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-resources-plugin/2.7/maven-resources-plugin-2.7.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-resources-plugin/2.7/maven-resources-plugin-2.7.jar (31 KB at 991.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-compiler-plugin/3.3/maven-compiler-plugin-3.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-compiler-plugin/3.3/maven-compiler-plugin-3.3.pom (12 KB at 276.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-plugins/27/maven-plugins-27.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-plugins/27/maven-plugins-27.pom (12 KB at 396.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/26/maven-parent-26.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/26/maven-parent-26.pom (39 KB at 1177.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/apache/16/apache-16.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/apache/16/apache-16.pom (16 KB at 537.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-compiler-plugin/3.3/maven-compiler-plugin-3.3.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-compiler-plugin/3.3/maven-compiler-plugin-3.3.jar (46 KB at 151.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-surefire-plugin/2.16/maven-surefire-plugin-2.16.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-surefire-plugin/2.16/maven-surefire-plugin-2.16.pom (5 KB at 152.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire/2.16/surefire-2.16.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire/2.16/surefire-2.16.pom (19 KB at 563.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-surefire-plugin/2.16/maven-surefire-plugin-2.16.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-surefire-plugin/2.16/maven-surefire-plugin-2.16.jar (34 KB at 897.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-jar-plugin/2.4/maven-jar-plugin-2.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-jar-plugin/2.4/maven-jar-plugin-2.4.pom (6 KB at 142.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-plugins/22/maven-plugins-22.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-plugins/22/maven-plugins-22.pom (13 KB at 363.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/21/maven-parent-21.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/21/maven-parent-21.pom (26 KB at 504.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/apache/10/apache-10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/apache/10/apache-10.pom (15 KB at 481.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-jar-plugin/2.4/maven-jar-plugin-2.4.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-jar-plugin/2.4/maven-jar-plugin-2.4.jar (34 KB at 772.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/google/code/findbugs/jsr305/3.0.0/jsr305-3.0.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/google/code/findbugs/jsr305/3.0.0/jsr305-3.0.0.pom (4 KB at 139.4 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/google/gag/gag/1.0.1/gag-1.0.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/google/gag/gag/1.0.1/gag-1.0.1.pom (2 KB at 40.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/google/guava/guava/18.0/guava-18.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/google/guava/guava/18.0/guava-18.0.pom (6 KB at 85.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/google/guava/guava-parent/18.0/guava-parent-18.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/google/guava/guava-parent/18.0/guava-parent-18.0.pom (8 KB at 278.0 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/sonatype/oss/oss-parent/7/oss-parent-7.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/sonatype/oss/oss-parent/7/oss-parent-7.pom (5 KB at 224.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.7.13/slf4j-api-1.7.13.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.7.13/slf4j-api-1.7.13.pom (3 KB at 117.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-parent/1.7.13/slf4j-parent-1.7.13.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-parent/1.7.13/slf4j-parent-1.7.13.pom (14 KB at 571.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/projectlombok/lombok/1.16.6/lombok-1.16.6.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/projectlombok/lombok/1.16.6/lombok-1.16.6.pom (2 KB at 69.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.6.1/jackson-databind-2.6.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.6.1/jackson-databind-2.6.1.pom (6 KB at 271.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/jackson-parent/2.6.1/jackson-parent-2.6.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/jackson-parent/2.6.1/jackson-parent-2.6.1.pom (8 KB at 380.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/oss-parent/23/oss-parent-23.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/oss-parent/23/oss-parent-23.pom (19 KB at 697.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-annotations/2.6.0/jackson-annotations-2.6.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-annotations/2.6.0/jackson-annotations-2.6.0.pom (2 KB at 56.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-core/2.6.1/jackson-core-2.6.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-core/2.6.1/jackson-core-2.6.1.pom (5 KB at 196.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/junit/junit/4.12/junit-4.12.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/junit/junit/4.12/junit-4.12.pom (24 KB at 1101.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/github/stefanbirkner/system-rules/1.12.1/system-rules-1.12.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/github/stefanbirkner/system-rules/1.12.1/system-rules-1.12.1.pom (3 KB at 81.3 KB/sec)\n[INFO] Downloading: https://repository.apache.org/releases/junit/junit-dep/maven-metadata.xml\n[INFO] Downloading: https://oss.sonatype.org/content/repositories/releases/junit/junit-dep/maven-metadata.xml\n[INFO] Downloading: http://repo.maven.apache.org/maven2/junit/junit-dep/maven-metadata.xml\n[INFO] Downloading: https://oss.sonatype.org/content/repositories/snapshots/junit/junit-dep/maven-metadata.xml\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/junit/junit-dep/maven-metadata.xml (563 B at 14.9 KB/sec)\n[INFO] Downloading: https://repository.apache.org/snapshots/junit/junit-dep/maven-metadata.xml\n[INFO] Downloading: https://nexus.codehaus.org/snapshots/junit/junit-dep/maven-metadata.xml\n[INFO] Downloaded: https://oss.sonatype.org/content/repositories/releases/junit/junit-dep/maven-metadata.xml (563 B at 2.3 KB/sec)\n[WARNING] Could not transfer metadata junit:junit-dep/maven-metadata.xml from/to codehaus-snapshots (https://nexus.codehaus.org/snapshots/): nexus.codehaus.org: unknown error\n[INFO] Downloading: http://repo.maven.apache.org/maven2/junit/junit-dep/4.9/junit-dep-4.9.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/junit/junit-dep/4.9/junit-dep-4.9.pom (3 KB at 109.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-core/1.1/hamcrest-core-1.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-core/1.1/hamcrest-core-1.1.pom (481 B at 23.5 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-parent/1.1/hamcrest-parent-1.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-parent/1.1/hamcrest-parent-1.1.pom (6 KB at 249.5 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/junit/junit-dep/4.10/junit-dep-4.10.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/junit/junit-dep/4.10/junit-dep-4.10.pom (3 KB at 114.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/junit/junit-dep/4.11-beta-1/junit-dep-4.11-beta-1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/junit/junit-dep/4.11-beta-1/junit-dep-4.11-beta-1.pom (2 KB at 90.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/junit/junit/4.11-beta-1/junit-4.11-beta-1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/junit/junit/4.11-beta-1/junit-4.11-beta-1.pom (3 KB at 99.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.pom (766 B at 37.4 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-parent/1.3/hamcrest-parent-1.3.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-parent/1.3/hamcrest-parent-1.3.pom (2 KB at 96.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-io/commons-io/maven-metadata.xml\n[INFO] Downloading: https://oss.sonatype.org/content/repositories/releases/commons-io/commons-io/maven-metadata.xml\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-io/commons-io/maven-metadata.xml (725 B at 26.2 KB/sec)\n[INFO] Downloading: https://oss.sonatype.org/content/repositories/snapshots/commons-io/commons-io/maven-metadata.xml\n[INFO] Downloading: https://repository.apache.org/snapshots/commons-io/commons-io/maven-metadata.xml\n[INFO] Downloading: https://repository.apache.org/releases/commons-io/commons-io/maven-metadata.xml\n[INFO] Downloading: https://nexus.codehaus.org/snapshots/commons-io/commons-io/maven-metadata.xml\n[INFO] Downloaded: https://repository.apache.org/snapshots/commons-io/commons-io/maven-metadata.xml (350 B at 0.6 KB/sec)\n[WARNING] Could not transfer metadata commons-io:commons-io/maven-metadata.xml from/to codehaus-snapshots (https://nexus.codehaus.org/snapshots/): nexus.codehaus.org\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.0/commons-io-2.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.0/commons-io-2.0.pom (9 KB at 442.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/15/commons-parent-15.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/15/commons-parent-15.pom (31 KB at 1406.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/apache/7/apache-7.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/apache/7/apache-7.pom (15 KB at 741.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.0.1/commons-io-2.0.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.0.1/commons-io-2.0.1.pom (9 KB at 439.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.1/commons-io-2.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.1/commons-io-2.1.pom (11 KB at 546.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/22/commons-parent-22.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/22/commons-parent-22.pom (41 KB at 2046.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/apache/9/apache-9.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/apache/9/apache-9.pom (15 KB at 740.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.2/commons-io-2.2.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.2/commons-io-2.2.pom (11 KB at 538.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/24/commons-parent-24.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/24/commons-parent-24.pom (47 KB at 2006.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.3/commons-io-2.3.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.3/commons-io-2.3.pom (11 KB at 567.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.4/commons-io-2.4.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.4/commons-io-2.4.pom (10 KB at 522.5 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/25/commons-parent-25.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/25/commons-parent-25.pom (48 KB at 2482.7 KB/sec)\n[INFO] Downloading: https://nexus.codehaus.org/snapshots/commons-io/commons-io/2.5-SNAPSHOT/maven-metadata.xml\n[INFO] Downloading: https://oss.sonatype.org/content/repositories/snapshots/commons-io/commons-io/2.5-SNAPSHOT/maven-metadata.xml\n[INFO] Downloading: https://repository.apache.org/snapshots/commons-io/commons-io/2.5-SNAPSHOT/maven-metadata.xml\n[INFO] Downloaded: https://repository.apache.org/snapshots/commons-io/commons-io/2.5-SNAPSHOT/maven-metadata.xml (3 KB at 4.0 KB/sec)\n[WARNING] Could not transfer metadata commons-io:commons-io:2.5-SNAPSHOT/maven-metadata.xml from/to codehaus-snapshots (https://nexus.codehaus.org/snapshots/): nexus.codehaus.org\n[WARNING] Failure to transfer commons-io:commons-io:2.5-SNAPSHOT/maven-metadata.xml from https://nexus.codehaus.org/snapshots/ was cached in the local repository, resolution will not be reattempted until the update interval of codehaus-snapshots has elapsed or updates are forced. Original error: Could not transfer metadata commons-io:commons-io:2.5-SNAPSHOT/maven-metadata.xml from/to codehaus-snapshots (https://nexus.codehaus.org/snapshots/): nexus.codehaus.org\n[INFO] Downloading: https://oss.sonatype.org/content/repositories/snapshots/commons-io/commons-io/2.5-SNAPSHOT/commons-io-2.5-20151119.212356-154.pom\n[INFO] Downloading: https://repository.apache.org/snapshots/commons-io/commons-io/2.5-SNAPSHOT/commons-io-2.5-20151119.212356-154.pom\n[INFO] Downloaded: https://repository.apache.org/snapshots/commons-io/commons-io/2.5-SNAPSHOT/commons-io-2.5-20151119.212356-154.pom (13 KB at 22.0 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/39/commons-parent-39.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/39/commons-parent-39.pom (61 KB at 2241.6 KB/sec)\n[INFO] Downloading: https://oss.sonatype.org/content/repositories/snapshots/commons-io/commons-io/2.6-SNAPSHOT/maven-metadata.xml\n[INFO] Downloading: https://repository.apache.org/snapshots/commons-io/commons-io/2.6-SNAPSHOT/maven-metadata.xml\n[INFO] Downloading: https://nexus.codehaus.org/snapshots/commons-io/commons-io/2.6-SNAPSHOT/maven-metadata.xml\n[INFO] Downloaded: https://repository.apache.org/snapshots/commons-io/commons-io/2.6-SNAPSHOT/maven-metadata.xml (3 KB at 3.5 KB/sec)\n[WARNING] Could not transfer metadata commons-io:commons-io:2.6-SNAPSHOT/maven-metadata.xml from/to codehaus-snapshots (https://nexus.codehaus.org/snapshots/): nexus.codehaus.org\n[WARNING] Failure to transfer commons-io:commons-io:2.6-SNAPSHOT/maven-metadata.xml from https://nexus.codehaus.org/snapshots/ was cached in the local repository, resolution will not be reattempted until the update interval of codehaus-snapshots has elapsed or updates are forced. Original error: Could not transfer metadata commons-io:commons-io:2.6-SNAPSHOT/maven-metadata.xml from/to codehaus-snapshots (https://nexus.codehaus.org/snapshots/): nexus.codehaus.org\n[INFO] Downloading: https://oss.sonatype.org/content/repositories/snapshots/commons-io/commons-io/2.6-SNAPSHOT/commons-io-2.6-20151126.182804-8.pom\n[INFO] Downloading: https://repository.apache.org/snapshots/commons-io/commons-io/2.6-SNAPSHOT/commons-io-2.6-20151126.182804-8.pom\n[INFO] Downloaded: https://repository.apache.org/snapshots/commons-io/commons-io/2.6-SNAPSHOT/commons-io-2.6-20151126.182804-8.pom (13 KB at 21.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-simple/1.7.13/slf4j-simple-1.7.13.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-simple/1.7.13/slf4j-simple-1.7.13.pom (793 B at 23.5 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-junit/2.0.0.0/hamcrest-junit-2.0.0.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-junit/2.0.0.0/hamcrest-junit-2.0.0.0.pom (2 KB at 71.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hamcrest/java-hamcrest/2.0.0.0/java-hamcrest-2.0.0.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hamcrest/java-hamcrest/2.0.0.0/java-hamcrest-2.0.0.0.pom (2 KB at 61.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hobsoft/hamcrest/hamcrest-compose/0.3.0/hamcrest-compose-0.3.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hobsoft/hamcrest/hamcrest-compose/0.3.0/hamcrest-compose-0.3.0.pom (2 KB at 36.0 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hobsoft/hamcrest/hamcrest-compose-parent/0.3.0/hamcrest-compose-parent-0.3.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hobsoft/hamcrest/hamcrest-compose-parent/0.3.0/hamcrest-compose-parent-0.3.0.pom (5 KB at 220.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hobsoft/hobsoft-parent/0.1.3/hobsoft-parent-0.1.3.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hobsoft/hobsoft-parent/0.1.3/hobsoft-parent-0.1.3.pom (7 KB at 343.5 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/mockito/mockito-core/2.0.31-beta/mockito-core-2.0.31-beta.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/mockito/mockito-core/2.0.31-beta/mockito-core-2.0.31-beta.pom (2 KB at 68.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/net/bytebuddy/byte-buddy/0.6.14/byte-buddy-0.6.14.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/net/bytebuddy/byte-buddy/0.6.14/byte-buddy-0.6.14.pom (10 KB at 403.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/net/bytebuddy/byte-buddy-parent/0.6.14/byte-buddy-parent-0.6.14.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/net/bytebuddy/byte-buddy-parent/0.6.14/byte-buddy-parent-0.6.14.pom (17 KB at 438.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/objenesis/objenesis/2.1/objenesis-2.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/objenesis/objenesis/2.1/objenesis-2.1.pom (3 KB at 95.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/objenesis/objenesis-parent/2.1/objenesis-parent-2.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/objenesis/objenesis-parent/2.1/objenesis-parent-2.1.pom (17 KB at 776.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path-assert/2.0.0/json-path-assert-2.0.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path-assert/2.0.0/json-path-assert-2.0.0.pom (2 KB at 58.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.7.10/slf4j-api-1.7.10.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.7.10/slf4j-api-1.7.10.pom (3 KB at 136.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-parent/1.7.10/slf4j-parent-1.7.10.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-parent/1.7.10/slf4j-parent-1.7.10.pom (13 KB at 624.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path/2.0.0/json-path-2.0.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path/2.0.0/json-path-2.0.0.pom (2 KB at 92.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/net/minidev/json-smart/2.1.1/json-smart-2.1.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/net/minidev/json-smart/2.1.1/json-smart-2.1.1.pom (3 KB at 98.0 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/net/minidev/parent/2.1.0/parent-2.1.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/net/minidev/parent/2.1.0/parent-2.1.0.pom (9 KB at 443.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/net/minidev/asm/1.0.2/asm-1.0.2.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/net/minidev/asm/1.0.2/asm-1.0.2.pom (2 KB at 87.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/asm/asm/3.3.1/asm-3.3.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/asm/asm/3.3.1/asm-3.3.1.pom (266 B at 13.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/asm/asm-parent/3.3.1/asm-parent-3.3.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/asm/asm-parent/3.3.1/asm-parent-3.3.1.pom (5 KB at 192.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-library/1.3/hamcrest-library-1.3.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-library/1.3/hamcrest-library-1.3.pom (820 B at 36.4 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/google/code/findbugs/jsr305/3.0.0/jsr305-3.0.0.jar\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/google/gag/gag/1.0.1/gag-1.0.1.jar\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/google/guava/guava/18.0/guava-18.0.jar\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.7.13/slf4j-api-1.7.13.jar\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/projectlombok/lombok/1.16.6/lombok-1.16.6.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/google/gag/gag/1.0.1/gag-1.0.1.jar (43 KB at 1362.4 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.6.1/jackson-databind-2.6.1.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/google/code/findbugs/jsr305/3.0.0/jsr305-3.0.0.jar (33 KB at 750.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-annotations/2.6.0/jackson-annotations-2.6.0.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.7.13/slf4j-api-1.7.13.jar (33 KB at 718.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-core/2.6.1/jackson-core-2.6.1.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-annotations/2.6.0/jackson-annotations-2.6.0.jar (46 KB at 777.4 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/junit/junit/4.12/junit-4.12.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-core/2.6.1/jackson-core-2.6.1.jar (253 KB at 3199.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/github/stefanbirkner/system-rules/1.12.1/system-rules-1.12.1.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.6.1/jackson-databind-2.6.1.jar (1140 KB at 12382.0 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-simple/1.7.13/slf4j-simple-1.7.13.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/github/stefanbirkner/system-rules/1.12.1/system-rules-1.12.1.jar (31 KB at 300.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-junit/2.0.0.0/hamcrest-junit-2.0.0.0.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/junit/junit/4.12/junit-4.12.jar (308 KB at 3045.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hamcrest/java-hamcrest/2.0.0.0/java-hamcrest-2.0.0.0.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/projectlombok/lombok/1.16.6/lombok-1.16.6.jar (1344 KB at 9806.0 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hobsoft/hamcrest/hamcrest-compose/0.3.0/hamcrest-compose-0.3.0.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-simple/1.7.13/slf4j-simple-1.7.13.jar (11 KB at 78.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/mockito/mockito-core/2.0.31-beta/mockito-core-2.0.31-beta.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/google/guava/guava/18.0/guava-18.0.jar (2204 KB at 14495.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/net/bytebuddy/byte-buddy/0.6.14/byte-buddy-0.6.14.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hamcrest/java-hamcrest/2.0.0.0/java-hamcrest-2.0.0.0.jar (111 KB at 776.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/objenesis/objenesis/2.1/objenesis-2.1.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-junit/2.0.0.0/hamcrest-junit-2.0.0.0.jar (15 KB at 98.0 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path-assert/2.0.0/json-path-assert-2.0.0.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hobsoft/hamcrest/hamcrest-compose/0.3.0/hamcrest-compose-0.3.0.jar (7 KB at 45.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path-assert/2.0.0/json-path-assert-2.0.0.jar (11 KB at 61.4 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path/2.0.0/json-path-2.0.0.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/objenesis/objenesis/2.1/objenesis-2.1.jar (41 KB at 235.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/net/minidev/json-smart/2.1.1/json-smart-2.1.1.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar (44 KB at 251.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/net/minidev/asm/1.0.2/asm-1.0.2.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/mockito/mockito-core/2.0.31-beta/mockito-core-2.0.31-beta.jar (730 KB at 3719.4 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/asm/asm/3.3.1/asm-3.3.1.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/net/minidev/asm/1.0.2/asm-1.0.2.jar (71 KB at 345.2 KB/sec)\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/net/minidev/json-smart/2.1.1/json-smart-2.1.1.jar (122 KB at 595.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-library/1.3/hamcrest-library-1.3.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path/2.0.0/json-path-2.0.0.jar (134 KB at 653.7 KB/sec)\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/net/bytebuddy/byte-buddy/0.6.14/byte-buddy-0.6.14.jar (1419 KB at 6600.0 KB/sec)\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/asm/asm/3.3.1/asm-3.3.1.jar (43 KB at 190.9 KB/sec)\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-library/1.3/hamcrest-library-1.3.jar (52 KB at 223.4 KB/sec)\n[INFO] Downloading: https://repository.apache.org/snapshots/commons-io/commons-io/2.6-SNAPSHOT/commons-io-2.6-20151126.182804-8.jar\n[INFO] Downloaded: https://repository.apache.org/snapshots/commons-io/commons-io/2.6-SNAPSHOT/commons-io-2.6-20151126.182804-8.jar (204 KB at 204.8 KB/sec)\n[INFO] \n[INFO] --- jacoco-maven-plugin:0.7.5.201505241946:prepare-agent (prepare-agent) @ logbook-core ---\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-api/2.2.1/maven-plugin-api-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-api/2.2.1/maven-plugin-api-2.2.1.pom (2 KB at 20.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven/2.2.1/maven-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven/2.2.1/maven-2.2.1.pom (22 KB at 705.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/11/maven-parent-11.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/11/maven-parent-11.pom (32 KB at 989.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/apache/5/apache-5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/apache/5/apache-5.pom (5 KB at 153.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-project/2.2.1/maven-project-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-project/2.2.1/maven-project-2.2.1.pom (3 KB at 112.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-settings/2.2.1/maven-settings-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-settings/2.2.1/maven-settings-2.2.1.pom (3 KB at 106.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-model/2.2.1/maven-model-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-model/2.2.1/maven-model-2.2.1.pom (4 KB at 150.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.15/plexus-utils-1.5.15.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.15/plexus-utils-1.5.15.pom (7 KB at 318.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/2.0.2/plexus-2.0.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/2.0.2/plexus-2.0.2.pom (12 KB at 515.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.11/plexus-interpolation-1.11.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.11/plexus-interpolation-1.11.pom (889 B at 43.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-components/1.1.14/plexus-components-1.1.14.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-components/1.1.14/plexus-components-1.1.14.pom (6 KB at 178.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/junit/junit/4.8.2/junit-4.8.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/junit/junit/4.8.2/junit-4.8.2.pom (2 KB at 68.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-profile/2.2.1/maven-profile-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-profile/2.2.1/maven-profile-2.2.1.pom (3 KB at 101.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact-manager/2.2.1/maven-artifact-manager-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact-manager/2.2.1/maven-artifact-manager-2.2.1.pom (4 KB at 89.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-repository-metadata/2.2.1/maven-repository-metadata-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-repository-metadata/2.2.1/maven-repository-metadata-2.2.1.pom (2 KB at 91.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact/2.2.1/maven-artifact-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact/2.2.1/maven-artifact-2.2.1.pom (2 KB at 73.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/backport-util-concurrent/backport-util-concurrent/3.1/backport-util-concurrent-3.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/backport-util-concurrent/backport-util-concurrent/3.1/backport-util-concurrent-3.1.pom (880 B at 26.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-registry/2.2.1/maven-plugin-registry-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-registry/2.2.1/maven-plugin-registry-2.2.1.pom (2 KB at 85.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.6/plexus-utils-1.5.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.6/plexus-utils-1.5.6.pom (6 KB at 215.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/1.0.12/plexus-1.0.12.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/1.0.12/plexus-1.0.12.pom (10 KB at 308.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/file-management/1.2.1/file-management-1.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/file-management/1.2.1/file-management-1.2.1.pom (4 KB at 164.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/10/maven-shared-components-10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/10/maven-shared-components-10.pom (9 KB at 374.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/9/maven-parent-9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/9/maven-parent-9.pom (33 KB at 782.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/apache/4/apache-4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/apache/4/apache-4.pom (5 KB at 175.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-io/1.1/maven-shared-io-1.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-io/1.1/maven-shared-io-1.1.pom (4 KB at 188.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/8/maven-shared-components-8.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/8/maven-shared-components-8.pom (3 KB at 108.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/7/maven-parent-7.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/7/maven-parent-7.pom (21 KB at 768.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact/2.0.2/maven-artifact-2.0.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact/2.0.2/maven-artifact-2.0.2.pom (765 B at 35.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven/2.0.2/maven-2.0.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven/2.0.2/maven-2.0.2.pom (13 KB at 559.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.1/plexus-utils-1.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.1/plexus-utils-1.1.pom (767 B at 32.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact-manager/2.0.2/maven-artifact-manager-2.0.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact-manager/2.0.2/maven-artifact-manager-2.0.2.pom (2 KB at 59.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-repository-metadata/2.0.2/maven-repository-metadata-2.0.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-repository-metadata/2.0.2/maven-repository-metadata-2.0.2.pom (2 KB at 67.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-container-default/1.0-alpha-9/plexus-container-default-1.0-alpha-9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-container-default/1.0-alpha-9/plexus-container-default-1.0-alpha-9.pom (2 KB at 63.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/wagon/wagon-provider-api/1.0-alpha-6/wagon-provider-api-1.0-alpha-6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/wagon/wagon-provider-api/1.0-alpha-6/wagon-provider-api-1.0-alpha-6.pom (588 B at 23.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/wagon/wagon/1.0-alpha-6/wagon-1.0-alpha-6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/wagon/wagon/1.0-alpha-6/wagon-1.0-alpha-6.pom (7 KB at 250.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.4.6/plexus-utils-1.4.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.4.6/plexus-utils-1.4.6.pom (3 KB at 96.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/2.2.1/maven-reporting-api-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/2.2.1/maven-reporting-api-2.2.1.pom (2 KB at 67.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting/2.2.1/maven-reporting-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting/2.2.1/maven-reporting-2.2.1.pom (2 KB at 54.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.1/doxia-sink-api-1.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.1/doxia-sink-api-1.1.pom (2 KB at 94.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.1/doxia-1.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.1/doxia-1.1.pom (15 KB at 592.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.1/doxia-logging-api-1.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.1/doxia-logging-api-1.1.pom (2 KB at 61.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-container-default/1.0-alpha-30/plexus-container-default-1.0-alpha-30.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-container-default/1.0-alpha-30/plexus-container-default-1.0-alpha-30.pom (4 KB at 154.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-containers/1.0-alpha-30/plexus-containers-1.0-alpha-30.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-containers/1.0-alpha-30/plexus-containers-1.0-alpha-30.pom (2 KB at 97.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.4.5/plexus-utils-1.4.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.4.5/plexus-utils-1.4.5.pom (3 KB at 110.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-classworlds/1.2-alpha-9/plexus-classworlds-1.2-alpha-9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-classworlds/1.2-alpha-9/plexus-classworlds-1.2-alpha-9.pom (4 KB at 143.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/1.0.10/plexus-1.0.10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/1.0.10/plexus-1.0.10.pom (9 KB at 335.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-impl/2.1/maven-reporting-impl-2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-impl/2.1/maven-reporting-impl-2.1.pom (5 KB at 192.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/15/maven-shared-components-15.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/15/maven-shared-components-15.pom (10 KB at 414.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/16/maven-parent-16.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/16/maven-parent-16.pom (23 KB at 811.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/3.0/maven-reporting-api-3.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/3.0/maven-reporting-api-3.0.pom (3 KB at 115.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.0/doxia-sink-api-1.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.0/doxia-sink-api-1.0.pom (2 KB at 64.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.0/doxia-1.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.0/doxia-1.0.pom (10 KB at 428.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/10/maven-parent-10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/10/maven-parent-10.pom (31 KB at 936.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-project/2.0.10/maven-project-2.0.10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-project/2.0.10/maven-project-2.0.10.pom (3 KB at 115.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven/2.0.10/maven-2.0.10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven/2.0.10/maven-2.0.10.pom (24 KB at 846.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-settings/2.0.10/maven-settings-2.0.10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-settings/2.0.10/maven-settings-2.0.10.pom (3 KB at 56.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-model/2.0.10/maven-model-2.0.10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-model/2.0.10/maven-model-2.0.10.pom (4 KB at 148.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.5/plexus-utils-1.5.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.5/plexus-utils-1.5.5.pom (6 KB at 228.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.1/plexus-interpolation-1.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.1/plexus-interpolation-1.1.pom (2 KB at 70.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-profile/2.0.10/maven-profile-2.0.10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-profile/2.0.10/maven-profile-2.0.10.pom (3 KB at 78.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact-manager/2.0.10/maven-artifact-manager-2.0.10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact-manager/2.0.10/maven-artifact-manager-2.0.10.pom (3 KB at 131.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-repository-metadata/2.0.10/maven-repository-metadata-2.0.10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-repository-metadata/2.0.10/maven-repository-metadata-2.0.10.pom (3 KB at 113.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact/2.0.10/maven-artifact-2.0.10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact/2.0.10/maven-artifact-2.0.10.pom (2 KB at 75.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-registry/2.0.10/maven-plugin-registry-2.0.10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-registry/2.0.10/maven-plugin-registry-2.0.10.pom (2 KB at 82.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-api/2.0.10/maven-plugin-api-2.0.10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-api/2.0.10/maven-plugin-api-2.0.10.pom (2 KB at 66.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.1.2/doxia-sink-api-1.1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.1.2/doxia-sink-api-1.1.2.pom (2 KB at 66.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.1.2/doxia-1.1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.1.2/doxia-1.1.2.pom (18 KB at 709.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/15/maven-parent-15.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/15/maven-parent-15.pom (24 KB at 837.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/apache/6/apache-6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/apache/6/apache-6.pom (13 KB at 403.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.1.2/doxia-logging-api-1.1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.1.2/doxia-logging-api-1.1.2.pom (2 KB at 70.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-core/1.1.2/doxia-core-1.1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-core/1.1.2/doxia-core-1.1.2.pom (4 KB at 151.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.12/plexus-utils-1.5.12.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.12/plexus-utils-1.5.12.pom (6 KB at 239.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/xerces/xercesImpl/2.8.1/xercesImpl-2.8.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/xerces/xercesImpl/2.8.1/xercesImpl-2.8.1.pom (3 KB at 102.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/xml-apis/xml-apis/1.3.03/xml-apis-1.3.03.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/xml-apis/xml-apis/1.3.03/xml-apis-1.3.03.pom (738 B at 36.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/apache/1/apache-1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/apache/1/apache-1.pom (4 KB at 128.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.4/commons-lang-2.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.4/commons-lang-2.4.pom (14 KB at 545.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/9/commons-parent-9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/9/commons-parent-9.pom (22 KB at 793.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-httpclient/commons-httpclient/3.1/commons-httpclient-3.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-httpclient/commons-httpclient/3.1/commons-httpclient-3.1.pom (8 KB at 329.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.0.4/commons-logging-1.0.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.0.4/commons-logging-1.0.4.pom (6 KB at 205.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.2/commons-codec-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.2/commons-codec-1.2.pom (4 KB at 169.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-site-renderer/1.1.2/doxia-site-renderer-1.1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-site-renderer/1.1.2/doxia-site-renderer-1.1.2.pom (6 KB at 271.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sitetools/1.1.2/doxia-sitetools-1.1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sitetools/1.1.2/doxia-sitetools-1.1.2.pom (15 KB at 481.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-decoration-model/1.1.2/doxia-decoration-model-1.1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-decoration-model/1.1.2/doxia-decoration-model-1.1.2.pom (3 KB at 96.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-xhtml/1.1.2/doxia-module-xhtml-1.1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-xhtml/1.1.2/doxia-module-xhtml-1.1.2.pom (2 KB at 71.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-modules/1.1.2/doxia-modules-1.1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-modules/1.1.2/doxia-modules-1.1.2.pom (3 KB at 108.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-fml/1.1.2/doxia-module-fml-1.1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-fml/1.1.2/doxia-module-fml-1.1.2.pom (6 KB at 233.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-i18n/1.0-beta-7/plexus-i18n-1.0-beta-7.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-i18n/1.0-beta-7/plexus-i18n-1.0-beta-7.pom (2 KB at 43.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-components/1.1.12/plexus-components-1.1.12.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-components/1.1.12/plexus-components-1.1.12.pom (3 KB at 139.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-velocity/1.1.7/plexus-velocity-1.1.7.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-velocity/1.1.7/plexus-velocity-1.1.7.pom (2 KB at 45.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-container-default/1.0-alpha-20/plexus-container-default-1.0-alpha-20.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-container-default/1.0-alpha-20/plexus-container-default-1.0-alpha-20.pom (3 KB at 139.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-containers/1.0-alpha-20/plexus-containers-1.0-alpha-20.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-containers/1.0-alpha-20/plexus-containers-1.0-alpha-20.pom (2 KB at 87.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.3/plexus-utils-1.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.3/plexus-utils-1.3.pom (2 KB at 50.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-classworlds/1.2-alpha-7/plexus-classworlds-1.2-alpha-7.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-classworlds/1.2-alpha-7/plexus-classworlds-1.2-alpha-7.pom (3 KB at 105.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/1.0.9/plexus-1.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/1.0.9/plexus-1.0.9.pom (8 KB at 326.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/velocity/velocity/1.5/velocity-1.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/velocity/velocity/1.5/velocity-1.5.pom (8 KB at 303.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/3.1/commons-collections-3.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/3.1/commons-collections-3.1.pom (6 KB at 270.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.1/commons-lang-2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.1/commons-lang-2.1.pom (10 KB at 269.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/oro/oro/2.0.8/oro-2.0.8.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/oro/oro/2.0.8/oro-2.0.8.pom (140 B at 6.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/3.2/commons-collections-3.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/3.2/commons-collections-3.2.pom (11 KB at 283.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-validator/commons-validator/1.2.0/commons-validator-1.2.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-validator/commons-validator/1.2.0/commons-validator-1.2.0.pom (9 KB at 286.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-beanutils/commons-beanutils/1.7.0/commons-beanutils-1.7.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-beanutils/commons-beanutils/1.7.0/commons-beanutils-1.7.0.pom (357 B at 13.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.0.3/commons-logging-1.0.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.0.3/commons-logging-1.0.3.pom (866 B at 31.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-digester/commons-digester/1.6/commons-digester-1.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-digester/commons-digester/1.6/commons-digester-1.6.pom (974 B at 45.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-beanutils/commons-beanutils/1.6/commons-beanutils-1.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-beanutils/commons-beanutils/1.6/commons-beanutils-1.6.pom (3 KB at 112.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.0/commons-logging-1.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.0/commons-logging-1.0.pom (163 B at 5.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/2.0/commons-collections-2.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/2.0/commons-collections-2.0.pom (171 B at 7.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/2.1/commons-collections-2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/2.1/commons-collections-2.1.pom (4 KB at 155.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/xml-apis/xml-apis/1.0.b2/xml-apis-1.0.b2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/xml-apis/xml-apis/1.0.b2/xml-apis-1.0.b2.pom (3 KB at 104.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/xml-apis/xml-apis/2.0.2/xml-apis-2.0.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/xml-apis/xml-apis/2.0.2/xml-apis-2.0.2.pom (346 B at 10.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.8/plexus-utils-1.5.8.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.8/plexus-utils-1.5.8.pom (8 KB at 302.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.agent/0.7.5.201505241946/org.jacoco.agent-0.7.5.201505241946.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.agent/0.7.5.201505241946/org.jacoco.agent-0.7.5.201505241946.pom (3 KB at 97.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.core/0.7.5.201505241946/org.jacoco.core-0.7.5.201505241946.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.core/0.7.5.201505241946/org.jacoco.core-0.7.5.201505241946.pom (2 KB at 36.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/ow2/asm/asm-debug-all/5.0.1/asm-debug-all-5.0.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/ow2/asm/asm-debug-all/5.0.1/asm-debug-all-5.0.1.pom (2 KB at 71.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/ow2/asm/asm-parent/5.0.1/asm-parent-5.0.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/ow2/asm/asm-parent/5.0.1/asm-parent-5.0.1.pom (6 KB at 214.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/ow2/ow2/1.3/ow2-1.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/ow2/ow2/1.3/ow2-1.3.pom (10 KB at 371.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.report/0.7.5.201505241946/org.jacoco.report-0.7.5.201505241946.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.report/0.7.5.201505241946/org.jacoco.report-0.7.5.201505241946.pom (2 KB at 57.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/backport-util-concurrent/backport-util-concurrent/3.1/backport-util-concurrent-3.1.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.11/plexus-interpolation-1.11.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/junit/junit/4.8.2/junit-4.8.2.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.6/plexus-utils-1.5.6.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/file-management/1.2.1/file-management-1.2.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.11/plexus-interpolation-1.11.jar (50 KB at 578.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-io/1.1/maven-shared-io-1.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/file-management/1.2.1/file-management-1.2.1.jar (37 KB at 311.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/2.2.1/maven-reporting-api-2.2.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-io/1.1/maven-shared-io-1.1.jar (39 KB at 285.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.1/doxia-sink-api-1.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/2.2.1/maven-reporting-api-2.2.1.jar (10 KB at 66.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.1/doxia-logging-api-1.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.6/plexus-utils-1.5.6.jar (245 KB at 1473.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-impl/2.1/maven-reporting-impl-2.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.1/doxia-logging-api-1.1.jar (12 KB at 66.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-core/1.1.2/doxia-core-1.1.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.1/doxia-sink-api-1.1.jar (13 KB at 68.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/xerces/xercesImpl/2.8.1/xercesImpl-2.8.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-impl/2.1/maven-reporting-impl-2.1.jar (17 KB at 77.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.4/commons-lang-2.4.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/junit/junit/4.8.2/junit-4.8.2.jar (232 KB at 772.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-httpclient/commons-httpclient/3.1/commons-httpclient-3.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.4/commons-lang-2.4.jar (256 KB at 743.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.2/commons-codec-1.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-core/1.1.2/doxia-core-1.1.2.jar (155 KB at 430.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-site-renderer/1.1.2/doxia-site-renderer-1.1.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.2/commons-codec-1.2.jar (30 KB at 74.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-decoration-model/1.1.2/doxia-decoration-model-1.1.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/backport-util-concurrent/backport-util-concurrent/3.1/backport-util-concurrent-3.1.jar (324 KB at 741.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-xhtml/1.1.2/doxia-module-xhtml-1.1.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-site-renderer/1.1.2/doxia-site-renderer-1.1.2.jar (50 KB at 112.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-fml/1.1.2/doxia-module-fml-1.1.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-xhtml/1.1.2/doxia-module-xhtml-1.1.2.jar (15 KB at 30.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-i18n/1.0-beta-7/plexus-i18n-1.0-beta-7.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-decoration-model/1.1.2/doxia-decoration-model-1.1.2.jar (52 KB at 104.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-velocity/1.1.7/plexus-velocity-1.1.7.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-fml/1.1.2/doxia-module-fml-1.1.2.jar (37 KB at 74.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/velocity/velocity/1.5/velocity-1.5.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-i18n/1.0-beta-7/plexus-i18n-1.0-beta-7.jar (11 KB at 19.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/3.2/commons-collections-3.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-velocity/1.1.7/plexus-velocity-1.1.7.jar (8 KB at 14.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-validator/commons-validator/1.2.0/commons-validator-1.2.0.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-httpclient/commons-httpclient/3.1/commons-httpclient-3.1.jar (298 KB at 484.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-beanutils/commons-beanutils/1.7.0/commons-beanutils-1.7.0.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-validator/commons-validator/1.2.0/commons-validator-1.2.0.jar (89 KB at 142.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-digester/commons-digester/1.6/commons-digester-1.6.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-digester/commons-digester/1.6/commons-digester-1.6.jar (165 KB at 214.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.0.4/commons-logging-1.0.4.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-beanutils/commons-beanutils/1.7.0/commons-beanutils-1.7.0.jar (185 KB at 225.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/oro/oro/2.0.8/oro-2.0.8.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.0.4/commons-logging-1.0.4.jar (38 KB at 44.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/xml-apis/xml-apis/1.0.b2/xml-apis-1.0.b2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/velocity/velocity/1.5/velocity-1.5.jar (383 KB at 430.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.agent/0.7.5.201505241946/org.jacoco.agent-0.7.5.201505241946-runtime.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/oro/oro/2.0.8/oro-2.0.8.jar (64 KB at 68.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.core/0.7.5.201505241946/org.jacoco.core-0.7.5.201505241946.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/xml-apis/xml-apis/1.0.b2/xml-apis-1.0.b2.jar (107 KB at 106.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/ow2/asm/asm-debug-all/5.0.1/asm-debug-all-5.0.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.core/0.7.5.201505241946/org.jacoco.core-0.7.5.201505241946.jar (131 KB at 113.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.report/0.7.5.201505241946/org.jacoco.report-0.7.5.201505241946.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/3.2/commons-collections-3.2.jar (558 KB at 444.5 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.agent/0.7.5.201505241946/org.jacoco.agent-0.7.5.201505241946-runtime.jar (282 KB at 223.3 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/jacoco/org.jacoco.report/0.7.5.201505241946/org.jacoco.report-0.7.5.201505241946.jar (137 KB at 102.0 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/ow2/asm/asm-debug-all/5.0.1/asm-debug-all-5.0.1.jar (372 KB at 274.9 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/xerces/xercesImpl/2.8.1/xercesImpl-2.8.1.jar (1185 KB at 849.1 KB/sec)\n[INFO] argLine set to -javaagent:/home/travis/.m2/repository/org/jacoco/org.jacoco.agent/0.7.5.201505241946/org.jacoco.agent-0.7.5.201505241946-runtime.jar\u003ddestfile\u003d/home/travis/build/zalando/logbook/logbook-core/target/jacoco.exec\n[INFO] \n[INFO] --- license-maven-plugin:1.8:update-file-header (default) @ logbook-core ---\n[INFO] Downloading: https://repo.maven.apache.org/maven2/junit/junit/4.11/junit-4.11.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/junit/junit/4.11/junit-4.11.pom (3 KB at 109.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/2.0.6/maven-reporting-api-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/2.0.6/maven-reporting-api-2.0.6.pom (2 KB at 57.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting/2.0.6/maven-reporting-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting/2.0.6/maven-reporting-2.0.6.pom (2 KB at 45.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.0-alpha-7/doxia-sink-api-1.0-alpha-7.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.0-alpha-7/doxia-sink-api-1.0-alpha-7.pom (424 B at 21.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.0-alpha-7/doxia-1.0-alpha-7.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.0-alpha-7/doxia-1.0-alpha-7.pom (4 KB at 91.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-impl/2.2/maven-reporting-impl-2.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-impl/2.2/maven-reporting-impl-2.2.pom (5 KB at 210.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/17/maven-shared-components-17.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/17/maven-shared-components-17.pom (9 KB at 180.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-api/2.0.1/maven-plugin-api-2.0.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-api/2.0.1/maven-plugin-api-2.0.1.pom (643 B at 31.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven/2.0.1/maven-2.0.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven/2.0.1/maven-2.0.1.pom (12 KB at 467.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.2/doxia-sink-api-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.2/doxia-sink-api-1.2.pom (2 KB at 76.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.2/doxia-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.2/doxia-1.2.pom (19 KB at 634.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/19/maven-parent-19.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/19/maven-parent-19.pom (25 KB at 581.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.2/doxia-logging-api-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.2/doxia-logging-api-1.2.pom (2 KB at 24.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-core/1.2/doxia-core-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-core/1.2/doxia-core-1.2.pom (4 KB at 143.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/2.0.5/plexus-utils-2.0.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/2.0.5/plexus-utils-2.0.5.pom (4 KB at 72.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/2.0.6/plexus-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/2.0.6/plexus-2.0.6.pom (17 KB at 215.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/xerces/xercesImpl/2.9.1/xercesImpl-2.9.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/xerces/xercesImpl/2.9.1/xercesImpl-2.9.1.pom (2 KB at 49.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/xml-apis/xml-apis/1.3.04/xml-apis-1.3.04.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/xml-apis/xml-apis/1.3.04/xml-apis-1.3.04.pom (2 KB at 48.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpclient/4.0.2/httpclient-4.0.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpclient/4.0.2/httpclient-4.0.2.pom (8 KB at 271.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcomponents-client/4.0.2/httpcomponents-client-4.0.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcomponents-client/4.0.2/httpcomponents-client-4.0.2.pom (9 KB at 265.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/project/4.1/project-4.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/project/4.1/project-4.1.pom (16 KB at 640.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcore/4.0.1/httpcore-4.0.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcore/4.0.1/httpcore-4.0.1.pom (5 KB at 132.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcomponents-core/4.0.1/httpcomponents-core-4.0.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcomponents-core/4.0.1/httpcomponents-core-4.0.1.pom (10 KB at 326.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/project/4.0/project-4.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/project/4.0/project-4.0.pom (13 KB at 533.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.1.1/commons-logging-1.1.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.1.1/commons-logging-1.1.1.pom (18 KB at 717.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/5/commons-parent-5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/5/commons-parent-5.pom (16 KB at 559.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.3/commons-codec-1.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.3/commons-codec-1.3.pom (6 KB at 248.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-site-renderer/1.2/doxia-site-renderer-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-site-renderer/1.2/doxia-site-renderer-1.2.pom (7 KB at 66.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sitetools/1.2/doxia-sitetools-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sitetools/1.2/doxia-sitetools-1.2.pom (16 KB at 392.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-decoration-model/1.2/doxia-decoration-model-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-decoration-model/1.2/doxia-decoration-model-1.2.pom (3 KB at 96.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-xhtml/1.2/doxia-module-xhtml-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-xhtml/1.2/doxia-module-xhtml-1.2.pom (2 KB at 81.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-modules/1.2/doxia-modules-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-modules/1.2/doxia-modules-1.2.pom (3 KB at 111.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-fml/1.2/doxia-module-fml-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-fml/1.2/doxia-module-fml-1.2.pom (6 KB at 109.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/3.2.1/commons-collections-3.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/3.2.1/commons-collections-3.2.1.pom (13 KB at 265.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-validator/commons-validator/1.3.1/commons-validator-1.3.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-validator/commons-validator/1.3.1/commons-validator-1.3.1.pom (9 KB at 267.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-core/1.5/doxia-core-1.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-core/1.5/doxia-core-1.5.pom (4 KB at 172.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.5/doxia-1.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.5/doxia-1.5.pom (18 KB at 684.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/23/maven-parent-23.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/23/maven-parent-23.pom (32 KB at 964.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/apache/13/apache-13.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/apache/13/apache-13.pom (14 KB at 593.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.5/doxia-sink-api-1.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.5/doxia-sink-api-1.5.pom (2 KB at 71.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.5/doxia-logging-api-1.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.5/doxia-logging-api-1.5.pom (2 KB at 71.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0.10/plexus-utils-3.0.10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0.10/plexus-utils-3.0.10.pom (4 KB at 139.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/3.3/plexus-3.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/3.3/plexus-3.3.pom (20 KB at 670.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-component-annotations/1.5.5/plexus-component-annotations-1.5.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-component-annotations/1.5.5/plexus-component-annotations-1.5.5.pom (815 B at 39.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-containers/1.5.5/plexus-containers-1.5.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-containers/1.5.5/plexus-containers-1.5.5.pom (5 KB at 147.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/2.0.7/plexus-2.0.7.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/2.0.7/plexus-2.0.7.pom (17 KB at 649.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-site-renderer/1.4/doxia-site-renderer-1.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-site-renderer/1.4/doxia-site-renderer-1.4.pom (6 KB at 198.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sitetools/1.4/doxia-sitetools-1.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sitetools/1.4/doxia-sitetools-1.4.pom (17 KB at 620.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-core/1.4/doxia-core-1.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-core/1.4/doxia-core-1.4.pom (4 KB at 180.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.4/doxia-1.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia/1.4/doxia-1.4.pom (18 KB at 626.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.4/doxia-sink-api-1.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.4/doxia-sink-api-1.4.pom (2 KB at 68.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.4/doxia-logging-api-1.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.4/doxia-logging-api-1.4.pom (2 KB at 68.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-decoration-model/1.4/doxia-decoration-model-1.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-decoration-model/1.4/doxia-decoration-model-1.4.pom (3 KB at 118.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-xhtml/1.4/doxia-module-xhtml-1.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-xhtml/1.4/doxia-module-xhtml-1.4.pom (2 KB at 54.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-modules/1.4/doxia-modules-1.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-modules/1.4/doxia-modules-1.4.pom (3 KB at 116.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-fml/1.4/doxia-module-fml-1.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-fml/1.4/doxia-module-fml-1.4.pom (5 KB at 138.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/velocity/velocity-tools/2.0/velocity-tools-2.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/velocity/velocity-tools/2.0/velocity-tools-2.0.pom (18 KB at 592.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-digester/commons-digester/1.8/commons-digester-1.8.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-digester/commons-digester/1.8/commons-digester-1.8.pom (7 KB at 228.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.1/commons-logging-1.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.1/commons-logging-1.1.pom (7 KB at 251.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/log4j/log4j/1.2.12/log4j-1.2.12.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/log4j/log4j/1.2.12/log4j-1.2.12.pom (145 B at 5.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/logkit/logkit/1.0.1/logkit-1.0.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/logkit/logkit/1.0.1/logkit-1.0.1.pom (147 B at 6.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/avalon-framework/avalon-framework/4.1.3/avalon-framework-4.1.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/avalon-framework/avalon-framework/4.1.3/avalon-framework-4.1.3.pom (167 B at 8.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/javax/servlet/servlet-api/2.3/servlet-api-2.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/javax/servlet/servlet-api/2.3/servlet-api-2.3.pom (156 B at 5.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-chain/commons-chain/1.1/commons-chain-1.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-chain/commons-chain/1.1/commons-chain-1.1.pom (6 KB at 266.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/sslext/sslext/1.2-0/sslext-1.2-0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/sslext/sslext/1.2-0/sslext-1.2-0.pom (653 B at 31.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/struts/struts-core/1.3.8/struts-core-1.3.8.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/struts/struts-core/1.3.8/struts-core-1.3.8.pom (5 KB at 145.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/struts/struts-parent/1.3.8/struts-parent-1.3.8.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/struts/struts-parent/1.3.8/struts-parent-1.3.8.pom (10 KB at 436.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/struts/struts-master/4/struts-master-4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/struts/struts-master/4/struts-master-4.pom (12 KB at 462.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/apache/2/apache-2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/apache/2/apache-2.pom (4 KB at 166.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/struts/struts-taglib/1.3.8/struts-taglib-1.3.8.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/struts/struts-taglib/1.3.8/struts-taglib-1.3.8.pom (4 KB at 73.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/struts/struts-tiles/1.3.8/struts-tiles-1.3.8.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/struts/struts-tiles/1.3.8/struts-tiles-1.3.8.pom (3 KB at 118.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/velocity/velocity/1.6.2/velocity-1.6.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/velocity/velocity/1.6.2/velocity-1.6.2.pom (11 KB at 280.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0.15/plexus-utils-3.0.15.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0.15/plexus-utils-3.0.15.pom (4 KB at 146.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/3.3.1/plexus-3.3.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/3.3.1/plexus-3.3.1.pom (20 KB at 739.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/nuiton/processor/nuiton-processor/1.3/nuiton-processor-1.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/nuiton/processor/nuiton-processor/1.3/nuiton-processor-1.3.pom (5 KB at 190.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/nuiton/processor/1.3/processor-1.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/nuiton/processor/1.3/processor-1.3.pom (7 KB at 309.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/nuiton/mavenpom4redmineAndCentral/3.4.4/mavenpom4redmineAndCentral-3.4.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/nuiton/mavenpom4redmineAndCentral/3.4.4/mavenpom4redmineAndCentral-3.4.4.pom (5 KB at 198.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/nuiton/mavenpom4redmine/3.4.4/mavenpom4redmine-3.4.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/nuiton/mavenpom4redmine/3.4.4/mavenpom4redmine-3.4.4.pom (21 KB at 794.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/nuiton/mavenpom/3.4.4/mavenpom-3.4.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/nuiton/mavenpom/3.4.4/mavenpom-3.4.4.pom (66 KB at 1432.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/commons/commons-lang3/3.1/commons-lang3-3.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/commons/commons-lang3/3.1/commons-lang3-3.1.pom (17 KB at 408.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.1.3/commons-logging-1.1.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.1.3/commons-logging-1.1.3.pom (18 KB at 597.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/28/commons-parent-28.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/28/commons-parent-28.pom (49 KB at 1360.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/freemarker/freemarker/2.3.20/freemarker-2.3.20.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/freemarker/freemarker/2.3.20/freemarker-2.3.20.pom (2 KB at 73.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/log4j/log4j/1.2.17/log4j-1.2.17.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/log4j/log4j/1.2.17/log4j-1.2.17.pom (22 KB at 849.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/2.0.6/maven-reporting-api-2.0.6.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-impl/2.2/maven-reporting-impl-2.2.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-validator/commons-validator/1.3.1/commons-validator-1.3.1.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-core/1.5/doxia-core-1.5.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.5/doxia-logging-api-1.5.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/2.0.6/maven-reporting-api-2.0.6.jar (10 KB at 159.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/xerces/xercesImpl/2.9.1/xercesImpl-2.9.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-impl/2.2/maven-reporting-impl-2.2.jar (17 KB at 245.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/xml-apis/xml-apis/1.3.04/xml-apis-1.3.04.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-logging-api/1.5/doxia-logging-api-1.5.jar (12 KB at 97.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpclient/4.0.2/httpclient-4.0.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-validator/commons-validator/1.3.1/commons-validator-1.3.1.jar (136 KB at 484.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.3/commons-codec-1.3.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-core/1.5/doxia-core-1.5.jar (160 KB at 519.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcore/4.0.1/httpcore-4.0.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpclient/4.0.2/httpclient-4.0.2.jar (287 KB at 880.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.5/doxia-sink-api-1.5.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.3/commons-codec-1.3.jar (46 KB at 135.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-site-renderer/1.4/doxia-site-renderer-1.4.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.5/doxia-sink-api-1.5.jar (11 KB at 31.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-decoration-model/1.4/doxia-decoration-model-1.4.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/xml-apis/xml-apis/1.3.04/xml-apis-1.3.04.jar (190 KB at 479.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-xhtml/1.4/doxia-module-xhtml-1.4.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-decoration-model/1.4/doxia-decoration-model-1.4.jar (60 KB at 146.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-fml/1.4/doxia-module-fml-1.4.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-site-renderer/1.4/doxia-site-renderer-1.4.jar (52 KB at 122.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/velocity/velocity-tools/2.0/velocity-tools-2.0.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-xhtml/1.4/doxia-module-xhtml-1.4.jar (16 KB at 33.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-chain/commons-chain/1.1/commons-chain-1.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-module-fml/1.4/doxia-module-fml-1.4.jar (37 KB at 75.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/sslext/sslext/1.2-0/sslext-1.2-0.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcore/4.0.1/httpcore-4.0.1.jar (169 KB at 344.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/struts/struts-core/1.3.8/struts-core-1.3.8.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-chain/commons-chain/1.1/commons-chain-1.1.jar (88 KB at 164.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/struts/struts-taglib/1.3.8/struts-taglib-1.3.8.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/sslext/sslext/1.2-0/sslext-1.2-0.jar (26 KB at 47.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/struts/struts-tiles/1.3.8/struts-tiles-1.3.8.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/struts/struts-tiles/1.3.8/struts-tiles-1.3.8.jar (117 KB at 168.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-component-annotations/1.5.5/plexus-component-annotations-1.5.5.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/struts/struts-taglib/1.3.8/struts-taglib-1.3.8.jar (246 KB at 352.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0.15/plexus-utils-3.0.15.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-component-annotations/1.5.5/plexus-component-annotations-1.5.5.jar (5 KB at 5.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/nuiton/processor/nuiton-processor/1.3/nuiton-processor-1.3.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/nuiton/processor/nuiton-processor/1.3/nuiton-processor-1.3.jar (29 KB at 36.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/commons/commons-lang3/3.1/commons-lang3-3.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/velocity/velocity-tools/2.0/velocity-tools-2.0.jar (339 KB at 412.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.1.3/commons-logging-1.1.3.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.1.3/commons-logging-1.1.3.jar (61 KB at 69.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/3.2.1/commons-collections-3.2.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/struts/struts-core/1.3.8/struts-core-1.3.8.jar (322 KB at 366.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-io/commons-io/2.2/commons-io-2.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0.15/plexus-utils-3.0.15.jar (234 KB at 224.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/freemarker/freemarker/2.3.20/freemarker-2.3.20.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-io/commons-io/2.2/commons-io-2.2.jar (170 KB at 151.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/log4j/log4j/1.2.17/log4j-1.2.17.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-collections/commons-collections/3.2.1/commons-collections-3.2.1.jar (562 KB at 479.8 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/commons/commons-lang3/3.1/commons-lang3-3.1.jar (309 KB at 261.1 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/log4j/log4j/1.2.17/log4j-1.2.17.jar (479 KB at 347.7 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/xerces/xercesImpl/2.9.1/xercesImpl-2.9.1.jar (1201 KB at 850.7 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/freemarker/freemarker/2.3.20/freemarker-2.3.20.jar (995 KB at 640.5 KB/sec)\n[INFO] Will search files to update from root /home/travis/build/zalando/logbook/logbook-core/src\n[INFO] Scan 49 files header done in 226.604ms.\n[INFO] All files are up-to-date.\n[INFO] \n[INFO] --- maven-resources-plugin:2.7:resources (default-resources) @ logbook-core ---\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-core/2.2.1/maven-core-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-core/2.2.1/maven-core-2.2.1.pom (12 KB at 420.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-parameter-documenter/2.2.1/maven-plugin-parameter-documenter-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-parameter-documenter/2.2.1/maven-plugin-parameter-documenter-2.2.1.pom (2 KB at 91.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/slf4j/slf4j-jdk14/1.5.6/slf4j-jdk14-1.5.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/slf4j/slf4j-jdk14/1.5.6/slf4j-jdk14-1.5.6.pom (2 KB at 71.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/slf4j/slf4j-parent/1.5.6/slf4j-parent-1.5.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/slf4j/slf4j-parent/1.5.6/slf4j-parent-1.5.6.pom (8 KB at 140.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.5.6/slf4j-api-1.5.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.5.6/slf4j-api-1.5.6.pom (3 KB at 107.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/slf4j/jcl-over-slf4j/1.5.6/jcl-over-slf4j-1.5.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/slf4j/jcl-over-slf4j/1.5.6/jcl-over-slf4j-1.5.6.pom (3 KB at 88.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-error-diagnostics/2.2.1/maven-error-diagnostics-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-error-diagnostics/2.2.1/maven-error-diagnostics-2.2.1.pom (2 KB at 50.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-cli/commons-cli/1.2/commons-cli-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-cli/commons-cli/1.2/commons-cli-1.2.pom (8 KB at 311.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/11/commons-parent-11.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/11/commons-parent-11.pom (25 KB at 617.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-descriptor/2.2.1/maven-plugin-descriptor-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-descriptor/2.2.1/maven-plugin-descriptor-2.2.1.pom (3 KB at 65.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interactivity-api/1.0-alpha-4/plexus-interactivity-api-1.0-alpha-4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interactivity-api/1.0-alpha-4/plexus-interactivity-api-1.0-alpha-4.pom (7 KB at 277.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-monitor/2.2.1/maven-monitor-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-monitor/2.2.1/maven-monitor-2.2.1.pom (2 KB at 51.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/classworlds/classworlds/1.1/classworlds-1.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/classworlds/classworlds/1.1/classworlds-1.1.pom (4 KB at 104.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/plexus/plexus-sec-dispatcher/1.3/plexus-sec-dispatcher-1.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/plexus/plexus-sec-dispatcher/1.3/plexus-sec-dispatcher-1.3.pom (3 KB at 103.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/spice/spice-parent/12/spice-parent-12.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/spice/spice-parent/12/spice-parent-12.pom (7 KB at 301.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/forge/forge-parent/4/forge-parent-4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/forge/forge-parent/4/forge-parent-4.pom (9 KB at 341.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/plexus/plexus-cipher/1.4/plexus-cipher-1.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/plexus/plexus-cipher/1.4/plexus-cipher-1.4.pom (3 KB at 84.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-filtering/1.2/maven-filtering-1.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-filtering/1.2/maven-filtering-1.2.pom (7 KB at 227.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/19/maven-shared-components-19.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/19/maven-shared-components-19.pom (7 KB at 270.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-core/2.0.6/maven-core-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-core/2.0.6/maven-core-2.0.6.pom (7 KB at 273.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-parameter-documenter/2.0.6/maven-plugin-parameter-documenter-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-parameter-documenter/2.0.6/maven-plugin-parameter-documenter-2.0.6.pom (2 KB at 88.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-error-diagnostics/2.0.6/maven-error-diagnostics-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-error-diagnostics/2.0.6/maven-error-diagnostics-2.0.6.pom (2 KB at 79.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-cli/commons-cli/1.0/commons-cli-1.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-cli/commons-cli/1.0/commons-cli-1.0.pom (3 KB at 97.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-descriptor/2.0.6/maven-plugin-descriptor-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-descriptor/2.0.6/maven-plugin-descriptor-2.0.6.pom (2 KB at 56.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-monitor/2.0.6/maven-monitor-2.0.6.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-monitor/2.0.6/maven-monitor-2.0.6.pom (2 KB at 55.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.3/maven-shared-utils-0.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.3/maven-shared-utils-0.3.pom (4 KB at 171.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/18/maven-shared-components-18.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/18/maven-shared-components-18.pom (5 KB at 200.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/com/google/code/findbugs/jsr305/2.0.1/jsr305-2.0.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/com/google/code/findbugs/jsr305/2.0.1/jsr305-2.0.1.pom (965 B at 36.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.12/plexus-interpolation-1.12.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.12/plexus-interpolation-1.12.pom (889 B at 37.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/plexus/plexus-build-api/0.0.4/plexus-build-api-0.0.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/plexus/plexus-build-api/0.0.4/plexus-build-api-0.0.4.pom (3 KB at 116.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/spice/spice-parent/10/spice-parent-10.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/spice/spice-parent/10/spice-parent-10.pom (3 KB at 128.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/forge/forge-parent/3/forge-parent-3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/forge/forge-parent/3/forge-parent-3.pom (5 KB at 213.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.19/plexus-interpolation-1.19.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.19/plexus-interpolation-1.19.pom (2 KB at 50.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-components/1.3.1/plexus-components-1.3.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-components/1.3.1/plexus-components-1.3.1.pom (3 KB at 93.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/slf4j/slf4j-jdk14/1.5.6/slf4j-jdk14-1.5.6.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.5.6/slf4j-api-1.5.6.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/slf4j/jcl-over-slf4j/1.5.6/jcl-over-slf4j-1.5.6.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-cli/commons-cli/1.2/commons-cli-1.2.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interactivity-api/1.0-alpha-4/plexus-interactivity-api-1.0-alpha-4.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/slf4j/jcl-over-slf4j/1.5.6/jcl-over-slf4j-1.5.6.jar (17 KB at 308.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/plexus/plexus-sec-dispatcher/1.3/plexus-sec-dispatcher-1.3.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/slf4j/slf4j-jdk14/1.5.6/slf4j-jdk14-1.5.6.jar (9 KB at 145.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/plexus/plexus-cipher/1.4/plexus-cipher-1.4.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.5.6/slf4j-api-1.5.6.jar (22 KB at 340.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-filtering/1.2/maven-filtering-1.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/plexus/plexus-cipher/1.4/plexus-cipher-1.4.jar (14 KB at 137.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.3/maven-shared-utils-0.3.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interactivity-api/1.0-alpha-4/plexus-interactivity-api-1.0-alpha-4.jar (14 KB at 128.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/com/google/code/findbugs/jsr305/2.0.1/jsr305-2.0.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/plexus/plexus-sec-dispatcher/1.3/plexus-sec-dispatcher-1.3.jar (28 KB at 216.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/plexus/plexus-build-api/0.0.4/plexus-build-api-0.0.4.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-cli/commons-cli/1.2/commons-cli-1.2.jar (41 KB at 306.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.19/plexus-interpolation-1.19.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-filtering/1.2/maven-filtering-1.2.jar (44 KB at 291.5 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/plexus/plexus-build-api/0.0.4/plexus-build-api-0.0.4.jar (7 KB at 42.6 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/com/google/code/findbugs/jsr305/2.0.1/jsr305-2.0.1.jar (32 KB at 200.8 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.19/plexus-interpolation-1.19.jar (61 KB at 344.3 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.3/maven-shared-utils-0.3.jar (152 KB at 725.7 KB/sec)\n[INFO] Using \u0027UTF-8\u0027 encoding to copy filtered resources.\n[INFO] skip non existing resourceDirectory /home/travis/build/zalando/logbook/logbook-core/src/main/resources\n[INFO] \n[INFO] --- maven-compiler-plugin:3.3:compile (default-compile) @ logbook-core ---\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-toolchain/2.2.1/maven-toolchain-2.2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-toolchain/2.2.1/maven-toolchain-2.2.1.pom (4 KB at 99.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.7/maven-shared-utils-0.7.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.7/maven-shared-utils-0.7.pom (5 KB at 148.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/20/maven-shared-components-20.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-components/20/maven-shared-components-20.pom (5 KB at 226.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-incremental/1.1/maven-shared-incremental-1.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-incremental/1.1/maven-shared-incremental-1.1.pom (5 KB at 220.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.1/maven-shared-utils-0.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.1/maven-shared-utils-0.1.pom (4 KB at 171.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler-api/2.5/plexus-compiler-api-2.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler-api/2.5/plexus-compiler-api-2.5.pom (865 B at 40.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler/2.5/plexus-compiler-2.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler/2.5/plexus-compiler-2.5.pom (6 KB at 225.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler-manager/2.5/plexus-compiler-manager-2.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler-manager/2.5/plexus-compiler-manager-2.5.pom (690 B at 33.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler-javac/2.5/plexus-compiler-javac-2.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler-javac/2.5/plexus-compiler-javac-2.5.pom (769 B at 37.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compilers/2.5/plexus-compilers-2.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compilers/2.5/plexus-compilers-2.5.pom (2 KB at 55.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-container-default/1.5.5/plexus-container-default-1.5.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-container-default/1.5.5/plexus-container-default-1.5.5.pom (3 KB at 128.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-classworlds/2.2.2/plexus-classworlds-2.2.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-classworlds/2.2.2/plexus-classworlds-2.2.2.pom (4 KB at 187.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/2.0.3/plexus-2.0.3.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/2.0.3/plexus-2.0.3.pom (16 KB at 539.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/xbean/xbean-reflect/3.4/xbean-reflect-3.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/xbean/xbean-reflect/3.4/xbean-reflect-3.4.pom (3 KB at 130.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/xbean/xbean/3.4/xbean-3.4.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/xbean/xbean/3.4/xbean-3.4.pom (19 KB at 624.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-logging/commons-logging-api/1.1/commons-logging-api-1.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-logging/commons-logging-api/1.1/commons-logging-api-1.1.pom (6 KB at 227.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/com/google/collections/google-collections/1.0/google-collections-1.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/com/google/collections/google-collections/1.0/google-collections-1.0.pom (3 KB at 56.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/com/google/google/1/google-1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/com/google/google/1/google-1.pom (2 KB at 75.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/junit/junit/3.8.2/junit-3.8.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/junit/junit/3.8.2/junit-3.8.2.pom (747 B at 36.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.15/plexus-utils-1.5.15.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.7/maven-shared-utils-0.7.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-incremental/1.1/maven-shared-incremental-1.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-incremental/1.1/maven-shared-incremental-1.1.jar (14 KB at 176.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler-api/2.5/plexus-compiler-api-2.5.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler-manager/2.5/plexus-compiler-manager-2.5.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler-javac/2.5/plexus-compiler-javac-2.5.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler-manager/2.5/plexus-compiler-manager-2.5.jar (5 KB at 96.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/xbean/xbean-reflect/3.4/xbean-reflect-3.4.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler-javac/2.5/plexus-compiler-javac-2.5.jar (19 KB at 319.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/log4j/log4j/1.2.12/log4j-1.2.12.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-compiler-api/2.5/plexus-compiler-api-2.5.jar (25 KB at 219.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-logging/commons-logging-api/1.1/commons-logging-api-1.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-logging/commons-logging-api/1.1/commons-logging-api-1.1.jar (44 KB at 385.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/com/google/collections/google-collections/1.0/google-collections-1.0.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.7/maven-shared-utils-0.7.jar (167 KB at 506.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/junit/junit/3.8.2/junit-3.8.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/xbean/xbean-reflect/3.4/xbean-reflect-3.4.jar (131 KB at 527.0 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.15/plexus-utils-1.5.15.jar (223 KB at 535.5 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/junit/junit/3.8.2/junit-3.8.2.jar (118 KB at 331.9 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/log4j/log4j/1.2.12/log4j-1.2.12.jar (350 KB at 867.7 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/com/google/collections/google-collections/1.0/google-collections-1.0.jar (625 KB at 1144.0 KB/sec)\n[INFO] Changes detected - recompiling the module!\n[INFO] Compiling 29 source files to /home/travis/build/zalando/logbook/logbook-core/target/classes\n[INFO] \n[INFO] --- maven-resources-plugin:2.7:testResources (default-testResources) @ logbook-core ---\n[INFO] Using \u0027UTF-8\u0027 encoding to copy filtered resources.\n[INFO] Copying 2 resources\n[INFO] \n[INFO] --- maven-compiler-plugin:3.3:testCompile (default-testCompile) @ logbook-core ---\n[INFO] Changes detected - recompiling the module!\n[INFO] Compiling 20 source files to /home/travis/build/zalando/logbook/logbook-core/target/test-classes\n[INFO] \n[INFO] --- maven-surefire-plugin:2.16:test (default-test) @ logbook-core ---\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-api/2.0.9/maven-plugin-api-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-api/2.0.9/maven-plugin-api-2.0.9.pom (2 KB at 40.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven/2.0.9/maven-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven/2.0.9/maven-2.0.9.pom (19 KB at 769.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/8/maven-parent-8.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-parent/8/maven-parent-8.pom (24 KB at 693.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/maven-surefire-common/2.16/maven-surefire-common-2.16.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/maven-surefire-common/2.16/maven-surefire-common-2.16.pom (6 KB at 283.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugin-tools/maven-plugin-annotations/3.2/maven-plugin-annotations-3.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugin-tools/maven-plugin-annotations/3.2/maven-plugin-annotations-3.2.pom (2 KB at 79.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugin-tools/maven-plugin-tools/3.2/maven-plugin-tools-3.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugin-tools/maven-plugin-tools/3.2/maven-plugin-tools-3.2.pom (17 KB at 556.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact/2.0.9/maven-artifact-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact/2.0.9/maven-artifact-2.0.9.pom (2 KB at 65.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.1/plexus-utils-1.5.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.1/plexus-utils-1.5.1.pom (3 KB at 112.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-api/2.16/surefire-api-2.16.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-api/2.16/surefire-api-2.16.pom (3 KB at 101.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-booter/2.16/surefire-booter-2.16.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-booter/2.16/surefire-booter-2.16.pom (3 KB at 138.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-descriptor/2.0.9/maven-plugin-descriptor-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-descriptor/2.0.9/maven-plugin-descriptor-2.0.9.pom (3 KB at 65.4 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-project/2.0.9/maven-project-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-project/2.0.9/maven-project-2.0.9.pom (3 KB at 126.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-settings/2.0.9/maven-settings-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-settings/2.0.9/maven-settings-2.0.9.pom (3 KB at 77.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-model/2.0.9/maven-model-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-model/2.0.9/maven-model-2.0.9.pom (4 KB at 153.3 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-profile/2.0.9/maven-profile-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-profile/2.0.9/maven-profile-2.0.9.pom (3 KB at 62.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact-manager/2.0.9/maven-artifact-manager-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-artifact-manager/2.0.9/maven-artifact-manager-2.0.9.pom (3 KB at 138.8 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-repository-metadata/2.0.9/maven-repository-metadata-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-repository-metadata/2.0.9/maven-repository-metadata-2.0.9.pom (2 KB at 59.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-registry/2.0.9/maven-plugin-registry-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-registry/2.0.9/maven-plugin-registry-2.0.9.pom (2 KB at 77.0 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-core/2.0.9/maven-core-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-core/2.0.9/maven-core-2.0.9.pom (8 KB at 330.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-parameter-documenter/2.0.9/maven-plugin-parameter-documenter-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-plugin-parameter-documenter/2.0.9/maven-plugin-parameter-documenter-2.0.9.pom (2 KB at 63.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/2.0.9/maven-reporting-api-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/2.0.9/maven-reporting-api-2.0.9.pom (2 KB at 92.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting/2.0.9/maven-reporting-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting/2.0.9/maven-reporting-2.0.9.pom (2 KB at 49.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-error-diagnostics/2.0.9/maven-error-diagnostics-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-error-diagnostics/2.0.9/maven-error-diagnostics-2.0.9.pom (2 KB at 85.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-monitor/2.0.9/maven-monitor-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-monitor/2.0.9/maven-monitor-2.0.9.pom (2 KB at 62.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-toolchain/2.0.9/maven-toolchain-2.0.9.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-toolchain/2.0.9/maven-toolchain-2.0.9.pom (4 KB at 147.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/maven-surefire-common/2.16/maven-surefire-common-2.16.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-booter/2.16/surefire-booter-2.16.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.1/plexus-utils-1.5.1.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/2.0.9/maven-reporting-api-2.0.9.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-api/2.16/surefire-api-2.16.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/reporting/maven-reporting-api/2.0.9/maven-reporting-api-2.0.9.jar (10 KB at 126.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugin-tools/maven-plugin-annotations/3.2/maven-plugin-annotations-3.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugin-tools/maven-plugin-annotations/3.2/maven-plugin-annotations-3.2.jar (15 KB at 165.5 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-booter/2.16/surefire-booter-2.16.jar (39 KB at 309.5 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-api/2.16/surefire-api-2.16.jar (146 KB at 466.3 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/1.5.1/plexus-utils-1.5.1.jar (206 KB at 548.6 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/maven-surefire-common/2.16/maven-surefire-common-2.16.jar (259 KB at 592.4 KB/sec)\n[INFO] Tests are skipped.\n[INFO] \n[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ logbook-core ---\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-archiver/2.5/maven-archiver-2.5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-archiver/2.5/maven-archiver-2.5.pom (5 KB at 192.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-archiver/2.1/plexus-archiver-2.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-archiver/2.1/plexus-archiver-2.1.pom (3 KB at 137.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0/plexus-utils-3.0.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0/plexus-utils-3.0.pom (4 KB at 180.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/spice/spice-parent/16/spice-parent-16.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/spice/spice-parent/16/spice-parent-16.pom (9 KB at 354.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/sonatype/forge/forge-parent/5/forge-parent-5.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/sonatype/forge/forge-parent/5/forge-parent-5.pom (9 KB at 355.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-io/2.0.2/plexus-io-2.0.2.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-io/2.0.2/plexus-io-2.0.2.pom (2 KB at 84.6 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-components/1.1.19/plexus-components-1.1.19.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-components/1.1.19/plexus-components-1.1.19.pom (3 KB at 138.7 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/3.0.1/plexus-3.0.1.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus/3.0.1/plexus-3.0.1.pom (19 KB at 727.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.15/plexus-interpolation-1.15.pom\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.15/plexus-interpolation-1.15.pom (1018 B at 33.1 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/maven-archiver/2.5/maven-archiver-2.5.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.0-alpha-7/doxia-sink-api-1.0-alpha-7.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-cli/commons-cli/1.0/commons-cli-1.0.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.15/plexus-interpolation-1.15.jar\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-archiver/2.1/plexus-archiver-2.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/maven-archiver/2.5/maven-archiver-2.5.jar (22 KB at 202.9 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-io/2.0.2/plexus-io-2.0.2.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/doxia/doxia-sink-api/1.0-alpha-7/doxia-sink-api-1.0-alpha-7.jar (6 KB at 53.2 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.1/commons-lang-2.1.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-cli/commons-cli/1.0/commons-cli-1.0.jar (30 KB at 224.5 KB/sec)\n[INFO] Downloading: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0/plexus-utils-3.0.jar\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-io/2.0.2/plexus-io-2.0.2.jar (57 KB at 353.4 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-interpolation/1.15/plexus-interpolation-1.15.jar (60 KB at 283.9 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-archiver/2.1/plexus-archiver-2.1.jar (181 KB at 531.3 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0/plexus-utils-3.0.jar (221 KB at 661.0 KB/sec)\n[INFO] Downloaded: https://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.1/commons-lang-2.1.jar (203 KB at 582.9 KB/sec)\n[INFO] Building jar: /home/travis/build/zalando/logbook/logbook-core/target/logbook-core-0.10.0-SNAPSHOT.jar\n[INFO] \n[INFO] --- jacoco-maven-plugin:0.7.5.201505241946:report (report) @ logbook-core ---\n[INFO] Skipping JaCoCo execution due to missing execution data file:/home/travis/build/zalando/logbook/logbook-core/target/jacoco.exec\n[INFO] \n[INFO] --- jacoco-maven-plugin:0.7.5.201505241946:check (check) @ logbook-core ---\n[INFO] Skipping JaCoCo execution due to missing execution data file:/home/travis/build/zalando/logbook/logbook-core/target/jacoco.exec\n[INFO] \n[INFO] --- maven-install-plugin:2.4:install (default-install) @ logbook-core ---\n[INFO] Installing /home/travis/build/zalando/logbook/logbook-core/target/logbook-core-0.10.0-SNAPSHOT.jar to /home/travis/.m2/repository/org/zalando/logbook-core/0.10.0-SNAPSHOT/logbook-core-0.10.0-SNAPSHOT.jar\n[INFO] Installing /home/travis/build/zalando/logbook/logbook-core/pom.xml to /home/travis/.m2/repository/org/zalando/logbook-core/0.10.0-SNAPSHOT/logbook-core-0.10.0-SNAPSHOT.pom\n[INFO]                                                                         \n[INFO] ------------------------------------------------------------------------\n[INFO] Building Logbook: HTTP Client 0.10.0-SNAPSHOT\n[INFO] ------------------------------------------------------------------------\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpclient/4.5.1/httpclient-4.5.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpclient/4.5.1/httpclient-4.5.1.pom (7 KB at 117.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcomponents-client/4.5.1/httpcomponents-client-4.5.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcomponents-client/4.5.1/httpcomponents-client-4.5.1.pom (16 KB at 765.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/project/7/project-7.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/project/7/project-7.pom (27 KB at 950.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcore/4.4.3/httpcore-4.4.3.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcore/4.4.3/httpcore-4.4.3.pom (6 KB at 94.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcomponents-core/4.4.3/httpcomponents-core-4.4.3.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcomponents-core/4.4.3/httpcomponents-core-4.4.3.pom (13 KB at 660.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.2/commons-logging-1.2.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.2/commons-logging-1.2.pom (19 KB at 457.5 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/34/commons-parent-34.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/34/commons-parent-34.pom (55 KB at 2731.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.9/commons-codec-1.9.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.9/commons-codec-1.9.pom (12 KB at 563.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/32/commons-parent-32.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/32/commons-parent-32.pom (52 KB at 2454.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-nop/1.7.13/slf4j-nop-1.7.13.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-nop/1.7.13/slf4j-nop-1.7.13.pom (786 B at 38.4 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/github/rest-driver/rest-client-driver/1.1.41/rest-client-driver-1.1.41.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/github/rest-driver/rest-client-driver/1.1.41/rest-client-driver-1.1.41.pom (3 KB at 122.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/github/rest-driver/rest-driver/1.1.41/rest-driver-1.1.41.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/github/rest-driver/rest-driver/1.1.41/rest-driver-1.1.41.pom (12 KB at 583.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/github/rest-driver/rest-driver-shared/1.1.41/rest-driver-shared-1.1.41.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/github/rest-driver/rest-driver-shared/1.1.41/rest-driver-shared-1.1.41.pom (2 KB at 43.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.2.0/jackson-databind-2.2.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.2.0/jackson-databind-2.2.0.pom (6 KB at 208.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/oss-parent/10/oss-parent-10.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/oss-parent/10/oss-parent-10.pom (23 KB at 874.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-annotations/2.2.0/jackson-annotations-2.2.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-annotations/2.2.0/jackson-annotations-2.2.0.pom (2 KB at 86.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/oss-parent/9/oss-parent-9.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/oss-parent/9/oss-parent-9.pom (23 KB at 1186.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-core/2.2.0/jackson-core-2.2.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-core/2.2.0/jackson-core-2.2.0.pom (6 KB at 291.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/google/guava/guava/14.0.1/guava-14.0.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/google/guava/guava/14.0.1/guava-14.0.1.pom (6 KB at 238.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/google/guava/guava-parent/14.0.1/guava-parent-14.0.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/google/guava/guava-parent/14.0.1/guava-parent-14.0.1.pom (3 KB at 131.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path/0.8.1/json-path-0.8.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path/0.8.1/json-path-0.8.1.pom (3 KB at 115.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path-parent/0.8.1/json-path-parent-0.8.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path-parent/0.8.1/json-path-parent-0.8.1.pom (9 KB at 434.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/sonatype/oss/oss-parent/5/oss-parent-5.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/sonatype/oss/oss-parent/5/oss-parent-5.pom (4 KB at 209.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/net/minidev/json-smart/1.1.1/json-smart-1.1.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/net/minidev/json-smart/1.1.1/json-smart-1.1.1.pom (2 KB at 66.0 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/net/minidev/parent/1.1.1/parent-1.1.1.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/net/minidev/parent/1.1.1/parent-1.1.1.pom (11 KB at 557.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.6/commons-lang-2.6.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.6/commons-lang-2.6.pom (18 KB at 569.5 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/17/commons-parent-17.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/commons/commons-parent/17/commons-parent-17.pom (31 KB at 1602.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/xmlunit/xmlunit/1.4/xmlunit-1.4.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/xmlunit/xmlunit/1.4/xmlunit-1.4.pom (3 KB at 148.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.8/commons-codec-1.8.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.8/commons-codec-1.8.pom (12 KB at 586.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-server/9.1.1.v20140108/jetty-server-9.1.1.v20140108.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-server/9.1.1.v20140108/jetty-server-9.1.1.v20140108.pom (5 KB at 174.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-project/9.1.1.v20140108/jetty-project-9.1.1.v20140108.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-project/9.1.1.v20140108/jetty-project-9.1.1.v20140108.pom (31 KB at 1542.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-parent/21/jetty-parent-21.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-parent/21/jetty-parent-21.pom (22 KB at 724.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/javax/servlet/javax.servlet-api/3.1.0/javax.servlet-api-3.1.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/javax/servlet/javax.servlet-api/3.1.0/javax.servlet-api-3.1.0.pom (14 KB at 240.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/net/java/jvnet-parent/3/jvnet-parent-3.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/net/java/jvnet-parent/3/jvnet-parent-3.pom (5 KB at 146.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-http/9.1.1.v20140108/jetty-http-9.1.1.v20140108.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-http/9.1.1.v20140108/jetty-http-9.1.1.v20140108.pom (3 KB at 117.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-util/9.1.1.v20140108/jetty-util-9.1.1.v20140108.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-util/9.1.1.v20140108/jetty-util-9.1.1.v20140108.pom (4 KB at 128.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-io/9.1.1.v20140108/jetty-io-9.1.1.v20140108.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-io/9.1.1.v20140108/jetty-io-9.1.1.v20140108.pom (3 KB at 111.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/jcl-over-slf4j/1.7.5/jcl-over-slf4j-1.7.5.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/jcl-over-slf4j/1.7.5/jcl-over-slf4j-1.7.5.pom (2 KB at 90.5 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-parent/1.7.5/slf4j-parent-1.7.5.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-parent/1.7.5/slf4j-parent-1.7.5.pom (12 KB at 548.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.7.5/slf4j-api-1.7.5.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.7.5/slf4j-api-1.7.5.pom (3 KB at 131.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpclient/4.5.1/httpclient-4.5.1.jar\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcore/4.4.3/httpcore-4.4.3.jar\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.2/commons-logging-1.2.jar\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.9/commons-codec-1.9.jar\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-nop/1.7.13/slf4j-nop-1.7.13.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-logging/commons-logging/1.2/commons-logging-1.2.jar (61 KB at 764.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/github/rest-driver/rest-client-driver/1.1.41/rest-client-driver-1.1.41.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpcore/4.4.3/httpcore-4.4.3.jar (319 KB at 2953.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/github/rest-driver/rest-driver-shared/1.1.41/rest-driver-shared-1.1.41.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/apache/httpcomponents/httpclient/4.5.1/httpclient-4.5.1.jar (716 KB at 5340.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.2.0/jackson-databind-2.2.0.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/github/rest-driver/rest-client-driver/1.1.41/rest-client-driver-1.1.41.jar (41 KB at 798.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-annotations/2.2.0/jackson-annotations-2.2.0.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/github/rest-driver/rest-driver-shared/1.1.41/rest-driver-shared-1.1.41.jar (23 KB at 423.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-core/2.2.0/jackson-core-2.2.0.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/slf4j-nop/1.7.13/slf4j-nop-1.7.13.jar (4 KB at 59.0 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path/0.8.1/json-path-0.8.1.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-codec/commons-codec/1.9/commons-codec-1.9.jar (258 KB at 2832.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/net/minidev/json-smart/1.1.1/json-smart-1.1.1.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-annotations/2.2.0/jackson-annotations-2.2.0.jar (33 KB at 366.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/xmlunit/xmlunit/1.4/xmlunit-1.4.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-core/2.2.0/jackson-core-2.2.0.jar (188 KB at 2082.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.4/commons-io-2.4.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/jayway/jsonpath/json-path/0.8.1/json-path-0.8.1.jar (66 KB at 672.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.6/commons-lang-2.6.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/net/minidev/json-smart/1.1.1/json-smart-1.1.1.jar (51 KB at 457.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-server/9.1.1.v20140108/jetty-server-9.1.1.v20140108.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-io/commons-io/2.4/commons-io-2.4.jar (181 KB at 1558.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/javax/servlet/javax.servlet-api/3.1.0/javax.servlet-api-3.1.0.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.2.0/jackson-databind-2.2.0.jar (845 KB at 7677.5 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-http/9.1.1.v20140108/jetty-http-9.1.1.v20140108.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.6/commons-lang-2.6.jar (278 KB at 2372.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-util/9.1.1.v20140108/jetty-util-9.1.1.v20140108.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/xmlunit/xmlunit/1.4/xmlunit-1.4.jar (97 KB at 773.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-io/9.1.1.v20140108/jetty-io-9.1.1.v20140108.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/javax/servlet/javax.servlet-api/3.1.0/javax.servlet-api-3.1.0.jar (94 KB at 668.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/jcl-over-slf4j/1.7.5/jcl-over-slf4j-1.7.5.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-util/9.1.1.v20140108/jetty-util-9.1.1.v20140108.jar (327 KB at 2188.9 KB/sec)\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-server/9.1.1.v20140108/jetty-server-9.1.1.v20140108.jar (391 KB at 2584.8 KB/sec)\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-http/9.1.1.v20140108/jetty-http-9.1.1.v20140108.jar (101 KB at 663.4 KB/sec)\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/eclipse/jetty/jetty-io/9.1.1.v20140108/jetty-io-9.1.1.v20140108.jar (98 KB at 619.5 KB/sec)\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/jcl-over-slf4j/1.7.5/jcl-over-slf4j-1.7.5.jar (17 KB at 102.7 KB/sec)\n[INFO] \n[INFO] --- jacoco-maven-plugin:0.7.5.201505241946:prepare-agent (prepare-agent) @ logbook-httpclient ---\n[INFO] argLine set to -javaagent:/home/travis/.m2/repository/org/jacoco/org.jacoco.agent/0.7.5.201505241946/org.jacoco.agent-0.7.5.201505241946-runtime.jar\u003ddestfile\u003d/home/travis/build/zalando/logbook/logbook-httpclient/target/jacoco.exec\n[INFO] \n[INFO] --- license-maven-plugin:1.8:update-file-header (default) @ logbook-httpclient ---\n[INFO] Will search files to update from root /home/travis/build/zalando/logbook/logbook-httpclient/src\n[INFO] Scan 10 files header done in 30.918ms.\n[INFO] All files are up-to-date.\n[INFO] \n[INFO] --- maven-resources-plugin:2.7:resources (default-resources) @ logbook-httpclient ---\n[INFO] Using \u0027UTF-8\u0027 encoding to copy filtered resources.\n[INFO] skip non existing resourceDirectory /home/travis/build/zalando/logbook/logbook-httpclient/src/main/resources\n[INFO] \n[INFO] --- maven-compiler-plugin:3.3:compile (default-compile) @ logbook-httpclient ---\n[INFO] Changes detected - recompiling the module!\n[INFO] Compiling 6 source files to /home/travis/build/zalando/logbook/logbook-httpclient/target/classes\n[INFO] \n[INFO] --- maven-resources-plugin:2.7:testResources (default-testResources) @ logbook-httpclient ---\n[INFO] Using \u0027UTF-8\u0027 encoding to copy filtered resources.\n[INFO] skip non existing resourceDirectory /home/travis/build/zalando/logbook/logbook-httpclient/src/test/resources\n[INFO] \n[INFO] --- maven-compiler-plugin:3.3:testCompile (default-testCompile) @ logbook-httpclient ---\n[INFO] Changes detected - recompiling the module!\n[INFO] Compiling 4 source files to /home/travis/build/zalando/logbook/logbook-httpclient/target/test-classes\n[INFO] \n[INFO] --- maven-surefire-plugin:2.16:test (default-test) @ logbook-httpclient ---\n[INFO] Tests are skipped.\n[INFO] \n[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ logbook-httpclient ---\n[INFO] Building jar: /home/travis/build/zalando/logbook/logbook-httpclient/target/logbook-httpclient-0.10.0-SNAPSHOT.jar\n[INFO] \n[INFO] --- jacoco-maven-plugin:0.7.5.201505241946:report (report) @ logbook-httpclient ---\n[INFO] Skipping JaCoCo execution due to missing execution data file:/home/travis/build/zalando/logbook/logbook-httpclient/target/jacoco.exec\n[INFO] \n[INFO] --- jacoco-maven-plugin:0.7.5.201505241946:check (check) @ logbook-httpclient ---\n[INFO] Skipping JaCoCo execution due to missing execution data file:/home/travis/build/zalando/logbook/logbook-httpclient/target/jacoco.exec\n[INFO] \n[INFO] --- maven-install-plugin:2.4:install (default-install) @ logbook-httpclient ---\n[INFO] Installing /home/travis/build/zalando/logbook/logbook-httpclient/target/logbook-httpclient-0.10.0-SNAPSHOT.jar to /home/travis/.m2/repository/org/zalando/logbook-httpclient/0.10.0-SNAPSHOT/logbook-httpclient-0.10.0-SNAPSHOT.jar\n[INFO] Installing /home/travis/build/zalando/logbook/logbook-httpclient/pom.xml to /home/travis/.m2/repository/org/zalando/logbook-httpclient/0.10.0-SNAPSHOT/logbook-httpclient-0.10.0-SNAPSHOT.pom\n[INFO]                                                                         \n[INFO] ------------------------------------------------------------------------\n[INFO] Building Logbook: Servlet 0.10.0-SNAPSHOT\n[INFO] ------------------------------------------------------------------------\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/glassfish/javax.servlet/3.0/javax.servlet-3.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/glassfish/javax.servlet/3.0/javax.servlet-3.0.pom (5 KB at 196.0 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/glassfish/api-pom/3.0/api-pom-3.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/glassfish/api-pom/3.0/api-pom-3.0.pom (5 KB at 234.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/glassfish/glassfish-parent/3.0/glassfish-parent-3.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/glassfish/glassfish-parent/3.0/glassfish-parent-3.0.pom (54 KB at 2526.5 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/glassfish/pom/8/pom-8.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/glassfish/pom/8/pom-8.pom (11 KB at 542.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/jcl-over-slf4j/1.7.13/jcl-over-slf4j-1.7.13.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/jcl-over-slf4j/1.7.13/jcl-over-slf4j-1.7.13.pom (963 B at 47.0 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-webmvc/4.2.0.RELEASE/spring-webmvc-4.2.0.RELEASE.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-webmvc/4.2.0.RELEASE/spring-webmvc-4.2.0.RELEASE.pom (12 KB at 618.4 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-beans/4.2.0.RELEASE/spring-beans-4.2.0.RELEASE.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-beans/4.2.0.RELEASE/spring-beans-4.2.0.RELEASE.pom (3 KB at 128.5 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-core/4.2.0.RELEASE/spring-core-4.2.0.RELEASE.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-core/4.2.0.RELEASE/spring-core-4.2.0.RELEASE.pom (3 KB at 128.0 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-context/4.2.0.RELEASE/spring-context-4.2.0.RELEASE.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-context/4.2.0.RELEASE/spring-context-4.2.0.RELEASE.pom (5 KB at 258.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-aop/4.2.0.RELEASE/spring-aop-4.2.0.RELEASE.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-aop/4.2.0.RELEASE/spring-aop-4.2.0.RELEASE.pom (3 KB at 107.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/aopalliance/aopalliance/1.0/aopalliance-1.0.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/aopalliance/aopalliance/1.0/aopalliance-1.0.pom (363 B at 13.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-expression/4.2.0.RELEASE/spring-expression-4.2.0.RELEASE.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-expression/4.2.0.RELEASE/spring-expression-4.2.0.RELEASE.pom (2 KB at 88.6 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-web/4.2.0.RELEASE/spring-web-4.2.0.RELEASE.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-web/4.2.0.RELEASE/spring-web-4.2.0.RELEASE.pom (8 KB at 397.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-test/4.2.0.RELEASE/spring-test-4.2.0.RELEASE.pom\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-test/4.2.0.RELEASE/spring-test-4.2.0.RELEASE.pom (8 KB at 339.3 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/glassfish/javax.servlet/3.0/javax.servlet-3.0.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/glassfish/javax.servlet/3.0/javax.servlet-3.0.jar (82 KB at 1600.5 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-webmvc/4.2.0.RELEASE/spring-webmvc-4.2.0.RELEASE.jar\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-beans/4.2.0.RELEASE/spring-beans-4.2.0.RELEASE.jar\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/slf4j/jcl-over-slf4j/1.7.13/jcl-over-slf4j-1.7.13.jar\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-aop/4.2.0.RELEASE/spring-aop-4.2.0.RELEASE.jar\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-context/4.2.0.RELEASE/spring-context-4.2.0.RELEASE.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/slf4j/jcl-over-slf4j/1.7.13/jcl-over-slf4j-1.7.13.jar (17 KB at 155.8 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/aopalliance/aopalliance/1.0/aopalliance-1.0.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-aop/4.2.0.RELEASE/spring-aop-4.2.0.RELEASE.jar (356 KB at 7405.1 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-core/4.2.0.RELEASE/spring-core-4.2.0.RELEASE.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-beans/4.2.0.RELEASE/spring-beans-4.2.0.RELEASE.jar (713 KB at 8795.7 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-expression/4.2.0.RELEASE/spring-expression-4.2.0.RELEASE.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/aopalliance/aopalliance/1.0/aopalliance-1.0.jar (5 KB at 64.2 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-web/4.2.0.RELEASE/spring-web-4.2.0.RELEASE.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-webmvc/4.2.0.RELEASE/spring-webmvc-4.2.0.RELEASE.jar (846 KB at 7478.9 KB/sec)\n[INFO] Downloading: http://repo.maven.apache.org/maven2/org/springframework/spring-test/4.2.0.RELEASE/spring-test-4.2.0.RELEASE.jar\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-core/4.2.0.RELEASE/spring-core-4.2.0.RELEASE.jar (1028 KB at 10381.0 KB/sec)\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-expression/4.2.0.RELEASE/spring-expression-4.2.0.RELEASE.jar (257 KB at 2562.4 KB/sec)\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-context/4.2.0.RELEASE/spring-context-4.2.0.RELEASE.jar (1060 KB at 7903.4 KB/sec)\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-web/4.2.0.RELEASE/spring-web-4.2.0.RELEASE.jar (748 KB at 6232.7 KB/sec)\n[INFO] Downloaded: http://repo.maven.apache.org/maven2/org/springframework/spring-test/4.2.0.RELEASE/spring-test-4.2.0.RELEASE.jar (537 KB at 3947.2 KB/sec)\n[INFO] \n[INFO] --- jacoco-maven-plugin:0.7.5.201505241946:prepare-agent (prepare-agent) @ logbook-servlet ---\n[INFO] argLine set to -javaagent:/home/travis/.m2/repository/org/jacoco/org.jacoco.agent/0.7.5.201505241946/org.jacoco.agent-0.7.5.201505241946-runtime.jar\u003ddestfile\u003d/home/travis/build/zalando/logbook/logbook-servlet/target/jacoco.exec\n[INFO] \n[INFO] --- license-maven-plugin:1.8:update-file-header (default) @ logbook-servlet ---\n[INFO] Will search files to update from root /home/travis/build/zalando/logbook/logbook-servlet/src\n[INFO] Scan 30 files header done in 80.337ms.\n[INFO] All files are up-to-date.\n[INFO] \n[INFO] --- maven-resources-plugin:2.7:resources (default-resources) @ logbook-servlet ---\n[INFO] Using \u0027UTF-8\u0027 encoding to copy filtered resources.\n[INFO] skip non existing resourceDirectory /home/travis/build/zalando/logbook/logbook-servlet/src/main/resources\n[INFO] \n[INFO] --- maven-compiler-plugin:3.3:compile (default-compile) @ logbook-servlet ---\n[INFO] Changes detected - recompiling the module!\n[INFO] Compiling 12 source files to /home/travis/build/zalando/logbook/logbook-servlet/target/classes\n[INFO] \n[INFO] --- maven-resources-plugin:2.7:testResources (default-testResources) @ logbook-servlet ---\n[INFO] Using \u0027UTF-8\u0027 encoding to copy filtered resources.\n[INFO] skip non existing resourceDirectory /home/travis/build/zalando/logbook/logbook-servlet/src/test/resources\n[INFO] \n[INFO] --- maven-compiler-plugin:3.3:testCompile (default-testCompile) @ logbook-servlet ---\n[INFO] Changes detected - recompiling the module!\n[INFO] Compiling 18 source files to /home/travis/build/zalando/logbook/logbook-servlet/target/test-classes\n[INFO] \n[INFO] --- maven-surefire-plugin:2.16:test (default-test) @ logbook-servlet ---\n[INFO] Tests are skipped.\n[INFO] \n[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ logbook-servlet ---\n[INFO] Building jar: /home/travis/build/zalando/logbook/logbook-servlet/target/logbook-servlet-0.10.0-SNAPSHOT.jar\n[INFO] \n[INFO] --- jacoco-maven-plugin:0.7.5.201505241946:report (report) @ logbook-servlet ---\n[INFO] Skipping JaCoCo execution due to missing execution data file:/home/travis/build/zalando/logbook/logbook-servlet/target/jacoco.exec\n[INFO] \n[INFO] --- jacoco-maven-plugin:0.7.5.201505241946:check (check) @ logbook-servlet ---\n[INFO] Skipping JaCoCo execution due to missing execution data file:/home/travis/build/zalando/logbook/logbook-servlet/target/jacoco.exec\n[INFO] \n[INFO] --- maven-install-plugin:2.4:install (default-install) @ logbook-servlet ---\n[INFO] Installing /home/travis/build/zalando/logbook/logbook-servlet/target/logbook-servlet-0.10.0-SNAPSHOT.jar to /home/travis/.m2/repository/org/zalando/logbook-servlet/0.10.0-SNAPSHOT/logbook-servlet-0.10.0-SNAPSHOT.jar\n[INFO] Installing /home/travis/build/zalando/logbook/logbook-servlet/pom.xml to /home/travis/.m2/repository/org/zalando/logbook-servlet/0.10.0-SNAPSHOT/logbook-servlet-0.10.0-SNAPSHOT.pom\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary:\n[INFO] \n[INFO] Logbook ............................................ SUCCESS [  5.392 s]\n[INFO] Logbook: Core ...................................... SUCCESS [ 37.702 s]\n[INFO] Logbook: HTTP Client ............................... SUCCESS [  2.485 s]\n[INFO] Logbook: Servlet ................................... SUCCESS [  5.753 s]\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 51.563 s\n[INFO] Finished at: 2015-12-02T12:48:54+00:00\n[INFO] Final Memory: 34M/487M\n[INFO] ------------------------------------------------------------------------\ntravis_time:end:067e08bb:start\u003d1449060478539353160,finish\u003d1449060545993856658,duration\u003d67454503498\n\u001b[0Ktravis_fold:end:install\n\u001b[0Ktravis_time:start:018b1be8\n\u001b[0K$ mvn clean verify\nJava HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize\u003d192m; support was removed in 8.0\n[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO] \n[INFO] Logbook\n[INFO] Logbook: Core\n[INFO] Logbook: HTTP Client\n[INFO] Logbook: Servlet\n[INFO]                                                                         \n[INFO] ------------------------------------------------------------------------\n[INFO] Building Logbook 0.10.0-SNAPSHOT\n[INFO] ------------------------------------------------------------------------\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-clean-plugin/2.5/maven-clean-plugin-2.5.pom\n4/4 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-clean-plugin/2.5/maven-clean-plugin-2.5.pom (4 KB at 4.3 KB/sec)\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-clean-plugin/2.5/maven-clean-plugin-2.5.jar\n4/25 KB   \n8/25 KB   \n12/25 KB   \n16/25 KB   \n20/25 KB   \n24/25 KB   \n25/25 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-clean-plugin/2.5/maven-clean-plugin-2.5.jar (25 KB at 375.9 KB/sec)\n[INFO] \n[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ logbook-parent ---\n[INFO]                                                                         \n[INFO] ------------------------------------------------------------------------\n[INFO] Building Logbook: Core 0.10.0-SNAPSHOT\n[INFO] ------------------------------------------------------------------------\nDownloading: https://oss.sonatype.org/content/repositories/releases/junit/junit-dep/maven-metadata.xml\nDownloading: https://repository.apache.org/releases/junit/junit-dep/maven-metadata.xml\nDownloading: https://repository.apache.org/snapshots/junit/junit-dep/maven-metadata.xml\nDownloading: https://nexus.codehaus.org/snapshots/junit/junit-dep/maven-metadata.xml\n\n563/563 B   \n\nDownloaded: https://oss.sonatype.org/content/repositories/releases/junit/junit-dep/maven-metadata.xml (563 B at 2.5 KB/sec)\n\n\n[WARNING] Could not transfer metadata junit:junit-dep/maven-metadata.xml from/to codehaus-snapshots (https://nexus.codehaus.org/snapshots/): nexus.codehaus.org: unknown error\nDownloading: https://oss.sonatype.org/content/repositories/releases/commons-io/commons-io/maven-metadata.xml\nDownloading: https://repository.apache.org/releases/commons-io/commons-io/maven-metadata.xml\nDownloading: https://repository.apache.org/snapshots/commons-io/commons-io/maven-metadata.xml\nDownloading: https://nexus.codehaus.org/snapshots/commons-io/commons-io/maven-metadata.xml\n\n\n\n350/350 B   \n\nDownloaded: https://repository.apache.org/snapshots/commons-io/commons-io/maven-metadata.xml (350 B at 0.6 KB/sec)\n[WARNING] Could not transfer metadata commons-io:commons-io/maven-metadata.xml from/to codehaus-snapshots (https://nexus.codehaus.org/snapshots/): nexus.codehaus.org\nDownloading: https://repository.apache.org/snapshots/commons-io/commons-io/2.5-SNAPSHOT/maven-metadata.xml\nDownloading: https://nexus.codehaus.org/snapshots/commons-io/commons-io/2.5-SNAPSHOT/maven-metadata.xml\n\n3/3 KB      \n\nDownloaded: https://repository.apache.org/snapshots/commons-io/commons-io/2.5-SNAPSHOT/maven-metadata.xml (3 KB at 3.5 KB/sec)\n[WARNING] Could not transfer metadata commons-io:commons-io:2.5-SNAPSHOT/maven-metadata.xml from/to codehaus-snapshots (https://nexus.codehaus.org/snapshots/): nexus.codehaus.org\n[WARNING] Failure to transfer commons-io:commons-io:2.5-SNAPSHOT/maven-metadata.xml from https://nexus.codehaus.org/snapshots/ was cached in the local repository, resolution will not be reattempted until the update interval of codehaus-snapshots has elapsed or updates are forced. Original error: Could not transfer metadata commons-io:commons-io:2.5-SNAPSHOT/maven-metadata.xml from/to codehaus-snapshots (https://nexus.codehaus.org/snapshots/): nexus.codehaus.org\nDownloading: https://repository.apache.org/snapshots/commons-io/commons-io/2.6-SNAPSHOT/maven-metadata.xml\nDownloading: https://nexus.codehaus.org/snapshots/commons-io/commons-io/2.6-SNAPSHOT/maven-metadata.xml\n\n3/3 KB   \n\nDownloaded: https://repository.apache.org/snapshots/commons-io/commons-io/2.6-SNAPSHOT/maven-metadata.xml (3 KB at 3.9 KB/sec)\n[WARNING] Could not transfer metadata commons-io:commons-io:2.6-SNAPSHOT/maven-metadata.xml from/to codehaus-snapshots (https://nexus.codehaus.org/snapshots/): nexus.codehaus.org\n[WARNING] Failure to transfer commons-io:commons-io:2.6-SNAPSHOT/maven-metadata.xml from https://nexus.codehaus.org/snapshots/ was cached in the local repository, resolution will not be reattempted until the update interval of codehaus-snapshots has elapsed or updates are forced. Original error: Could not transfer metadata commons-io:commons-io:2.6-SNAPSHOT/maven-metadata.xml from/to codehaus-snapshots (https://nexus.codehaus.org/snapshots/): nexus.codehaus.org\n[INFO] \n[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ logbook-core ---\n[INFO] Deleting /home/travis/build/zalando/logbook/logbook-core/target\n[INFO] \n[INFO] --- jacoco-maven-plugin:0.7.5.201505241946:prepare-agent (prepare-agent) @ logbook-core ---\n[INFO] argLine set to -javaagent:/home/travis/.m2/repository/org/jacoco/org.jacoco.agent/0.7.5.201505241946/org.jacoco.agent-0.7.5.201505241946-runtime.jar\u003ddestfile\u003d/home/travis/build/zalando/logbook/logbook-core/target/jacoco.exec\n[INFO] \n[INFO] --- license-maven-plugin:1.8:update-file-header (default) @ logbook-core ---\n[INFO] Will search files to update from root /home/travis/build/zalando/logbook/logbook-core/src\n[INFO] Scan 49 files header done in 245.278ms.\n[INFO] All files are up-to-date.\n[INFO] \n[INFO] --- maven-resources-plugin:2.7:resources (default-resources) @ logbook-core ---\n[INFO] Using \u0027UTF-8\u0027 encoding to copy filtered resources.\n[INFO] skip non existing resourceDirectory /home/travis/build/zalando/logbook/logbook-core/src/main/resources\n[INFO] \n[INFO] --- maven-compiler-plugin:3.3:compile (default-compile) @ logbook-core ---\n[INFO] Changes detected - recompiling the module!\n[INFO] Compiling 29 source files to /home/travis/build/zalando/logbook/logbook-core/target/classes\n[INFO] \n[INFO] --- maven-resources-plugin:2.7:testResources (default-testResources) @ logbook-core ---\n[INFO] Using \u0027UTF-8\u0027 encoding to copy filtered resources.\n[INFO] Copying 2 resources\n[INFO] \n[INFO] --- maven-compiler-plugin:3.3:testCompile (default-testCompile) @ logbook-core ---\n[INFO] Changes detected - recompiling the module!\n[INFO] Compiling 20 source files to /home/travis/build/zalando/logbook/logbook-core/target/test-classes\n[INFO] \n[INFO] --- maven-surefire-plugin:2.16:test (default-test) @ logbook-core ---\n[INFO] Surefire report directory: /home/travis/build/zalando/logbook/logbook-core/target/surefire-reports\n[INFO] parallel\u003d\u0027classesAndMethods\u0027, perCoreThreadCount\u003dtrue, threadCount\u003d1, useUnlimitedThreads\u003dfalse, threadCountSuites\u003d0, threadCountClasses\u003d0, threadCountMethods\u003d0\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit47/2.16/surefire-junit47-2.16.pom\n4/5 KB   \n5/5 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit47/2.16/surefire-junit47-2.16.pom (5 KB at 227.4 KB/sec)\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-providers/2.16/surefire-providers-2.16.pom\n3/3 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-providers/2.16/surefire-providers-2.16.pom (3 KB at 154.8 KB/sec)\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-junit48/2.16/common-junit48-2.16.pom\n4/4 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-junit48/2.16/common-junit48-2.16.pom (4 KB at 173.0 KB/sec)\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-junit4/2.16/common-junit4-2.16.pom\n2/2 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-junit4/2.16/common-junit4-2.16.pom (2 KB at 34.4 KB/sec)\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-junit3/2.16/common-junit3-2.16.pom\n2/2 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-junit3/2.16/common-junit3-2.16.pom (2 KB at 33.2 KB/sec)\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-java5/2.16/common-java5-2.16.pom\n2/2 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-java5/2.16/common-java5-2.16.pom (2 KB at 25.5 KB/sec)\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.4/maven-shared-utils-0.4.pom\n4/4 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.4/maven-shared-utils-0.4.pom (4 KB at 77.5 KB/sec)\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-grouper/2.16/surefire-grouper-2.16.pom\n3/3 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-grouper/2.16/surefire-grouper-2.16.pom (3 KB at 39.7 KB/sec)\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit47/2.16/surefire-junit47-2.16.jar\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-junit48/2.16/common-junit48-2.16.jar\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-junit4/2.16/common-junit4-2.16.jar\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-java5/2.16/common-java5-2.16.jar\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-junit3/2.16/common-junit3-2.16.jar\n4/37 KB   \n4/11 KB   8/37 KB   4/115 KB   \n4/11 KB   12/37 KB   4/115 KB   \n4/11 KB   16/37 KB   4/115 KB   \n4/11 KB   4/37 KB   4/115 KB   \n4/11 KB   16/37 KB   8/115 KB   \n4/11 KB   16/37 KB   12/115 KB   \n4/11 KB   16/37 KB   16/115 KB   \n4/11 KB   4/37 KB   \n8/11 KB   16/37 KB   16/115 KB   \n11/11 KB   16/37 KB   16/115 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-junit3/2.16/common-junit3-2.16.jar (11 KB at 97.0 KB/sec)\n16/37 KB   20/115 KB              \n20/37 KB   24/115 KB   \n20/37 KB   28/115 KB   \n20/37 KB   32/115 KB   \n20/37 KB   20/115 KB   \n24/37 KB   32/115 KB   \n28/37 KB   32/115 KB   \n32/37 KB   36/115 KB   \n36/37 KB   36/115 KB   \n37/37 KB   36/115 KB   \n37/37 KB   2/16 KB   36/115 KB   \n28/37 KB   36/115 KB   \n37/37 KB   2/16 KB   40/115 KB   \n37/37 KB   2/16 KB   44/115 KB   \n37/37 KB   2/16 KB   48/115 KB   \n4/18 KB   37/37 KB   2/16 KB   48/115 KB   \n8/18 KB   37/37 KB   2/16 KB   48/115 KB   \n12/18 KB   37/37 KB   2/16 KB   48/115 KB   \n16/18 KB   37/37 KB   6/16 KB   48/115 KB   \n18/18 KB   37/37 KB   6/16 KB   48/115 KB   \n\n12/18 KB   37/37 KB   6/16 KB   48/115 KB   \n18/18 KB   10/16 KB   48/115 KB             \n18/18 KB   14/16 KB   48/115 KB   \n18/18 KB   16/16 KB   48/115 KB   \nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.4/maven-shared-utils-0.4.jar\n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-junit4/2.16/common-junit4-2.16.jar (16 KB at 67.6 KB/sec)\n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-junit48/2.16/common-junit48-2.16.jar (18 KB at 68.4 KB/sec)\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/common-java5/2.16/common-java5-2.16.jar (37 KB at 159.0 KB/sec)\nDownloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-grouper/2.16/surefire-grouper-2.16.jar\n52/115 KB                         \n56/115 KB   \n60/115 KB   \n64/115 KB   \n4/152 KB   64/115 KB   \n8/152 KB   64/115 KB   \n12/152 KB   4/37 KB   64/115 KB   \n16/152 KB   4/37 KB   64/115 KB   \n20/152 KB   4/37 KB   64/115 KB   \n24/152 KB   4/37 KB   64/115 KB   \n8/152 KB   4/37 KB   64/115 KB   \n24/152 KB   8/37 KB   68/115 KB   \n24/152 KB   12/37 KB   68/115 KB   \n24/152 KB   16/37 KB   68/115 KB   \n24/152 KB   20/37 KB   68/115 KB   \n28/152 KB   24/37 KB   68/115 KB   \n28/152 KB   28/37 KB   68/115 KB   \n28/152 KB   32/37 KB   68/115 KB   \n28/152 KB   36/37 KB   68/115 KB   \n24/152 KB   4/37 KB   68/115 KB   \n28/152 KB   37/37 KB   72/115 KB   \n28/152 KB   37/37 KB   76/115 KB   \n28/152 KB   37/37 KB   80/115 KB   \n28/152 KB   37/37 KB   84/115 KB   \n28/152 KB   20/37 KB   68/115 KB   \n32/152 KB   37/37 KB   84/115 KB   \n36/152 KB   37/37 KB   84/115 KB   \n40/152 KB   37/37 KB   84/115 KB   \n44/152 KB   37/37 KB   84/115 KB   \n28/152 KB   37/37 KB   84/115 KB   \n48/152 KB   37/37 KB   84/115 KB   \n48/152 KB   37/37 KB   88/115 KB   \n52/152 KB   37/37 KB   92/115 KB   \n52/152 KB   37/37 KB   96/115 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-grouper/2.16/surefire-grouper-2.16.jar (37 KB at 405.5 KB/sec)\n52/152 KB   37/37 KB   88/115 KB   \n52/152 KB   100/115 KB             \n52/152 KB   104/115 KB   \n52/152 KB   108/115 KB   \n52/152 KB   112/115 KB   \n52/152 KB   115/115 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit47/2.16/surefire-junit47-2.16.jar (115 KB at 278.3 KB/sec)\n56/152 KB                \n60/152 KB   \n64/152 KB   \n68/152 KB   \n72/152 KB   \n76/152 KB   \n80/152 KB   \n84/152 KB   \n88/152 KB   \n92/152 KB   \n96/152 KB   \n100/152 KB   \n104/152 KB   \n108/152 KB   \n112/152 KB   \n116/152 KB   \n120/152 KB   \n124/152 KB   \n128/152 KB   \n132/152 KB   \n136/152 KB   \n140/152 KB   \n144/152 KB   \n148/152 KB   \n152/152 KB   \n152/152 KB   \n\nDownloaded: https://repo.maven.apache.org/maven2/org/apache/maven/shared/maven-shared-utils/0.4/maven-shared-utils-0.4.jar (152 KB at 581.6 KB/sec)\n\n-------------------------------------------------------\n T E S T S\n-------------------------------------------------------\nRunning org.zalando.logbook.DefaultHttpLogWriterLevelTest\nTests run: 15, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.698 sec - in org.zalando.logbook.DefaultHttpLogWriterLevelTest\nRunning org.zalando.logbook.ObfuscatedHttpResponseTest\nTests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.729 sec - in org.zalando.logbook.ObfuscatedHttpResponseTest\nRunning org.zalando.logbook.ForwardingHttpRequestTest\nTests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.213 sec - in org.zalando.logbook.ForwardingHttpRequestTest\nRunning org.zalando.logbook.ForwardingHttpResponseTest\nTests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.zalando.logbook.ForwardingHttpResponseTest\nRunning org.zalando.logbook.HttpMessageTest\nTests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.212 sec - in org.zalando.logbook.HttpMessageTest\nRunning org.zalando.logbook.BodyObfuscatorTest\nTests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.zalando.logbook.BodyObfuscatorTest\nRunning org.zalando.logbook.DefaultHttpLogFormatterTest\nTests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.595 sec - in org.zalando.logbook.DefaultHttpLogFormatterTest\nRunning org.zalando.logbook.ForwardingRawHttpRequestTest\nTests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.zalando.logbook.ForwardingRawHttpRequestTest\nRunning org.zalando.logbook.ObfuscatorTest\nTests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.017 sec - in org.zalando.logbook.ObfuscatorTest\nRunning org.zalando.logbook.QueryParametersTest\nTests run: 13, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.266 sec - in org.zalando.logbook.QueryParametersTest\nRunning org.zalando.logbook.JsonHttpLogFormatterTest\nTests run: 16, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 4.171 sec - in org.zalando.logbook.JsonHttpLogFormatterTest\nRunning org.zalando.logbook.HttpLogWriterTest\nTests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.408 sec - in org.zalando.logbook.HttpLogWriterTest\nRunning org.zalando.logbook.DefaultHttpLogWriterTest\nTests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.002 sec - in org.zalando.logbook.DefaultHttpLogWriterTest\nRunning org.zalando.logbook.EnforceCoverageTest\nTests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 sec - in org.zalando.logbook.EnforceCoverageTest\nRunning org.zalando.logbook.DefaultLogbookTest\nTests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.037 sec - in org.zalando.logbook.DefaultLogbookTest\nRunning org.zalando.logbook.StreamHttpLogWriterTest\nTests run: 5, Failures: 2, Errors: 0, Skipped: 0, Time elapsed: 1.962 sec \u003c\u003c\u003c FAILURE! - in org.zalando.logbook.StreamHttpLogWriterTest\nshouldRequestToStdoutByDefault(org.zalando.logbook.StreamHttpLogWriterTest)  Time elapsed: 0.044 sec  \u003c\u003c\u003c FAILURE!\njava.lang.AssertionError: \nExpected: is \"foo\\n\"\n     but: was \"\"\n    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)\n    at org.junit.Assert.assertThat(Assert.java:956)\n    at org.junit.Assert.assertThat(Assert.java:923)\n    at org.zalando.logbook.StreamHttpLogWriterTest.shouldRequestToStdoutByDefault(StreamHttpLogWriterTest.java:75)\n\nshouldResponseToStdoutByDefault(org.zalando.logbook.StreamHttpLogWriterTest)  Time elapsed: 0.019 sec  \u003c\u003c\u003c FAILURE!\njava.lang.AssertionError: \nExpected: is \"bar\\n\"\n     but: was \"foo\\n\"\n    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)\n    at org.junit.Assert.assertThat(Assert.java:956)\n    at org.junit.Assert.assertThat(Assert.java:923)\n    at org.zalando.logbook.StreamHttpLogWriterTest.shouldResponseToStdoutByDefault(StreamHttpLogWriterTest.java:84)\n\nRunning org.zalando.logbook.ObfuscatedHttpRequestTest\nTests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.zalando.logbook.ObfuscatedHttpRequestTest\n\nResults :\n\nFailed tests: \n  StreamHttpLogWriterTest.shouldRequestToStdoutByDefault:75 \nExpected: is \"foo\\n\"\n     but: was \"\"\n  StreamHttpLogWriterTest.shouldResponseToStdoutByDefault:84 \nExpected: is \"bar\\n\"\n     but: was \"foo\\n\"\n\nTests run: 88, Failures: 2, Errors: 0, Skipped: 0\n\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary:\n[INFO] \n[INFO] Logbook ............................................ SUCCESS [  1.729 s]\n[INFO] Logbook: Core ...................................... FAILURE [ 27.768 s]\n[INFO] Logbook: HTTP Client ............................... SKIPPED\n[INFO] Logbook: Servlet ................................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 29.685 s\n[INFO] Finished at: 2015-12-02T12:49:37+00:00\n[INFO] Final Memory: 26M/407M\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.16:test (default-test) on project logbook-core: There are test failures.\n[ERROR] \n[ERROR] Please refer to /home/travis/build/zalando/logbook/logbook-core/target/surefire-reports for the individual test results.\n[ERROR] -\u003e [Help 1]\n[ERROR] \n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR] \n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException\n[ERROR] \n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR]   mvn \u003cgoals\u003e -rf :logbook-core\ntravis_time:end:018b1be8:start\u003d1449060545997815188,finish\u003d1449060579863282429,duration\u003d33865467241\n\u001b[0K\n\u001b[31;1mThe command \"mvn clean verify\" exited with 1.\u001b[0m\n\nDone. Your build exited with 1.\n```\n",
    "keywords": [
      "apache org/maven2/org/apache/maven/maven-settings/2",
      "apache org/maven2/org/codehaus/plexus/plexus-containers/1",
      "0-snapshot",
      "objects",
      "org/maven2/org/apache/maven/surefire/common-junit3/2 16/common-junit3-2",
      "remote",
      "resolution",
      "building",
      "org/maven2/org/apache/httpcomponents/httpcomponents-core/4",
      "\u001b[0k$",
      "------------------------------------------------------------------------",
      "2 kb",
      "xml",
      "28/37",
      "0 10",
      "apache org/maven2/com/fasterxml/jackson/core/jackson-databind/2",
      "$",
      "1/jsr305-2",
      "apache org/maven2/org/codehaus/plexus/plexus/2",
      "apache org/maven2/org/codehaus/plexus/plexus/1",
      "apache org/maven2/org/codehaus/plexus/plexus/3",
      "20/freemarker-2",
      "version",
      "downloading: https://oss",
      "versions\u001b[0m",
      "6/commons-digester-1",
      "0",
      "1",
      "2",
      "org/maven2/backport-util-concurrent/backport-util-concurrent/3",
      "3",
      "4",
      "5",
      "6",
      "7",
      "6 jar",
      "8",
      "9",
      "apache org/maven2/org/apache/maven/doxia/doxia-logging-api/1",
      "org/maven2/org/codehaus/mojo/license-maven-plugin/1",
      "2/2 kb",
      "0 0",
      "[error] [error]",
      "@",
      "0 1",
      "0 2",
      "0 3",
      "100%",
      "0 4",
      "16/37",
      "org/maven2/org/apache/maven/plugins/maven-install-plugin/2",
      "0 6",
      "[info] downloading",
      "0 8",
      "0 9",
      "logbook",
      "[info] building",
      "apache org/maven2/asm/asm/3",
      "logbook-servlet",
      "org/maven2/org/hamcrest/hamcrest-core/1",
      "org/maven2/log4j/log4j/1",
      "0/plexus-digest-1",
      "org/maven2/org/codehaus/plexus/plexus-interactivity-api/1",
      "[",
      "org/maven2/org/apache/maven/reporting/maven-reporting-api/2",
      "1/commons-logging-api-1",
      "org/maven2/org/sonatype/plexus/plexus-cipher/1",
      "b",
      "failures",
      "org/maven2/org/codehaus/plexus/plexus-interpolation/1",
      "0-beta-7",
      "org/maven2/org/apache/maven/maven-settings/2 0",
      "transfer commons-io:commons-io:2",
      "6/slf4j-api-1 5",
      "6 pom",
      "org/maven2/org/apache/maven/surefire/common-junit48/2 16/common-junit48-2",
      "19/plexus-interpolation-1",
      "transfer metadata",
      "s",
      "9/maven-reporting-api-2",
      "4/11 kb",
      "1/plexus-3",
      "org/maven2/org/apache/maven/maven-artifact-manager/2",
      "org/maven2/org/apache/maven/reporting/maven-reporting-impl/2",
      "[info] downloaded",
      "org/maven2/com/github/rest-driver/rest-driver-shared/1",
      "3/hamcrest-core-1",
      "apache org/maven2/org/apache/velocity/velocity/1",
      "org/maven2/org/apache/maven/doxia/doxia-module-fml/1",
      "org/maven2/commons-cli/commons-cli/1",
      "0 errors",
      "3 1/asm-3",
      "org/maven2/org/objenesis/objenesis/2",
      "org/maven2/xerces/xercesimpl/2",
      "skipped [info]",
      "jacoco-maven-plugin:0",
      "copying",
      "4/doxia-decoration-model-1",
      "6 kb/sec",
      "1 kb/sec",
      "org/maven2/org/apache/maven/doxia/doxia-core/1",
      "skipping",
      "9 kb/sec",
      "report/0",
      "16/maven-surefire-common-2",
      "4/doxia-module-xhtml-1",
      "84%",
      "check",
      "encoding",
      "4/xbean-reflect-3",
      "[info]",
      "maven-resources-plugin:2",
      "------------------------------------------------------------------------ [info]",
      "tests",
      "org/maven2/org/eclipse/jetty/jetty-io/9",
      "org/maven2/org/codehaus/plexus/plexus-compiler-api/2",
      "success",
      "org/maven2/org/apache/maven/maven-model/2 0",
      "org/snapshots/commons-io/commons-io/2 5-snapshot/maven-metadata",
      "http",
      "31 kb",
      "\u003c\u003c\u003c",
      "exec",
      "1/jackson-core-2",
      "1 1/json-smart-2",
      "codehaus org",
      "85%",
      "\u001b[k",
      "41/rest-driver-shared-1",
      "skipped",
      "root",
      "13/slf4j-nop-1",
      "4 kb",
      "org/maven2/org/slf4j/slf4j-api/1",
      "org/maven2/org/apache/maven/plugins/maven-jar-plugin/2",
      "2/doxia-module-xhtml-1",
      "62%",
      "1/system-rules-1",
      "apache org/maven2/org/apache/maven/doxia/doxia-modules/1",
      "1/maven-reporting-api-2",
      "org/maven2/org/apache/httpcomponents/httpcomponents-client/4",
      "up-to-date",
      "19/plexus-interpolation-1 19",
      "detected",
      "3:testcompile",
      "1/json-smart-1",
      "1/json-smart-2",
      "24/152",
      "org/maven2/org/apache/maven/maven-plugin-api/2 0",
      "org/maven2/com/google/code/findbugs/jsr305/2",
      "release",
      "5/plexus-compiler-manager-2",
      "org/maven2/com/google/code/findbugs/jsr305/3",
      "1/objenesis-2",
      "org/maven2/org/apache/maven/maven-plugin-registry/2 0",
      "logbook-httpclient",
      "org/maven2/org/apache/maven/maven/2",
      "logbook-servlet ---",
      "b2/xml-apis-1",
      "8 jar",
      "5 pom",
      "4/4",
      "org/maven2/org/apache/maven/surefire/common-junit48/2",
      "org/maven2/org/apache/maven/maven-plugin-descriptor/2",
      "apache org/maven2/org/codehaus/plexus/plexus-digest/1",
      "apache org/maven2/com/fasterxml/jackson/core/jackson-core/2",
      "apache org/maven2/org/apache/maven/maven-plugin-api/2",
      "using \u0027utf-8\u0027",
      "64%",
      "5/plexus-compiler-api-2",
      "--- jacoco-maven-plugin:0",
      "40%",
      "13/slf4j-api-1 7",
      "201505241946/jacoco-maven-plugin-0",
      "org/maven2/org/apache/maven/surefire/common-junit3/2",
      "7:resources",
      "system",
      "not transfer",
      "2/16",
      "org/maven2/net/bytebuddy/byte-buddy/0",
      "0-snapshot [info]",
      "apache org/maven2/org/apache/maven/doxia/doxia-sink-api/1",
      "1/maven-2",
      "apache org/maven2/org/apache/maven/reporting/maven-reporting-impl/2",
      "org/maven2/org/jacoco/org",
      "assertthat",
      "11/plexus-interpolation-1",
      "8 pom",
      "89%",
      "streamhttplogwritertest",
      "org [info]",
      "org/maven2/org/apache/maven/plugins/maven-clean-plugin/2",
      "5 jar",
      "local",
      "23 kb",
      "org/maven2/org/codehaus/plexus/plexus-classworlds/1",
      "2-0",
      "@ logbook-servlet",
      "52/152",
      "apache org/maven2/org/apache/maven/doxia/doxia-module-fml/1",
      "6/plexus-utils-1",
      "66%",
      "source files",
      "42%",
      "downloading: http://repo",
      "org/maven2/org/ow2/asm/asm-debug-all/5",
      "0/guava-18",
      "default-jar",
      "https://nexus codehaus",
      "201505241946:report",
      "forced original",
      "16/maven-surefire-plugin-2",
      "0/plexus-digest-1 0",
      "release/spring-aop-4 2",
      "2/httpclient-4",
      "67%",
      "43%",
      "16/115",
      "apache org/maven2/org/slf4j/slf4j-parent/1",
      "org/maven2/com/fasterxml/jackson/core/jackson-core/2",
      "[info] ------------------------------------------------------------------------",
      "201505241946:prepare-agent",
      "0 0/json-path-2",
      "--- maven-compiler-plugin:3",
      "2/2",
      "6 kb",
      "org/snapshots/commons-io/commons-io/maven-metadata xml",
      "1/doxia-sink-api-1",
      "11 kb",
      "68%",
      "org/maven2/org/apache/struts/struts-core/1",
      "8/license-maven-plugin-1",
      "201505241946/org",
      "sonatype org/content/repositories/snapshots/commons-io/commons-io/2",
      "3/maven-shared-utils-0",
      "apache org/maven2/org/apache/maven/maven-artifact-manager/2",
      "9/maven-reporting-api-2 0",
      "\u001b[34m\u001b[1mpre-installed",
      "20/37 kb",
      "4/11",
      "18/18",
      "5-20151119",
      "v20140108/jetty-util-9",
      "errors: 0",
      "running",
      "\u001b[0m",
      "0/plexus-utils-3",
      "org/maven2/org/apache/maven/maven-repository-metadata/2",
      "\u001b[0k",
      "resources [info]",
      "commons-io:commons-io:2",
      "1/json-path-0",
      "[info] [info]",
      "0/hamcrest-compose-0",
      "org/maven2/org/eclipse/jetty/jetty-http/9",
      "46%",
      "22%",
      "https://oss sonatype",
      "org/maven2/org/codehaus/plexus/plexus-compiler-javac/2",
      "3/plexus-sec-dispatcher-1",
      "7/plexus-velocity-1",
      "5-snapshot/maven-metadata xml",
      "org/maven2/com/fasterxml/jackson/core/jackson-databind/2",
      "33 kb",
      "7 pom",
      "org/maven2/org/eclipse/jetty/jetty-server/9",
      "223",
      "224",
      "226",
      "org/maven2/commons-chain/commons-chain/1",
      "227",
      "2/doxia-decoration-model-1",
      "apache org/maven2/org/apache/maven/doxia/doxia/1",
      "1/maven-shared-io-1",
      "1/commons-lang3-3 1",
      "4/37",
      "compiling",
      "skipping jacoco",
      "9 1",
      "2/doxia-sink-api-1",
      "downloaded: https://repository",
      "9 1/xercesimpl-2",
      "org/maven2/org/apache/velocity/velocity-tools/2",
      "elapsed: 0",
      "skipped: 0",
      "java",
      "479",
      "1/plexus-archiver-2",
      "jar",
      "7/maven-shared-utils-0 7",
      "existing resourcedirectory",
      "48%",
      "using",
      "201505241946:check",
      "org/maven2/org/slf4j/slf4j-nop/1",
      "8 kb",
      "expected",
      "org/maven2/org/apache/maven/maven-artifact/2",
      "481",
      "org/maven2/com/jayway/jsonpath/json-path-assert/2",
      "11 pom",
      "3/nuiton-processor-1",
      "downloaded: https://repo",
      "245",
      "apache org/maven2/commons-lang/commons-lang/2",
      "6/jcl-over-slf4j-1",
      "5/plexus-utils-3 0",
      "org/maven2/org/apache/maven/surefire/surefire-grouper/2 16/surefire-grouper-2",
      "5 6/plexus-utils-1",
      "time elapsed",
      "8/struts-core-1",
      "org/maven2/commons-logging/commons-logging-api/1",
      "run: 1",
      "version\u001b[0m",
      "from/to codehaus-snapshots",
      "0-alpha-20",
      "org/maven2/org/apache/maven/maven-profile/2 0",
      "pom",
      "default",
      "6 14",
      "31-beta/mockito-core-2",
      "recompiling",
      "http://repo",
      "filtered resources",
      "org/maven2/commons-validator/commons-validator/1",
      "apache org/maven2/org/codehaus/plexus/plexus-container-default/1",
      "apache org/maven2/org/apache/maven/maven-repository-metadata/2",
      "[info] installing",
      "26 kb",
      "apache org/maven2/org/jacoco/org",
      "0-alpha-30",
      "org/maven2/oro/oro/2",
      "zalando logbook",
      "266",
      "1/gag-1 0",
      "org/maven2/org/apache/maven/maven-project/2 0",
      "https://repo maven",
      "36/115",
      "4/maven-shared-utils-0",
      "jacoco agent-0",
      "7 0",
      "6/16",
      "9 jar",
      "13/jcl-over-slf4j-1",
      "failures: 0",
      "org/maven2/org/apache/maven/maven/2 0",
      "run",
      "source",
      "7 5",
      "271",
      "org/maven2/org/apache/maven/maven-model/2",
      "org/maven2/org/springframework/spring-expression/4",
      "2-0/sslext-1",
      "278",
      "0/javax",
      "4/maven-jar-plugin-2",
      "10 pom",
      "org/maven2/org/glassfish/javax",
      "3:compile",
      "--- maven-resources-plugin:2",
      "13/slf4j-api-1",
      "downloaded",
      "283",
      "release/spring-beans-4",
      "org/maven2/org/nuiton/processor/nuiton-processor/1",
      "14 kb",
      "16/common-junit3-2",
      "0/json-path-2",
      "org/maven2/org/apache/maven/maven-plugin-parameter-documenter/2",
      "2/doxia-module-fml-1",
      "201505241946/org jacoco",
      "org/maven2/org/springframework/spring-web/4 2",
      "updates",
      "non",
      "2/doxia-modules-1",
      "52/152 kb",
      "not",
      "org/maven2/org/apache/maven/reporting/maven-reporting/2",
      "4/commons-io-2",
      "9 pom",
      "org/maven2/org/apache/maven/maven-archiver/2",
      "4/4 kb",
      "org/maven2/org/apache/maven/maven-artifact/2 0",
      "0/hamcrest-junit-2",
      "[info] compiling",
      "org/maven2/commons-codec/commons-codec/1 9/commons-codec-1",
      "apache org/snapshots/commons-io/commons-io/2",
      "junit",
      "org/maven2/javax/servlet/javax",
      "release/spring-core-4",
      "resolving",
      "release/spring-aop-4",
      "212356-154",
      "reattempted",
      "apache org/maven2/org/apache/maven/maven-core/2",
      "org/maven2/org/springframework/spring-web/4",
      "apache org/maven2/com/fasterxml/jackson/core/jackson-annotations/2",
      "48/115 kb",
      "time",
      "6/slf4j-jdk14-1",
      "1/commons-lang3-3",
      "org/maven2/org/apache/maven/maven-project/2",
      "5 1",
      "apache org/maven2/commons-beanutils/commons-beanutils/1",
      "foo\\n",
      "5/plexus-compiler-javac-2",
      "5 5",
      "5 6",
      "[info] using",
      "4/37 kb",
      "org/maven2/commons-lang/commons-lang/2",
      "org/maven2/org/apache/maven/doxia/doxia-core/1 5/doxia-core-1",
      "6/maven-reporting-api-2",
      "41 kb",
      "org/maven2/org/springframework/spring-beans/4",
      "apache org/maven2/org/slf4j/slf4j-api/1",
      "v20140108/jetty-io-9 1",
      "0-alpha-7/doxia-sink-api-1 0-alpha-7",
      "0-alpha-7/doxia-sink-api-1",
      "org/maven2/org/hamcrest/hamcrest-library/1 3/hamcrest-library-1",
      "8/struts-taglib-1",
      "18 kb",
      "0-snapshot jar",
      "org/maven2/org/apache/maven/doxia/doxia-site-renderer/1",
      "apache org/maven2/org/springframework/spring-aop/4",
      "org/maven2/org/apache/maven/maven-settings/2",
      "4/115",
      "2/doxia-sitetools-1",
      "11-beta-1",
      "org/maven2/org/slf4j/slf4j-jdk14/1",
      "org/maven2/org/apache/xbean/xbean-reflect/3",
      "module [info]",
      "receiving",
      "apache org/maven2/xerces/xercesimpl/2",
      "0 time",
      "report-0",
      "release/spring-webmvc-4",
      "agent/0",
      "https://nexus",
      "nexus codehaus",
      "skip non",
      "24/152 kb",
      "@ logbook-httpclient",
      "5/maven-archiver-2",
      "68/115 kb",
      "apache org/maven2/org/apache/maven/maven-error-diagnostics/2",
      "org/maven2/org/sonatype/plexus/plexus-sec-dispatcher/1",
      "2/doxia-1",
      "release/spring-context-4",
      "--- [info]",
      "7:testresources",
      "[info] changes",
      "2/maven-reporting-impl-2",
      "org/maven2/org/apache/maven/surefire/surefire-junit47/2 16/surefire-junit47-2",
      "18/18 kb",
      "org/maven2/org/codehaus/plexus/plexus-archiver/2",
      "3 0",
      "3 1",
      "org/maven2/org/apache/commons/commons-lang3/3",
      "0/aopalliance-1",
      "4/maven-install-plugin-2",
      "5-snapshot/commons-io-2",
      "3 8",
      "commons-io:commons-io:2 5-snapshot/maven-metadata",
      "from/to",
      "4 kb/sec",
      "codehaus-snapshots https://nexus",
      "receiving objects",
      "1/junit-3",
      "2/commons-collections-3",
      "[warning]",
      "org/maven2/org/apache/struts/struts-taglib/1",
      "0-alpha-4",
      "0-alpha-6",
      "0-alpha-7",
      "0 4/plexus-build-api-0",
      "agent-0",
      "done",
      "transfer",
      "201505241946-runtime",
      "32/115",
      "0 skipped",
      "org/maven2/org/hamcrest/hamcrest-library/1",
      "5/plexus-compiler-manager-2 5",
      "resolution will",
      "apache org/maven2/org/apache/maven/maven-plugin-parameter-documenter/2",
      "org/maven2/classworlds/classworlds/1",
      "apache org/maven2/org/apache/maven/reporting/maven-reporting-api/2",
      "org/maven2/org/codehaus/plexus/plexus/1 0",
      "reactor",
      "apache org/maven2/org/apache/maven/maven-plugin-registry/2",
      "2/commons-io-2",
      "61 kb",
      "5-snapshot/maven-metadata",
      "org/maven2/org/apache/maven/surefire/common-java5/2",
      "31-beta",
      "deltas",
      "original",
      "org/maven2/org/apache/maven/surefire/common-junit4/2 16/common-junit4-2",
      "maven-surefire-plugin:2",
      "resourcedirectory",
      "48/115",
      "org/maven2/commons-logging/commons-logging/1 0",
      "org/maven2/commons-logging/commons-logging/1 1",
      "build",
      "org/maven2/org/apache/maven/shared/maven-shared-io/1",
      "org/maven2/org/apache/maven/surefire/surefire-junit47/2",
      "org/maven2/org/springframework/spring-expression/4 2",
      "16 kb",
      "16/common-junit48-2",
      "1 0",
      "1 1",
      "1 2",
      "1 3",
      "\u0027utf-8\u0027 encoding",
      "servlet",
      "1 7",
      "maven apache",
      "org/maven2/org/hamcrest/hamcrest-junit/2",
      "apache org/maven2/org/codehaus/plexus/plexus-utils/1",
      "apache org/maven2/org/codehaus/plexus/plexus-utils/3",
      "3/hamcrest-library-1",
      "1/maven-plugin-api-2",
      "91%",
      "b2",
      "org/maven2/org/apache/maven/plugins/maven-surefire-plugin/2",
      "8/oro-2",
      "apache org/maven2/commons-logging/commons-logging/1",
      "compressing",
      "apache org/maven2/org/codehaus/plexus/plexus-compiler-manager/2",
      "12/log4j-1",
      "92%",
      "https://repository apache",
      "13/slf4j-simple-1",
      "10 kb",
      "org/maven2/org/apache/maven/shared/file-management/1",
      "org/maven2/net/minidev/asm/1",
      "org/maven2/org/apache/maven/reporting/maven-reporting-impl/2 2/maven-reporting-impl-2",
      "1/xercesimpl-2",
      "zalando",
      "org [warning]",
      "xml downloading",
      "5/jcl-over-slf4j-1",
      "apache org/maven2/net/minidev/json-smart/2",
      "sec",
      "search",
      "0/java-hamcrest-2",
      "org/maven2/org/codehaus/plexus/plexus-utils/1 4",
      "org/maven2/org/codehaus/plexus/plexus-utils/1 5",
      "org/maven2/org/apache/maven/surefire/maven-surefire-common/2",
      "14 pom",
      "pom 15",
      "64/115",
      "pom 10",
      "set",
      "org/maven2/com/google/gag/gag/1 0",
      "2/doxia-site-renderer-1",
      "org/maven2/org/apache/maven/surefire/surefire-grouper/2",
      "org/maven2/org/apache/maven/plugin-tools/maven-plugin-annotations/3",
      "11/plexus-interpolation-1 11",
      "apache org/maven2/org/apache/maven/maven-project/2",
      "3 kb",
      "org/maven2/org/apache/maven/surefire/common-java5/2 16/common-java5-2",
      "apache org/maven2/commons-io/commons-io/2",
      "0/jackson-core-2",
      "org/maven2/com/fasterxml/jackson/core/jackson-annotations/2",
      "@ logbook-core",
      "org/maven2/junit/junit/3",
      "org/maven2/commons-httpclient/commons-httpclient/3",
      "org/maven2/junit/junit/4",
      "org/maven2/org/apache/maven/shared/maven-shared-utils/0",
      "1/file-management-1",
      "19 kb",
      "org/maven2/org/apache/maven/plugins/maven-resources-plugin/2",
      "org/content/repositories/releases/junit/junit-dep/maven-metadata xml",
      "6-snapshot/maven-metadata",
      "15 jar",
      "codehaus",
      "95%",
      "default-install",
      "apache org/maven2/org/codehaus/plexus/plexus-components/1",
      "prepare-agent",
      "2/maven-plugin-annotations-3",
      "0 jar",
      "matcherassert",
      "10 0-snapshot",
      "1/plexus-utils-1",
      "3/httpcore-4 4",
      "96%",
      "apache org/maven2/org/apache/maven/maven-artifact/2",
      "0-beta-7/plexus-i18n-1",
      "org/maven2/org/codehaus/plexus/plexus-velocity/1",
      "v20140108/jetty-server-9",
      "org/maven2/org/apache/maven/surefire/surefire-api/2",
      "0/commons-validator-1",
      "logbook-core",
      "1/commons-chain-1",
      "v20140108/jetty-http-9",
      "agent/0 7",
      "6-20151126",
      "0/velocity-tools-2",
      "32/115 kb",
      "pom 8",
      "pom 9",
      "license-maven-plugin:1",
      "pom 6",
      "org/maven2/org/apache/maven/plugins/maven-compiler-plugin/3",
      "pom 7",
      "5 1/plexus-utils-1",
      "pom 4",
      "pom 5",
      "apache org/maven2/org/apache/maven/maven-monitor/2",
      "41/rest-client-driver-1",
      "pom 2",
      "org/maven2/asm/asm/3",
      "pom 3",
      "2/plexus-io-2",
      "4/doxia-module-fml-1",
      "97%",
      "0 release/spring-web-4",
      "16/surefire-api-2",
      "logbook-httpclient ---",
      "15 pom",
      "org/maven2/org/jacoco/jacoco-maven-plugin/0",
      "logbook: core",
      "apache org/maven2/commons-cli/commons-cli/1",
      "5/doxia-core-1",
      "org/maven2/org/codehaus/plexus/plexus-utils/3 0",
      "84/115 kb",
      "client",
      "0_31",
      "1 41",
      "org/maven2/org/apache/maven/reporting/maven-reporting-api/2 0",
      "default-compile",
      "org/maven2/org/slf4j/slf4j-parent/1 7",
      "org/maven2/org/apache/maven/shared/maven-shared-incremental/1",
      "201505241946",
      "98%",
      "74%",
      "argline",
      "2/doxia-logging-api-1",
      "50%",
      "0 pom",
      "5/plexus-utils-3",
      "org/maven2/org/apache/maven/maven-core/2",
      "apache org/maven2/org/eclipse/jetty/jetty-io/9",
      "7/maven-resources-plugin-2",
      "home",
      "existing",
      "5/plexus-utils-1",
      "org/maven2/commons-collections/commons-collections/3",
      "local repository",
      "28/37 kb",
      "org/maven2/commons-collections/commons-collections/2",
      "apache org/maven2/org/apache/httpcomponents/httpcore/4",
      "org/maven2/org/apache/maven/doxia/doxia/1",
      "org/maven2/org/apache/maven/maven-error-diagnostics/2",
      "remote: compressing",
      "org/maven2/org/springframework/spring-core/4",
      "20/37",
      "16/common-java5-2",
      "5/velocity-1",
      "51%",
      "apache org/maven2/org/apache/maven/doxia/doxia-site-renderer/1",
      "logbook: servlet",
      "org/maven2/xmlunit/xmlunit/1",
      "4/xmlunit-1",
      "6-snapshot/commons-io-2 6-20151126",
      "org/maven2/commons-codec/commons-codec/1",
      "org/maven2/org/apache/maven/doxia/doxia-sitetools/1",
      "[info] ---",
      "[info] skip",
      "76%",
      "52%",
      "https://oss",
      "apache org/maven2/com/jayway/jsonpath/json-path/2",
      "16/115 kb",
      "13 pom",
      "apache org/maven2/org/hamcrest/hamcrest-core/1",
      "org/maven2/org/freemarker/freemarker/2",
      "apache org/maven2/org/apache/maven/doxia/doxia-sitetools/1",
      "org/maven2/org/codehaus/plexus/plexus-utils/3",
      "org/maven2/org/codehaus/plexus/plexus-utils/1",
      "5 kb",
      "interval",
      "org/maven2/commons-logging/commons-logging/1",
      "apache org/maven2/commons-collections/commons-collections/3",
      "release/spring-test-4",
      "46 kb",
      "server",
      "http://repo maven",
      "org/maven2/org/springframework/spring-test/4",
      "org/maven2/org/codehaus/plexus/plexus-io/2",
      "77%",
      "1 v20140108",
      "53%",
      "jacoco agent/0",
      "skip",
      "org/maven2/xml-apis/xml-apis/1",
      "41 pom",
      "apache org/maven2/org/apache/maven/maven-profile/2",
      "org/maven2/org/apache/maven/shared/maven-filtering/1",
      "kb",
      "3/3",
      "4/commons-logging-1",
      "org/maven2/org/apache/maven/doxia/doxia-module-xhtml/1",
      "0/jackson-annotations-2",
      "default-testcompile",
      "13 jar",
      "54%",
      "5/plexus-component-annotations-1",
      "copy filtered",
      "org/maven2/org/apache/maven/doxia/doxia-modules/1",
      "3/3 kb",
      "1/httpcore-4",
      "apache org/maven2/log4j/log4j/1",
      "org/maven2/org/apache/maven/surefire/common-junit4/2",
      "org/maven2/org/hamcrest/java-hamcrest/2",
      "report",
      "308",
      "309",
      "12 kb",
      "15/plexus-utils-1",
      "org/maven2/org/apache/maven/plugins/maven-clean-plugin/2 5/maven-clean-plugin-2",
      "org/maven2/org/apache/maven/maven-artifact-manager/2 0",
      "79%",
      "15/plexus-utils-3",
      "org/maven2/com/google/collections/google-collections/1",
      "org/maven2/junit/junit-dep/4",
      "2 kb/sec",
      "downloading",
      "6/16 kb",
      "7 kb/sec",
      "jacoco-maven-plugin:0 7",
      "2/doxia-core-1",
      "12 pom",
      "15/plexus-utils-1 5",
      "56%",
      "exec [info]",
      "apache org/maven2/org/slf4j/jcl-over-slf4j/1",
      "32%",
      "org/maven2/junit/junit/3 8",
      "org/content/repositories/snapshots/commons-io/commons-io/2",
      "org/maven2/org/apache/struts/struts-tiles/1",
      "563",
      "apache org/maven2/org/apache/maven/maven-plugin-descriptor/2",
      "header",
      "errors",
      "nexus",
      "apache org/maven2/org/codehaus/plexus/plexus-interpolation/1",
      "org/maven2/org/slf4j/slf4j-simple/1",
      "5 201505241946/org",
      "15/plexus-interpolation-1",
      "release/spring-beans-4 2",
      "6/commons-lang-2",
      "maven-install-plugin:2",
      "installing",
      "elapsed",
      "apache org/maven2/org/apache/commons/commons-lang3/3",
      "total",
      "04/xml-apis-1",
      "apache org/maven2/org/apache/maven/doxia/doxia-core/1",
      "16/surefire-grouper-2",
      "apache org/maven2/org/sonatype/plexus/plexus-build-api/0",
      "https://repository",
      "22 kb",
      "execution",
      "v20140108",
      "org/maven2/sslext/sslext/1",
      "58%",
      "jacoco",
      "0 release",
      "2/commons-codec-1",
      "1/asm-debug-all-5 0",
      "16/37 kb",
      "101",
      "1/commons-httpclient-3",
      "12 jar",
      "102",
      "3/maven-compiler-plugin-3",
      "104",
      "due",
      "0%",
      "107",
      "7 kb",
      "109",
      "v20140108/jetty-io-9",
      "m2/repository/org/jacoco/org",
      "apache org/maven2/org/apache/maven/shared/maven-shared-utils/0",
      "logbook: http",
      "84/115",
      "metadata",
      "35%",
      "org/maven2/org/apache/velocity/velocity/1",
      "org/maven2/org/apache/maven/doxia/doxia-logging-api/1",
      "04",
      "0/google-collections-1",
      "v20140108/jetty-server-9 1",
      "org/snapshots/commons-io/commons-io/2",
      "org/maven2/org/apache/maven/doxia/doxia-decoration-model/1",
      "org/maven2/org/slf4j/jcl-over-slf4j/1",
      "4/doxia-site-renderer-1",
      "592",
      "350",
      "1/commons-io-2",
      "111",
      "112",
      "1/jackson-databind-2",
      "115",
      "release pom",
      "org/maven2/org/codehaus/plexus/plexus-containers/1",
      "org/maven2/org/codehaus/plexus/plexus-utils/3 0/plexus-utils-3",
      "apache org/maven2/org/apache/maven/doxia/doxia-module-xhtml/1",
      "117",
      "15 kb",
      "118",
      "68/115",
      "org/snapshots/junit/junit-dep/maven-metadata",
      "release jar",
      "10",
      "11",
      "12",
      "13",
      "14",
      "15",
      "16",
      "logbook-core ---",
      "17",
      "module",
      "18",
      "182804-8",
      "19",
      "org/maven2/com/jayway/jsonpath/json-path/0",
      "org/maven2/org/ow2/asm/asm-debug-all/5 0",
      "org/maven2/com/jayway/jsonpath/json-path/2",
      "org/maven2/org/apache/maven/maven-profile/2",
      "122",
      "execution due",
      "servlet-3",
      "128",
      "org/maven2/org/apache/maven/maven-toolchain/2",
      "7/maven-shared-utils-0",
      "20",
      "3 pom",
      "21",
      "22",
      "23",
      "37%",
      "24",
      "org/maven2/org/apache/httpcomponents/httpcore/4",
      "25",
      "26",
      "9/commons-codec-1",
      "27",
      "[info] logbook",
      "3/commons-codec-1",
      "29",
      "org/maven2/org/apache/maven/maven-plugin-registry/2",
      "scan",
      "8 1",
      "8 2",
      "s]",
      "131",
      "3%",
      "137",
      "3/httpcore-4",
      "138",
      "139",
      "1/maven-reporting-impl-2",
      "17/log4j-1",
      "30",
      "31",
      "5 201505241946",
      "32",
      "33",
      "org/maven2/org/mockito/mockito-core/2",
      "34",
      "14%",
      "org/maven2/commons-cli/commons-cli/1 2/commons-cli-1",
      "36",
      "37",
      "64-bit",
      "org/maven2/net/minidev/json-smart/2",
      "39",
      "org/maven2/net/minidev/json-smart/1",
      "non existing",
      "apache org/maven2/commons-codec/commons-codec/1",
      "3 jar",
      "563 b",
      "servlet/3",
      "release/spring-expression-4",
      "145",
      "146",
      "running org",
      "147",
      "148",
      "4/plexus-build-api-0",
      "0/commons-beanutils-1",
      "tm",
      "37 kb",
      "40",
      "41",
      "43",
      "org/maven2/org/codehaus/plexus/plexus-components/1",
      "44",
      "core/0",
      "45",
      "org/maven2/org/apache/maven/maven-plugin-api/2",
      "46",
      "47",
      "kb/sec [info]",
      "9 kb",
      "49",
      "forced",
      "xml [info]",
      "release/spring-web-4",
      "org/maven2/org/codehaus/plexus/plexus/1",
      "org/maven2/org/codehaus/plexus/plexus/2",
      "org/maven2/org/codehaus/plexus/plexus-digest/1",
      "25 kb",
      "151",
      "---",
      "152",
      "4 pom",
      "154",
      "tests run",
      "155",
      "16/surefire-booter-2",
      "3 kb/sec",
      "apache",
      "org/maven2/org/codehaus/plexus/plexus-component-annotations/1",
      "org/maven2/org/codehaus/plexus/plexus/3",
      "org/maven2/org/projectlombok/lombok/1",
      "https://repo",
      "0/json-path-assert-2",
      "-javaagent:/home/travis/",
      "8 kb/sec",
      "org/maven2/xml-apis/xml-apis/1 3",
      "0 kb/sec",
      "50",
      "apache org/maven2/junit/junit/4",
      "51",
      "apache org/maven2/org/apache/maven/reporting/maven-reporting/2",
      "apache org/maven2/junit/junit/3",
      "52",
      "org/maven2/org/codehaus/plexus/plexus-components/1 1",
      "6/slf4j-api-1",
      "54",
      "16%",
      "55",
      "56",
      "5/doxia-logging-api-1",
      "57",
      "oracle",
      "59",
      "downloaded: http://repo",
      "0 release/spring-expression-4",
      "1/commons-validator-1",
      "org/maven2/org/slf4j/slf4j-api/1 5",
      "codehaus org/snapshots/",
      "org/maven2/com/github/stefanbirkner/system-rules/1",
      "1/asm-debug-all-5",
      "org/maven2/org/springframework/spring-context/4",
      "org/maven2/org/slf4j/slf4j-api/1 7",
      "apache org/maven2/org/eclipse/jetty/jetty-server/9",
      "7 13",
      "apache org/maven2/org/springframework/spring-beans/4",
      "failure",
      "1/commons-lang-2",
      "vm",
      "52 kb",
      "servlet-api-3",
      "60",
      "61",
      "64",
      "pom [info]",
      "65",
      "66",
      "67",
      "1/doxia-logging-api-1",
      "68",
      "4 jar",
      "core-0",
      "2/junit-3",
      "6 1",
      "2/junit-4",
      "changes",
      "update",
      "org/maven2/org/sonatype/plexus/plexus-build-api/0",
      "171",
      "org/maven2/org/hamcrest/hamcrest-parent/1",
      "org/maven2/org/codehaus/plexus/plexus-compiler-manager/2",
      "missing",
      "/home/travis/",
      "org/maven2/org/codehaus/plexus/plexus-container-default/1",
      "71",
      "8 0_31",
      "73",
      "checkout",
      "org/maven2/org/springframework/spring-webmvc/4",
      "75",
      "5/doxia-sink-api-1",
      "13 kb",
      "77",
      "78",
      "2/16 kb",
      "default-test",
      "4/commons-lang-2",
      "org",
      "1/backport-util-concurrent-3",
      "180",
      "org/maven2/org/apache/maven/doxia/doxia-sink-api/1",
      "org/maven2/org/apache/maven/maven-repository-metadata/2 0",
      "6/lombok-1",
      "org/maven2/org/apache/maven/shared/maven-shared-utils/0 4/maven-shared-utils-0",
      "1/httpclient-4",
      "3/commons-logging-1",
      "org/maven2/org/springframework/spring-aop/4",
      "servlet-api/3",
      "\u0027utf-8\u0027",
      "81",
      "org/maven2/org/eclipse/jetty/jetty-util/9",
      "19%",
      "85",
      "2/maven-filtering-1",
      "87",
      "88",
      "16/common-junit4-2",
      "16 jar",
      "37/37",
      "190",
      "apache org/maven2/junit/junit-dep/4",
      "org/maven2/commons-beanutils/commons-beanutils/1",
      "192",
      "org zalando",
      "repository",
      "apache org/maven2/org/apache/maven/maven-model/2",
      "org/maven2/org/hobsoft/hamcrest/hamcrest-compose/0",
      "org/maven2/org/apache/httpcomponents/httpcore/4 4",
      "filtered",
      "org/maven2/org/jacoco/org jacoco",
      "4/115 kb",
      "apache org/maven2/org/apache/httpcomponents/httpclient/4",
      "90",
      "0/jsr305-3",
      "91",
      "14/byte-buddy-0",
      "94",
      "org/maven2/com/google/guava/guava/18",
      "1 pom",
      "96",
      "org/maven2/aopalliance/aopalliance/1",
      "default-resources",
      "97",
      "98",
      "downloading: https://repo",
      "metadata commons-io:commons-io:2",
      "org/maven2/org/slf4j/jcl-over-slf4j/1 7",
      "org/maven2/org/apache/httpcomponents/httpclient/4",
      "4:jar",
      "jar [info]",
      "apache org/maven2/commons-digester/commons-digester/1",
      "org/maven2/com/github/rest-driver/rest-client-driver/1",
      "28/152",
      "hotspot",
      "37/37 kb",
      "4 3",
      "4 4",
      "org/maven2/log4j/log4j/1 2",
      "0/jackson-databind-2",
      "8:update-file-header",
      "assert",
      "cached",
      "16:test",
      "copy",
      "17 kb",
      "64/115 kb",
      "maven-compiler-plugin:3",
      "16/surefire-junit47-2",
      "org/snapshots/junit/junit-dep/maven-metadata xml",
      "apache org/maven2/org/apache/maven/maven/2",
      "1 jar",
      "execution data",
      "apache org/maven2/org/apache/maven/doxia/doxia-decoration-model/1",
      "16 pom",
      "org/snapshots/commons-io/commons-io/maven-metadata",
      "org/maven2/org/codehaus/plexus/plexus-i18n/1",
      "org/snapshots/",
      "0/commons-cli-1",
      "5/maven-clean-plugin-2",
      "data",
      "org/maven2/org/codehaus/plexus/plexus/2 0",
      "2/commons-logging-1",
      "org/maven2/org/apache/maven/surefire/surefire-booter/2",
      "org/content/repositories/releases/junit/junit-dep/maven-metadata",
      "kb/sec",
      "v20140108 pom",
      "1/commons-collections-3",
      "28/152 kb",
      "1/maven-shared-incremental-1",
      "6-snapshot/maven-metadata xml",
      "1/commons-logging-1",
      "5 kb/sec",
      "36/115 kb",
      "changes detected",
      "maven",
      "apache org/maven2/xml-apis/xml-apis/1",
      "maven-jar-plugin:2",
      "2 pom",
      "core",
      "org/maven2/commons-digester/commons-digester/1",
      "4/plexus-cipher-1",
      "201505241946 jar",
      "12/log4j-1 2",
      "downloading: https://repository",
      "2/commons-cli-1",
      "8/struts-tiles-1",
      "files",
      "org/snapshots/ ",
      "6-snapshot/commons-io-2",
      "org/maven2/com/google/gag/gag/1",
      "2 0",
      "2 1",
      "2 2",
      "org/maven2/org/apache/httpcomponents/project/4",
      "error",
      "4:install",
      "1/gag-1",
      "1/asm-3",
      "git",
      "apache org/maven2/commons-validator/commons-validator/1",
      "org/maven2/commons-io/commons-io/2",
      "12/junit-4",
      "default-testresources",
      "[error]",
      "0-alpha-4/plexus-interactivity-api-1",
      "mvn",
      "org/maven2/org/slf4j/slf4j-parent/1",
      "will",
      "resources",
      "sonatype",
      "codehaus-snapshots",
      "agent-0 7",
      "org/maven2/org/apache/maven/maven-monitor/2",
      "xml from/to",
      "2/asm-1",
      "201505241946 pom",
      "2 jar"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/zalando/logbook/commit/87fa2234a9e5a7f455a70a9430f1b07ca98e8466",
      "files": [
        {
          "file_name": "logbook-core/pom.xml",
          "patch": "@@ -31,6 +31,13 @@\n                 \u003cartifactId\u003elicense-maven-plugin\u003c/artifactId\u003e\n             \u003c/plugin\u003e\n             \u003cplugin\u003e\n+                \u003cgroupId\u003eorg.apache.maven.plugins\u003c/groupId\u003e\n+                \u003cartifactId\u003emaven-surefire-plugin\u003c/artifactId\u003e\n+                \u003cconfiguration\u003e\n+                    \u003cparallel\u003eclasses\u003c/parallel\u003e\n+                \u003c/configuration\u003e\n+            \u003c/plugin\u003e\n+            \u003cplugin\u003e\n                 \u003cgroupId\u003eorg.jacoco\u003c/groupId\u003e\n                 \u003cartifactId\u003ejacoco-maven-plugin\u003c/artifactId\u003e\n             \u003c/plugin\u003e"
        }
      ]
    }
  },
  {
    "name": "race condition with creating symlink",
    "url": "https://github.com/bouncestorage/bouncestorage/issues/240",
    "description": "if application writes to a blob that\u0027s being moved, bounce could overwrite the new object with symlink and lose the new object\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/bouncestorage/bouncestorage/commit/2b06129d04bcb7e279a6d3aed5f63a7f3ac38e5b",
      "files": [
        {
          "file_name": "bounce/src/main/java/com/bouncestorage/bounce/admin/policy/WriteBackPolicy.java",
          "patch": "@@ -25,6 +25,7 @@\n import java.util.stream.StreamSupport;\n \n import javax.ws.rs.ClientErrorException;\n+import javax.ws.rs.ServiceUnavailableException;\n import javax.ws.rs.core.Response;\n \n import com.bouncestorage.bounce.BlobStoreTarget;\n@@ -33,6 +34,7 @@\n import com.bouncestorage.bounce.Utils;\n import com.bouncestorage.bounce.admin.BounceApplication;\n import com.bouncestorage.bounce.admin.BouncePolicy;\n+import com.bouncestorage.bounce.utils.ReconcileLocker;\n import com.google.auto.service.AutoService;\n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.collect.ImmutableSet;\n@@ -78,6 +80,7 @@\n     private static final ListContainerOptions LIST_CONTAINER_RECURSIVE \u003d new ListContainerOptions().recursive();\n     protected Duration copyDelay;\n     protected Duration evictDelay;\n+    private ReconcileLocker reconcileLocker \u003d new ReconcileLocker();\n \n     public static boolean isMarkerBlob(String name) {\n         return name.endsWith(LOG_MARKER_SUFFIX);\n@@ -144,14 +147,17 @@ public boolean deleteContainerIfEmpty(String container) {\n \n     @Override\n     public String putBlob(String containerName, Blob blob, PutOptions options) {\n-        if (blob.getMetadata().getName().startsWith(INTERNAL_PREFIX)) {\n+        String blobName \u003d blob.getMetadata().getName();\n+        if (blobName.startsWith(INTERNAL_PREFIX)) {\n             throw new UnsupportedOperationException(\"illegal prefix\");\n         }\n-        putMarkerBlob(containerName, blob.getMetadata().getName());\n-        String etag \u003d getSource().putBlob(containerName, blob, options);\n-        String blobName \u003d blob.getMetadata().getName();\n-        enqueueReconcile(containerName, blobName);\n-        return etag;\n+\n+        try (ReconcileLocker.LockKey ignored \u003d reconcileLocker.lockObject(containerName, blobName, false)) {\n+            putMarkerBlob(containerName, blobName);\n+            String etag \u003d getSource().putBlob(containerName, blob, options);\n+            enqueueReconcile(containerName, blobName);\n+            return etag;\n+        }\n     }\n \n     @Override\n@@ -304,25 +310,30 @@ private BounceResult reconcileObject(String container, String blob)\n     @Override\n     public BounceResult reconcileObject(String container, BounceStorageMetadata sourceObject, StorageMetadata\n             destinationObject) {\n-        logger.debug(\"reconciling {}\", sourceObject \u003d\u003d null ? destinationObject.getName() : sourceObject.getName());\n-        if (sourceObject !\u003d null) {\n-            logger.debug(\"reconciling {} {} {}\", sourceObject.getName(),\n-                    destinationObject \u003d\u003d null ? \"null\" : destinationObject.getName(), sourceObject.getRegions());\n-            try {\n-                if (isEvict() \u0026\u0026 isObjectExpired(sourceObject, evictDelay)) {\n-                    return maybeMoveObject(container, sourceObject, destinationObject);\n-                } else if (isCopy() \u0026\u0026 (isImmediateCopy() || isObjectExpired(sourceObject, copyDelay))) {\n-                    return maybeCopyObject(container, sourceObject, destinationObject);\n+        String blobName \u003d sourceObject \u003d\u003d null ? destinationObject.getName() : sourceObject.getName();\n+        try (ReconcileLocker.LockKey ignored \u003d reconcileLocker.lockObject(container, blobName, true)) {\n+            logger.debug(\"reconciling {}\", blobName);\n+            if (sourceObject !\u003d null) {\n+                logger.debug(\"reconciling {} {} {}\", sourceObject.getName(),\n+                        destinationObject \u003d\u003d null ? \"null\" : destinationObject.getName(), sourceObject.getRegions());\n+                try {\n+                    if (isEvict() \u0026\u0026 isObjectExpired(sourceObject, evictDelay)) {\n+                        return maybeMoveObject(container, sourceObject, destinationObject);\n+                    } else if (isCopy() \u0026\u0026 (isImmediateCopy() || isObjectExpired(sourceObject, copyDelay))) {\n+                        return maybeCopyObject(container, sourceObject, destinationObject);\n+                    }\n+                } catch (IOException e) {\n+                    throw propagate(e);\n                 }\n-            } catch (IOException e) {\n-                throw propagate(e);\n-            }\n \n+                return BounceResult.NO_OP;\n+            } else {\n+                logger.debug(\"reconciling null {}\", destinationObject.getName());\n+                getDestination().removeBlob(container, destinationObject.getName());\n+                return BounceResult.REMOVE;\n+            }\n+        } catch (ServiceUnavailableException e) {\n             return BounceResult.NO_OP;\n-        } else {\n-            logger.debug(\"reconciling null {}\", destinationObject.getName());\n-            getDestination().removeBlob(container, destinationObject.getName());\n-            return BounceResult.REMOVE;\n         }\n     }\n "
        }
      ]
    }
  },
  {
    "name": "Fix race condition in P1.memo()",
    "url": "https://github.com/functionaljava/functionaljava/pull/106",
    "description": "The race was when two thread encountered the uninitialized state, `a \u003d\u003d null`.\nOne thread gets suspended before entering the `synchronized` block, while the other runs though it. The latter thread sets `v` to something not null. Then the first thread resumes, enters the `synchronized` block and checks if `(v \u003d\u003d null || v.get() \u003d\u003d null)` which is now false, and thus returns the still uninitialized `a`.\n\nFixes #105\n",
    "keywords": [
      "\u003d\u003d",
      "null",
      "thread"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/functionaljava/functionaljava/commit/7ca522d673ae1742657c1e93045b7299e93e7216",
      "files": [
        {
          "file_name": "core/src/main/java/fj/P1.java",
          "patch": "@@ -223,9 +223,12 @@ public A _1() {\n             A a \u003d v !\u003d null ? v.get() : null;\n             if (a \u003d\u003d null)\n               synchronized (latch) {\n-                if (v \u003d\u003d null || v.get() \u003d\u003d null)\n+                if (v \u003d\u003d null || v.get() \u003d\u003d null) {\n                   a \u003d self._1();\n-                v \u003d new SoftReference\u003cA\u003e(a);\n+                  v \u003d new SoftReference\u003cA\u003e(a);\n+                } else {\n+                  a \u003d v.get();\n+                }\n               }\n             return a;\n           }"
        },
        {
          "file_name": "core/src/test/java/fj/P1Test.java",
          "patch": "@@ -0,0 +1,31 @@\n+package fj;\n+\n+import org.junit.Test;\n+\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+public final class P1Test {\n+\n+  @Test\n+  public void bug105() throws Exception {\n+    final P1\u003cString\u003e p1 \u003d P.p(\"Foo\").memo();\n+    final AtomicInteger nullCounter \u003d new AtomicInteger();\n+    ExecutorService executorService \u003d Executors.newCachedThreadPool();\n+\n+    for (int i \u003d 0; i \u003c 10000; i++) {\n+      executorService.submit(() -\u003e {\n+        if (p1._1() \u003d\u003d null) {\n+          nullCounter.incrementAndGet();\n+        }\n+      });\n+    }\n+\n+    executorService.shutdown();\n+    executorService.awaitTermination(10, TimeUnit.DAYS);\n+\n+    org.junit.Assert.assertEquals(\"Race condition in P1.memo()\", 0, nullCounter.get());\n+  }\n+}"
        }
      ]
    }
  },
  {
    "name": "Fix problem caused by race condition in scope creation",
    "url": "https://github.com/Red5/red5-server/pull/15",
    "description": "Now the scope is set whether or not the scope creation is successful.\nThis ensures that if two connections try to create the same scope at\nthe same time, both will end up with the right scope.\n\nThis fixes the bug reported at Red5/red5-server#14.\n",
    "keywords": [
      "scope"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/Red5/red5-server/commit/8276e6caa29ef44163830b806750640301494ddf",
      "files": [
        {
          "file_name": "src/main/java/org/red5/server/scope/ScopeResolver.java",
          "patch": "@@ -95,16 +95,14 @@ public IScope resolveScope(IScope root, String path) {\n \t\t\t\t\t// skip empty path elements\r\n \t\t\t\t\tcontinue;\r\n \t\t\t\t}\r\n-\t\t\t\tif (scope.hasChildScope(child)) {\r\n-\t\t\t\t\tscope \u003d scope.getScope(child);\r\n-\t\t\t\t} else if (!scope.equals(root)) {\r\n-\t\t\t\t\t// no need for sync here, scope.children is concurrent\r\n-\t\t\t\t\tif (scope.createChildScope(child)) {\r\n-\t\t\t\t\t\tscope \u003d scope.getScope(child);\r\n-\t\t\t\t\t}\r\n+\t\t\t\t// if scope does not exist and we are not in the root, create a child scope\r\n+\t\t\t\tif (!scope.hasChildScope(child) \u0026\u0026 !scope.equals(root)) {\r\n+\t\t\t\t\tscope.createChildScope(child);\r\n \t\t\t\t}\r\n-\t\t\t\t// if the scope is still equal to root then the room was not found\r\n-\t\t\t\tif (scope \u003d\u003d root) {\r\n+\t\t\t\t// get child scope\r\n+\t\t\t\tscope \u003d scope.getScope(child);\r\n+\t\t\t\t// if the scope is null then the room was not found\r\n+\t\t\t\tif (scope \u003d\u003d null) {\r\n \t\t\t\t\tthrow new ScopeNotFoundException(scope, child);\r\n \t\t\t\t}\r\n \t\t\t\t// some scopes don\u0027t implement IScope, such as SharedObjectScope\r"
        }
      ]
    }
  },
  {
    "name": "Race condition in unit tests",
    "url": "https://github.com/imagej/imagej-omero/issues/61",
    "description": "In the `OMEROFormattest`, `testChecker` and `testGetFormatName` both seem to have race conditions which can lead to their failure. I have observed `getFormat` return `null` implying the Format is not available yet... which seems odd.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/imagej/imagej-omero/commit/e7101ec16ce753a560d96cf4f92eea83b59dfed2",
      "files": [
        {
          "file_name": "src/test/java/net/imagej/omero/OMEROFormatTest.java",
          "patch": "@@ -32,6 +32,7 @@\n import io.scif.FormatException;\n import io.scif.MetadataService;\n import io.scif.SCIFIO;\n+import net.imagej.patcher.LegacyInjector;\n \n import org.junit.Test;\n \n@@ -42,6 +43,13 @@\n  */\n public class OMEROFormatTest {\n \n+\tstatic {\n+\t\tLegacyInjector.preinit();\n+\t\tscifio \u003d new SCIFIO();\n+\t}\n+\n+\tprivate static SCIFIO scifio;\n+\n \t/** Tests {@link OMEROFormat#getFormatName()}. */\n \t@Test\n \tpublic void testGetFormatName() {\n@@ -103,6 +111,6 @@ public void testParseArguments() throws FormatException {\n \t// -- Helper methods --\n \n \tprivate OMEROFormat getFormat() {\n-\t\treturn new SCIFIO().format().getFormatFromClass(OMEROFormat.class);\n+\t\treturn scifio.format().getFormatFromClass(OMEROFormat.class);\n \t}\n }"
        }
      ]
    }
  },
  {
    "name": "Race condition in `link` method - concurrent calls fail occasionally",
    "url": "https://github.com/opencb/opencga/issues/551",
    "description": "When concurrent calls are made to the link method, some of them will occasionally fail. This does not happen if the calls are made sequentially, which indicates a race condition in the server.\r\n\r\nError message:\r\n```\r\nException: {\"apiVersion\":\"v1\",\"warning\":\"\",\"error\":\"File { path : \\\"opencga_stress_test_0/\\\" } from study { id : 5 } already exists.\",\"queryOptions\":{\"metadata\":true,\"skipCount\":true,\"skip\":0,\"limit\":1000},\"response\":[{\"id\":\"\",\"time\":0,\"dbTime\":-1,\"numResults\":-1,\"numTotalResults\":-1,\"warningMsg\":\"Future errors will ONLY be shown in the QueryResponse body\",\"errorMsg\":\"DEPRECATED: org.opencb.opencga.catalog.exceptions.CatalogDBException: File { path : \\\"opencga_stress_test_0/\\\" } from study { id : 5 } already exists.\",\"resultType\":\"\",\"result\":[]}]}\r\n```\r\n\r\nMethod invocation that originates the error:\r\n```\r\n    catalog_file \u003d self.pycga.files.link(\r\n            study\u003dself.study_id, path\u003dpar_dir_path, uri\u003dfile_abs_path,\r\n            parents\u003dTrue,        # needed to crete parent directories\r\n            createFolder\u003dFalse,  # otherwise linking extra files under same dir fails because parents\u003dTrue\r\n    ).get()[0]\r\n```\r\n\r\nIt seems that OpenCGA is trying to create parent directories, even when `createFolder\u003dFalse`. \r\n\r\nThis is the stress test that I am using to observe the problem:\r\n\r\n```\r\ndef strees_test_worker(queue, results, connector):\r\n    index, file_path \u003d queue.get()\r\n    try:\r\n        results[index] \u003d connector.file_register_with_metadata(\r\n            file_path, [\u0027LP1234\u0027, \u0027LP1235\u0027],\r\n            run_id\u003d2, delivery_ids\u003d[\u00271234\u0027, \u00274567\u0027],\r\n            delivery_format_version\u003dDeliveryFormatVersion.V4)\r\n    except Exception as e:\r\n        results[index] \u003d e\r\n    queue.task_done()\r\n\r\n\r\ndef stress_opencga(connector, dir_path):\r\n    file_amount \u003d 100\r\n\r\n    # create files:\r\n    file_paths \u003d [os.path.join(dir_path, \u0027temp_file{}.txt\u0027.format(i)) for i in range(file_amount)]\r\n    for file_path in file_paths:\r\n        open(file_path, \u0027w+\u0027).close()\r\n\r\n    # register all those files:\r\n    queue \u003d Queue(maxsize\u003d0)\r\n    results \u003d [None] * file_amount\r\n    for i in range(file_amount):\r\n        thread \u003d threading.Thread(target\u003dstrees_test_worker,\r\n                                  kwargs\u003ddict(queue\u003dqueue,\r\n                                              results\u003dresults,\r\n                                              connector\u003dconnector))\r\n        thread.setDaemon(True)\r\n        thread.start()\r\n\r\n    for i in range(file_amount):\r\n        queue.put((i, file_paths[i]))\r\n    queue.join()\r\n\r\n    # process results:\r\n    for result in results:\r\n        if isinstance(result, BaseException):\r\n            raise result\r\n\r\n\r\n@pytest.mark.parametrize(\u0027use_retries\u0027, [True, False])\r\ndef test_stress(connector, use_retries):\r\n    \"\"\"Register a large number of files pseudo-concurrently\"\"\"\r\n    if use_retries:\r\n        connector.pycga.configuration.retry \u003d dict(\r\n            max_attempts\u003d10,\r\n            min_retry_seconds\u003d1,\r\n            max_retry_seconds\u003d2\r\n        )  # enable retries (disabled by default)\r\n\r\n    # look for a directory name that does NOT exist in catalog:\r\n    dir_initial_name \u003d \u0027opencga_stress_test\u0027\r\n    dir_name \u003d dir_initial_name\r\n    n \u003d 0\r\n    while connector.pycga.files.search(connector.study_id, path\u003ddir_name+\u0027/\u0027).get():\r\n        dir_name \u003d \"{}_{}\".format(dir_initial_name, n)\r\n        n +\u003d 1\r\n\r\n    dir_path \u003d os.path.join(\u0027/genomes/\u0027, dir_name)\r\n    directory_existed \u003d os.path.exists(dir_path)\r\n    if directory_existed:\r\n        if not os.path.isdir(dir_path):\r\n            raise Exception(\"Cant perform test - path exists and is not a directory: \" + dir_path)\r\n    else:\r\n        os.makedirs(dir_path)\r\n\r\n    try:\r\n        stress_opencga(connector, dir_path)\r\n    finally:\r\n        if not directory_existed:\r\n            shutil.rmtree(dir_path)\r\n```",
    "keywords": [
      "exception",
      "file_path",
      "def",
      "range",
      "error",
      "dir_path",
      "result",
      "path",
      "not",
      "get",
      "join",
      "id",
      "results",
      ":-1",
      "#",
      "method",
      "os",
      "file_amount",
      "dir_name",
      "dir_initial_name",
      "directory_existed",
      "range file_amount",
      "thread",
      "n",
      "connector",
      "calls",
      "pycga",
      "exists",
      "files",
      "queue"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/opencb/opencga/commit/1c797109aeeebf011780ed252021619ece69dc14",
      "files": [
        {
          "file_name": "opencga-catalog/src/main/java/org/opencb/opencga/catalog/db/mongodb/FileMongoDBAdaptor.java",
          "patch": "@@ -16,8 +16,8 @@\n \n package org.opencb.opencga.catalog.db.mongodb;\n \n-import com.mongodb.DuplicateKeyException;\n import com.mongodb.MongoClient;\n+import com.mongodb.MongoWriteException;\n import com.mongodb.client.MongoCursor;\n import com.mongodb.client.model.Aggregates;\n import com.mongodb.client.model.Filters;\n@@ -100,7 +100,7 @@ public MongoDBCollection getFileCollection() {\n \n         try {\n             fileCollection.insert(fileDocument, null);\n-        } catch (DuplicateKeyException e) {\n+        } catch (MongoWriteException e) {\n             throw CatalogDBException.alreadyExists(\"File\", studyId, \"path\", file.getPath(), e);\n         }\n "
        },
        {
          "file_name": "opencga-catalog/src/main/java/org/opencb/opencga/catalog/managers/FileManager.java",
          "patch": "@@ -1645,7 +1645,17 @@ private void createParents(long studyId, String userId, URI studyURI, Path path,\n \n     public QueryResult\u003cFile\u003e link(URI uriOrigin, String pathDestiny, long studyId, ObjectMap params, String sessionId)\n             throws CatalogException, IOException {\n+        // We make two attempts to link to ensure the behaviour remains even if it is being called at the same time link from different\n+        // threads\n+        try {\n+            return privateLink(uriOrigin, pathDestiny, studyId, params, sessionId);\n+        } catch (CatalogException | IOException e) {\n+            return privateLink(uriOrigin, pathDestiny, studyId, params, sessionId);\n+        }\n+    }\n \n+    private QueryResult\u003cFile\u003e privateLink(URI uriOrigin, String pathDestiny, long studyId, ObjectMap params, String sessionId)\n+            throws CatalogException, IOException {\n         CatalogIOManager ioManager \u003d catalogIOManagerFactory.get(uriOrigin);\n         if (!ioManager.exists(uriOrigin)) {\n             throw new CatalogIOException(\"File \" + uriOrigin + \" does not exist\");\n@@ -1960,7 +1970,6 @@ public FileVisitResult postVisitDirectory(Path dir, IOException exc) throws IOEx\n \n             return fileDBAdaptor.get(query, queryOptions);\n         }\n-\n     }\n \n     public QueryResult\u003cFile\u003e unlink(String fileIdStr, @Nullable String studyStr, String sessionId) throws CatalogException, IOException {"
        },
        {
          "file_name": "opencga-catalog/src/test/java/org/opencb/opencga/catalog/managers/FileManagerTest.java",
          "patch": "@@ -29,6 +29,7 @@\n import org.opencb.commons.utils.StringUtils;\n import org.opencb.opencga.catalog.CatalogManagerExternalResource;\n import org.opencb.opencga.catalog.db.api.FileDBAdaptor;\n+import org.opencb.opencga.catalog.db.api.SampleDBAdaptor;\n import org.opencb.opencga.catalog.exceptions.*;\n import org.opencb.opencga.catalog.io.CatalogIOManager;\n import org.opencb.opencga.catalog.managers.api.IFileManager;\n@@ -45,6 +46,12 @@\n import java.nio.file.Path;\n import java.nio.file.Paths;\n import java.util.*;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.function.Function;\n import java.util.stream.Collectors;\n \n import static org.hamcrest.CoreMatchers.containsString;\n@@ -394,6 +401,78 @@ public void testLinkNonExistentFile() throws CatalogException, IOException {\n         catalogManager.link(uri, \"test/myLinkedFolder/\", Long.toString(studyId), params, sessionIdUser);\n     }\n \n+    // The VCF file that is going to be linked contains names with \".\" Issue: #570\n+    @Test\n+    public void testLinkFile() throws CatalogException, IOException, URISyntaxException {\n+        URI uri \u003d getClass().getResource(\"/biofiles/variant-test-file-dot-names.vcf.gz\").toURI();\n+        QueryResult\u003cFile\u003e link \u003d fileManager.link(uri, \".\", studyId, new ObjectMap(), sessionIdUser);\n+\n+        assertEquals(4, link.first().getSampleIds().size());\n+\n+        Query query \u003d new Query()\n+                .append(SampleDBAdaptor.QueryParams.ID.key(), link.first().getSampleIds())\n+                .append(SampleDBAdaptor.QueryParams.STUDY_ID.key(), studyId);\n+        QueryResult\u003cSample\u003e sampleQueryResult \u003d catalogManager.getSampleManager().get(query, QueryOptions.empty(), sessionIdUser);\n+\n+        assertEquals(4, sampleQueryResult.getNumResults());\n+        List\u003cString\u003e sampleNames \u003d sampleQueryResult.getResult().stream().map(Sample::getName).collect(Collectors.toList());\n+        assertTrue(sampleNames.contains(\"test-name.bam\"));\n+        assertTrue(sampleNames.contains(\"NA19660\"));\n+        assertTrue(sampleNames.contains(\"NA19661\"));\n+        assertTrue(sampleNames.contains(\"NA19685\"));\n+    }\n+\n+    @Test\n+    public void stressTestLinkFile() throws Exception {\n+        URI uri \u003d getClass().getResource(\"/biofiles/variant-test-file.vcf.gz\").toURI();\n+        AtomicInteger numFailures \u003d new AtomicInteger();\n+        AtomicInteger numOk \u003d new AtomicInteger();\n+        int numThreads \u003d 10;\n+        int numOperations \u003d 500;\n+\n+        ExecutorService executorService \u003d Executors.newFixedThreadPool(numThreads);\n+\n+        for (int i \u003d 0; i \u003c numOperations; i++) {\n+            executorService.submit(() -\u003e {\n+                try {\n+                    fileManager.link(uri, \".\", studyId, new ObjectMap(), sessionIdUser);\n+                    int num \u003d numOk.incrementAndGet();\n+                    System.out.println(\"i \u003d \" + num);\n+                } catch (Exception ignore) {\n+                    ignore.printStackTrace();\n+                    numFailures.incrementAndGet();\n+                }\n+            });\n+\n+        }\n+//        executorService.shutdown();\n+        executorService.awaitTermination(30, TimeUnit.SECONDS);\n+        executorService.shutdown();\n+\n+        int unexecuted \u003d executorService.shutdownNow().size();\n+        System.out.println(\"Do not execute \" + unexecuted + \" tasks!\");\n+//        for (int i \u003d 0; i \u003c numThreads; i++) {\n+//            threads.add(new Thread(() -\u003e {\n+//                try {\n+//                    fileManager.link(uri, \".\", studyId, new ObjectMap(), sessionIdUser);\n+//                } catch (IOException | CatalogException ignore) {\n+//                    numFailures.incrementAndGet();\n+//                }\n+//            }));\n+//        }\n+//        threads.parallelStream().forEach(Thread::run);\n+//        threads.parallelStream().forEach((thread) -\u003e {\n+//            try {\n+//                thread.join();\n+//            } catch (InterruptedException e) {\n+//                e.printStackTrace();\n+//            }\n+//        });\n+\n+        System.out.println(\"numFailures \u003d \" + numFailures);\n+        System.out.println(\"numOk.get() \u003d \" + numOk.get());\n+    }\n+\n     @Test\n     public void testUnlinkFolder() throws CatalogException, IOException {\n         URI uri \u003d Paths.get(catalogManager.getStudyUri(studyId)).resolve(\"data\").toUri();"
        },
        {
          "file_name": "opencga-catalog/src/test/resources/biofiles/variant-test-file-dot-names.vcf.gz"
        }
      ]
    }
  },
  {
    "name": "[caldav] Fix race condition causing NPE",
    "url": "https://github.com/openhab/openhab1-addons/pull/5152",
    "description": "This fixes a problem described in https://community.openhab.org/t/caldav-binding-setup-issue/21651 caused by a race-condition of the binding not having been initialized at the right time.\r\n\r\nShould find some time to do a new openhab 2 port, but for now we\u0027re fine.",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/openhab/openhab1-addons/commit/a4980ba44a28ec8a5e6f0eef348ca94ac2438d68",
      "files": [
        {
          "file_name": "bundles/binding/org.openhab.binding.caldav-personal/src/main/java/org/openhab/binding/caldav_personal/internal/CalDavBinding.java",
          "patch": "@@ -220,7 +220,7 @@ private void updateItemsForEvent() {\n         for (String item : bindingProvider.getItemNames()) {\n             CalDavConfig config \u003d bindingProvider.getConfig(item);\n             List\u003cCalDavEvent\u003e events \u003d eventCache.get(config.getUniqueEventListKey());\n-            if (events \u003d\u003d null) {\n+            if (events \u003d\u003d null \u0026\u0026 this.calDavLoader !\u003d null) {\n                 CalDavQuery query \u003d getQueryForConfig(config);\n                 events \u003d this.calDavLoader.getEvents(query);\n                 eventCache.put(config.getUniqueEventListKey(), events);"
        }
      ]
    }
  },
  {
    "name": "Fix request attribute-related race condition in Logback request logging",
    "url": "https://github.com/dropwizard/dropwizard/pull/1678",
    "description": "Addresses #1672 \n\n`i.d.request.logging.async.AsyncAccessEventAppenderFactory` invokes `AccessEvent. prepareForDeferredProcessing`, which triggers a race with an identical invocation [within Logback itself](https://github.com/qos-ch/logback/blob/658963544cc08059fc3cec48f5d35f650de5f6df/logback-core/src/main/java/ch/qos/logback/core/OutputStreamAppender.java#L205). The reported issue indicates that the race manifests in inconsistent logging behavior when request attributes are set within a resource class.\n\nThis change removes the `prepareForDeferredProcessing` call from dropwizard-request-logging. As far as I know, all `IAccessEvent`s encountered by this class will be of concrete type `AccessEvent` and all non-async appenders extend `OutputStreamAppender`, so the `prepareForDeferredProcessing` method should always be invoked exactly once.\n",
    "keywords": [
      "request",
      "race",
      "logging"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/dropwizard/dropwizard/commit/e7c16c97572b5c683e09b5f9b34f934cc95d3e63",
      "files": [
        {
          "file_name": "dropwizard-logging/src/main/java/io/dropwizard/logging/async/AsyncLoggingEventAppenderFactory.java",
          "patch": "@@ -10,8 +10,8 @@\n public class AsyncLoggingEventAppenderFactory implements AsyncAppenderFactory\u003cILoggingEvent\u003e {\n \n     /**\n-     * Creates an {@link AsyncAppenderFactory} of type {@link ILoggingEvent}\n-     * @return the {@link AsyncAppenderFactory}\n+     * Creates an {@link AsyncAppenderBase} of type {@link ILoggingEvent}\n+     * @return the {@link AsyncAppenderBase}\n      */\n     @Override\n     public AsyncAppenderBase\u003cILoggingEvent\u003e build() {"
        },
        {
          "file_name": "dropwizard-request-logging/src/main/java/io/dropwizard/request/logging/async/AsyncAccessEventAppenderFactory.java",
          "patch": "@@ -10,17 +10,11 @@\n public class AsyncAccessEventAppenderFactory implements AsyncAppenderFactory\u003cIAccessEvent\u003e {\n \n     /**\n-     * Creates an {@link AsyncAppenderFactory} of type {@link IAccessEvent} that prepares events\n-     * for deferred processing\n-     * @return the {@link AsyncAppenderFactory}\n+     * Creates an {@link AsyncAppenderBase} of type {@link IAccessEvent}.\n+     * @return the {@link AsyncAppenderBase}\n      */\n     @Override\n     public AsyncAppenderBase\u003cIAccessEvent\u003e build() {\n-        return new AsyncAppenderBase\u003cIAccessEvent\u003e() {\n-            @Override\n-            protected void preprocess(IAccessEvent event) {\n-                event.prepareForDeferredProcessing();\n-            }\n-        };\n+        return new AsyncAppenderBase\u003cIAccessEvent\u003e();\n     }\n }"
        }
      ]
    }
  },
  {
    "name": "IndexService - synchronize  close to prevent race condition with shard creation",
    "url": "https://github.com/elastic/elasticsearch/pull/8557",
    "description": "During node shutdown we have a race condition between processing cluster state updates (creating shards) and closing down the index service. This may cause shards to leak and not be closed properly.\n\n This commit removes the concurrency in shard closing as InternalIndexService.removeShard has been synchronized for a long time now.\n\n On the other hand, the commit restores the parallel shutdown of indices lost in 7e1d8a6ca3b23c07cbaebe72831c7ef4a201bd2b\n\nThis is the cause of http://build-us-00.elasticsearch.org/job/es_core_1x_strong/1406/testReport/junit/org.elasticsearch.gateway.local/LocalGatewayIndexStateTests/testDanglingIndicesNoAutoImport/\n\n```\njava.lang.RuntimeException: MockDirectoryWrapper: cannot close: there are still open locks: {write.lock\u003djava.lang.RuntimeException: lock \"write.lock\" was not released}\n\nCaused by: java.lang.RuntimeException: lock \"write.lock\" was not released\n    at org.apache.lucene.store.MockLockFactoryWrapper$MockLock.obtain(MockLockFactoryWrapper.java:74)\n    at org.apache.lucene.store.Lock.obtain(Lock.java:77)\n    at org.apache.lucene.index.IndexWriter.\u003cinit\u003e(IndexWriter.java:753)\n    at org.elasticsearch.index.engine.internal.InternalEngine.createWriter(InternalEngine.java:1453)\n    at org.elasticsearch.index.engine.internal.InternalEngine.start(InternalEngine.java:273)\n    at org.elasticsearch.index.shard.service.InternalIndexShard.performRecoveryPrepareForTranslog(InternalIndexShard.java:733)\n```\n",
    "keywords": [
      "not",
      "apache",
      "elasticsearch",
      "org",
      "org elasticsearch",
      "lucene",
      "index",
      "lock",
      "runtimeexception",
      "shard",
      "internalengine",
      "lang"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/elastic/elasticsearch/commit/fb81a3203b601fcbc168e7c279f2d0014a08d719",
      "files": [
        {
          "file_name": "src/main/java/org/elasticsearch/index/service/InternalIndexService.java",
          "patch": "@@ -21,7 +21,6 @@\n \n import com.google.common.collect.ImmutableMap;\n import com.google.common.collect.ImmutableSet;\n-import com.google.common.collect.Sets;\n import com.google.common.collect.UnmodifiableIterator;\n import org.apache.lucene.util.IOUtils;\n import org.elasticsearch.ElasticsearchException;\n@@ -30,7 +29,6 @@\n import org.elasticsearch.common.Nullable;\n import org.elasticsearch.common.inject.*;\n import org.elasticsearch.common.settings.Settings;\n-import org.elasticsearch.common.util.concurrent.AbstractRunnable;\n import org.elasticsearch.common.util.concurrent.CountDown;\n import org.elasticsearch.env.NodeEnvironment;\n import org.elasticsearch.env.ShardLock;\n@@ -84,16 +82,12 @@\n import org.elasticsearch.indices.InternalIndicesLifecycle;\n import org.elasticsearch.plugins.PluginsService;\n import org.elasticsearch.plugins.ShardsPluginsModule;\n-import org.elasticsearch.threadpool.ThreadPool;\n \n import java.io.IOException;\n-import java.util.ArrayList;\n import java.util.List;\n import java.util.Map;\n import java.util.Set;\n import java.util.concurrent.CopyOnWriteArrayList;\n-import java.util.concurrent.CountDownLatch;\n-import java.util.concurrent.Executor;\n import java.util.concurrent.TimeUnit;\n import java.util.concurrent.atomic.AtomicBoolean;\n \n@@ -109,8 +103,6 @@\n \n     private final Settings indexSettings;\n \n-    private final ThreadPool threadPool;\n-\n     private final PluginsService pluginsService;\n \n     private final InternalIndicesLifecycle indicesLifecycle;\n@@ -148,14 +140,13 @@\n     private final AtomicBoolean closed \u003d new AtomicBoolean(false);\n \n     @Inject\n-    public InternalIndexService(Injector injector, Index index, @IndexSettings Settings indexSettings, NodeEnvironment nodeEnv, ThreadPool threadPool,\n+    public InternalIndexService(Injector injector, Index index, @IndexSettings Settings indexSettings, NodeEnvironment nodeEnv,\n                                 AnalysisService analysisService, MapperService mapperService, IndexQueryParserService queryParserService,\n                                 SimilarityService similarityService, IndexAliasesService aliasesService, IndexCache indexCache, IndexEngine indexEngine,\n                                 IndexGateway indexGateway, IndexStore indexStore, IndexSettingsService settingsService, IndexFieldDataService indexFieldData,\n                                 BitsetFilterCache bitSetFilterCache ) {\n         super(index, indexSettings);\n         this.injector \u003d injector;\n-        this.threadPool \u003d threadPool;\n         this.indexSettings \u003d indexSettings;\n         this.analysisService \u003d analysisService;\n         this.mapperService \u003d mapperService;\n@@ -279,37 +270,19 @@ public IndexEngine engine() {\n         return indexEngine;\n     }\n \n-    public void close(final String reason, @Nullable Executor executor, final IndicesService.IndexCloseListener listener) {\n-       if (closed.compareAndSet(false, true)) {\n-           final Set\u003cInteger\u003e shardIds \u003d shardIds();\n-           final CountDownLatch latch \u003d new CountDownLatch(shardIds.size());\n-           final IndicesService.IndexCloseListener innerListener \u003d listener \u003d\u003d null ? null :\n-                   new PerShardIndexCloseListener(shardIds, listener);\n-           for (final int shardId : shardIds) {\n-               executor \u003d executor \u003d\u003d null ? threadPool.generic() : executor;\n-               executor.execute(new AbstractRunnable() {\n-                   @Override\n-                   public void onFailure(Throwable t) {\n-                       logger.warn(\"failed to close shard\", t);\n-                   }\n-\n-                   @Override\n-                   public void doRun() {\n-                       try {\n-                           removeShard(shardId, reason, innerListener);\n-                       } finally {\n-                           latch.countDown();\n-                       }\n-                   }\n-               });\n-           }\n-           try {\n-               latch.await();\n-           } catch (InterruptedException e) {\n-               logger.debug(\"Interrupted closing index [{}]\", e, index().name());\n-               Thread.currentThread().interrupt();\n-           }\n-       }\n+    public synchronized void close(final String reason, final IndicesService.IndexCloseListener listener) {\n+        if (closed.compareAndSet(false, true)) {\n+            final Set\u003cInteger\u003e shardIds \u003d shardIds();\n+            final IndicesService.IndexCloseListener innerListener \u003d listener \u003d\u003d null ? null :\n+                    new PerShardIndexCloseListener(shardIds, listener);\n+            for (final int shardId : shardIds) {\n+                try {\n+                    removeShard(shardId, reason, innerListener);\n+                } catch (Throwable t) {\n+                    logger.warn(\"failed to close shard\", t);\n+                }\n+            }\n+        }\n     }\n \n     @Override"
        },
        {
          "file_name": "src/main/java/org/elasticsearch/indices/InternalIndicesService.java",
          "patch": "@@ -65,7 +65,6 @@\n import org.elasticsearch.index.similarity.SimilarityModule;\n import org.elasticsearch.index.store.IndexStore;\n import org.elasticsearch.index.store.IndexStoreModule;\n-import org.elasticsearch.index.store.Store;\n import org.elasticsearch.indices.analysis.IndicesAnalysisService;\n import org.elasticsearch.indices.recovery.RecoverySettings;\n import org.elasticsearch.indices.store.IndicesStore;\n@@ -75,8 +74,10 @@\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n-import java.util.concurrent.*;\n-import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n \n import static com.google.common.collect.Maps.newHashMap;\n import static org.elasticsearch.cluster.metadata.IndexMetaData.SETTING_NUMBER_OF_REPLICAS;\n@@ -128,22 +129,25 @@ protected void doStop() throws ElasticsearchException {\n         final CountDownLatch latch \u003d new CountDownLatch(indices.size());\n \n         final ExecutorService indicesStopExecutor \u003d Executors.newFixedThreadPool(5, EsExecutors.daemonThreadFactory(\"indices_shutdown\"));\n-        final ExecutorService shardsStopExecutor \u003d Executors.newFixedThreadPool(5, EsExecutors.daemonThreadFactory(\"shards_shutdown\"));\n \n         for (final String index : indices) {\n             indicesStopExecutor.execute(new Runnable() {\n                 @Override\n                 public void run() {\n                     try {\n-                        removeIndex(index, \"shutdown\", shardsStopExecutor, new IndexCloseListener() {\n+                        removeIndex(index, \"shutdown\", new IndexCloseListener() {\n                             @Override\n                             public void onAllShardsClosed(Index index, List\u003cThrowable\u003e failures) {\n                                 latch.countDown();\n                             }\n+\n                             @Override\n-                            public void onShardClosed(ShardId shardId) {}\n+                            public void onShardClosed(ShardId shardId) {\n+                            }\n+\n                             @Override\n-                            public void onShardCloseFailed(ShardId shardId, Throwable t) {}\n+                            public void onShardCloseFailed(ShardId shardId, Throwable t) {\n+                            }\n                         });\n                     } catch (Throwable e) {\n                         latch.countDown();\n@@ -159,7 +163,6 @@ public void onShardCloseFailed(ShardId shardId, Throwable t) {}\n         } catch (InterruptedException e) {\n             // ignore\n         } finally {\n-            shardsStopExecutor.shutdown();\n             indicesStopExecutor.shutdown();\n         }\n     }\n@@ -325,34 +328,32 @@ public synchronized IndexService createIndex(String sIndexName, Settings setting\n \n     @Override\n     public void removeIndex(String index, String reason) throws ElasticsearchException {\n-        removeIndex(index, reason, null, null);\n+        removeIndex(index, reason, null);\n     }\n \n     @Override\n     public void removeIndex(String index, String reason, @Nullable  IndexCloseListener listener) throws ElasticsearchException {\n-        removeIndex(index, reason, null, listener);\n-    }\n+        final IndexService indexService;\n+        final Injector indexInjector;\n+        synchronized (this) {\n+            indexInjector \u003d indicesInjectors.remove(index);\n+            if (indexInjector \u003d\u003d null) {\n+                return;\n+            }\n \n-    private synchronized void removeIndex(String index, String reason, @Nullable Executor executor,  @Nullable IndexCloseListener listener) throws ElasticsearchException {\n-        IndexService indexService;\n-        Injector indexInjector \u003d indicesInjectors.remove(index);\n-        if (indexInjector \u003d\u003d null) {\n-            return;\n+            logger.debug(\"[{}] closing ... (reason [{}])\", index, reason);\n+            Map\u003cString, IndexService\u003e tmpMap \u003d newHashMap(indices);\n+            indexService \u003d tmpMap.remove(index);\n+            indices \u003d ImmutableMap.copyOf(tmpMap);\n         }\n-\n-        logger.debug(\"[{}] closing ... (reason [{}])\", index, reason);\n-        Map\u003cString, IndexService\u003e tmpMap \u003d newHashMap(indices);\n-        indexService \u003d tmpMap.remove(index);\n-        indices \u003d ImmutableMap.copyOf(tmpMap);\n-\n         indicesLifecycle.beforeIndexClosed(indexService);\n \n         for (Class\u003c? extends CloseableIndexComponent\u003e closeable : pluginsService.indexServices()) {\n             indexInjector.getInstance(closeable).close();\n         }\n \n         logger.debug(\"[{}] closing index service\", index, reason);\n-        ((InternalIndexService) indexService).close(reason, executor, listener);\n+        ((InternalIndexService) indexService).close(reason, listener);\n \n         logger.debug(\"[{}] closing index cache\", index, reason);\n         indexInjector.getInstance(IndexCache.class).close();"
        }
      ]
    }
  },
  {
    "name": "Race condition in streams forwarding ?",
    "url": "https://github.com/NLeSC/Xenon/issues/105",
    "description": "There seems to be a race condition in the output stream forwarding used by the local and SSH adaptor. \n\nEvery now an then, a test fails because a job is done but the output is not written to the stdout.txt file yet. The check on the output then complains the stdout.txt file is empty. \n",
    "keywords": [
      "output"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/NLeSC/Xenon/commit/53cd99394101f68addd9a7bd809ff789bd9aef19",
      "files": [
        {
          "file_name": "src/nl/esciencecenter/octopus/adaptors/local/LocalBatchProcess.java",
          "patch": "@@ -20,16 +20,11 @@\n import java.io.FileOutputStream;\n import java.io.IOException;\n \n-import nl.esciencecenter.octopus.engine.jobs.JobImplementation;\n-import nl.esciencecenter.octopus.engine.util.MergingOutputStream;\n import nl.esciencecenter.octopus.engine.util.ProcessWrapper;\n import nl.esciencecenter.octopus.engine.util.StreamForwarder;\n import nl.esciencecenter.octopus.jobs.JobDescription;\n import nl.esciencecenter.octopus.jobs.Streams;\n \n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-\n /**\n  * LocalBatchProcess implements a {@link ProcessWrapper} for local batch processes. \n  * \n@@ -39,31 +34,16 @@\n  */\n class LocalBatchProcess implements ProcessWrapper {\n \n-    private static final Logger logger \u003d LoggerFactory.getLogger(LocalBatchProcess.class);\n-\n-    private final java.lang.Process[] processes;\n-\n-    private final StreamForwarder[] stdinForwarders;\n-    private final StreamForwarder[] stdoutForwarders;\n-    private final StreamForwarder[] stderrForwarders;\n-\n-    private final MergingOutputStream stdoutStream;\n-    private final MergingOutputStream stderrStream;\n-\n-    private final int [] exitCodes;\n-    private final boolean [] done;\n+    private final LocalInteractiveProcess process;\n     \n-    LocalBatchProcess(JobImplementation job) throws IOException { \n-\n-        JobDescription description \u003d job.getJobDescription();\n-        \n-        int count \u003d description.getProcessesPerNode();\n+    private StreamForwarder stdinForwarder;\n+    private StreamForwarder stdoutForwarder;\n+    private StreamForwarder stderrForwarder;\n \n-        exitCodes \u003d new int[count];\n-        done \u003d new boolean[count];\n+    LocalBatchProcess(LocalInteractiveProcess process, JobDescription description) throws IOException { \n \n-        ProcessBuilder builder \u003d new ProcessBuilder();\n-            \n+        this.process \u003d process;\n+        \n         String workingDirectory \u003d description.getWorkingDirectory();\n         \n         String stdout \u003d description.getStdout();\n@@ -86,122 +66,54 @@\n             stdin \u003d workingDirectory + File.separator + stdin;\n         }\n         \n-        builder.command().add(description.getExecutable());\n-        builder.command().addAll(description.getArguments());\n-        builder.environment().putAll(description.getEnvironment());\n-        builder.directory(new java.io.File(workingDirectory));\n-\n-        // Merge stdout and stderr into a single stream\n-        if (description.getMergeOutputStreams()) {             \n-            stdoutStream \u003d new MergingOutputStream(new FileOutputStream(stdout));\n-            stderrStream \u003d new MergingOutputStream(new FileOutputStream(stderr));\n+        Streams s \u003d process.getStreams();\n+        \n+        stdoutForwarder \u003d new StreamForwarder(s.getStdout(), new FileOutputStream(stdout));\n+        stderrForwarder \u003d new StreamForwarder(s.getStderr(), new FileOutputStream(stderr));\n+        \n+        if (stdin \u003d\u003d null) { \n+            stdinForwarder \u003d null;\n+            s.getStdin().close();\n         } else { \n-            stdoutStream \u003d null;\n-            stderrStream \u003d null;\n-        }\n-\n-        processes \u003d new java.lang.Process[count];\n-        stdinForwarders \u003d new StreamForwarder[count];\n-        stdoutForwarders \u003d new StreamForwarder[count];\n-        stderrForwarders \u003d new StreamForwarder[count];\n-\n-        for (int i \u003d 0; i \u003c count; i++) {\n-            processes[i] \u003d builder.start();\n-\n-            if (stdin \u003d\u003d null) {\n-                stdinForwarders[i] \u003d null;\n-                processes[i].getOutputStream().close();\n-            } else {\n-                stdinForwarders[i] \u003d new StreamForwarder(new FileInputStream(stdin),\n-                                processes[i].getOutputStream());\n-            }\n-\n-            if (description.getMergeOutputStreams()) { \n-                stdoutForwarders[i] \u003d new StreamForwarder(processes[i].getInputStream(), stdoutStream);\n-                stderrForwarders[i] \u003d new StreamForwarder(processes[i].getErrorStream(), stderrStream);\n-            } else { \n-                stdoutForwarders[i] \u003d new StreamForwarder(processes[i].getInputStream(), \n-                        new FileOutputStream(stdout + \".\" + i));\n-                 \n-                stderrForwarders[i] \u003d new StreamForwarder(processes[i].getErrorStream(),\n-                        new FileOutputStream(stderr  + \".\" + i));\n-            }\n+            stdinForwarder \u003d new StreamForwarder(new FileInputStream(stdin), s.getStdin());\n         }\n     }\n \n-//    private void kill() {\n-//        for (int i \u003d 0; i \u003c processes.length; i++) {\n-//            processes[i].destroy();\n-//\n-//            if (stdinForwarders[i] !\u003d null) {\n-//                stdinForwarders[i].close();\n-//            }\n-//\n-//            stdoutForwarders[i].close();\n-//            stderrForwarders[i].close();\n-//        }\n-//        \n-//        try {\n-//            if (stdoutStream !\u003d null) { \n-//                stdoutStream.close();\n-//            }\n-//        } catch (IOException e) {\n-//            // IGNORE\n-//        }\n-//        \n-//        try {\n-//            if (stderrStream !\u003d null) { \n-//                stderrStream.close();\n-//            }\n-//        } catch (IOException e) {\n-//            // IGNORE\n-//        }\n-//    }\n-\n-//    public int waitFor() throws InterruptedException {\n-//        \n-//        int[] results \u003d new int[processes.length];\n-//\n-//        for (int i \u003d 0; i \u003c processes.length; i++) {\n-//            results[i] \u003d processes[i].waitFor();\n-//        }\n-//\n-//        return results[0];\n-//    }\n-\n-    public boolean isDone() {\n+    private synchronized void closeStreams() { \n         \n-        for (int i\u003d0;i\u003cprocesses.length;i++) {\n-            \n-            if (!done[i]) {\n-                try { \n-                    exitCodes[i] \u003d processes[i].exitValue();\n-                    done[i] \u003d true;\n-                } catch (IllegalThreadStateException e) { \n-                    // ignored\n-                    return false;\n-                }\n-            }\n-        } \n+        if (stdinForwarder !\u003d null) { \n+            stdinForwarder.close();\n+            stdinForwarder \u003d null;\n+        }\n+        \n+        if (stdoutForwarder !\u003d null) { \n+            stdoutForwarder.close();\n+            stdoutForwarder \u003d null;\n+        }\n         \n-        return true;\n+        if (stderrForwarder !\u003d null) { \n+            stderrForwarder.close();\n+            stderrForwarder \u003d null;\n+        }\n     }\n-  \n-    public int getExitStatus() {\n+    \n+    public boolean isDone() {\n         \n-        for (int i\u003d0;i\u003cexitCodes.length;i++) { \n-            if (exitCodes[i] !\u003d 0) { \n-                return exitCodes[i];\n-            }\n+        if (process.isDone()) {\n+            closeStreams();\n+            return true;\n         }\n         \n-        return 0;\n+        return false;\n+    }\n+   \n+    public int getExitStatus() {\n+        return process.getExitStatus();\n     }\n     \n     public void destroy() {\n-        for (int i \u003d 0; i \u003c processes.length; i++) {\n-            LocalUtils.unixDestroy(processes[i]);\n-        }\n+        process.destroy();\n+        closeStreams();\n     }\n \n     @Override"
        },
        {
          "file_name": "src/nl/esciencecenter/octopus/adaptors/local/LocalFileAttributes.java",
          "patch": "@@ -152,7 +152,7 @@ public String toString() {\n     public int hashCode() {\n         final int prime \u003d 31;\n         int result \u003d 1;\n-        result \u003d prime * result + ((attributes \u003d\u003d null) ? 0 : attributes.hashCode());\n+        result \u003d prime * result + attributes.hashCode();\n         result \u003d prime * result + (executable ? 1231 : 1237);\n         result \u003d prime * result + (hidden ? 1231 : 1237);\n         result \u003d prime * result + (readable ? 1231 : 1237);\n@@ -180,17 +180,17 @@ public boolean equals(Object obj) {\n             return false;\n         }\n         \n-        if (hidden !\u003d other.hidden) { \n-            return false;\n-        }\n-        \n         if (readable !\u003d other.readable) { \n             return false;\n         }\n         \n         if (writable !\u003d other.writable) { \n             return false;\n         }\n+\n+        if (hidden !\u003d other.hidden) { \n+            return false;\n+        }\n         \n // FIXME: Always fails ?         \n //        if (attributes \u003d\u003d null) { "
        },
        {
          "file_name": "src/nl/esciencecenter/octopus/adaptors/local/LocalInteractiveProcess.java",
          "patch": "@@ -69,12 +69,6 @@\n     public Streams getStreams() { \n         return streams;\n     }\n-    \n-//    public int waitFor() throws InterruptedException {\n-//        exitCode \u003d process.waitFor();\n-//        done \u003d true;\n-//        return exitCode;\n-//    }\n \n     public boolean isDone() {\n         "
        },
        {
          "file_name": "src/nl/esciencecenter/octopus/adaptors/local/LocalProcessWrapperFactory.java",
          "patch": "@@ -34,10 +34,13 @@\n \n     @Override\n     public ProcessWrapper createProcessWrapper(Adaptor adaptor, JobImplementation job) throws IOException {\n+        \n+        LocalInteractiveProcess tmp \u003d new LocalInteractiveProcess(job);\n+        \n         if (job.getJobDescription().isInteractive()) {\n-            return new LocalInteractiveProcess(job);\n-        } else { \n-            return new LocalBatchProcess(job);\n+            return tmp;\n         }\n+        \n+        return new LocalBatchProcess(tmp, job.getJobDescription());\n     }\n }"
        },
        {
          "file_name": "src/nl/esciencecenter/octopus/engine/util/CopyEngine.java",
          "patch": "@@ -127,26 +127,31 @@ private void streamCopy(InputStream in, OutputStream out, CopyInfo ac) throws IO\n     private void append(AbsolutePath source, long fromOffset, AbsolutePath target, CopyInfo ac) throws OctopusIOException { \n \n         // We need to append some bytes from source to target. \n-        try (InputStream in \u003d owner.newInputStream(source); \n-             OutputStream out \u003d owner.newOutputStream(target, OpenOption.OPEN, OpenOption.APPEND)) {\n-\n+        \n+        InputStream in \u003d owner.newInputStream(source);\n+        OutputStream out \u003d owner.newOutputStream(target, OpenOption.OPEN, OpenOption.APPEND);\n+        \n+        try { \n             in.skip(fromOffset);\n-            \n             streamCopy(in, out, ac);\n         } catch (IOException e) { \n             throw new OctopusIOException(\"CopyEngine\", \"Failed to copy \" + source.getPath() + \":\" + fromOffset + \n                     \" to target \" + target.getPath(), e);\n-        }          \n+        } finally { \n+            close(in);\n+            close(out);\n+        }\n     }\n     \n     private boolean compareHead(CopyInfo ac, AbsolutePath target, AbsolutePath source) throws OctopusIOException, IOException { \n         \n         byte [] buf1 \u003d new byte[4*1024];\n         byte [] buf2 \u003d new byte[4*1024];\n         \n-        try (InputStream in1 \u003d owner.newInputStream(target);\n-             InputStream in2 \u003d owner.newInputStream(source)) { \n-            \n+        InputStream in1 \u003d owner.newInputStream(target);\n+        InputStream in2 \u003d owner.newInputStream(source);\n+        \n+        try {  \n             while (true) { \n \n                 if (ac.isCancelled()) {\n@@ -169,8 +174,11 @@ private boolean compareHead(CopyInfo ac, AbsolutePath target, AbsolutePath sourc\n                         return false;\n                     }\n                 }\n-            }           \n-        }        \n+            }\n+        } finally { \n+            close(in1);\n+            close(in2);            \n+        }\n     }\n     \n     private void doResume(CopyInfo ac) throws OctopusIOException {\n@@ -361,9 +369,7 @@ private void doCopy(CopyInfo ac) throws OctopusIOException {\n     \n     private void copy(CopyInfo info) {\n         \n-        if (logger.isDebugEnabled()) { \n-            logger.debug(\"Start copy: \" + info);\n-        }\n+        logger.debug(\"Start copy: {}\", info);\n         \n         try { \n             switch (info.mode) { \n@@ -386,9 +392,7 @@ private void copy(CopyInfo info) {\n             info.setException(e);\n         }\n         \n-        if (logger.isDebugEnabled()) { \n-            logger.debug(\"Finished copy: \" + info);\n-        }        \n+        logger.debug(\"Finished copy: {}\", info);\n     }\n     \n     public void copy(CopyInfo info, boolean asynchronous) {"
        },
        {
          "file_name": "src/nl/esciencecenter/octopus/engine/util/JobQueues.java",
          "patch": "@@ -51,6 +51,8 @@\n     \n     private static final Logger logger \u003d LoggerFactory.getLogger(JobQueues.class);\n     \n+    private final String adaptorName;\n+    \n     private final Scheduler myScheduler;\n     \n     private final LinkedList\u003cJobExecutor\u003e singleQ;\n@@ -77,8 +79,13 @@\n     \n     public JobQueues(Adaptor adaptor, Scheduler myScheduler, ProcessWrapperFactory factory, int multiQThreads, int maxQSize, \n             int pollingDelay) throws BadParameterException { \n-    \n+        \n+        logger.debug(\"{}: Creating JobQueues for Adaptor {} with multiQThreads: {}, maxQSize: {} and pollingDelay: {}\", \n+                adaptor.getName(), multiQThreads, maxQSize, pollingDelay);\n+        \n         this.adaptor \u003d adaptor;\n+        this.adaptorName \u003d adaptor.getName();\n+        \n         this.myScheduler \u003d myScheduler;\n         this.factory \u003d factory;\n         this.maxQSize \u003d maxQSize;\n@@ -89,15 +96,15 @@ public JobQueues(Adaptor adaptor, Scheduler myScheduler, ProcessWrapperFactory f\n         unlimitedQ \u003d new LinkedList\u003cJobExecutor\u003e();\n \n         if (maxQSize \u003c 0 \u0026\u0026 maxQSize !\u003d -1) {\n-            throw new BadParameterException(adaptor.getName(), \"Maximum queue size cannot be negative (excluding -1 for unlimited)\");\n+            throw new BadParameterException(adaptorName, \"Maximum queue size cannot be negative (excluding -1 for unlimited)\");\n         }\n \n         if (multiQThreads \u003c 1) {\n-            throw new BadParameterException(adaptor.getName(), \"Number of slots for the multi queue cannot be smaller than one!\");\n+            throw new BadParameterException(adaptorName, \"Number of slots for the multi queue cannot be smaller than one!\");\n         }\n         \n         if (pollingDelay \u003c 100 ||  pollingDelay \u003e 60000) {\n-            throw new BadParameterException(adaptor.getName(), \"Polling delay must be between 100 and 60000!\");\n+            throw new BadParameterException(adaptorName, \"Polling delay must be between 100 and 60000!\");\n         }\n \n         unlimitedExecutor \u003d Executors.newCachedThreadPool();\n@@ -111,26 +118,23 @@ private synchronized int getNextJobID() {\n     \n     private void checkScheduler(Scheduler scheduler) throws OctopusException { \n         if (scheduler !\u003d myScheduler) {\n-            throw new OctopusException(adaptor.getName(), \"Scheduler mismatch! \" + scheduler + \" !\u003d \" + myScheduler) ;\n+            throw new OctopusException(adaptorName, \"Scheduler mismatch! \" + scheduler + \" !\u003d \" + myScheduler) ;\n         }\n     }\n     \n     private void getJobs(LinkedList\u003cJobExecutor\u003e list, LinkedList\u003cJob\u003e out) {\n-        \n-        if (list \u003d\u003d null) { \n-            return;\n-        }\n-        \n         for (JobExecutor e : list) {\n             out.add(e.getJob());\n         }\n     }\n     \n     public Job[] getJobs(String... queueNames) throws NoSuchQueueException {\n         \n+        logger.debug(\"{}: getJobs for queues {}\", adaptorName, queueNames);\n+        \n         LinkedList\u003cJob\u003e out \u003d new LinkedList\u003cJob\u003e();\n         \n-        if (queueNames \u003d\u003d null) {\n+        if (queueNames \u003d\u003d null || queueNames.length \u003d\u003d 0) {\n             getJobs(singleQ, out);\n             getJobs(multiQ, out);\n             getJobs(unlimitedQ, out);\n@@ -143,37 +147,14 @@ private void getJobs(LinkedList\u003cJobExecutor\u003e list, LinkedList\u003cJob\u003e out) {\n                 } else if (name.equals(\"unlimited\")) {\n                     getJobs(unlimitedQ, out);\n                 } else { \n-                    throw new NoSuchQueueException(adaptor.getName(), \"Queue \\\"\" + name + \"\\\" does not exist\");                    \n+                    throw new NoSuchQueueException(adaptorName, \"Queue \\\"\" + name + \"\\\" does not exist\");                    \n                 }\n             }\n         }\n         \n         return out.toArray(new Job[out.size()]);\n     }\n-/*\n-    private synchronized void purgeQ(LinkedList\u003cJobExecutor\u003e q) {\n-        \n-        if (maxQSize \u003d\u003d -1) {\n-            return;\n-        }\n-\n-        //how many jobs do we need to remove\n-        int purgeCount \u003d q.size() - maxQSize;\n \n-        if (purgeCount \u003c\u003d 0) {\n-            return;\n-        }\n-\n-        Iterator\u003cJobExecutor\u003e iterator \u003d q.iterator();\n-\n-        while (iterator.hasNext() \u0026\u0026 purgeCount \u003e 0) {\n-            if (iterator.next().isDone()) {\n-                iterator.remove();\n-                purgeCount--;\n-            }\n-        }\n-    }\n-*/\n     private LinkedList\u003cJobExecutor\u003e findQueue(String queueName) throws OctopusException {\n \n         if (queueName \u003d\u003d null || queueName.equals(\"single\")) {\n@@ -183,7 +164,7 @@ private synchronized void purgeQ(LinkedList\u003cJobExecutor\u003e q) {\n         } else if (queueName.equals(\"unlimited\")) {\n             return unlimitedQ;\n         } else {\n-            throw new OctopusException(adaptor.getName(), \"Queue \\\"\" + queueName + \"\\\" does not exist!\");\n+            throw new OctopusException(adaptorName, \"Queue \\\"\" + queueName + \"\\\" does not exist!\");\n         }\n     }\n \n@@ -195,7 +176,7 @@ private JobExecutor findJob(LinkedList\u003cJobExecutor\u003e queue, Job job) throws Octop\n             }\n         }\n \n-        throw new OctopusException(adaptor.getName(), \"Job not found: \" + job.getIdentifier());\n+        throw new OctopusException(adaptorName, \"Job not found: \" + job.getIdentifier());\n     }\n \n     private JobExecutor findJob(Job job) throws OctopusException {\n@@ -217,6 +198,9 @@ private void cleanupJob(LinkedList\u003cJobExecutor\u003e queue, Job job) {\n     }\n     \n     public JobStatus getJobStatus(Job job) throws OctopusException {\n+        \n+        logger.debug(\"{}: getJobStatus for job {}\", adaptorName, job.getIdentifier());\n+        \n         checkScheduler(job.getScheduler());\n         \n         LinkedList\u003cJobExecutor\u003e queue \u003d findQueue(job.getJobDescription().getQueueName());\n@@ -231,6 +215,8 @@ public JobStatus getJobStatus(Job job) throws OctopusException {\n     \n     public JobStatus[] getJobStatuses(Job... jobs) {\n \n+        logger.debug(\"{}: getJobStatuses for jobs {}\", adaptorName, jobs);\n+        \n         JobStatus[] result \u003d new JobStatus[jobs.length];\n \n         for (int i \u003d 0; i \u003c jobs.length; i++) {\n@@ -250,29 +236,22 @@ public JobStatus getJobStatus(Job job) throws OctopusException {\n     \n     public JobStatus waitUntilDone(Job job, long timeout) throws OctopusException, OctopusIOException {\n         \n-        if (logger.isDebugEnabled()) { \n-            logger.debug(\"Waiting for \" + job.getIdentifier() + \" for \" + timeout + \" ms.\");\n-        }\n+        logger.debug(\"{}: Waiting for job {} for {} ms.\", adaptorName, job.getIdentifier(), timeout);\n         \n         if (timeout \u003c 0) { \n-            throw new OctopusException(adaptor.getName(), \"Illegal timeout \" + timeout);\n+            throw new OctopusException(adaptorName, \"Illegal timeout \" + timeout);\n         }\n         \n         checkScheduler(job.getScheduler());\n         \n         LinkedList\u003cJobExecutor\u003e queue \u003d findQueue(job.getJobDescription().getQueueName());\n         JobStatus status \u003d findJob(queue, job).waitUntilDone(timeout);\n         \n-        if (status.isDone()) { \n-            if (logger.isDebugEnabled()) { \n-                logger.debug(\"Job \" + job.getIdentifier() + \" is done after \" + timeout + \" ms.\");\n-            }\n-            \n+        if (status.isDone()) {\n+            logger.debug(\"{}: Job {} is done after {} ms.\", adaptorName, job.getIdentifier(), timeout);\n             cleanupJob(queue, job);\n         } else { \n-            if (logger.isDebugEnabled()) { \n-                logger.debug(\"Job \" + job.getIdentifier() + \" is NOT done after \" + timeout + \" ms.\");\n-            }\n+            logger.debug(\"{}: Job {} is NOT done after {} ms.\", adaptorName, job.getIdentifier(), timeout);\n         }\n         \n         return status;    \n@@ -288,124 +267,113 @@ private void verifyJobDescription(JobDescription description) throws OctopusExce\n         }\n         \n         if (!(queue.equals(\"single\") || queue.equals(\"multi\") || queue.equals(\"unlimited\"))) {\n-            throw new InvalidJobDescriptionException(adaptor.getName(), \"Queue \" + queue + \" not available locally!\");\n+            throw new InvalidJobDescriptionException(adaptorName, \"Queue \" + queue + \" not available locally!\");\n         }\n \n         String executable \u003d description.getExecutable(); \n         \n         if (executable \u003d\u003d null) { \n-            throw new IncompleteJobDescriptionException(adaptor.getName(), \"Executable missing in JobDescription!\");\n+            throw new IncompleteJobDescriptionException(adaptorName, \"Executable missing in JobDescription!\");\n         }\n         \n         int nodeCount \u003d description.getNodeCount();\n         \n         if (nodeCount !\u003d 1) { \n-            throw new InvalidJobDescriptionException(adaptor.getName(), \"Illegal node count: \" + nodeCount);\n+            throw new InvalidJobDescriptionException(adaptorName, \"Illegal node count: \" + nodeCount);\n         }\n         \n         int processesPerNode \u003d description.getProcessesPerNode();\n         \n-        if (processesPerNode \u003c\u003d 0) { \n-            throw new InvalidJobDescriptionException(adaptor.getName(), \"Illegal processes per node count: \" + \n+        if (processesPerNode !\u003d 1) { \n+            throw new InvalidJobDescriptionException(adaptorName, \"Illegal processes per node count: \" + \n                     processesPerNode);\n         }\n \n         int maxTime \u003d description.getMaxTime();\n         \n         if (maxTime \u003c\u003d 0) { \n-            throw new InvalidJobDescriptionException(adaptor.getName(), \"Illegal maximum runtime: \" + maxTime);\n+            throw new InvalidJobDescriptionException(adaptorName, \"Illegal maximum runtime: \" + maxTime);\n         }\n \n         if (description.isInteractive()) { \n \n             if (description.getStdin() !\u003d null) { \n-                throw new InvalidJobDescriptionException(adaptor.getName(), \n+                throw new InvalidJobDescriptionException(adaptorName, \n                         \"Illegal stdin redirect for interactive job!\");            \n             }\n             \n             if (description.getStdout() !\u003d null \u0026\u0026 !description.getStdout().equals(\"stdout.txt\")) { \n-                throw new InvalidJobDescriptionException(adaptor.getName(), \n+                throw new InvalidJobDescriptionException(adaptorName, \n                         \"Illegal stdout redirect for interactive job!\");            \n             }\n             \n             if (description.getStderr() !\u003d null \u0026\u0026 !description.getStderr().equals(\"stderr.txt\")) { \n-                throw new InvalidJobDescriptionException(adaptor.getName(), \n+                throw new InvalidJobDescriptionException(adaptorName, \n                         \"Illegal stderr redirect for interactive job!\");            \n             }\n         } else {             \n             \n             if (description.getStdout() \u003d\u003d null) { \n-                throw new InvalidJobDescriptionException(adaptor.getName(), \n+                throw new InvalidJobDescriptionException(adaptorName, \n                         \"Missing stdout redirect for interactive job!\");            \n             }\n             \n             if (description.getStderr() \u003d\u003d null) { \n-                throw new InvalidJobDescriptionException(adaptor.getName(), \n+                throw new InvalidJobDescriptionException(adaptorName, \n                         \"Missing stderr redirect for interactive job!\");            \n             }            \n         }\n     }\n     \n     public Job submitJob(Scheduler scheduler, JobDescription description) throws OctopusException {\n         \n-        if (logger.isDebugEnabled()) { \n-            logger.debug(adaptor.getName() + \": Submitting job\");\n-        }\n+        logger.debug(\"{}: Submitting job\", adaptorName);\n         \n         checkScheduler(scheduler);\n         \n         verifyJobDescription(description);\n \n-        if (logger.isDebugEnabled()) { \n-            logger.debug(adaptor.getName() + \": JobDescription verified OK\");\n-        }\n-\n+        logger.debug(\"{}: JobDescription verified OK\", adaptorName);\n+        \n         JobImplementation result \u003d new JobImplementation(description, scheduler, OctopusEngine.getNextUUID(), \n-                adaptor.getName() + \"-\" + getNextJobID(), description.isInteractive(), true);\n+                adaptorName + \"-\" + getNextJobID(), description.isInteractive(), true);\n \n-        if (logger.isDebugEnabled()) { \n-            logger.debug(adaptor.getName() + \": Created Job \" + result.getIdentifier());\n-        }\n+        logger.debug(\"{}: Created Job {}\", adaptorName, result.getIdentifier());\n         \n         JobExecutor executor \u003d new JobExecutor(adaptor, result, factory, pollingDelay);\n         \n         String queueName \u003d description.getQueueName();\n        \n-        if (logger.isDebugEnabled()) { \n-            logger.debug(adaptor.getName() + \": Submitting job to queue \" + queueName);\n-        }\n-       \n-        if (queueName \u003d\u003d null || queueName.equals(\"single\")) {\n-            singleQ.add(executor);\n-            singleExecutor.execute(executor);\n+        logger.debug(\"{}: Submitting job to queue \", adaptorName, queueName);\n+        \n+        // NOTE: the verifyJobDescription ensures that the queueName has a valid value!\n+        if (queueName.equals(\"unlimited\")) {\n+            unlimitedQ.add(executor);\n+            unlimitedExecutor.execute(executor);\n         } else if (queueName.equals(\"multi\")) {\n             multiQ.add(executor);\n             multiExecutor.execute(executor);\n-        } else if (queueName.equals(\"unlimited\")) {\n-            unlimitedQ.add(executor);\n-            unlimitedExecutor.execute(executor);\n-        } else {\n-            throw new OctopusException(adaptor.getName(), \"INTERNAL ERROR: failed to submit job!\");\n-        }\n+        } else { // queueName \u003d\u003d \"single\"  \n+            singleQ.add(executor);\n+            singleExecutor.execute(executor);\n+        }  \n         \n-        // Purge jobs from the queue if needed (will not actually cancel execution of jobs)\n-//        purgeQ(singleQ);\n-//        purgeQ(multiQ);\n-//        purgeQ(unlimitedQ);\n-\n         if (description.isInteractive()) {\n             executor.waitUntilRunning();\n             \n             if (executor.isDone() \u0026\u0026 !executor.hasRun()) { \n-                Exception e \u003d executor.getError();\n-                throw new OctopusException(adaptor.getName(), \"Job failed to start!\", e);\n+                cleanupJob(findQueue(queueName), result);\n+                throw new OctopusException(adaptorName, \"Job failed to start!\", executor.getError());\n             } \n         }\n         \n         return result;\n     }\n     \n     public JobStatus cancelJob(Job job) throws OctopusException {\n+        \n+        logger.debug(\"{}: Cancel job {}\", adaptorName, job);\n+        \n         checkScheduler(job.getScheduler());\n         \n         LinkedList\u003cJobExecutor\u003e queue \u003d findQueue(job.getJobDescription().getQueueName());\n@@ -423,17 +391,19 @@ public JobStatus cancelJob(Job job) throws OctopusException {\n     }\n \n     public QueueStatus getQueueStatus(Scheduler scheduler, String queueName) throws OctopusException {\n-     \n+\n         checkScheduler(scheduler);\n         \n+        logger.debug(\"{}: getQueueStatus {}:{}\", adaptorName, scheduler, queueName);\n+\n         if (queueName \u003d\u003d null || queueName.equals(\"single\")) {\n             return new QueueStatusImplementation(scheduler, \"single\", null, null);\n         } else if (queueName.equals(\"multi\")) {\n             return new QueueStatusImplementation(scheduler, \"multi\", null, null);\n         } else if (queueName.equals(\"unlimited\")) {\n             return new QueueStatusImplementation(scheduler, \"unlimited\", null, null);\n         } else {\n-            throw new NoSuchQueueException(adaptor.getName(), \"No such queue: \" + queueName);\n+            throw new NoSuchQueueException(adaptorName, \"No such queue: \" + queueName);\n         }\n     }\n     "
        },
        {
          "file_name": "src/nl/esciencecenter/octopus/engine/util/StreamForwarder.java",
          "patch": "@@ -15,6 +15,7 @@\n  */\n package nl.esciencecenter.octopus.engine.util;\n \n+import java.io.Closeable;\n import java.io.IOException;\n import java.io.InputStream;\n import java.io.OutputStream;\n@@ -50,13 +51,19 @@ public StreamForwarder(InputStream in, OutputStream out) {\n     /**\n      * Closes the input stream, thereby stopping the stream forwarder, and closing the output stream.\n      */\n-    public void close() {\n+    private void close(Closeable c, String error) {\n         try {\n-            in.close();\n-        } catch (IOException e) {\n-            logger.error(\"Cannot close input stream\", e);\n+            c.close();\n+        } catch (Exception e) {\n+            if (error !\u003d null) { \n+                logger.error(error, e);\n+            }\n         }\n     }\n+    \n+    public void close() {\n+        close(in, \"Cannot close input stream\");\n+    }\n \n     public void run() {\n         try {\n@@ -73,16 +80,8 @@ public void run() {\n         } catch (IOException e) {\n             logger.error(\"Cannot forward stream\", e);\n         } finally {\n-            try {\n-                in.close();\n-            } catch (IOException e) {\n-                logger.error(\"Cannot close input stream\", e);\n-            }\n-            try {\n-                out.close();\n-            } catch (IOException e) {\n-                logger.error(\"Cannot close output stream\", e);\n-            }\n+            close(in, null);\n+            close(out, null);\n         }\n     }\n }\n\\ No newline at end of file"
        },
        {
          "file_name": "src/nl/esciencecenter/octopus/util/FileUtils.java",
          "patch": "@@ -353,7 +353,4 @@ public static void recursiveDelete(Octopus octopus, AbsolutePath path) throws Oc\n         octopus.files().delete(path);\n     }\n \n-    public static void recursiveWipe(Octopus octopus, AbsolutePath path) {\n-        // TODO Auto-generated method stub\n-    }\n }"
        },
        {
          "file_name": "src/nl/esciencecenter/octopus/util/Sandbox.java",
          "patch": "@@ -62,7 +62,7 @@\n \n     private List\u003cPair\u003e downloadFiles \u003d new LinkedList\u003cPair\u003e();\n \n-    public class Pair {\n+    public static class Pair {\n \n         final AbsolutePath source;\n         final AbsolutePath destination;\n@@ -132,13 +132,21 @@ public String toString() {\n      * @throws OctopusIOException\n      */\n     public Sandbox(Octopus octopus, AbsolutePath root, String sandboxName) throws OctopusException, OctopusIOException {\n-        this.octopus \u003d octopus;\n-\n+        \n+        if (octopus \u003d\u003d null) { \n+            throw new OctopusException(\"Sandbox\", \"Need an octopus to create a sandbox!\");\n+        }\n+        \n+        if (root \u003d\u003d null) { \n+            throw new OctopusException(\"Sandbox\", \"Need an root directory to create a sandbox!\");\n+        }\n+        \n         if (sandboxName \u003d\u003d null) {\n-            path \u003d root.resolve(new RelativePath(\"octopus_sandbox_\" + UUID.randomUUID()));\n-        } else {\n-            path \u003d root.resolve(new RelativePath(sandboxName));\n+            sandboxName \u003d \"octopus_sandbox_\" + UUID.randomUUID();\n         }\n+        \n+        this.octopus \u003d octopus;\n+        this.path \u003d root.resolve(new RelativePath(sandboxName));\n     }\n \n     /**\n@@ -251,10 +259,6 @@ public void download(CopyOption... options) throws OctopusIOException, Unsupport\n         copy(downloadFiles, options);\n     }\n \n-    public void wipe() throws OctopusIOException {\n-        FileUtils.recursiveWipe(octopus, path);\n-    }\n-\n     /**\n      * Deletes all files in sandbox.\n      *\n@@ -268,8 +272,8 @@ public void delete() throws OctopusIOException {\n     public int hashCode() {\n         final int prime \u003d 31;\n         int result \u003d 1;\n-        result \u003d prime * result + ((octopus \u003d\u003d null) ? 0 : octopus.hashCode());\n-        result \u003d prime * result + ((path \u003d\u003d null) ? 0 : path.hashCode());\n+        result \u003d prime * result + octopus.hashCode();\n+        result \u003d prime * result + path.hashCode();\n         result \u003d prime * result + uploadFiles.hashCode();\n         result \u003d prime * result + downloadFiles.hashCode();\n         return result;\n@@ -286,27 +290,25 @@ public boolean equals(Object obj) {\n         if (getClass() !\u003d obj.getClass()) {\n             return false;\n         }\n+        \n         Sandbox other \u003d (Sandbox) obj;\n-        if (octopus \u003d\u003d null) {\n-            if (other.octopus !\u003d null) {\n-                return false;\n-            }\n-        } else if (!octopus.equals(other.octopus)) {\n+    \n+        if (!octopus.equals(other.octopus)) {\n             return false;\n         }\n-        if (path \u003d\u003d null) {\n-            if (other.path !\u003d null) {\n-                return false;\n-            }\n-        } else if (!path.equals(other.path)) {\n+        \n+        if (!path.equals(other.path)) {\n             return false;\n         }\n+        \n         if (!downloadFiles.equals(other.downloadFiles)) {\n             return false;\n         }\n+        \n         if (!uploadFiles.equals(other.uploadFiles)) {\n             return false;\n         }\n+        \n         return true;\n     }\n "
        },
        {
          "file_name": "test/src/nl/esciencecenter/octopus/adaptors/local/LocalFileAttributesTest.java",
          "patch": "@@ -0,0 +1,143 @@\n+/*\n+ * Copyright 2013 Netherlands eScience Center\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package nl.esciencecenter.octopus.adaptors.local;\n+\n+import static org.junit.Assert.*;\n+\n+import java.nio.file.attribute.PosixFilePermissions;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import nl.esciencecenter.octopus.Octopus;\n+import nl.esciencecenter.octopus.OctopusFactory;\n+import nl.esciencecenter.octopus.exceptions.OctopusIOException;\n+import nl.esciencecenter.octopus.files.AbsolutePath;\n+import nl.esciencecenter.octopus.files.FileAttributes;\n+import nl.esciencecenter.octopus.files.FileSystem;\n+import nl.esciencecenter.octopus.files.Files;\n+import nl.esciencecenter.octopus.files.RelativePath;\n+\n+/**\n+ * @author Jason Maassen \u003cJ.Maassen@esciencecenter.nl\u003e\n+ *\n+ */\n+public class LocalFileAttributesTest {\n+\n+    @org.junit.Test(expected \u003d NullPointerException.class)\n+    public void testPathIsNull() throws Exception {\n+        new LocalFileAttributes(null);\n+    }\n+    \n+    @org.junit.Test(expected \u003d OctopusIOException.class)\n+    public void testNonExistingFile() throws Exception {\n+        Octopus o \u003d OctopusFactory.newOctopus(null);\n+        Files files \u003d o.files();\n+        FileSystem fs \u003d files.getLocalCWDFileSystem();\n+        \n+        AbsolutePath path \u003d fs.getEntryPath().resolve(new RelativePath(\"noot.txt\"));\n+        new LocalFileAttributes(path);\n+    }\n+\n+    @org.junit.Test\n+    public void testCreationTime() throws Exception {\n+        Octopus o \u003d OctopusFactory.newOctopus(null);\n+        Files files \u003d o.files();\n+        FileSystem fs \u003d files.getLocalCWDFileSystem();\n+        AbsolutePath path \u003d fs.getEntryPath().resolve(new RelativePath(\"aap.txt\"));\n+        \n+        long now \u003d System.currentTimeMillis();\n+        \n+        files.createFile(path);\n+        \n+        FileAttributes att \u003d new LocalFileAttributes(path);\n+        \n+        long time \u003d att.creationTime();\n+        \n+        System.out.println(\"NOW \" + now + \" CREATE \" + time);\n+        \n+        files.delete(path);\n+        OctopusFactory.endOctopus(o);\n+        \n+        assertTrue(time \u003e\u003d now - 5000);\n+        assertTrue(time \u003c\u003d now + 5000);\n+    }\n+\n+    @org.junit.Test\n+    public void testHashCode() throws Exception {\n+        Octopus o \u003d OctopusFactory.newOctopus(null);\n+        Files files \u003d o.files();\n+        FileSystem fs \u003d files.getLocalCWDFileSystem();\n+        AbsolutePath path \u003d fs.getEntryPath().resolve(new RelativePath(\"aap.txt\"));\n+        files.createFile(path);\n+        \n+        FileAttributes att \u003d new LocalFileAttributes(path);\n+      \n+        int hash \u003d att.hashCode();\n+        \n+        // TODO: check hashcode ?\n+        \n+        files.delete(path);\n+        OctopusFactory.endOctopus(o);\n+    }\n+\n+    @org.junit.Test\n+    public void testEquals() throws Exception {\n+        Octopus o \u003d OctopusFactory.newOctopus(null);\n+        Files files \u003d o.files();\n+        FileSystem fs \u003d files.getLocalCWDFileSystem();\n+        AbsolutePath path1 \u003d fs.getEntryPath().resolve(new RelativePath(\"aap.txt\"));\n+        files.createFile(path1);\n+        \n+        AbsolutePath path2 \u003d fs.getEntryPath().resolve(new RelativePath(\"noot.txt\"));\n+        files.createFile(path2);\n+        \n+        files.setPosixFilePermissions(path1, LocalUtils.octopusPermissions(PosixFilePermissions.fromString(\"rwxr--r--\")));\n+        files.setPosixFilePermissions(path2, LocalUtils.octopusPermissions(PosixFilePermissions.fromString(\"---r--r--\")));\n+        \n+        FileAttributes att1 \u003d new LocalFileAttributes(path1);\n+        FileAttributes att2 \u003d new LocalFileAttributes(path2);\n+        \n+        assertTrue(att1.equals(att1));\n+        assertFalse(att1.equals(null));\n+        assertFalse(att1.equals(\"aap\"));\n+        assertFalse(att1.equals(att2));\n+        \n+        files.setPosixFilePermissions(path2, LocalUtils.octopusPermissions(PosixFilePermissions.fromString(\"--xr--r--\")));\n+        att2 \u003d new LocalFileAttributes(path2);\n+        \n+        assertFalse(att1.equals(att2));\n+        \n+        files.setPosixFilePermissions(path2, LocalUtils.octopusPermissions(PosixFilePermissions.fromString(\"r-xr--r--\")));\n+        att2 \u003d new LocalFileAttributes(path2);\n+        \n+        assertFalse(att1.equals(att2));\n+       \n+        files.setPosixFilePermissions(path2, LocalUtils.octopusPermissions(PosixFilePermissions.fromString(\"rwxr--r--\")));\n+        att2 \u003d new LocalFileAttributes(path2);\n+        \n+        assertTrue(att1.equals(att2));\n+\n+        files.delete(path1);\n+        files.delete(path2);\n+        \n+        OctopusFactory.endOctopus(o);\n+    }\n+\n+    \n+    \n+    \n+}"
        },
        {
          "file_name": "test/src/nl/esciencecenter/octopus/engine/jobs/JobsEngineTest.java",
          "patch": "@@ -15,22 +15,20 @@\n  */\n package nl.esciencecenter.octopus.engine.jobs;\n \n-import static org.junit.Assert.*;\n-import static org.mockito.Mockito.*;\n-import static org.hamcrest.CoreMatchers.*;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n \n import java.net.URI;\n-import java.net.URISyntaxException;\n import java.util.Properties;\n import java.util.UUID;\n \n-import nl.esciencecenter.octopus.engine.Adaptor;\n import nl.esciencecenter.octopus.engine.OctopusEngine;\n import nl.esciencecenter.octopus.exceptions.OctopusException;\n-import nl.esciencecenter.octopus.exceptions.OctopusIOException;\n import nl.esciencecenter.octopus.jobs.Job;\n import nl.esciencecenter.octopus.jobs.JobDescription;\n-import nl.esciencecenter.octopus.jobs.Jobs;\n+import nl.esciencecenter.octopus.jobs.JobStatus;\n+import nl.esciencecenter.octopus.jobs.Scheduler;\n \n import org.junit.Test;\n \n@@ -45,6 +43,64 @@ public void testToString() throws OctopusException {\n         assertTrue(je.toString().equals(\"JobsEngine [octopusEngine\u003d\" + oe + \"]\"));\n     }\n     \n+    @Test\n+    public void testGetJobStatusesWithException() throws Exception {\n+    \n+        OctopusEngine oe \u003d new OctopusEngine(new Properties());\n+        JobsEngine je \u003d new JobsEngine(oe); \n+        \n+        JobDescription desc \u003d new JobDescription();\n+\n+        Scheduler s \u003d new SchedulerImplementation(\"test\", \"id1\", new URI(\"test:///\"), new String [] { \"testq\" }, null, \n+                null, true, true, true);     \n+        \n+        UUID uuid \u003d UUID.randomUUID();\n+        \n+        Job job \u003d new JobImplementation(desc, s, uuid, \"id1\", true, true);\n+       \n+        JobStatus [] status \u003d je.getJobStatuses(job);\n+        \n+        assertNotNull(status);\n+        assertTrue(status.length \u003d\u003d 1);\n+        assertNotNull(status[0]);\n+        assertTrue(status[0].hasException());\n+    }\n+\n+    @Test\n+    public void testGetJobStatusesWithException2() throws Exception {\n+    \n+        OctopusEngine oe \u003d new OctopusEngine(new Properties());\n+        JobsEngine je \u003d new JobsEngine(oe); \n+        \n+        JobDescription desc \u003d new JobDescription();\n+\n+        Scheduler s \u003d new SchedulerImplementation(\"test1\", \"id1\", new URI(\"test:///\"), new String [] { \"testq\" }, null, \n+                null, true, true, true);     \n+        \n+        UUID uuid \u003d UUID.randomUUID();\n+        \n+        Job job1 \u003d new JobImplementation(desc, s, uuid, \"id1\", true, true);\n+       \n+        s \u003d new SchedulerImplementation(\"test1\", \"id1\", new URI(\"test:///\"), new String [] { \"testq\" }, null, \n+                null, true, true, true);     \n+         \n+        uuid \u003d UUID.randomUUID();\n+        \n+        Job job2 \u003d new JobImplementation(desc, s, uuid, \"id2\", true, true);\n+        \n+        JobStatus [] status \u003d je.getJobStatuses(job1, null, job2);\n+        \n+        assertNotNull(status);\n+        assertTrue(status.length \u003d\u003d 3);\n+        assertNotNull(status[0]);\n+        assertNull(status[1]);\n+        assertNotNull(status[2]);\n+        assertTrue(status[0].hasException());\n+        assertTrue(status[2].hasException());\n+    }\n+\n+    \n+    \n //    \n //    \n //    "
        },
        {
          "file_name": "test/src/nl/esciencecenter/octopus/engine/util/JobQueueTest.java",
          "patch": "@@ -0,0 +1,496 @@\n+/*\n+ * Copyright 2013 Netherlands eScience Center\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package nl.esciencecenter.octopus.engine.util;\n+\n+import java.io.IOException;\n+\n+import nl.esciencecenter.octopus.engine.Adaptor;\n+import nl.esciencecenter.octopus.engine.jobs.JobImplementation;\n+import nl.esciencecenter.octopus.exceptions.IncompleteJobDescriptionException;\n+import nl.esciencecenter.octopus.exceptions.InvalidJobDescriptionException;\n+import nl.esciencecenter.octopus.exceptions.OctopusException;\n+import nl.esciencecenter.octopus.exceptions.BadParameterException;\n+import nl.esciencecenter.octopus.jobs.Job;\n+import nl.esciencecenter.octopus.jobs.JobDescription;\n+import nl.esciencecenter.octopus.jobs.JobStatus;\n+import nl.esciencecenter.octopus.jobs.Scheduler;\n+import nl.esciencecenter.octopus.jobs.Streams;\n+\n+import static org.junit.Assert.*;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+/**\n+ * @author Jason Maassen \u003cJ.Maassen@esciencecenter.nl\u003e\n+ *\n+ */\n+public class JobQueueTest {\n+\n+    public static final int POLLING_DELAY \u003d 250;\n+    \n+    static class MyProcessWrapper implements ProcessWrapper {\n+        \n+        final Adaptor adaptor; \n+        final JobImplementation job;\n+        \n+        boolean destoyed \u003d false;\n+        boolean done \u003d false;\n+        int exit \u003d -1;\n+        \n+        public MyProcessWrapper(Adaptor adaptor, JobImplementation job) { \n+            this.adaptor \u003d adaptor;\n+            this.job \u003d job;\n+        }\n+        \n+        @Override\n+        public Streams getStreams() {\n+            return null;\n+        }\n+\n+        public synchronized void setDone() { \n+           done \u003d true;\n+        }\n+        \n+        @Override\n+        public synchronized boolean isDone() {\n+            return done;\n+        }\n+\n+        public synchronized void setExitStatus(int exit) { \n+            this.exit \u003d exit;\n+        }\n+        \n+        @Override\n+        public synchronized int getExitStatus() {\n+            return exit;\n+        }\n+\n+        @Override\n+        public synchronized void destroy() {\n+            destoyed \u003d true;\n+        }         \n+        \n+        public synchronized boolean isDestroyed() {\n+            return destoyed;\n+        }\n+    }\n+    \n+    static class MyFactory implements ProcessWrapperFactory {\n+        \n+        private boolean fail \u003d false;\n+        \n+        public void setFail(boolean value) { \n+            fail \u003d value;\n+        }\n+        \n+        @Override\n+        public ProcessWrapper createProcessWrapper(Adaptor adaptor, JobImplementation job) throws IOException {\n+            \n+            if (fail) {\n+                currentWrapper \u003d null;\n+                throw new IOException(\"Failed to create process!\");\n+            }\n+            \n+            currentWrapper \u003d new MyProcessWrapper(adaptor, job);\n+            return currentWrapper;\n+        }\n+    }\n+    \n+    public static Scheduler scheduler;\n+    public static Adaptor adaptor;\n+    public static JobQueues jobQueue;\n+    public static MyFactory myFactory;\n+    \n+    public static MyProcessWrapper currentWrapper;\n+    \n+    @BeforeClass\n+    public static void prepare() throws Exception { \n+\n+        scheduler \u003d mock(Scheduler.class);\n+        adaptor \u003d mock(Adaptor.class);\n+        when(adaptor.getName()).thenReturn(\"test\");\n+    \n+        myFactory \u003d new MyFactory();\n+        jobQueue \u003d new JobQueues(adaptor, scheduler, myFactory, 2, -1, POLLING_DELAY);\n+    }\n+\n+    @AfterClass\n+    public static void cleanup() throws Exception { \n+\n+        Job [] jobs \u003d jobQueue.getJobs();\n+        \n+        if (jobs !\u003d null \u0026\u0026 jobs.length \u003e 0) { \n+            \n+            System.err.println(\"Jobs stuck in queue: \" + jobs.length);\n+            \n+            for (int i\u003d0;i\u003cjobs.length;i++) { \n+                System.err.println(\"   \" + jobs[i]);                   \n+            }\n+            \n+            throw new Exception(\"There are jobs sutck in the queue!\");\n+        }        \n+    }\n+    \n+    @Test(expected \u003d BadParameterException.class)\n+    public void test_constructor1() throws Exception {\n+        // throws exception\n+        new JobQueues(adaptor, scheduler, myFactory, 2, -2, POLLING_DELAY);\n+    }\n+\n+    @Test(expected \u003d BadParameterException.class)\n+    public void test_constructor2() throws Exception {\n+        // throws exception\n+        new JobQueues(adaptor, scheduler, myFactory, 0, -1, POLLING_DELAY);\n+    }\n+    \n+    @Test(expected \u003d BadParameterException.class)\n+    public void test_constructor3() throws Exception {\n+        // throws exception\n+        new JobQueues(adaptor, scheduler, myFactory, 2, -1, 1);\n+    }\n+    \n+    @Test(expected \u003d BadParameterException.class)\n+    public void test_constructor4() throws Exception {\n+        // throws exception\n+        new JobQueues(adaptor, scheduler, myFactory, 2, -1, 100000);\n+    }\n+\n+    @Test(expected \u003d InvalidJobDescriptionException.class)\n+    public void test_invalidJobDescription1() throws Exception {\n+        JobDescription d \u003d new JobDescription();\n+        d.setQueueName(\"aap\");\n+        jobQueue.submitJob(scheduler, d);\n+    }\n+    \n+    @Test(expected \u003d IncompleteJobDescriptionException.class)\n+    public void test_incompleteJobDescription1() throws Exception { \n+        jobQueue.submitJob(scheduler, new JobDescription());\n+    }\n+    \n+    @Test(expected \u003d InvalidJobDescriptionException.class)\n+    public void test_invalidJobDescription2() throws Exception {\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_invalidJobDescription2\");\n+        d.setNodeCount(42);\n+        jobQueue.submitJob(scheduler, d);\n+    }\n+\n+    @Test(expected \u003d InvalidJobDescriptionException.class)\n+    public void test_invalidJobDescription3() throws Exception {\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_invalidJobDescription3\");\n+        d.setProcessesPerNode(0);\n+        jobQueue.submitJob(scheduler, d);\n+    }\n+\n+    @Test(expected \u003d InvalidJobDescriptionException.class)\n+    public void test_invalidJobDescription4() throws Exception {\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_invalidJobDescription4\");\n+        d.setMaxTime(-1);\n+        jobQueue.submitJob(scheduler, d);\n+    }\n+\n+    @Test(expected \u003d InvalidJobDescriptionException.class)\n+    public void test_invalidJobDescription5() throws Exception {\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_invalidJobDescription5\");\n+        d.setInteractive(true);\n+        d.setStdin(\"aap\");\n+        jobQueue.submitJob(scheduler, d);\n+    }\n+\n+    @Test(expected \u003d InvalidJobDescriptionException.class)\n+    public void test_invalidJobDescription6() throws Exception {\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_invalidJobDescription6\");\n+        d.setInteractive(true);\n+        d.setStdout(\"aap\");\n+        jobQueue.submitJob(scheduler, d);\n+    }\n+\n+    @Test(expected \u003d InvalidJobDescriptionException.class)\n+    public void test_invalidJobDescription7() throws Exception {\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_invalidJobDescription7\");\n+        d.setInteractive(true);\n+        d.setStderr(\"aap\");\n+        jobQueue.submitJob(scheduler, d);\n+    }\n+\n+    @Test(expected \u003d InvalidJobDescriptionException.class)\n+    public void test_invalidJobDescription8() throws Exception {\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_invalidJobDescription8\");\n+        d.setStdout(null);\n+        jobQueue.submitJob(scheduler, d);\n+    }\n+\n+    @Test(expected \u003d InvalidJobDescriptionException.class)\n+    public void test_invalidJobDescription9() throws Exception {\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_invalidJobDescription9\");\n+        d.setStderr(null);\n+        jobQueue.submitJob(scheduler, d);\n+    }\n+\n+    @Test(expected \u003d OctopusException.class)\n+    public void test_failingInteractiveJob1() throws Exception {\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_failingInteractiveJob1\");\n+        d.setInteractive(true);\n+        d.setQueueName(\"unlimited\");\n+\n+        myFactory.setFail(true);\n+        \n+        try {\n+            // throws exception\n+            jobQueue.submitJob(scheduler, d);\n+        } finally { \n+            myFactory.setFail(false);\n+        }        \n+    }\n+    \n+    @Test(expected \u003d OctopusException.class)\n+    public void test_failingInteractiveJob2() throws Exception {\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_failingInteractiveJob1\");\n+        d.setInteractive(true);\n+        d.setQueueName(\"unlimited\");\n+        d.setStderr(null);\n+        d.setStdout(null);\n+        \n+        myFactory.setFail(true);\n+        \n+        try {\n+            // throws exception\n+            jobQueue.submitJob(scheduler, d);\n+        } finally { \n+            myFactory.setFail(false);\n+        }        \n+    }\n+\n+    \n+    \n+\n+    @Test(expected \u003d OctopusException.class)\n+    public void test_invalidWaitTimeout() throws Exception {\n+        // throws exception\n+        jobQueue.waitUntilDone(mock(Job.class), -42);\n+    }\n+\n+    @Test(expected \u003d OctopusException.class)\n+    public void test_invalidScheduler() throws Exception {\n+        Scheduler s \u003d mock(Scheduler.class);\n+        Job job \u003d mock(Job.class);\n+        when(job.getScheduler()).thenReturn(s);\n+       \n+        // throws exception\n+        jobQueue.getJobStatus(job);\n+    }\n+\n+    @Test(expected \u003d OctopusException.class)\n+    public void test_invalidQueueName() throws Exception {\n+        \n+        JobDescription d \u003d new JobDescription();\n+        d.setQueueName(\"test\");\n+        \n+        Job job \u003d mock(Job.class);\n+        when(job.getScheduler()).thenReturn(scheduler);\n+        when(job.getJobDescription()).thenReturn(d);\n+        \n+        // throws exception\n+        jobQueue.getJobStatus(job);\n+    }\n+\n+    @Test(expected \u003d OctopusException.class)\n+    public void test_invalidJob() throws Exception {\n+        \n+        JobDescription d \u003d new JobDescription();\n+        d.setQueueName(\"unlimited\");\n+        \n+        Job job \u003d mock(Job.class);\n+        when(job.getScheduler()).thenReturn(scheduler);\n+        when(job.getJobDescription()).thenReturn(d);\n+        \n+        // throws exception\n+        jobQueue.getJobStatus(job);\n+    }\n+    \n+    @Test\n+    public void test_cancelJob1() throws Exception {\n+\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_cancelJob1\");\n+        d.setQueueName(\"unlimited\");\n+\n+        Job job \u003d jobQueue.submitJob(scheduler, d);\n+        \n+        // Wait for at least the polling delay!\n+        try { \n+            Thread.sleep(POLLING_DELAY * 2);\n+        } catch (InterruptedException e) { \n+            // ignored\n+        }\n+\n+        JobStatus status \u003d jobQueue.cancelJob(job);\n+        \n+        assertNotNull(status);\n+        assertTrue(status.isDone());\n+        assertTrue(status.hasException());\n+    }\n+\n+    @Test\n+    public void test_cancelJob2() throws Exception {\n+\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_cancelJob2\");\n+        d.setQueueName(\"unlimited\");\n+        \n+        Job job \u003d jobQueue.submitJob(scheduler, d);\n+\n+        // Wait for at least the polling delay!\n+        try { \n+            Thread.sleep(POLLING_DELAY * 2);\n+        } catch (InterruptedException e) { \n+            // ignored\n+        }\n+        \n+        currentWrapper.setExitStatus(42);\n+        currentWrapper.setDone();\n+        \n+        JobStatus status \u003d jobQueue.cancelJob(job);\n+        \n+        assertNotNull(status);\n+        assertTrue(status.isDone());\n+        assertFalse(status.hasException());\n+        assertTrue(status.getExitCode() \u003d\u003d 42);\n+    }\n+\n+    @Test\n+    public void test_pollJob() throws Exception {\n+\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_pollJob\");\n+        d.setQueueName(\"unlimited\");\n+        \n+        Job job \u003d jobQueue.submitJob(scheduler, d);\n+\n+        // Wait for at least the polling delay!\n+        try { \n+            Thread.sleep(POLLING_DELAY * 2);\n+        } catch (InterruptedException e) { \n+            // ignored\n+        }\n+        \n+        JobStatus status \u003d jobQueue.getJobStatus(job);\n+        \n+        assertNotNull(status);\n+        assertFalse(status.isDone());\n+        \n+        currentWrapper.setExitStatus(42);\n+        currentWrapper.setDone();\n+        \n+        // Wait for at least the polling delay!\n+        try { \n+            Thread.sleep(POLLING_DELAY * 2);\n+        } catch (InterruptedException e) { \n+            // ignored\n+        }\n+        \n+        status \u003d jobQueue.getJobStatus(job);\n+        \n+        assertNotNull(status);\n+        assertTrue(status.isDone());\n+        assertFalse(status.hasException());\n+        assertTrue(status.getExitCode() \u003d\u003d 42);\n+    }\n+    \n+    @Test\n+    public void test_waitForJob() throws Exception {\n+\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_waitForJob\");\n+        d.setQueueName(\"unlimited\");\n+        \n+        Job job \u003d jobQueue.submitJob(scheduler, d);\n+\n+        JobStatus status \u003d jobQueue.getJobStatus(job);\n+        \n+        assertNotNull(status);\n+        assertFalse(status.isDone());\n+        \n+        currentWrapper.setExitStatus(42);\n+        currentWrapper.setDone();\n+   \n+        status \u003d jobQueue.waitUntilDone(job, POLLING_DELAY*3);\n+        \n+        assertNotNull(status);\n+        assertTrue(status.isDone());\n+        assertFalse(status.hasException());\n+        assertTrue(status.getExitCode() \u003d\u003d 42);\n+    }\n+    \n+    @Test\n+    public void test_getJobs1() throws Exception {\n+\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_getJobs\");\n+        d.setQueueName(\"unlimited\");\n+        \n+        Job job \u003d jobQueue.submitJob(scheduler, d);\n+\n+        Job [] status \u003d jobQueue.getJobs();\n+        \n+        assertNotNull(status);\n+        assertTrue(status.length \u003d\u003d 1);\n+        \n+        status \u003d jobQueue.getJobs((String []) null);\n+        \n+        assertNotNull(status);\n+        assertTrue(status.length \u003d\u003d 1);\n+        \n+        jobQueue.cancelJob(job);\n+    }\n+    \n+    @Test\n+    public void test_getJobs2() throws Exception {\n+\n+        JobDescription d \u003d new JobDescription();\n+        d.setExecutable(\"exec_getJobs\");\n+        d.setQueueName(\"unlimited\");\n+        \n+        Job job \u003d jobQueue.submitJob(scheduler, d);\n+\n+        Job [] status \u003d jobQueue.getJobs(\"unlimited\");\n+        \n+        assertNotNull(status);\n+        assertTrue(status.length \u003d\u003d 1);\n+        \n+        status \u003d jobQueue.getJobs(\"single\");\n+        \n+        assertNotNull(status);\n+        assertTrue(status.length \u003d\u003d 0);\n+        \n+        jobQueue.cancelJob(job);\n+    }\n+\n+}"
        },
        {
          "file_name": "test/src/nl/esciencecenter/octopus/exceptions/ExceptionsTest.java",
          "patch": "@@ -0,0 +1,469 @@\n+/*\n+ * Copyright 2013 Netherlands eScience Center\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package nl.esciencecenter.octopus.exceptions;\n+\n+import static org.junit.Assert.*;\n+\n+import org.junit.Test;\n+\n+/**\n+ * @author Jason Maassen \u003cJ.Maassen@esciencecenter.nl\u003e\n+ *\n+ */\n+public class ExceptionsTest {\n+\n+    private void testException(Exception e, String name, String message, Throwable cause) {\n+        \n+        if (name \u003d\u003d null) { \n+            assertEquals(message, e.getMessage());\n+        } else { \n+            assertEquals(name + \" adaptor: \" + message, e.getMessage());\n+        }\n+        assertTrue(e.getCause() \u003d\u003d cause);\n+    }\n+    \n+    private void testException(Exception e, Throwable cause) { \n+        testException(e, \"name\", \"message\", cause);\n+    }\n+    \n+    private void testException(Exception e) { \n+        testException(e, \"name\", \"message\", null);\n+    }\n+    \n+    @Test\n+    public void testOctopusException1() throws Exception {\n+        testException(new OctopusException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testOctopusException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new OctopusException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testOctopusException3() throws Exception {\n+        testException(new OctopusException(null, \"message\"), null, \"message\", null);\n+    }\n+    \n+    @Test\n+    public void testOctopusRuntimeException1() throws Exception {\n+        testException(new OctopusRuntimeException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testOctopusRuntimeException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new OctopusRuntimeException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testOctopusIOException3() throws Exception {\n+        testException(new OctopusIOException(null, \"message\"), null, \"message\", null);\n+    }\n+\n+    \n+    @Test\n+    public void testOctopusIOException1() throws Exception {\n+        testException(new OctopusIOException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testOctopusIOException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new OctopusIOException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testOctopusRuntimeException3() throws Exception {\n+        testException(new OctopusRuntimeException(null, \"message\"), null, \"message\", null);\n+    }\n+    \n+\n+    @Test\n+    public void testAttributeNotSupportedException1() throws Exception {\n+        testException(new AttributeNotSupportedException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testAttributeNotSupportedException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new AttributeNotSupportedException(\"name\", \"message\", t), t);\n+    }\n+\n+    \n+    @Test\n+    public void testBadParameterException1() throws Exception {\n+        testException(new BadParameterException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testBadParameterException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new BadParameterException(\"name\", \"message\", t), t);\n+    }\n+\n+    \n+    @Test\n+    public void testCommandNotFoundException1() throws Exception {\n+        testException(new CommandNotFoundException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testCommandNotFoundException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new CommandNotFoundException(\"name\", \"message\", t), t);\n+    }\n+\n+    \n+    @Test\n+    public void testConnectionLostException1() throws Exception {\n+        testException(new ConnectionLostException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testConnectionLostException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new ConnectionLostException(\"name\", \"message\", t), t);\n+    }\n+    \n+    \n+    @Test\n+    public void testDirectoryIteratorException1() throws Exception {\n+        testException(new DirectoryIteratorException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testDirectoryIteratorException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new DirectoryIteratorException(\"name\", \"message\", t), t);\n+    }\n+    \n+    \n+    \n+    @Test\n+    public void testDirectoryNotEmptyException1() throws Exception {\n+        testException(new DirectoryNotEmptyException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testDirectoryNotEmptyException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new DirectoryNotEmptyException(\"name\", \"message\", t), t);\n+    }\n+    \n+    \n+    @Test\n+    public void testEndOfFileException1() throws Exception {\n+        testException(new EndOfFileException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testEndOfFileException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new EndOfFileException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testFileAlreadyExistsException1() throws Exception {\n+        testException(new FileAlreadyExistsException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testFileAlreadyExistsException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new FileAlreadyExistsException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testIllegalPropertyException1() throws Exception {\n+        testException(new IllegalPropertyException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testIllegalPropertyException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new IllegalPropertyException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testIllegalSourcePathException1() throws Exception {\n+        testException(new IllegalSourcePathException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testIllegalSourcePathException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new IllegalSourcePathException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testIllegalTargetPathException1() throws Exception {\n+        testException(new IllegalTargetPathException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testIllegalTargetPathException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new IllegalTargetPathException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testIncompatibleVersionException1() throws Exception {\n+        testException(new IncompatibleVersionException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testIncompatibleVersionException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new IncompatibleVersionException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testIncompleteJobDescriptionException1() throws Exception {\n+        testException(new IncompleteJobDescriptionException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testIncompleteJobDescriptionException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new IncompleteJobDescriptionException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testInvalidCloseException1() throws Exception {\n+        testException(new InvalidCloseException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testInvalidCloseException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new InvalidCloseException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testInvalidCredentialException1() throws Exception {\n+        testException(new InvalidCredentialException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testInvalidCredentialException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new InvalidCredentialException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testInvalidCredentialsException1() throws Exception {\n+        testException(new InvalidCredentialsException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testInvalidCredentialsException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new InvalidCredentialsException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testInvalidDataException1() throws Exception {\n+        testException(new InvalidDataException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testInvalidDataException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new InvalidDataException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testInvalidJobDescriptionException1() throws Exception {\n+        testException(new InvalidJobDescriptionException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testInvalidJobDescriptionException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new InvalidJobDescriptionException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testInvalidLocationException1() throws Exception {\n+        testException(new InvalidLocationException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testInvalidLocationException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new InvalidLocationException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testInvalidOpenOptionsException1() throws Exception {\n+        testException(new InvalidOpenOptionsException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testInvalidOpenOptionsException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new InvalidOpenOptionsException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testInvalidPropertyException1() throws Exception {\n+        testException(new InvalidPropertyException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testInvalidPropertyException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new InvalidPropertyException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testNoSuchCopyException1() throws Exception {\n+        testException(new NoSuchCopyException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testNoSuchCopyException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new NoSuchCopyException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testNoSuchFileException1() throws Exception {\n+        testException(new NoSuchFileException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testNoSuchFileException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new NoSuchFileException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testNoSuchJobException1() throws Exception {\n+        testException(new NoSuchJobException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testNoSuchJobException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new NoSuchJobException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testNoSuchOctopusException1() throws Exception {\n+        testException(new NoSuchOctopusException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testNoSuchOctopusException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new NoSuchOctopusException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testNoSuchQueueException1() throws Exception {\n+        testException(new NoSuchQueueException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testNoSuchQueueException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new NoSuchQueueException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testNoSuchSchedulerException1() throws Exception {\n+        testException(new NoSuchSchedulerException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testNoSuchSchedulerException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new NoSuchSchedulerException(\"name\", \"message\", t), t);\n+    }\n+\n+    @Test\n+    public void testNotConnectedException1() throws Exception {\n+        testException(new NotConnectedException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testNotConnectedException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new NotConnectedException(\"name\", \"message\", t), t);\n+    }\n+\n+   \n+\n+    @Test\n+    public void testPermissionDeniedException1() throws Exception {\n+        testException(new PermissionDeniedException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testPermissionDeniedException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new PermissionDeniedException(\"name\", \"message\", t), t);\n+    }\n+   \n+    @Test\n+    public void testUnknownPropertyException1() throws Exception {\n+        testException(new UnknownPropertyException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testUnknownPropertyException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new UnknownPropertyException(\"name\", \"message\", t), t);\n+    }\n+   \n+    @Test\n+    public void testUnsupportedIOOperationException1() throws Exception {\n+        testException(new UnsupportedIOOperationException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testUnsupportedIOOperationException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new UnsupportedIOOperationException(\"name\", \"message\", t), t);\n+    }\n+   \n+    @Test\n+    public void testUnsupportedJobDescriptionException1() throws Exception {\n+        testException(new UnsupportedJobDescriptionException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testUnsupportedJobDescriptionException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new UnsupportedJobDescriptionException(\"name\", \"message\", t), t);\n+    }\n+   \n+    @Test\n+    public void testUnsupportedOperationException1() throws Exception {\n+        testException(new UnsupportedOperationException(\"name\", \"message\"));\n+    }\n+    \n+    @Test\n+    public void testUnsupportedOperationException2() throws Exception {\n+        Throwable t \u003d new Throwable();        \n+        testException(new UnsupportedOperationException(\"name\", \"message\", t), t);\n+    }\n+   \n+  }"
        },
        {
          "file_name": "test/src/nl/esciencecenter/octopus/util/RealSandboxTest.java",
          "patch": "@@ -0,0 +1,479 @@\n+package nl.esciencecenter.octopus.util;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.net.URISyntaxException;\n+import java.util.List;\n+\n+import nl.esciencecenter.octopus.Octopus;\n+import nl.esciencecenter.octopus.OctopusFactory;\n+import nl.esciencecenter.octopus.exceptions.OctopusException;\n+import nl.esciencecenter.octopus.exceptions.OctopusIOException;\n+import nl.esciencecenter.octopus.files.AbsolutePath;\n+import nl.esciencecenter.octopus.files.CopyOption;\n+import nl.esciencecenter.octopus.files.FileSystem;\n+import nl.esciencecenter.octopus.files.Files;\n+import nl.esciencecenter.octopus.files.RelativePath;\n+import nl.esciencecenter.octopus.util.Sandbox.Pair;\n+\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+public class RealSandboxTest {\n+\n+    private static Octopus octopus;\n+    private static Files files;\n+    private static FileSystem fileSystem;\n+    \n+    private static AbsolutePath testDir;\n+    \n+    private static AbsolutePath testInput1;\n+    private static AbsolutePath testInput2;\n+    \n+    private static int counter \u003d 0;\n+    \n+    @BeforeClass\n+    public static void prepare() throws Exception { \n+        octopus \u003d OctopusFactory.newOctopus(null);\n+        files \u003d octopus.files();\n+        fileSystem \u003d files.getLocalCWDFileSystem();\n+        testDir \u003d fileSystem.getEntryPath().resolve(new RelativePath(\"octopus_test_\" + System.currentTimeMillis()));\n+        files.createDirectory(testDir);\n+    \n+        testInput1 \u003d testDir.resolve(new RelativePath(\"input1\"));\n+        testInput2 \u003d testDir.resolve(new RelativePath(\"input2\"));\n+         \n+        files.createFile(testInput1);\n+        files.createFile(testInput2);\n+    }\n+\n+    @AfterClass\n+    public static void cleanup() throws Exception { \n+        FileUtils.recursiveDelete(octopus, testDir);\n+        OctopusFactory.endOctopus(octopus);\n+    }\n+\n+    public static synchronized String getNextSandbox() { \n+        return \"sandbox-\" + counter++;\n+    }\n+    \n+    @Test(expected \u003d OctopusException.class)\n+    public void testSandbox_WithNullOctopus() throws URISyntaxException, OctopusIOException, OctopusException {\n+        // throws exception\n+        new Sandbox(null, testDir, getNextSandbox());\n+    }\n+\n+    @Test(expected \u003d OctopusException.class)\n+    public void testSandbox_WithNullPath() throws URISyntaxException, OctopusIOException, OctopusException {\n+        // throws exception\n+        new Sandbox(octopus, null, getNextSandbox());\n+    }\n+    \n+    @Test\n+    public void testSandbox_WithName() throws URISyntaxException, OctopusIOException, OctopusException {\n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+\n+        AbsolutePath expectedPath \u003d testDir.resolve(new RelativePath(name));\n+        assertEquals(expectedPath, sandbox.getPath());\n+        assertEquals(0, sandbox.getUploadFiles().size());\n+        assertEquals(0, sandbox.getDownloadFiles().size());\n+    }\n+\n+    @Test\n+    public void testSandbox_WithoutName() throws URISyntaxException, OctopusIOException, OctopusException {\n+   \n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, null);\n+\n+        String sandboxPath \u003d sandbox.getPath().getPath();\n+        String tmp \u003d testDir.getPath();\n+        \n+        assertTrue(sandboxPath.startsWith(tmp + \"/octopus_sandbox_\"));\n+    }\n+\n+    @Test\n+    public void testAddUploadFile_SrcAndDst() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+\n+        sandbox.addUploadFile(testInput1, \"input\");\n+\n+        List\u003cPair\u003e uploadfiles \u003d sandbox.getUploadFiles();\n+        AbsolutePath dst \u003d testDir.resolve(new RelativePath(name)).resolve(new RelativePath(\"input\"));\n+        \n+        assertEquals(1, uploadfiles.size());\n+        assertEquals(testInput1, uploadfiles.get(0).source);\n+        assertEquals(dst, uploadfiles.get(0).destination);\n+    }\n+\n+    @Test\n+    public void testSetUploadFiles() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+        \n+        sandbox.setUploadFiles(testInput1, testInput2);\n+\n+        List\u003cPair\u003e uploadfiles \u003d sandbox.getUploadFiles();\n+        \n+        AbsolutePath sb \u003d testDir.resolve(new RelativePath(name));\n+        AbsolutePath dst1 \u003d sb.resolve(new RelativePath(\"input1\"));\n+        AbsolutePath dst2 \u003d sb.resolve(new RelativePath(\"input2\"));\n+         \n+        assertEquals(2, uploadfiles.size());\n+        assertEquals(testInput1, uploadfiles.get(0).source);\n+        assertEquals(dst1, uploadfiles.get(0).destination);\n+    \n+        assertEquals(testInput2, uploadfiles.get(1).source);\n+        assertEquals(dst2, uploadfiles.get(1).destination);\n+    }\n+    \n+    @Test\n+    public void testAddUploadFile_DstNull_DstSameFileName() throws URISyntaxException, OctopusIOException, OctopusException {\n+        \n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+ \n+        sandbox.addUploadFile(testInput1, null);\n+\n+        List\u003cPair\u003e uploadfiles \u003d sandbox.getUploadFiles();\n+       \n+        AbsolutePath dst \u003d testDir.resolve(new RelativePath(name)).resolve(new RelativePath(\"input1\"));\n+        \n+        assertEquals(1, uploadfiles.size());\n+        assertEquals(testInput1, uploadfiles.get(0).source);\n+        assertEquals(dst, uploadfiles.get(0).destination);\n+    }\n+\n+    @Test\n+    public void testAddUploadFile_SrcNull_NullPointerException() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+\n+        try {\n+            sandbox.addUploadFile(null);\n+            fail(\"Expected an NullPointerException\");\n+        } catch (NullPointerException e) {\n+            assertEquals(\"the source path cannot be null when adding a preStaged file\", e.getMessage());\n+        }\n+    }\n+\n+    @Test\n+    public void testAddDownloadFile() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+        \n+        sandbox.addDownloadFile(\"output1\", testInput1);\n+\n+        List\u003cPair\u003e downfiles \u003d sandbox.getDownloadFiles();\n+        \n+        AbsolutePath sb \u003d testDir.resolve(new RelativePath(name));\n+        AbsolutePath src \u003d sb.resolve(new RelativePath(\"output1\"));\n+         \n+        assertEquals(1, downfiles.size());\n+        assertEquals(src, downfiles.get(0).source);\n+        assertEquals(testInput1, downfiles.get(0).destination);\n+    }\n+\n+    @Test\n+    public void testAddDownloadFileSrcNull() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+        \n+        sandbox.addDownloadFile(null, testInput1);\n+        \n+        List\u003cPair\u003e downfiles \u003d sandbox.getDownloadFiles();\n+        \n+        AbsolutePath sb \u003d testDir.resolve(new RelativePath(name));\n+        AbsolutePath src \u003d sb.resolve(new RelativePath(\"input1\"));\n+        \n+        assertEquals(1, downfiles.size());\n+        assertEquals(src, downfiles.get(0).source);\n+        assertEquals(testInput1, downfiles.get(0).destination);\n+    }\n+\n+    @Test(expected \u003d NullPointerException.class)\n+    public void testAddDownloadFileDstNull() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+        \n+        // throws exception\n+        sandbox.addDownloadFile(\"output\", null);\n+    }\n+    \n+    @Test\n+    public void testUploadDelete() throws OctopusIOException, OctopusException, URISyntaxException {\n+\n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+\n+        sandbox.addUploadFile(testInput1, \"input\");\n+        sandbox.upload(CopyOption.REPLACE);\n+       \n+        AbsolutePath dstDir \u003d testDir.resolve(new RelativePath(name));\n+        AbsolutePath dstFile \u003d dstDir.resolve(new RelativePath(\"input\"));\n+       \n+        assertTrue(files.exists(dstDir));\n+        assertTrue(files.exists(dstFile));\n+\n+        sandbox.delete();\n+    \n+        assertFalse(files.exists(dstDir));\n+        assertFalse(files.exists(dstFile));\n+    }\n+\n+    @Test\n+    public void testUploadDownloadDelete() throws OctopusIOException, OctopusException, URISyntaxException {\n+\n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+\n+        AbsolutePath download \u003d testDir.resolve(new RelativePath(\"download\"));\n+        \n+        sandbox.addUploadFile(testInput1, \"input\");\n+        sandbox.addDownloadFile(\"input\", download);\n+        \n+        sandbox.upload(CopyOption.REPLACE);\n+       \n+        AbsolutePath dstDir \u003d testDir.resolve(new RelativePath(name));\n+        AbsolutePath dstFile \u003d dstDir.resolve(new RelativePath(\"input\"));\n+       \n+        assertTrue(files.exists(dstDir));\n+        assertTrue(files.exists(dstFile));\n+\n+        sandbox.download(CopyOption.REPLACE);\n+        sandbox.delete();\n+    \n+        assertFalse(files.exists(dstDir));\n+        assertFalse(files.exists(dstFile));\n+    \n+        assertTrue(files.exists(download));\n+        \n+        files.delete(download);\n+    }\n+    \n+    @Test\n+    public void testDoubleUploadDelete() throws OctopusIOException, OctopusException, URISyntaxException {\n+\n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+\n+        sandbox.addUploadFile(testInput1, \"input\");\n+\n+        sandbox.upload(CopyOption.REPLACE);\n+        \n+        AbsolutePath dstDir \u003d testDir.resolve(new RelativePath(name));\n+        AbsolutePath dstFile \u003d dstDir.resolve(new RelativePath(\"input\"));\n+       \n+        assertTrue(files.exists(dstDir));\n+        assertTrue(files.exists(dstFile));\n+\n+        sandbox.upload(CopyOption.REPLACE);\n+        \n+        sandbox.delete();\n+    \n+        assertFalse(files.exists(dstDir));\n+        assertFalse(files.exists(dstFile));        \n+    }\n+\n+\n+    @Test\n+    public void testHashCode() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+\n+        final int prime \u003d 31;\n+        int result \u003d 1;\n+        result \u003d prime * result + octopus.hashCode();\n+        result \u003d prime * result + testDir.resolve(new RelativePath(name)).hashCode();\n+        result \u003d prime * result + sandbox.getUploadFiles().hashCode();\n+        result \u003d prime * result + sandbox.getDownloadFiles().hashCode();\n+        \n+        assertEquals(result, sandbox.hashCode());\n+    }\n+\n+    @Test\n+    public void testToString() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        String name \u003d getNextSandbox();\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, name);\n+\n+        assertTrue(sandbox.toString().startsWith(\"Sandbox\"));\n+        \n+        // NOTE: very hard to test toString, as it depends on the location from where the test is started. Fortunately, we don\u0027t \n+        // really care what it prints, as it is for debugging anyway ;-)\n+    }\n+\n+    @Test\n+    public void testEquals_sameObject_equal() throws URISyntaxException, OctopusIOException, OctopusException {\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, getNextSandbox());\n+        assertEquals(sandbox, sandbox);\n+    }\n+\n+    @Test\n+    public void testEquals_otherClass_notEqual() throws URISyntaxException, OctopusIOException, OctopusException {\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, getNextSandbox());\n+        assertFalse(sandbox.equals(42));\n+    }\n+\n+    @Test\n+    public void testEquals_otherNull_notEqual() throws URISyntaxException, OctopusIOException, OctopusException {\n+        Sandbox sandbox \u003d new Sandbox(octopus, testDir, getNextSandbox());\n+        assertFalse(sandbox.equals(null));\n+    }\n+\n+    @Test\n+    public void testEquals_otherOctopus_notEqual() throws URISyntaxException, OctopusIOException, OctopusException {\n+        \n+        Octopus octopus2 \u003d OctopusFactory.newOctopus(null);\n+        \n+        String name \u003d getNextSandbox();\n+        \n+        Sandbox sandbox1 \u003d new Sandbox(octopus, testDir, name);\n+        Sandbox sandbox2 \u003d new Sandbox(octopus2, testDir, name);\n+        \n+        assertNotEquals(sandbox1,sandbox2);\n+        \n+        OctopusFactory.endOctopus(octopus2);\n+    }\n+\n+    @Test\n+    public void testEquals_otherPath_notEqual() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        AbsolutePath path \u003d fileSystem.getEntryPath().resolve(new RelativePath(\"octopus_test_\" + System.currentTimeMillis()));\n+        \n+        String name \u003d getNextSandbox();\n+        \n+        Sandbox sandbox1 \u003d new Sandbox(octopus, testDir, name);\n+        Sandbox sandbox2 \u003d new Sandbox(octopus, path, name);\n+        \n+        assertNotEquals(sandbox1,sandbox2);\n+    }\n+   \n+    @Test\n+    public void testEquals_otherUpload_notEqual() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        String name \u003d getNextSandbox();\n+        \n+        Sandbox sandbox1 \u003d new Sandbox(octopus, testDir, name);\n+        Sandbox sandbox2 \u003d new Sandbox(octopus, testDir, name);\n+\n+        sandbox1.addUploadFile(testInput1);\n+        assertNotEquals(sandbox1,sandbox2);\n+    }\n+\n+    @Test\n+    public void testEquals_otherDownload_notEqual() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        String name \u003d getNextSandbox();\n+        \n+        Sandbox sandbox1 \u003d new Sandbox(octopus, testDir, name);\n+        Sandbox sandbox2 \u003d new Sandbox(octopus, testDir, name);\n+\n+        sandbox1.addDownloadFile(\"output\", testInput1);\n+        assertNotEquals(sandbox1,sandbox2);\n+    }\n+\n+    @Test\n+    public void testEquals_sameUpload_Equal() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        String name \u003d getNextSandbox();\n+        \n+        Sandbox sandbox1 \u003d new Sandbox(octopus, testDir, name);\n+        Sandbox sandbox2 \u003d new Sandbox(octopus, testDir, name);\n+\n+        sandbox1.addUploadFile(testInput1);\n+        sandbox2.addUploadFile(testInput1);\n+\n+        assertEquals(sandbox1,sandbox2);\n+    }\n+\n+    @Test\n+    public void testPair_Equals() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        AbsolutePath src \u003d testInput1;\n+        AbsolutePath dst \u003d testInput2;\n+        \n+        Sandbox.Pair pair \u003d new Sandbox.Pair(src, dst);\n+        Sandbox.Pair pair2 \u003d new Sandbox.Pair(src, dst);\n+        Sandbox.Pair pair3 \u003d new Sandbox.Pair(src, null);\n+        Sandbox.Pair pair4 \u003d new Sandbox.Pair(null, dst);\n+        Sandbox.Pair pair5 \u003d new Sandbox.Pair(src, null);\n+        Sandbox.Pair pair6 \u003d new Sandbox.Pair(null, dst);\n+        \n+        assertTrue(pair.equals(pair));\n+        assertTrue(pair3.equals(pair5));\n+        assertTrue(pair4.equals(pair6));\n+        \n+        assertFalse(pair.equals(null));\n+        assertFalse(pair.equals(\"AAP\"));\n+        \n+        assertTrue(pair.equals(pair2));\n+            \n+        assertFalse(pair.equals(pair3));\n+        assertFalse(pair.equals(pair4));\n+        \n+        assertFalse(pair3.equals(pair));\n+        assertFalse(pair4.equals(pair));\n+    }\n+    \n+    @Test\n+    public void testPair_hashCode() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        AbsolutePath src \u003d testInput1;\n+        AbsolutePath dst \u003d testInput2;\n+        \n+        Sandbox.Pair pair \u003d new Sandbox.Pair(src, dst);\n+        Sandbox.Pair pair2 \u003d new Sandbox.Pair(null, null);\n+        Sandbox.Pair pair3 \u003d new Sandbox.Pair(src, null);\n+        Sandbox.Pair pair4 \u003d new Sandbox.Pair(null, dst);\n+       \n+        final int prime \u003d 31;\n+        int result \u003d 1;\n+        result \u003d prime * result + dst.hashCode();\n+        result \u003d prime * result + src.hashCode();\n+        \n+        assertTrue(pair.hashCode() \u003d\u003d result);\n+        \n+        result \u003d 1;\n+        result \u003d prime * result + 0;\n+        result \u003d prime * result + src.hashCode();\n+        \n+        assertTrue(pair3.hashCode() \u003d\u003d result);\n+        \n+        result \u003d 1;\n+        result \u003d prime * result + dst.hashCode();\n+        result \u003d prime * result + 0;\n+        \n+        assertTrue(pair4.hashCode() \u003d\u003d result);\n+        \n+        result \u003d 1;\n+        result \u003d prime * result + 0;\n+        result \u003d prime * result + 0;\n+        \n+        assertTrue(pair2.hashCode() \u003d\u003d result);\n+    } \n+    @Test\n+    public void testPair_toString() throws URISyntaxException, OctopusIOException, OctopusException {\n+\n+        AbsolutePath src \u003d testInput1;\n+        AbsolutePath dst \u003d testInput2;\n+        \n+        Sandbox.Pair pair \u003d new Sandbox.Pair(src, dst);\n+\n+        // NOTE: bogus test. We don\u0027t really care what it prints exactly, as it is for debugging anyway ;-)\n+        assertTrue(pair.toString().startsWith(\"Pair\"));\n+    } \n+    \n+}"
        },
        {
          "file_name": "test/src/nl/esciencecenter/octopus/util/SandboxTest.java",
          "patch": "@@ -25,6 +25,30 @@\n \n public class SandboxTest {\n \n+    private Sandbox sampleSandbox() throws URISyntaxException, OctopusException, OctopusIOException {\n+        \n+        Octopus o \u003d mock(Octopus.class);\n+        FileSystem fs \u003d new FileSystemImplementation(\"local\", \"local-0\", new URI(\"file:///\"), new RelativePath(), null, null);\n+        AbsolutePath path \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp\"));\n+        Sandbox sandbox \u003d new Sandbox(o, path, \"sandbox-1\");\n+        sandbox.addUploadFile(new AbsolutePathImplementation(fs, new RelativePath(\"/tmp/inputfile\")));\n+        sandbox.addDownloadFile(\"outputfile\", new AbsolutePathImplementation(fs, new RelativePath(\"/tmp/outputfile\")));\n+        return sandbox;\n+    }\n+   \n+    \n+    @Test(expected \u003d OctopusException.class)\n+    public void testSandbox_WithNullOctopus() throws URISyntaxException, OctopusIOException, OctopusException {\n+        // throws exception\n+        new Sandbox(null, mock(AbsolutePath.class), \"sandbox-1\");\n+    }\n+\n+    @Test(expected \u003d OctopusException.class)\n+    public void testSandbox_WithNullPath() throws URISyntaxException, OctopusIOException, OctopusException {\n+        // throws exception\n+        new Sandbox(mock(Octopus.class), null, \"sandbox-1\");\n+    }\n+    \n     @Test\n     public void testSandbox_WithName() throws URISyntaxException, OctopusIOException, OctopusException {\n         Octopus octopus \u003d mock(Octopus.class);\n@@ -69,6 +93,31 @@ public void testAddUploadFile_SrcAndDst() throws URISyntaxException, OctopusIOEx\n     }\n \n     @Test\n+    public void testSetUploadFiles() throws URISyntaxException, OctopusIOException, OctopusException {\n+        Octopus octopus \u003d mock(Octopus.class);\n+        FileSystem fs \u003d new FileSystemImplementation(\"local\", \"local-0\", new URI(\"file:///\"), new RelativePath(), null, null);\n+        AbsolutePath path \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp\"));\n+        Sandbox sandbox \u003d new Sandbox(octopus, path, \"sandbox-1\");\n+\n+        AbsolutePath src1 \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp/input1\"));\n+        AbsolutePath src2 \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp/input2\"));\n+        \n+        sandbox.setUploadFiles(src1, src2);\n+\n+        List\u003cPair\u003e uploadfiles \u003d sandbox.getUploadFiles();\n+        \n+        AbsolutePath dst1 \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp/sandbox-1/input1\"));\n+        AbsolutePath dst2 \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp/sandbox-1/input2\"));\n+         \n+        assertEquals(2, uploadfiles.size());\n+        assertEquals(src1, uploadfiles.get(0).source);\n+        assertEquals(dst1, uploadfiles.get(0).destination);\n+    \n+        assertEquals(src2, uploadfiles.get(1).source);\n+        assertEquals(dst2, uploadfiles.get(1).destination);\n+    }\n+    \n+    @Test\n     public void testAddUploadFile_DstNull_DstSameFileName() throws URISyntaxException, OctopusIOException, OctopusException {\n         Octopus octopus \u003d mock(Octopus.class);\n         FileSystem fs \u003d new FileSystemImplementation(\"local\", \"local-0\", new URI(\"file:///\"), new RelativePath(), null, null);\n@@ -221,32 +270,6 @@ public void testDownload() throws OctopusIOException, URISyntaxException, Octopu\n         verify(files).copy(src, dst);\n     }\n \n-    private Sandbox sampleSandbox() throws URISyntaxException, OctopusException, OctopusIOException {\n-        FileSystem fs \u003d new FileSystemImplementation(\"local\", \"local-0\", new URI(\"file:///\"), new RelativePath(), null, null);\n-        AbsolutePath path \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp\"));\n-        // Use null for octopus so hashcode is the same every time\n-        Sandbox sandbox \u003d new Sandbox(null, path, \"sandbox-1\");\n-        sandbox.addUploadFile(new AbsolutePathImplementation(fs, new RelativePath(\"/tmp/inputfile\")));\n-        sandbox.addDownloadFile(\"outputfile\", new AbsolutePathImplementation(fs, new RelativePath(\"/tmp/outputfile\")));\n-        return sandbox;\n-    }\n-\n-    @Test\n-    public void testHashCode() throws URISyntaxException, OctopusIOException, OctopusException {\n-        Sandbox sandbox \u003d sampleSandbox();\n-\n-        assertEquals(47434737, sandbox.hashCode());\n-    }\n-\n-    @Test\n-    public void testToString() throws URISyntaxException, OctopusIOException, OctopusException {\n-        Sandbox sandbox \u003d sampleSandbox();\n-\n-        String expected \u003d\n-                \"Sandbox [octopus\u003dnull, path\u003dFileSystemImplementation [adaptorName\u003dlocal, uri\u003dfile:///, entryPath\u003dRelativePath [element\u003d[], seperator\u003d/], properties\u003dnull]RelativePath [element\u003d[tmp, sandbox-1], seperator\u003d/], uploadFiles\u003d[Pair [source\u003dFileSystemImplementation [adaptorName\u003dlocal, uri\u003dfile:///, entryPath\u003dRelativePath [element\u003d[], seperator\u003d/], properties\u003dnull]RelativePath [element\u003d[tmp, inputfile], seperator\u003d/], destination\u003dFileSystemImplementation [adaptorName\u003dlocal, uri\u003dfile:///, entryPath\u003dRelativePath [element\u003d[], seperator\u003d/], properties\u003dnull]RelativePath [element\u003d[tmp, sandbox-1, inputfile], seperator\u003d/]]], downloadFiles\u003d[Pair [source\u003dFileSystemImplementation [adaptorName\u003dlocal, uri\u003dfile:///, entryPath\u003dRelativePath [element\u003d[], seperator\u003d/], properties\u003dnull]RelativePath [element\u003d[tmp, sandbox-1, outputfile], seperator\u003d/], destination\u003dFileSystemImplementation [adaptorName\u003dlocal, uri\u003dfile:///, entryPath\u003dRelativePath [element\u003d[], seperator\u003d/], properties\u003dnull]RelativePath [element\u003d[tmp, outputfile], seperator\u003d/]]]]\";\n-        assertEquals(expected, sandbox.toString());\n-    }\n-\n     @Test\n     public void testEquals_sameObject_equal() throws URISyntaxException, OctopusIOException, OctopusException {\n         Sandbox sandbox \u003d sampleSandbox();\n@@ -282,52 +305,19 @@ public void testEquals_otherOctopus_notEqual() throws URISyntaxException, Octopu\n     }\n \n     @Test\n-    public void testEquals_thisOctopusIsNull_notEqual() throws URISyntaxException, OctopusIOException, OctopusException {\n-        Octopus octopus \u003d mock(Octopus.class);\n-        FileSystem fs \u003d new FileSystemImplementation(\"local\", \"local-0\", new URI(\"file:///\"), new RelativePath(), null, null);\n-        AbsolutePath path \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp\"));\n-\n-        Sandbox sandbox1 \u003d new Sandbox(null, path, \"sandbox-1\");\n-        Sandbox sandbox2 \u003d new Sandbox(octopus, path, \"sandbox-1\");\n-        \n-        assertNotEquals(sandbox1,sandbox2);\n-    }\n-\n-    @Test\n-    public void testEquals_otherOctopusIsNull_notEqual() throws URISyntaxException, OctopusIOException, OctopusException {\n-        Octopus octopus \u003d mock(Octopus.class);\n-        FileSystem fs \u003d new FileSystemImplementation(\"local\", \"local-0\", new URI(\"file:///\"), new RelativePath(), null, null);\n-        AbsolutePath path \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp\"));\n-\n-        Sandbox sandbox1 \u003d new Sandbox(octopus, path, \"sandbox-1\");\n-        Sandbox sandbox2 \u003d new Sandbox(null, path, \"sandbox-1\");\n-\n-        assertNotEquals(sandbox1,sandbox2);\n-    }\n-\n-    @Test\n-    public void testEquals_bothOctopusNull_Equal() throws URISyntaxException, OctopusIOException, OctopusException {\n-        FileSystem fs \u003d new FileSystemImplementation(\"local\", \"local-0\", new URI(\"file:///\"), new RelativePath(), null, null);\n-        AbsolutePath path \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp\"));\n-\n-        Sandbox sandbox1 \u003d new Sandbox(null, path, \"sandbox-1\");\n-        Sandbox sandbox2 \u003d new Sandbox(null, path, \"sandbox-1\");\n-\n-        assertNotEquals(sandbox1,sandbox2);\n-    }\n-\n-    @Test\n     public void testEquals_otherPath_notEqual() throws URISyntaxException, OctopusIOException, OctopusException {\n         Octopus octopus \u003d mock(Octopus.class);\n         FileSystem fs \u003d new FileSystemImplementation(\"local\", \"local-0\", new URI(\"file:///\"), new RelativePath(), null, null);\n-        AbsolutePath path \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp\"));\n \n-        Sandbox sandbox1 \u003d new Sandbox(octopus, path, \"sandbox-1\");\n-        Sandbox sandbox2 \u003d new Sandbox(octopus, path, \"sandbox-2\");\n+        AbsolutePath path1 \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp1\"));\n+        AbsolutePath path2 \u003d new AbsolutePathImplementation(fs, new RelativePath(\"/tmp2\"));\n+        \n+        Sandbox sandbox1 \u003d new Sandbox(octopus, path1, \"sandbox-1\");\n+        Sandbox sandbox2 \u003d new Sandbox(octopus, path2, \"sandbox-2\");\n \n         assertNotEquals(sandbox1,sandbox2);\n     }\n-\n+   \n     @Test\n     public void testEquals_otherUpload_notEqual() throws URISyntaxException, OctopusIOException, OctopusException {\n         Octopus octopus \u003d mock(Octopus.class);\n@@ -371,5 +361,4 @@ public void testEquals_sameUpload_Equal() throws URISyntaxException, OctopusIOEx\n \n         assertEquals(sandbox1,sandbox2);\n     }\n-\n }"
        }
      ]
    }
  },
  {
    "name": "Race condition in AbstractBlockingExtension",
    "url": "https://github.com/ljnelson/microbean-cdi/issues/1",
    "description": "There appears to be a scenario when running with Weld SE as the backing CDI implementation (which installs its own shutdown hooks) that can result in a race condition.\r\n\r\nI\u0027m observing in a project that uses the [`microbean-jersey-container-grizzly2-http-cdi-extension`](https://github.com/ljnelson/microbean-jersey-container-grizzly2-http-cdi-extension) project that the container comes up, the Jersey container inside it comes up, the Jersey container shuts down, the _container shuts down_ and then blocks in the shutdown process.  I\u0027m not sure where the problem lies but solving it will probably involve the [`fireBlockingEvent` method](https://github.com/ljnelson/microbean-cdi/blob/microbean-cdi-0.1.2/src/main/java/org/microbean/cdi/AbstractBlockingExtension.java#L136-L145).\r\n\r\nThe workaround is to try starting the container again; it will work eventually.\r\n\r\nMy hazy sense is that the Weld shutdown hook is firing, thus bringing down the container, but the `AbstractExtension` manages to get off its `fireBlockingEvent` call, which then hangs.  The result would be, if I\u0027m right, a container that is shut down (in terms of its state), but hanging waiting for the blocking event to be processed.",
    "keywords": [
      "container",
      "shutdown"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/ljnelson/microbean-cdi/commit/1890f91856cd34f76fcba7f7ef8bcdd33f562be3",
      "files": [
        {
          "file_name": "pom.xml",
          "patch": "@@ -7,7 +7,7 @@\n   \u003c/prerequisites\u003e\n \n   \u003cartifactId\u003emicrobean-cdi\u003c/artifactId\u003e\n-  \u003cversion\u003e0.1.3-SNAPSHOT\u003c/version\u003e\n+  \u003cversion\u003e0.2.0-SNAPSHOT\u003c/version\u003e\n \n   \u003cparent\u003e\n     \u003cgroupId\u003eorg.microbean\u003c/groupId\u003e\n@@ -30,9 +30,16 @@\n     \u003cdependencies\u003e\n \n       \u003cdependency\u003e\n+        \u003cgroupId\u003ejavax.annotation\u003c/groupId\u003e\n+        \u003cartifactId\u003ejavax.annotation-api\u003c/artifactId\u003e\n+        \u003cversion\u003e1.3\u003c/version\u003e\n+        \u003ctype\u003ejar\u003c/type\u003e\n+      \u003c/dependency\u003e\n+      \n+      \u003cdependency\u003e\n         \u003cgroupId\u003ejavax.enterprise\u003c/groupId\u003e\n         \u003cartifactId\u003ecdi-api\u003c/artifactId\u003e\n-        \u003cversion\u003e2.0-PFD2\u003c/version\u003e\n+        \u003cversion\u003e2.0\u003c/version\u003e\n         \u003ctype\u003ejar\u003c/type\u003e\n       \u003c/dependency\u003e\n \n@@ -89,6 +96,13 @@\n     \u003c!-- Provided-scoped dependencies. --\u003e\n \n     \u003cdependency\u003e\n+      \u003cgroupId\u003ejavax.annotation\u003c/groupId\u003e\n+      \u003cartifactId\u003ejavax.annotation-api\u003c/artifactId\u003e\n+      \u003ctype\u003ejar\u003c/type\u003e\n+      \u003cscope\u003eprovided\u003c/scope\u003e\n+    \u003c/dependency\u003e\n+    \n+    \u003cdependency\u003e\n       \u003cgroupId\u003ejavax.enterprise\u003c/groupId\u003e\n       \u003cartifactId\u003ecdi-api\u003c/artifactId\u003e\n       \u003ctype\u003ejar\u003c/type\u003e\n@@ -212,7 +226,7 @@\n     \u003cfindbugs.threshold\u003eMedium\u003c/findbugs.threshold\u003e\n \n     \u003c!-- maven-javadoc-plugin properties; see https://maven.apache.org/plugins/maven-javadoc-plugin/javadoc-mojo.html --\u003e\n-    \u003clinks\u003ehttps://www.slf4j.org/api/,http://docs.jboss.org/cdi/api/2.0-PFD2/,http://docs.oracle.com/javaee/7/api/\u003c/links\u003e\n+    \u003clinks\u003ehttps://www.slf4j.org/api/,http://docs.jboss.org/cdi/api/2.0/,http://docs.oracle.com/javaee/7/api/\u003c/links\u003e\n \n     \u003c!-- maven-release-plugin properties --\u003e\n     \u003cgoals\u003edeploy,site-deploy\u003c/goals\u003e"
        },
        {
          "file_name": "src/main/java/org/microbean/cdi/AbstractBlockingExtension.java",
          "patch": "@@ -16,17 +16,26 @@\n  */\n package org.microbean.cdi;\n \n+import java.util.IdentityHashMap;\n import java.util.Objects;\n \n import java.util.concurrent.CountDownLatch;\n \n+import javax.annotation.Priority;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.context.BeforeDestroyed;\n+\n import javax.enterprise.event.Event; // for javadoc only\n import javax.enterprise.event.NotificationOptions;\n import javax.enterprise.event.ObservesAsync;\n+import javax.enterprise.event.Observes;\n \n import javax.enterprise.inject.spi.BeanManager;\n import javax.enterprise.inject.spi.Extension;\n \n+import javax.interceptor.Interceptor;\n+\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n@@ -51,6 +60,23 @@\n \n \n   /*\n+   * Static fields.\n+   */\n+\n+\n+  /**\n+   * An {@link IdentityHashMap} tracking all known instances of the\n+   * {@link AbstractBlockingExtension} class for {@linkplain\n+   * #unblockAll() unblocking purposes}.\n+   *\n+   * @see #unblockAll()\n+   *\n+   * @see #unblock(boolean)\n+   */\n+  private static final IdentityHashMap\u003cAbstractBlockingExtension, Void\u003e instances \u003d new IdentityHashMap\u003c\u003e(5);\n+  \n+\n+  /*\n    * Instance fields.\n    */\n \n@@ -94,8 +120,9 @@ protected AbstractBlockingExtension() {\n    * Creates a new {@link AbstractBlockingExtension} that uses the\n    * supplied {@link CountDownLatch} for governing blocking behavior,\n    * and installs a {@linkplain Runtime#addShutdownHook(Thread)\n-   * shutdown hook} that calls {@link CountDownLatch#countDown()\n-   * countDown()} on the supplied {@code latch}.\n+   * shutdown hook} that (indirectly) calls {@link\n+   * CountDownLatch#countDown() countDown()} on the supplied {@code\n+   * latch}.\n    *\n    * @param latch a {@link CountDownLatch} whose {@link\n    * CountDownLatch#countDown()} and {@link CountDownLatch#await()}\n@@ -110,6 +137,9 @@ protected AbstractBlockingExtension(final CountDownLatch latch) {\n     this.latch \u003d latch;\n     this.logger \u003d LoggerFactory.getLogger(this.getClass());\n     Runtime.getRuntime().addShutdownHook(new ShutdownHook());\n+    synchronized (instances) {\n+      instances.put(this, null);\n+    }\n   }\n \n \n@@ -125,23 +155,22 @@ protected AbstractBlockingExtension(final CountDownLatch latch) {\n    * cause {@link CountDownLatch#await()} to be called in a separate\n    * thread.\n    *\n+   * \u003cp\u003e\u003cstrong\u003eThis method is no longer necessary and is slated for\n+   * removal.\u003c/strong\u003e\u003c/p\u003e\n+   *\n    * @param beanManager the {@link BeanManager} to use to fire the\n    * event; must not be {@code null}\n    *\n    * @exception NullPointerException if {@code beanManager} is {@code\n    * null}\n    *\n    * @see #unblock()\n+   *\n+   * @deprecated This method is slated for removal.\n    */\n+  @Deprecated\n   protected void fireBlockingEvent(final BeanManager beanManager) {\n-    if (this.logger.isTraceEnabled()) {\n-      this.logger.trace(\"ENTRY {} {} {}\", this.getClass().getName(), \"fireBlockingEvent\", beanManager);\n-    }\n     Objects.requireNonNull(beanManager);\n-    beanManager.getEvent().select(BlockingEvent.class).fireAsync(new BlockingEvent());\n-    if (this.logger.isTraceEnabled()) {\n-      this.logger.trace(\"EXIT {} {}\", this.getClass().getName(), \"fireBlockingEvent\");\n-    }\n   }\n \n   /**\n@@ -151,6 +180,9 @@ protected void fireBlockingEvent(final BeanManager beanManager) {\n    * AbstractBlockingExtension} that will cause {@link\n    * CountDownLatch#await()} to be called in a separate thread.\n    *\n+   * \u003cp\u003e\u003cstrong\u003eThis method is no longer necessary and is slated for\n+   * removal.\u003c/strong\u003e\u003c/p\u003e\n+   *\n    * @param beanManager the {@link BeanManager} to use to fire the\n    * event; must not be {@code null}\n    *\n@@ -163,37 +195,46 @@ protected void fireBlockingEvent(final BeanManager beanManager) {\n    * @exception NullPointerException if {@code beanManager} is {@code \n    * null}\n    *\n+   * @exception InterruptedException if the thread was interrupted\n+   *\n    * @see #unblock()\n+   *\n+   * @deprecated This method is slated for removal.\n    */\n-  protected void fireBlockingEvent(final BeanManager beanManager, final NotificationOptions options) {\n-    if (this.logger.isTraceEnabled()) {\n-      this.logger.trace(\"ENTRY {} {} {}, {}\", this.getClass().getName(), \"fireBlockingEvent\", beanManager, options);\n-    }\n+  @Deprecated\n+  protected void fireBlockingEvent(final BeanManager beanManager,\n+                                   final NotificationOptions options)\n+    throws InterruptedException {\n     Objects.requireNonNull(beanManager);\n-    beanManager.getEvent().select(BlockingEvent.class).fireAsync(new BlockingEvent(), options);\n-    if (this.logger.isTraceEnabled()) {\n-      this.logger.trace(\"EXIT {} {}\", this.getClass().getName(), \"fireBlockingEvent\");\n-    }\n   }\n \n   /**\n-   * {@linkplain ObservesAsync Observes the asynchronous firing} of a\n-   * {@link BlockingEvent}, such as fired by the {@link\n-   * #fireBlockingEvent(BeanManager)} method, by calling {@link\n-   * CountDownLatch#await()} on the {@link CountDownLatch} {@linkplain\n-   * #AbstractBlockingExtension(CountDownLatch) supplied at\n-   * construction time}.\n+   * Blocks the main CDI thread immediately before any other recipient\n+   * of the {@link BeforeDestroyed\n+   * BeforeDestroyed(ApplicationScoped.class)} event is notified and\n+   * waits for some other thread to call the {@link #unblock()}\n+   * method.\n+   *\n+   * \u003cp\u003eNote that since the {@link #unblock()} method has no side\n+   * effects, this very thread could have already called it, in which\n+   * case no blocking behavior will be observed.\u003c/p\u003e\n    *\n    * @param event the event in question; may be {@code null}; ignored\n    *\n    * @exception InterruptedException if the current {@link Thread} is\n    * {@linkplain Thread#interrupt() interrupted}\n    *\n-   * @see #fireBlockingEvent(BeanManager)\n-   *\n    * @see #unblock()\n+   *\n+   * @see #unblockAll()\n+   *\n+   * @see Interceptor.Priority#PLATFORM_BEFORE\n    */\n-  private final void block(@ObservesAsync final BlockingEvent event) throws InterruptedException {\n+  private final void block(@Observes\n+                           @BeforeDestroyed(ApplicationScoped.class)\n+                           @Priority(Interceptor.Priority.PLATFORM_BEFORE - 1)\n+                           final Object event)\n+    throws InterruptedException {\n     if (this.logger.isTraceEnabled()) {\n       this.logger.trace(\"ENTRY {} {} {}\", this.getClass().getName(), \"block\", event);\n     }\n@@ -209,18 +250,70 @@ private final void block(@ObservesAsync final BlockingEvent event) throws Interr\n    * #AbstractBlockingExtension(CountDownLatch) supplied at\n    * construction time}.\n    *\n-   * @see #fireBlockingEvent(BeanManager)\n+   * \u003cp\u003eThis method may be invoked more than once without any side\n+   * effects.\u003c/p\u003e\n+   *\n+   * @see #unblockAll()\n    */\n   public void unblock() {\n+    this.unblock(true);\n+  }\n+\n+  /**\n+   * Calls {@link CountDownLatch#countDown()} on the {@link\n+   * CountDownLatch} {@linkplain\n+   * #AbstractBlockingExtension(CountDownLatch) supplied at\n+   * construction time}.\n+   *\n+   * \u003cp\u003eThis method may be invoked more than once without any side\n+   * effects.\u003c/p\u003e\n+   *\n+   * @param remove whether to remove this {@link\n+   * AbstractBlockingExtension} from {@linkplain #instances the\n+   * internal set of \u003ccode\u003eAbstractBlockingExtension\u003c/code\u003e instances}\n+   */\n+  private final void unblock(final boolean remove) {\n     if (this.logger.isTraceEnabled()) {\n       this.logger.trace(\"ENTRY {} {}\", this.getClass().getName(), \"unblock\");\n     }\n+    assert this.latch.getCount() \u003d\u003d 0 || this.latch.getCount() \u003d\u003d 1;\n     this.latch.countDown();\n+    if (remove) {\n+      synchronized (instances) {\n+        instances.remove(this);\n+      }\n+    }\n     if (this.logger.isTraceEnabled()) {\n       this.logger.trace(\"EXIT {} {}\", this.getClass().getName(), \"unblock\");\n     }\n   }\n \n+  /**\n+   * Unblocks all known instances of the {@link\n+   * AbstractBlockingExtension} class by calling their associated\n+   * {@link CountDownLatch}es {@linkplain\n+   * #AbstractBlockingExtension(CountDownLatch) supplied at their\n+   * construction time}.\n+   *\n+   * \u003cp\u003eThis method may be invoked more than once without any side\n+   * effects.\u003c/p\u003e\n+   *\n+   * @see #unblock()\n+   */\n+  public static final void unblockAll() {\n+    synchronized (instances) {\n+      if (!instances.isEmpty()) {\n+        instances.forEach((instance, ignored) -\u003e {\n+            if (instance !\u003d null) {\n+              instance.unblock(false);\n+            }\n+          });\n+        instances.clear();\n+      }\n+      assert instances.isEmpty();\n+    }\n+  }\n+\n \n   /*\n    * Inner and nested classes.\n@@ -269,32 +362,37 @@ public final void run() {\n \n \n   /**\n-   * A CDI event indicating that, when {@linkplain\n-   * Event#fireAsync(Object) fired asynchronously}, indicates that the\n-   * receiver should wait for its current {@link Thread} to die.\n+   * An {@link Object} serving as a CDI event indicating that,\n+   * when {@linkplain Event#fireAsync(Object) fired asynchronously},\n+   * indicates that the receiver should wait for its current {@link\n+   * Thread} to die.\n    *\n    * @author \u003ca href\u003d\"https://about.me/lairdnelson\"\n    * target\u003d\"_parent\"\u003eLaird Nelson\u003c/a\u003e\n    *\n-   * @see #fireBlockingEvent(BeanManager)\n-   *\n    * @see CountDownLatch#await()\n+   *\n+   * @deprecated This class is slated for removal.\n    */\n+  @Deprecated\n   protected static final class BlockingEvent {\n \n-\n+    \n     /*\n      * Constructors.\n      */\n \n \n     /**\n      * Creates a new {@link BlockingEvent}.\n+     *\n+     * @deprecated This class is slated for removal.\n      */\n+    @Deprecated\n     private BlockingEvent() {\n       super();\n     }\n-    \n+\n   }\n   \n }"
        }
      ]
    }
  },
  {
    "name": "Fix race condition in RemoteClusterConnection node supplier",
    "url": "https://github.com/elastic/elasticsearch/pull/25432",
    "description": "This commit fixes a race condition in the node supplier used by the RemoteClusterConnection. The\r\nnode supplier stores an iterator over a set backed by a ConcurrentHashMap, but the get operation\r\nof the supplier uses multiple methods of the iterator and is suceptible to a race between the\r\ncalls to hasNext() and next(). The test in this commit fails under the old implementation with a\r\nNoSuchElementException. This commit adds a wrapper object over a set and a list, with all methods\r\nbeing synchronized to avoid races. Additionally, iterators are no longer used and replaced with a\r\ncounter and index based access of an array list to maintain the round robin aspect of the previous\r\nnode supplier implementation.",
    "keywords": [
      "node",
      "race",
      "supplier",
      "commit"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/elastic/elasticsearch/commit/64d11b883170393b05316d9a4db9261fd30ae2b8",
      "files": [
        {
          "file_name": "core/src/main/java/org/elasticsearch/transport/RemoteClusterConnection.java",
          "patch": "@@ -33,7 +33,6 @@\n import org.elasticsearch.action.admin.cluster.state.ClusterStateAction;\n import org.elasticsearch.action.admin.cluster.state.ClusterStateRequest;\n import org.elasticsearch.action.admin.cluster.state.ClusterStateResponse;\n-import org.elasticsearch.action.search.SearchRequest;\n import org.elasticsearch.cluster.node.DiscoveryNode;\n import org.elasticsearch.cluster.node.DiscoveryNodes;\n import org.elasticsearch.common.component.AbstractComponent;\n@@ -56,15 +55,13 @@\n import java.util.Set;\n import java.util.concurrent.ArrayBlockingQueue;\n import java.util.concurrent.BlockingQueue;\n-import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.RejectedExecutionException;\n import java.util.concurrent.Semaphore;\n import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.function.Function;\n import java.util.function.Predicate;\n import java.util.stream.Collectors;\n-import java.util.stream.Stream;\n \n /**\n  * Represents a connection to a single remote cluster. In contrast to a local cluster a remote cluster is not joined such that the\n@@ -83,8 +80,7 @@\n \n     private final TransportService transportService;\n     private final ConnectionProfile remoteProfile;\n-    private final Set\u003cDiscoveryNode\u003e connectedNodes \u003d Collections.newSetFromMap(new ConcurrentHashMap\u003c\u003e());\n-    private final Supplier\u003cDiscoveryNode\u003e nodeSupplier;\n+    private final ConnectedNodes connectedNodes;\n     private final String clusterAlias;\n     private final int maxNumRemoteConnections;\n     private final Predicate\u003cDiscoveryNode\u003e nodePredicate;\n@@ -116,19 +112,7 @@\n             TransportRequestOptions.Type.STATE,\n             TransportRequestOptions.Type.RECOVERY);\n         remoteProfile \u003d builder.build();\n-        nodeSupplier \u003d new Supplier\u003cDiscoveryNode\u003e() {\n-            private volatile Iterator\u003cDiscoveryNode\u003e current;\n-            @Override\n-            public DiscoveryNode get() {\n-                if (current \u003d\u003d null || current.hasNext() \u003d\u003d false) {\n-                    current \u003d connectedNodes.iterator();\n-                    if (current.hasNext() \u003d\u003d false) {\n-                        throw new IllegalStateException(\"No node available for cluster: \" + clusterAlias + \" nodes: \" + connectedNodes);\n-                    }\n-                }\n-                return current.next();\n-            }\n-        };\n+        connectedNodes \u003d new ConnectedNodes(clusterAlias);\n         this.seedNodes \u003d Collections.unmodifiableList(seedNodes);\n         this.connectHandler \u003d new ConnectHandler();\n         transportService.addConnectionListener(this);\n@@ -156,7 +140,7 @@ public void onNodeDisconnected(DiscoveryNode node) {\n      */\n     public void fetchSearchShards(ClusterSearchShardsRequest searchRequest,\n                                   ActionListener\u003cClusterSearchShardsResponse\u003e listener) {\n-        if (connectedNodes.isEmpty()) {\n+        if (connectedNodes.size() \u003d\u003d 0) {\n             // just in case if we are not connected for some reason we try to connect and if we fail we have to notify the listener\n             // this will cause some back pressure on the search end and eventually will cause rejections but that\u0027s fine\n             // we can\u0027t proceed with a search on a cluster level.\n@@ -173,7 +157,7 @@ public void fetchSearchShards(ClusterSearchShardsRequest searchRequest,\n      * will invoke the listener immediately.\n      */\n     public void ensureConnected(ActionListener\u003cVoid\u003e voidActionListener) {\n-        if (connectedNodes.isEmpty()) {\n+        if (connectedNodes.size() \u003d\u003d 0) {\n             connectHandler.connect(voidActionListener);\n         } else {\n             voidActionListener.onResponse(null);\n@@ -182,7 +166,7 @@ public void ensureConnected(ActionListener\u003cVoid\u003e voidActionListener) {\n \n     private void fetchShardsInternal(ClusterSearchShardsRequest searchShardsRequest,\n                                      final ActionListener\u003cClusterSearchShardsResponse\u003e listener) {\n-        final DiscoveryNode node \u003d nodeSupplier.get();\n+        final DiscoveryNode node \u003d connectedNodes.get();\n         transportService.sendRequest(node, ClusterSearchShardsAction.NAME, searchShardsRequest,\n             new TransportResponseHandler\u003cClusterSearchShardsResponse\u003e() {\n \n@@ -218,7 +202,7 @@ void collectNodes(ActionListener\u003cFunction\u003cString, DiscoveryNode\u003e\u003e listener) {\n             request.clear();\n             request.nodes(true);\n             request.local(true); // run this on the node that gets the request it\u0027s as good as any other\n-            final DiscoveryNode node \u003d nodeSupplier.get();\n+            final DiscoveryNode node \u003d connectedNodes.get();\n             transportService.sendRequest(node, ClusterStateAction.NAME, request, TransportRequestOptions.EMPTY,\n                 new TransportResponseHandler\u003cClusterStateResponse\u003e() {\n                     @Override\n@@ -243,7 +227,7 @@ public String executor() {\n                     }\n                 });\n         };\n-        if (connectedNodes.isEmpty()) {\n+        if (connectedNodes.size() \u003d\u003d 0) {\n             // just in case if we are not connected for some reason we try to connect and if we fail we have to notify the listener\n             // this will cause some back pressure on the search end and eventually will cause rejections but that\u0027s fine\n             // we can\u0027t proceed with a search on a cluster level.\n@@ -260,7 +244,7 @@ public String executor() {\n      * given node.\n      */\n     Transport.Connection getConnection(DiscoveryNode remoteClusterNode) {\n-        DiscoveryNode discoveryNode \u003d nodeSupplier.get();\n+        DiscoveryNode discoveryNode \u003d connectedNodes.get();\n         Transport.Connection connection \u003d transportService.getConnection(discoveryNode);\n         return new Transport.Connection() {\n             @Override\n@@ -283,12 +267,11 @@ public void close() throws IOException {\n     }\n \n     Transport.Connection getConnection() {\n-        DiscoveryNode discoveryNode \u003d nodeSupplier.get();\n+        DiscoveryNode discoveryNode \u003d connectedNodes.get();\n         return transportService.getConnection(discoveryNode);\n     }\n \n-\n-        @Override\n+    @Override\n     public void close() throws IOException {\n         connectHandler.close();\n     }\n@@ -583,12 +566,19 @@ boolean isNodeConnected(final DiscoveryNode node) {\n         return connectedNodes.contains(node);\n     }\n \n+    DiscoveryNode getConnectedNode() {\n+        return connectedNodes.get();\n+    }\n+\n+    void addConnectedNode(DiscoveryNode node) {\n+        connectedNodes.add(node);\n+    }\n \n     /**\n      * Fetches connection info for this connection\n      */\n     public void getConnectionInfo(ActionListener\u003cRemoteConnectionInfo\u003e listener) {\n-        final Optional\u003cDiscoveryNode\u003e anyNode \u003d connectedNodes.stream().findAny();\n+        final Optional\u003cDiscoveryNode\u003e anyNode \u003d connectedNodes.getAny();\n         if (anyNode.isPresent() \u003d\u003d false) {\n             // not connected we return immediately\n             RemoteConnectionInfo remoteConnectionStats \u003d new RemoteConnectionInfo(clusterAlias,\n@@ -650,4 +640,68 @@ public String executor() {\n     int getNumNodesConnected() {\n         return connectedNodes.size();\n     }\n+\n+    private static class ConnectedNodes implements Supplier\u003cDiscoveryNode\u003e {\n+\n+        private final Set\u003cDiscoveryNode\u003e nodeSet \u003d new HashSet\u003c\u003e();\n+        private final String clusterAlias;\n+\n+        private Iterator\u003cDiscoveryNode\u003e currentIterator \u003d null;\n+\n+        private ConnectedNodes(String clusterAlias) {\n+            this.clusterAlias \u003d clusterAlias;\n+        }\n+\n+        @Override\n+        public synchronized DiscoveryNode get() {\n+            ensureIteratorAvailable();\n+            if (currentIterator.hasNext()) {\n+                return currentIterator.next();\n+            } else {\n+                throw new IllegalStateException(\"No node available for cluster: \" + clusterAlias);\n+            }\n+        }\n+\n+        synchronized boolean remove(DiscoveryNode node) {\n+            final boolean setRemoval \u003d nodeSet.remove(node);\n+            if (setRemoval) {\n+                currentIterator \u003d null;\n+            }\n+            return setRemoval;\n+        }\n+\n+        synchronized boolean add(DiscoveryNode node) {\n+            final boolean added \u003d nodeSet.add(node);\n+            if (added) {\n+                currentIterator \u003d null;\n+            }\n+            return added;\n+        }\n+\n+        synchronized int size() {\n+            return nodeSet.size();\n+        }\n+\n+        synchronized boolean contains(DiscoveryNode node) {\n+            return nodeSet.contains(node);\n+        }\n+\n+        synchronized Optional\u003cDiscoveryNode\u003e getAny() {\n+            ensureIteratorAvailable();\n+            if (currentIterator.hasNext()) {\n+                return Optional.of(currentIterator.next());\n+            } else {\n+                return Optional.empty();\n+            }\n+        }\n+\n+        private synchronized void ensureIteratorAvailable() {\n+            if (currentIterator \u003d\u003d null) {\n+                currentIterator \u003d nodeSet.iterator();\n+            } else if (currentIterator.hasNext() \u003d\u003d false \u0026\u0026 nodeSet.isEmpty() \u003d\u003d false) {\n+                // iterator rollover\n+                currentIterator \u003d nodeSet.iterator();\n+            }\n+        }\n+    }\n }"
        },
        {
          "file_name": "core/src/test/java/org/elasticsearch/transport/RemoteClusterConnectionTests.java",
          "patch": "@@ -19,6 +19,7 @@\n package org.elasticsearch.transport;\n \n import org.apache.lucene.store.AlreadyClosedException;\n+import org.apache.lucene.util.IOUtils;\n import org.elasticsearch.Build;\n import org.elasticsearch.Version;\n import org.elasticsearch.action.ActionListener;\n@@ -72,6 +73,7 @@\n import java.util.concurrent.RejectedExecutionException;\n import java.util.concurrent.TimeUnit;\n import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n import java.util.concurrent.atomic.AtomicReference;\n import java.util.function.Function;\n \n@@ -818,4 +820,90 @@ public void testCollectNodes() throws Exception {\n             }\n         }\n     }\n+\n+    public void testConnectedNodesConcurrentAccess() throws IOException, InterruptedException {\n+        List\u003cDiscoveryNode\u003e knownNodes \u003d new CopyOnWriteArrayList\u003c\u003e();\n+        List\u003cMockTransportService\u003e discoverableTransports \u003d new CopyOnWriteArrayList\u003c\u003e();\n+        try {\n+            final int numDiscoverableNodes \u003d randomIntBetween(5, 20);\n+            List\u003cDiscoveryNode\u003e discoverableNodes \u003d new ArrayList\u003c\u003e(numDiscoverableNodes);\n+            for (int i \u003d 0; i \u003c numDiscoverableNodes; i++ ) {\n+                MockTransportService transportService \u003d startTransport(\"discoverable_node\" + i, knownNodes, Version.CURRENT);\n+                discoverableNodes.add(transportService.getLocalDiscoNode());\n+                discoverableTransports.add(transportService);\n+            }\n+\n+            List\u003cDiscoveryNode\u003e seedNodes \u003d randomSubsetOf(discoverableNodes);\n+            Collections.shuffle(seedNodes, random());\n+\n+            try (MockTransportService service \u003d MockTransportService.createNewService(Settings.EMPTY, Version.CURRENT, threadPool, null)) {\n+                service.start();\n+                service.acceptIncomingRequests();\n+                try (RemoteClusterConnection connection \u003d new RemoteClusterConnection(Settings.EMPTY, \"test-cluster\",\n+                    seedNodes, service, Integer.MAX_VALUE, n -\u003e true)) {\n+                    final int numGetThreads \u003d randomIntBetween(4, 10);\n+                    final Thread[] getThreads \u003d new Thread[numGetThreads];\n+                    final int numModifyingThreads \u003d randomIntBetween(4, 10);\n+                    final Thread[] modifyingThreads \u003d new Thread[numModifyingThreads];\n+                    CyclicBarrier barrier \u003d new CyclicBarrier(numGetThreads + numModifyingThreads);\n+                    for (int i \u003d 0; i \u003c getThreads.length; i++) {\n+                        final int numGetCalls \u003d randomIntBetween(1000, 10000);\n+                        getThreads[i] \u003d new Thread(() -\u003e {\n+                            try {\n+                                barrier.await();\n+                                for (int j \u003d 0; j \u003c numGetCalls; j++) {\n+                                    try {\n+                                        DiscoveryNode node \u003d connection.getConnectedNode();\n+                                        assertNotNull(node);\n+                                    } catch (IllegalStateException e) {\n+                                        if (e.getMessage().startsWith(\"No node available for cluster:\") \u003d\u003d false) {\n+                                            throw e;\n+                                        }\n+                                    }\n+                                }\n+                            } catch (Exception ex) {\n+                                throw new AssertionError(ex);\n+                            }\n+                        });\n+                        getThreads[i].start();\n+                    }\n+\n+                    final AtomicInteger counter \u003d new AtomicInteger();\n+                    for (int i \u003d 0; i \u003c modifyingThreads.length; i++) {\n+                        final int numDisconnects \u003d randomIntBetween(5, 10);\n+                        modifyingThreads[i] \u003d new Thread(() -\u003e {\n+                            try {\n+                                barrier.await();\n+                                for (int j \u003d 0; j \u003c numDisconnects; j++) {\n+                                    if (randomBoolean()) {\n+                                        MockTransportService transportService \u003d\n+                                            startTransport(\"discoverable_node_added\" + counter.incrementAndGet(), knownNodes,\n+                                                Version.CURRENT);\n+                                        discoverableTransports.add(transportService);\n+                                        connection.addConnectedNode(transportService.getLocalDiscoNode());\n+                                    } else {\n+                                        DiscoveryNode node \u003d randomFrom(discoverableNodes);\n+                                        connection.onNodeDisconnected(node);\n+                                    }\n+                                }\n+                            } catch (Exception ex) {\n+                                throw new AssertionError(ex);\n+                            }\n+                        });\n+                        modifyingThreads[i].start();\n+                    }\n+\n+                    for (Thread thread : getThreads) {\n+                        thread.join();\n+                    }\n+                    for (Thread thread : modifyingThreads) {\n+                        thread.join();\n+                    }\n+                }\n+            }\n+        } finally {\n+            IOUtils.closeWhileHandlingException(discoverableTransports);\n+        }\n+    }\n+\n }"
        }
      ]
    }
  },
  {
    "name": "Fix race condition in ProgramClient#stopAll",
    "url": "https://github.com/caskdata/cdap/pull/8669",
    "description": "If program stops on its own before we call stop, simply log the resulting exception instead of propagating it.\r\n\r\nhttps://builds.cask.co/browse/CDAP-DUT5677-1",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/caskdata/cdap/commit/f440634980a76b550852148a9cdff5e8ae0e29a6",
      "files": [
        {
          "file_name": "cdap-client/src/main/java/co/cask/cdap/client/ProgramClient.java",
          "patch": "@@ -60,6 +60,8 @@\n import com.google.common.reflect.TypeToken;\n import com.google.gson.Gson;\n import com.google.gson.GsonBuilder;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n import java.io.IOException;\n import java.lang.reflect.Type;\n@@ -79,7 +81,7 @@\n  */\n @Beta\n public class ProgramClient {\n-\n+  private static final Logger LOG \u003d LoggerFactory.getLogger(ProgramClient.class);\n   private static final Gson GSON \u003d new GsonBuilder()\n     .registerTypeAdapter(WorkflowActionSpecification.class, new WorkflowActionSpecificationCodec())\n     .registerTypeAdapter(CustomActionSpecification.class, new CustomActionSpecificationCodec())\n@@ -353,7 +355,19 @@ public void stopAll(NamespaceId namespace)\n           ProgramId program \u003d appId.program(programRecord.getType(), programRecord.getName());\n           String status \u003d this.getStatus(program);\n           if (!status.equals(\"STOPPED\")) {\n-            this.stop(program);\n+            try {\n+              this.stop(program);\n+            } catch (IOException ioe) {\n+              // ProgramClient#stop calls RestClient, which throws an IOException if the HTTP response code is 400,\n+              // which can be due to the program already being stopped when calling stop on it.\n+              if (!\"STOPPED\".equals(getStatus(program))) {\n+                throw ioe;\n+              }\n+              // Most likely, there was a race condition that the program stopped between the time we checked its\n+              // status and calling the stop method.\n+              LOG.warn(\"Program {} is already stopped, proceeding even though the following exception is raised.\",\n+                       program, ioe);\n+            }\n             this.waitForStatus(program, ProgramStatus.STOPPED, 60, TimeUnit.SECONDS);\n           }\n         } catch (ProgramNotFoundException e) {"
        }
      ]
    }
  },
  {
    "name": "Race condition in SystemTypeManager.getSystemEdgeType",
    "url": "https://github.com/thinkaurelius/titan/issues/89",
    "description": "in creating the hashmap with all the system types.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/thinkaurelius/titan/commit/898033872164962f81ef6cd0415c829f9ef7746a",
      "files": [
        {
          "file_name": "src/main/java/com/thinkaurelius/titan/graphdb/types/system/SystemTypeManager.java",
          "patch": "@@ -1,5 +1,6 @@\n package com.thinkaurelius.titan.graphdb.types.system;\n \n+import com.google.common.collect.ImmutableMap;\n import com.google.common.collect.ImmutableSet;\n import com.thinkaurelius.titan.core.TypeGroup;\n import com.thinkaurelius.titan.graphdb.types.group.StandardTypeGroup;\n@@ -20,15 +21,18 @@\n \tpublic static SystemType getSystemEdgeType(long id) {\n \t\tif (systemEdgeTypes\u003d\u003dnull) {\n \t\t\t//Initialize\n-\t\t\tsystemEdgeTypes\u003dnew HashMap\u003cLong,SystemType\u003e();\n-\t\t\tfor (SystemType et : SystemKey.values()) {\n-\t\t\t\tassert !systemEdgeTypes.containsKey(et.getID());\n-\t\t\t\tsystemEdgeTypes.put(Long.valueOf(et.getID()), et);\n-\t\t\t}\n-\t\t\tfor (SystemType et : SystemLabel.values()) {\n-\t\t\t\tassert !systemEdgeTypes.containsKey(et.getID());\n-\t\t\t\tsystemEdgeTypes.put(Long.valueOf(et.getID()), et);\n-\t\t\t}\n+            synchronized (SystemTypeManager.class) {\n+                if (systemEdgeTypes\u003d\u003dnull) {\n+                    ImmutableMap.Builder\u003cLong,SystemType\u003e builder \u003d ImmutableMap.builder();\n+                    for (SystemType et : SystemKey.values()) {\n+                        builder.put(Long.valueOf(et.getID()), et);\n+                    }\n+                    for (SystemType et : SystemLabel.values()) {\n+                        builder.put(Long.valueOf(et.getID()), et);\n+                    }\n+                    systemEdgeTypes \u003d builder.build();\n+                }\n+            }\n \t\t}\n \t\tSystemType et \u003d systemEdgeTypes.get(Long.valueOf(id));\n \t\tif (et\u003d\u003dnull) throw new IllegalArgumentException(\"System edge type is unknown with ID:\" + id);"
        }
      ]
    }
  },
  {
    "name": "Race condition in LeastRecentlyUsedSet",
    "url": "https://github.com/cgeo/cgeo/issues/2316",
    "description": "Found in Google Play console:\n\n```\njava.util.NoSuchElementException\nat java.util.LinkedHashMap$LinkedHashIterator.nextEntry(LinkedHashMap.java:353)\nat java.util.LinkedHashMap$KeyIterator.next(LinkedHashMap.java:370)\nat java.util.AbstractCollection.toArray(AbstractCollection.java:343)\nat java.util.ArrayList.\u003cinit\u003e(ArrayList.java:93)\nat cgeo.geocaching.utils.LeastRecentlyUsedSet.getAsList(LeastRecentlyUsedSet.java:141)\nat cgeo.geocaching.maps.CGeoMap.countVisibleCaches(CGeoMap.java:344)\n```\n",
    "keywords": [
      "java",
      "util",
      "leastrecentlyusedset",
      "java util"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/cgeo/cgeo/commit/67f776a540e883a20baa88bc24a9fd5b0dcd6b40",
      "files": [
        {
          "file_name": "main/src/cgeo/geocaching/utils/LeastRecentlyUsedSet.java",
          "patch": "@@ -2,6 +2,7 @@\n \n import java.util.AbstractSet;\n import java.util.ArrayList;\n+import java.util.Collection;\n import java.util.HashSet;\n import java.util.Iterator;\n import java.util.List;\n@@ -102,6 +103,18 @@ public synchronized boolean remove(Object o) {\n     }\n \n     /**\n+     * Synchronized removal of all elements contained in another collection.\n+     */\n+    @Override\n+    public synchronized boolean removeAll(final Collection\u003c?\u003e c) {\n+        boolean changed \u003d false;\n+        for (final Object o: c) {\n+            changed |\u003d remove(o);\n+        }\n+        return changed;\n+    }\n+\n+    /**\n      * Synchronized clearing of the set\n      * Copy of the HashSet code if clear()\n      * "
        }
      ]
    }
  },
  {
    "name": "Race condition in game logic",
    "url": "https://github.com/Kurocon/softwaresystemen/issues/15",
    "description": "There is a race condition in the game logic where the move is transmitted over the network but the next player is never assigned, as the board seems to be still waiting on the move. Needs to have an observer that notifies it when a move is available.\n",
    "keywords": [
      "move"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/Kurocon/softwaresystemen/commit/8b3719e727b3866258f4f16b9b47a1be2f64e952",
      "files": [
        {
          "file_name": "Rolit/.checkstyle",
          "patch": "@@ -0,0 +1,7 @@\n+\u003c?xml version\u003d\"1.0\" encoding\u003d\"UTF-8\"?\u003e\n+\n+\u003cfileset-config file-format-version\u003d\"1.2.0\" simple-config\u003d\"true\" sync-formatter\u003d\"false\"\u003e\n+  \u003cfileset name\u003d\"all\" enabled\u003d\"true\" check-config-name\u003d\"Sun Checks\" local\u003d\"false\"\u003e\n+    \u003cfile-match-pattern match-pattern\u003d\".\" include-pattern\u003d\"true\"/\u003e\n+  \u003c/fileset\u003e\n+\u003c/fileset-config\u003e"
        },
        {
          "file_name": "Rolit/.classpath",
          "patch": "@@ -1,8 +1,10 @@\n \u003c?xml version\u003d\"1.0\" encoding\u003d\"UTF-8\"?\u003e\n \u003cclasspath\u003e\n-\t\u003cclasspathentry kind\u003d\"src\" path\u003d\"src\"/\u003e\n+\t\u003cclasspathentry kind\u003d\"src\" path\u003d\"src\"\u003e\n+\t\t\u003cattributes\u003e\n+\t\t\t\u003cattribute name\u003d\"org.eclipse.jdt.launching.CLASSPATH_ATTR_LIBRARY_PATH_ENTRY\" value\u003d\"Rolit/lib\"/\u003e\n+\t\t\u003c/attributes\u003e\n+\t\u003c/classpathentry\u003e\n \t\u003cclasspathentry kind\u003d\"con\" path\u003d\"org.eclipse.jdt.launching.JRE_CONTAINER\"/\u003e\n-\t\u003cclasspathentry kind\u003d\"lib\" path\u003d\"lib/commons-codec-1.9.jar\"/\u003e\n-\t\u003cclasspathentry kind\u003d\"lib\" path\u003d\"/home/kevin/University Twente/softwaresystemen/Rolit/lib/forms-1.3.0.jar\" sourcepath\u003d\"forms-1.3.0-src.zip\"/\u003e\n \t\u003cclasspathentry kind\u003d\"output\" path\u003d\"bin\"/\u003e\n \u003c/classpath\u003e"
        },
        {
          "file_name": "Rolit/src/rolit/Board.java",
          "patch": "@@ -3,14 +3,15 @@\n import java.util.ArrayList;\n import java.util.Collections;\n import java.util.HashMap;\n+import java.util.Observable;\n \n /**.\n  * Game board for Rolit\n  *\n  * @author Sophie Lathouwers \u0026 Kevin Alberts\n  * @version $Revision: 1.0 $\n  */\n-public class Board {\n+public class Board extends Observable{\n \n \t/*\t\tCONSTANTS\t\t*/\n \t/**.\n@@ -1061,4 +1062,15 @@ public boolean canHitDiagonalRightLeft(int index, Mark m) {\n \tpublic int getPlayerCount() {\n \t\treturn this.amountPlayers;\n \t}\n+\n+\tpublic String getValidMovesString(Mark m) {\n+\t\tint[] validMoves \u003d this.getValidFields(this, m);\n+\t\tString result \u003d \"[\";\n+\t\tfor(int move : validMoves){\n+\t\t\tint[] rowcol \u003d this.rowcol(move);\n+\t\t\tresult \u003d result+rowcol[0]+\",\"+rowcol[1]+\"; \";\n+\t\t}\n+\t\tresult \u003d result+\"]\";\n+\t\treturn result;\n+\t}\n }"
        },
        {
          "file_name": "Rolit/src/rolit/Game.java",
          "patch": "@@ -10,7 +10,7 @@\n  * @author Sophie Lathouwers \u0026 Kevin Alberts\n  * @version $Revision: 1.0 $\n  */\n-public class Game extends Observable {\n+public class Game extends Observable implements Runnable {\n \n     // -- Instance variables -----------------------------------------\n \t/**.\n@@ -64,47 +64,17 @@ public Game(ArrayList\u003cPlayer\u003e players) {\n \n     /**\n      * Starts the Rolit game. \u003cbr\u003e\n-     * Asks after each ended game if the user want to continue. Continues until\n-     * the user does not want to play anymore.\n      */\n     public void start() {\n-        boolean oneMoreTime \u003d true;\n-        while (oneMoreTime) {\n-            reset();\n-            play();\n-            oneMoreTime \u003d readBoolean(\"\\n\u003e Play another time? (y/n)?\", \"y\", \"n\");\n-        }\n-    }\n-\n-    /**\n-     * Prints a question which can be answered by yes (true) or no (false).\n-     * After prompting the question on standard out, this method reads a String\n-     * from standard in and compares it to the parameters for yes and no. If the\n-     * user inputs a different value, the prompt is repeated and te method reads\n-     * input again.\n-     *\n-     * @param prompt the question to print\n-     * @param yes\n-     *            the String corresponding to a yes answer\n-     * @param no\n-     *            the String corresponding to a no answer\n-     * @return true is the yes answer is typed, false if the no answer is typed\n-     */\n-    private boolean readBoolean(String prompt, String yes, String no) {\n-        String answer;\n-        do {\n-            System.out.print(prompt);\n-            Scanner in \u003d new Scanner(System.in);\n-            answer \u003d in.hasNextLine() ? in.nextLine() : null;\n-        } while (answer \u003d\u003d null || (!answer.equals(yes) \u0026\u0026 !answer.equals(no)));\n-        return answer.equals(yes);\n+    \tThread thread \u003d new Thread(this);\n+    \tthread.start();\n     }\n \n     /**\n      * Resets the game. \u003cbr\u003e\n      * The board is emptied and player[0] becomes the current player.\n      */\n-    private void reset() {\n+    protected void reset() {\n         current \u003d 0;\n         board.reset();\n     }\n@@ -130,8 +100,10 @@ private void play() {\n      * Performs one move and notifies the observers\n      */\n     public void playOneMove() {\n+    \tLogger.log(Logger.DEBUG, \"Notifying player \"+current+\" that a move is to be made\");\n     \tint keuze \u003d playersArray[current].makeMove(board);\n     \tthis.lastMoveMade \u003d keuze;\n+    \tLogger.log(Logger.DEBUG, \"Incrementing current player\");\n     \tcurrent \u003d (current + 1) % numPlayers;\n     \tupdate();\n         setChanged();\n@@ -204,4 +176,10 @@ public int getPlayerCount() {\n \tpublic void resetGame() {\n \t\tthis.reset();\n \t}\n+\n+\t@Override\n+\tpublic void run() {\n+\t\treset();\n+\t\tplay();\n+\t}\n }"
        },
        {
          "file_name": "Rolit/src/rolit/Logger.java",
          "patch": "@@ -11,6 +11,40 @@\n \t * higher means less verbose\n \t */\n \tprivate static final int LOGLEVEL \u003d 0;\n+\t\n+\t/**\n+\t * Constant for debug messages\n+\t */\n+\tpublic static final int DEBUG \u003d 0;\n+\t/**\n+\t * Constant for debug messages\n+\t */\n+\tpublic static final int INFO \u003d 1;\n+\t/**\n+\t * Constant for debug messages\n+\t */\n+\tpublic static final int GAMEINFO \u003d 2;\n+\t/**\n+\t * Constant for debug messages\n+\t */\n+\tpublic static final int WARNING \u003d 3;\n+\t/**\n+\t * Constant for debug messages\n+\t */\n+\tpublic static final int ERROR \u003d 4;\n+\t/**\n+\t * Constant for debug messages\n+\t */\n+\tpublic static final int MESSAGE \u003d 5;\n+\t/**\n+\t * Constant for debug messages\n+\t */\n+\tpublic static final int COMMAND \u003d 6;\n+\t/**\n+\t * Constant for debug messages\n+\t */\n+\tpublic static final int CUSTOMCMD \u003d 7;\n+\t\n \t/**\n \t * log method to print errors, debugs, incoming messages, etc.\n \t * @param level - level of the log,\n@@ -20,27 +54,30 @@\n \tpublic static void log(int level, String string) {\n \t\tString levelString;\n \t\tswitch(level) {\n-\t\t\tcase 0:\n+\t\t\tcase DEBUG:\n \t\t\t\tlevelString \u003d \"DEBUG\";\n \t\t\t\tbreak;\n-\t\t\tcase 1:\n+\t\t\tcase INFO:\n \t\t\t\tlevelString \u003d \"INFO\";\n \t\t\t\tbreak;\n-\t\t\tcase 2:\n+\t\t\tcase WARNING:\n \t\t\t\tlevelString \u003d \"WARNING\";\n \t\t\t\tbreak;\n-\t\t\tcase 3:\n+\t\t\tcase ERROR:\n \t\t\t\tlevelString \u003d \"ERROR\";\n \t\t\t\tbreak;\n-\t\t\tcase 4:\n+\t\t\tcase MESSAGE:\n \t\t\t\tlevelString \u003d \"MSG\";\n \t\t\t\tbreak;\n-\t\t\tcase 5:\n+\t\t\tcase COMMAND:\n \t\t\t\tlevelString \u003d \"COMMAND\";\n \t\t\t\tbreak;\n-\t\t\tcase 6:\n+\t\t\tcase CUSTOMCMD:\n \t\t\t\tlevelString \u003d \"CUSTOMCMD\";\n \t\t\t\tbreak;\n+\t\t\tcase GAMEINFO:\n+\t\t\t\tlevelString \u003d \"GAMEINFO\";\n+\t\t\t\tbreak;\n \t\t\tdefault:\n \t\t\t\tlevelString \u003d \"INFO\";\n \t\t\t\tbreak;"
        },
        {
          "file_name": "Rolit/src/rolit/Mark.java",
          "patch": "@@ -48,4 +48,26 @@ public Mark next(int numPlayers) {\n \t\t}\n \t\treturn next;\n \t}\n+\t\n+\tpublic static Mark[] getMarkList(int numPlayers){\n+\t\tMark[] result \u003d  new Mark[numPlayers];\n+\t\tswitch(numPlayers){\n+\t\t\tcase 2:\n+\t\t\t\tresult[0] \u003d Mark.RED;\n+\t\t\t\tresult[1] \u003d Mark.GRN;\n+\t\t\t\tbreak;\n+\t\t\tcase 3:\n+\t\t\t\tresult[0] \u003d Mark.RED;\n+\t\t\t\tresult[1] \u003d Mark.YEL;\n+\t\t\t\tresult[2] \u003d Mark.GRN;\n+\t\t\t\tbreak;\n+\t\t\tcase 4:\n+\t\t\t\tresult[0] \u003d Mark.RED;\n+\t\t\t\tresult[1] \u003d Mark.YEL;\n+\t\t\t\tresult[2] \u003d Mark.GRN;\n+\t\t\t\tresult[3] \u003d Mark.BLU;\n+\t\t\t\tbreak;\n+\t\t}\n+\t\treturn result;\n+\t}\n }"
        },
        {
          "file_name": "Rolit/src/rolit/NetworkGame.java",
          "patch": "@@ -0,0 +1,122 @@\n+package rolit;\n+\n+import java.util.ArrayList;\n+import java.util.Observable;\n+import java.util.Scanner;\n+\n+/**\n+ * Class for maintaining the Rolit game.\n+ *\n+ * @author Sophie Lathouwers \u0026 Kevin Alberts\n+ * @version $Revision: 1.0 $\n+ */\n+public class NetworkGame extends Game {\n+\n+    // -- Constructors -----------------------------------------------\n+    /**\n+     * Creates a new Game object.\n+     * @param players - ArrayList of players that are participating\n+     */\n+    public NetworkGame(ArrayList\u003cPlayer\u003e players) {\n+    \tsuper(players);\n+    }\n+\n+    // -- Commands ---------------------------------------------------\n+\n+    /**\n+     * Starts the Rolit game. \u003cbr\u003e\n+     */\n+    public void start() {\n+    \treset();\n+    \tplay();\n+    }\n+\n+    /**\n+     * Plays the Rolit game. \u003cbr\u003e\n+     * First the (still empty) board is shown. Then the game is played until it\n+     * is over. Players can make a move one after the other. After each move,\n+     * the changed game situation is printed.\n+     */\n+    private void play() {\n+        playOneMove();\n+    }\n+\n+    /**.\n+     * Performs one move and notifies the observers\n+     */\n+    public void playOneMove() {\n+    \tint keuze \u003d playersArray[current].makeMove(board);\n+    \tthis.lastMoveMade \u003d keuze;\n+    \tcurrent \u003d (current + 1) % numPlayers;\n+    \tupdate();\n+        setChanged();\n+        notifyObservers();\n+    }\n+\n+    /**\n+     * @return gets current player\n+     */\n+    public Player getPlayer() {\n+    \treturn this.playersArray[current];\n+    }\n+\n+    /**\n+     * Prints the game situation.\n+     */\n+    private void update() {\n+        System.out.println(\"\\ncurrent game situation: \\n\\n\" + board.toString()\n+                + \"\\n\");\n+        int[] possibleMoves \u003d board.getValidFields(board, this.playersArray[this.current].getMark());\n+        System.out.println(\"Possible moves: \" + Board.intArrayToString(possibleMoves));\n+    }\n+\n+    /**\n+     * Prints the result of the last game. \u003cbr\u003e\n+     */\n+    private void printResult() {\n+    \ttestBoard.debug(board.countSquares(board).toString());\n+        if (board.hasWinner()) {\n+            Player winner \u003d null;\n+            for (int i \u003d 0; i \u003c 4; i++) {\n+            \tif (board.isWinner(playersArray[i].getMark())) {\n+            \t\twinner \u003d playersArray[i];\n+            \t}\n+            }\n+            System.out.println(\"Player \" + winner.getName() + \" (\"\n+                    + winner.getMark().toString() + \") has won!\");\n+        } else {\n+            System.out.println(\"Draw. There is no winner!\");\n+        }\n+    }\n+\n+    /**.\n+     * returns current player\u0027s mark\n+     * @return Mark of current player\n+     */\n+    public Mark getCurrentPlayer() {\n+    \treturn this.playersArray[this.current].getMark();\n+    }\n+\n+    /**.\n+     * returns the board of this game\n+     * @return board\n+     */\n+    public Board getBoard() {\n+    \treturn this.board;\n+    }\n+\n+    /**.\n+     * gets number of participating players\n+     * @return number of players participating\n+     */\n+    public int getPlayerCount() {\n+    \treturn this.numPlayers;\n+    }\n+\n+    /**.\n+     * resets the game\n+     */\n+\tpublic void resetGame() {\n+\t\tthis.reset();\n+\t}\n+}"
        },
        {
          "file_name": "Rolit/src/rolit/NetworkPlayer.java",
          "patch": "@@ -0,0 +1,110 @@\n+package rolit;\n+\n+import java.util.concurrent.locks.ReentrantLock;\n+\n+import rolit.server.ClientHandler;\n+import sun.misc.Lock;\n+\n+/**\n+ * Class for maintaining a human player in Rolit.\n+ *\n+ * @author Sophie Lathouwers \u0026 Kevin Alberts\n+ * @version $Revision: 1.0 $\n+ */\n+public class NetworkPlayer extends Player {\n+\t/**.\n+\t * variable to check whether a move has been done already\n+\t */\n+\tpublic boolean moveDone \u003d false;\n+\t//public Object lock \u003d new Object();\n+\tpublic ReentrantLock lock \u003d new ReentrantLock();\n+\t/**.\n+\t * variable to store the chosen move\n+\t */\n+\tprivate int chosenMove;\n+\t/**\n+\t * variable to store the ClientHandler for this player\n+\t */\n+\tprivate ClientHandler client \u003d null;\n+    // -- Constructors -----------------------------------------------\n+    /**\n+     * Creates a new Network player object.\n+     * @param name - name of Player\n+     * @param mark - mark of Player\n+     */\n+    public NetworkPlayer(String name, Mark mark) {\n+        super(name, mark);\n+    }\n+    /**\n+     * Creates a new Network player object.\n+     * @param name - ClientHandler for player\n+     * @param mark - mark of Player\n+     */\n+    public NetworkPlayer(ClientHandler client, Mark mark){\n+    \tthis(client.getNick(), mark);\n+    \tthis.client \u003d client;\n+    }\n+\n+    // -- Commands ---------------------------------------------------\n+    /**\n+     * Asks the user to input the field where to place the next mark. This is\n+     * done using the standard input/output. \\\n+     *\n+     * @param board - the game board\n+     * @return the player\u0027s chosen field\n+     */\n+    public int determineMove(Board board) {\n+    \tthis.moveDone \u003d false;\n+    \tthis.client.clientInfo.networkGame.determineMove(this);\n+    \tLogger.log(Logger.DEBUG, \"Entering loop in awaitance of move.\");\n+    \t\n+    \tsynchronized(this){\n+    \t\ttry{\n+    \t\t\twhile(!this.moveDone){\n+    \t\t\t\tthis.wait();\n+    \t\t\t}\n+    \t\t}catch (InterruptedException e){\n+    \t\t\t\n+    \t\t}\n+    \t}\n+\t\t\n+    \tLogger.log(Logger.DEBUG, \"Gotten move! The move is \"+this.chosenMove);\n+    \treturn this.chosenMove;\n+    }\n+\n+    /**.\n+     * checks if move is valid\n+     * @param choice - move that the player wants to do\n+     * @param b - board\n+     * @return boolean - whether move is valid or not\n+     */\n+    public boolean isMoveValid(int choice, Board b) {\n+    \tint[] fields \u003d b.getValidFields(b, this.getMark());\n+    \tfor (int i : fields) {\n+    \t\tif (i \u003d\u003d choice) {\n+    \t\t\treturn true;\n+    \t\t}\n+    \t}\n+    \treturn false;\n+    }\n+\n+    /**.\n+     * sets chosenMove\n+     * @param j field that is chosen\n+     */\n+\tpublic void chooseMove(int j) {\n+\t\tthis.chosenMove \u003d j;\n+\t\tthis.moveDone \u003d true;\n+\t\tsynchronized(this){\n+\t\t\tthis.notifyAll();\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t/**\n+\t * returns the player\u0027s ClientHandler\n+\t */\n+\tpublic ClientHandler getClient(){\n+\t\treturn this.client;\n+\t}\n+}"
        },
        {
          "file_name": "Rolit/src/rolit/Player.java",
          "patch": "@@ -69,6 +69,7 @@ public Mark getMark() {\n     public int makeMove(Board board) {\n     \tint keuze \u003d determineMove(board);\n     \tboard.setField(keuze, getMark());\n+    \tLogger.log(Logger.DEBUG, \"Board has set the field\");\n     \tsetChanged();\n     \tnotifyObservers();\n     \treturn keuze;"
        },
        {
          "file_name": "Rolit/src/rolit/client/Client.java",
          "patch": "@@ -38,15 +38,15 @@ public Client(String serverName, int serverPort, String nickName){\n \t\n \tprivate void connectServer(){\n \t\t\n-\t\tLogger.log(1, \"Establishing connection with server...\");\n+\t\tLogger.log(Logger.INFO, \"Establishing connection with server...\");\n \t\ttry{\n \t\t\tsocket \u003d new Socket(this.serverIP, this.serverPort);\n-\t\t\tLogger.log(1, \"Connected to server \"+socket.getInetAddress()+\":\"+socket.getPort());\n+\t\t\tLogger.log(Logger.INFO, \"Connected to server \"+socket.getInetAddress()+\":\"+socket.getPort());\n \t\t\tstart();\n \t\t}catch(UnknownHostException e){\n-\t\t\tLogger.log(3, \"Unknown host: \"+e.getMessage());\n+\t\t\tLogger.log(Logger.ERROR, \"Unknown host: \"+e.getMessage());\n \t\t}catch(IOException e){\n-\t\t\tLogger.log(3, \"Unexpected error: \"+e.getMessage());\n+\t\t\tLogger.log(Logger.ERROR, \"Unexpected error: \"+e.getMessage());\n \t\t}\n \t}\n \t\n@@ -58,7 +58,7 @@ public void run() {\n \t\t\t\tstreamOut.flush();\n \t\t\t\thandle(message);\n \t\t\t}catch(IOException e){\n-\t\t\t\tLogger.log(3, \"Cannot send string: \"+e.getMessage());\n+\t\t\t\tLogger.log(Logger.ERROR, \"Cannot send string: \"+e.getMessage());\n \t\t\t\tstop();\n \t\t\t}\n \t\t}\n@@ -90,34 +90,34 @@ public void start() throws IOException{\n \tpublic void stop(){\n \t\ttry{\n \t\t\tif(streamIn !\u003d null){\n-\t\t\t\tLogger.log(1, \"Stopping client! [Closing InputStream]\");\n+\t\t\t\tLogger.log(Logger.INFO, \"Stopping client! [Closing InputStream]\");\n \t\t\t\tstreamIn.close();\n \t\t\t\tstreamIn \u003d null;\n \t\t\t}\n \t\t\tif(streamOut !\u003d null){\n-\t\t\t\tLogger.log(1, \"Stopping client! [Closing OutputStream]\");\n+\t\t\t\tLogger.log(Logger.INFO, \"Stopping client! [Closing OutputStream]\");\n \t\t\t\tstreamOut.close();\n \t\t\t\tstreamOut \u003d null;\n \t\t\t}\n \t\t\tif(server !\u003d null){\n-\t\t\t\tLogger.log(1, \"Stopping client! [Closing ServerHandler]\");\n+\t\t\t\tLogger.log(Logger.INFO, \"Stopping client! [Closing ServerHandler]\");\n \t\t\t\tserver.close();\n \t\t\t\tserver \u003d null;\n \t\t\t}\n \t\t\tif(socket !\u003d null){\n-\t\t\t\tLogger.log(1, \"Stopping client! [Closing Socket]\");\n+\t\t\t\tLogger.log(Logger.INFO, \"Stopping client! [Closing Socket]\");\n \t\t\t\tsocket.close();\n \t\t\t\tsocket \u003d null;\n \t\t\t}\n \t\t}catch(IOException e){\n-\t\t\tLogger.log(3, \"Failed closing the connection.\");\n+\t\t\tLogger.log(Logger.ERROR, \"Failed closing the connection.\");\n \t\t}\n \t\tif(thread !\u003d null){\n \t\t\ttry {\n \t\t\t\tthread.join();\n-\t\t\t\tLogger.log(1, \"Stopping client! [Thread joined main program]\");\n+\t\t\t\tLogger.log(Logger.INFO, \"Stopping client! [Thread joined main program]\");\n \t\t\t} catch (InterruptedException e) {\n-\t\t\t\tLogger.log(3, \"Could not stop client! [Thread failed to join]\");\n+\t\t\t\tLogger.log(Logger.ERROR, \"Could not stop client! [Thread failed to join]\");\n \t\t\t}\n \t\t\tthread \u003d null;\n \t\t}"
        },
        {
          "file_name": "Rolit/src/rolit/client/InputHandler.java",
          "patch": "@@ -27,20 +27,20 @@\n \tpublic InputHandler(Client client) {\n \t\tthis.parentClient \u003d client;\n \t\t\n-\t\tLogger.log(0, \"InputHandler breaking off into own thread\");\n+\t\tLogger.log(Logger.DEBUG, \"InputHandler breaking off into own thread\");\n \t\tthis.thread \u003d new Thread(this);\n \t\tthis.thread.start();\n \t}\n \t\n \tpublic void listen(){\n-\t\tLogger.log(0, \"Started listening to console input\");\n+\t\tLogger.log(Logger.DEBUG, \"Started listening to console input\");\n \t\twhile(!finished){\n \t\t\ttry {\n \t\t\t\tthis.lastMessage \u003d this.consoleInReader.readLine();\n \t\t\t\tthis.consoleOutWriter.write(this.lastMessage);\n \t\t\t\tthis.parentClient.handleInput(this.lastMessage);\n \t\t\t} catch (IOException e) {\n-\t\t\t\tLogger.log(3, \"Could not send messages to client [\"+e.getMessage()+\"]\");\n+\t\t\t\tLogger.log(Logger.ERROR, \"Could not send messages to client [\"+e.getMessage()+\"]\");\n \t\t\t}\n \t\t}\n \t}"
        },
        {
          "file_name": "Rolit/src/rolit/client/ServerHandler.java",
          "patch": "@@ -22,7 +22,7 @@ public void open(){\n \t\ttry{\n \t\t\tstreamIn \u003d new DataInputStream(socket.getInputStream());\n \t\t}catch(IOException e){\n-\t\t\tLogger.log(3, \"Could not get input stream: \"+e.getMessage());\n+\t\t\tLogger.log(Logger.ERROR, \"Could not get input stream: \"+e.getMessage());\n \t\t\tclient.stop();\n \t\t}\n \t}\n@@ -33,7 +33,7 @@ public void close(){\n \t\t\t\tstreamIn.close();\n \t\t\t}\n \t\t}catch(IOException e){\n-\t\t\tLogger.log(3, \"Could not close input stream: \"+e.getMessage());\n+\t\t\tLogger.log(Logger.ERROR, \"Could not close input stream: \"+e.getMessage());\n \t\t}\n \t}\n \t\n@@ -42,7 +42,7 @@ public void run(){\n \t\t\ttry{\n \t\t\t\tclient.handle(streamIn.readUTF());\n \t\t\t}catch(IOException e){\n-\t\t\t\tLogger.log(3, \"Listening error: \"+e.getMessage());\n+\t\t\t\tLogger.log(Logger.ERROR, \"Listening error: \"+e.getMessage());\n \t\t\t\tclient.stop();\n \t\t\t}\n \t\t}"
        },
        {
          "file_name": "Rolit/src/rolit/gui/RView.java",
          "patch": "@@ -131,7 +131,7 @@ private void startGame() {\n \tpublic static void main(String[] args){\n \t\tif (args.length \u003e 1 \u0026\u0026 args.length \u003c 5) {\n \t\t\tArrayList\u003cPlayer\u003e players \u003d new ArrayList\u003cPlayer\u003e();\n-\t        Mark[] marks \u003d {Mark.RED, Mark.YEL, Mark.BLU, Mark.GRN}; \n+\t        Mark[] marks \u003d {Mark.RED, Mark.YEL, Mark.BLU, Mark.GRN};\n \t        for(int i\u003d0; i\u003cargs.length; i++){\n \t        \tplayers.add(Rolit.createPlayer(args[i], marks[i]));\n \t        }"
        },
        {
          "file_name": "Rolit/src/rolit/network/ClientProtocol.java",
          "patch": "@@ -239,7 +239,7 @@ public void executeCommand(String msg) throws IllegalArgumentException, IOExcept\n \t* @param version Een beschrijving van wat de server kan\n \t*/\n \tpublic void handshake(int supports, String version) throws IOException {\n-\t\tLogger.log(5, \"hello \"+supports+\" \"+version);\n+\t\tLogger.log(Logger.COMMAND, \"hello \"+supports+\" \"+version);\n \t}\n \n \t/**\n@@ -253,7 +253,7 @@ public void handshake(int supports, String version) throws IOException {\n \t* @throws IOException\n \t*/\n \tpublic void handshake(int supports, String version, String nonce) throws IOException {\n-\t\tLogger.log(5, \"hello \"+supports+\" \"+version+\" \"+nonce);\n+\t\tLogger.log(Logger.COMMAND, \"hello \"+supports+\" \"+version+\" \"+nonce);\n \t}\n \n \t/**\n@@ -264,7 +264,7 @@ public void handshake(int supports, String version, String nonce) throws IOExcep\n \t* @throws IOException\n \t*/\n \tpublic void authOk() throws IOException {\n-\t\tLogger.log(5, \"authok\");\n+\t\tLogger.log(Logger.COMMAND, \"authok\");\n \t}\n \n \t/**\n@@ -275,7 +275,7 @@ public void authOk() throws IOException {\n \t* @param errorCode De error-code, op te zoeken in de errorCode-tabel.\n \t*/\n \tpublic void error(int errorCode) throws IOException {\n-\t\tLogger.log(5, \"error \"+errorCode);\n+\t\tLogger.log(Logger.COMMAND, \"error \"+errorCode);\n \t}\n \n \t/**\n@@ -291,7 +291,7 @@ public void error(int errorCode) throws IOException {\n \t* @param noPlayers Het aantal spelers in het spel.\n \t*/\n \tpublic void game(String creator, int status, int noPlayers) throws IOException {\n-\t\tLogger.log(5, \"game \"+creator+\" \"+status+\" \"+noPlayers);\n+\t\tLogger.log(Logger.COMMAND, \"game \"+creator+\" \"+status+\" \"+noPlayers);\n \t}\n \n \t/**\n@@ -304,7 +304,7 @@ public void game(String creator, int status, int noPlayers) throws IOException {\n \t* @param playerTwo De tweede speler\n \t*/\n \tpublic void start(String playerOne, String playerTwo) throws IOException {\n-\t\tLogger.log(5, \"start \"+playerOne+\" \"+playerTwo);\n+\t\tLogger.log(Logger.COMMAND, \"start \"+playerOne+\" \"+playerTwo);\n \t}\n \n \t/**\n@@ -315,7 +315,7 @@ public void start(String playerOne, String playerTwo) throws IOException {\n \t* @param playerThree De derde speler\n \t*/\n \tpublic void start(String playerOne, String playerTwo, String playerThree) throws IOException {\n-\t\tLogger.log(5, \"start \"+playerOne+\" \"+playerTwo+\" \"+playerThree);\n+\t\tLogger.log(Logger.COMMAND, \"start \"+playerOne+\" \"+playerTwo+\" \"+playerThree);\n \t}\n \n \t/**\n@@ -327,7 +327,7 @@ public void start(String playerOne, String playerTwo, String playerThree) throws\n \t* @param playerFour De vierde speler\n \t*/\n \tpublic void start(String playerOne, String playerTwo, String playerThree, String playerFour) throws IOException {\n-\t\tLogger.log(5, \"start \"+playerOne+\" \"+playerTwo+\" \"+playerThree+\" \"+playerFour);\n+\t\tLogger.log(Logger.COMMAND, \"start \"+playerOne+\" \"+playerTwo+\" \"+playerThree+\" \"+playerFour);\n \t}\n \n \t/**\n@@ -338,7 +338,7 @@ public void start(String playerOne, String playerTwo, String playerThree, String\n \t* @requires Dat de speler ook echt aan de beurt is.\n \t*/\n \tpublic void move() throws IOException {\n-\t\tLogger.log(5, \"move\");\n+\t\tLogger.log(Logger.COMMAND, \"move\");\n \t}\n \n \t/**\n@@ -352,7 +352,7 @@ public void move() throws IOException {\n \t* @param y Y-coördinaat, waarbij de bovenkant 0 is en de onderkant 7.\n \t*/\n \tpublic void moveDone(String name, int x, int y) throws IOException {\n-\t\tLogger.log(5, \"movedone \"+name+\" \"+x+\" \"+y);\n+\t\tLogger.log(Logger.COMMAND, \"movedone \"+name+\" \"+x+\" \"+y);\n \t}\n \t\n \t/**\n@@ -364,7 +364,7 @@ public void moveDone(String name, int x, int y) throws IOException {\n \t* @requires Dat één van de mensen is weggegaan\n \t*/\n \tpublic void gameOver() throws IOException {\n-\t\tLogger.log(5, \"gameover\");\n+\t\tLogger.log(Logger.COMMAND, \"gameover\");\n \t}\n \n \t/**\n@@ -383,7 +383,7 @@ public void gameOver(int score, String[] winners) throws IOException {\n \t\tfor(String winner : winners){\n \t\t\twinnerString \u003d winnerString+winner;\n \t\t}\n-\t\tLogger.log(5, \"gameover \"+score+\" \"+winnerString);\n+\t\tLogger.log(Logger.COMMAND, \"gameover \"+score+\" \"+winnerString);\n \t}\n \n \t/**\n@@ -394,7 +394,7 @@ public void gameOver(int score, String[] winners) throws IOException {\n \t* @param body Tekst van het chatbericht\n \t*/\n \tpublic void message(String name, String body) throws IOException {\n-\t\tLogger.log(5, \"message \"+name+\" \"+body);\n+\t\tLogger.log(Logger.COMMAND, \"message \"+name+\" \"+body);\n \t}\n \n \t/**\n@@ -406,7 +406,7 @@ public void message(String name, String body) throws IOException {\n \t* @param challenger De uitdager\n \t*/\n \tpublic void challenge(String challenger, String other1) throws IOException {\n-\t\tLogger.log(5, \"challenge \"+challenger+\" \"+other1);\n+\t\tLogger.log(Logger.COMMAND, \"challenge \"+challenger+\" \"+other1);\n \t}\n \n \t/**\n@@ -416,7 +416,7 @@ public void challenge(String challenger, String other1) throws IOException {\n \t* @param other1 Andere gebruiker\n \t*/\n \tpublic void challenge(String challenger, String other1, String other2) throws IOException {\n-\t\tLogger.log(5, \"challenge \"+challenger+\" \"+other1+\" \"+other2);\n+\t\tLogger.log(Logger.COMMAND, \"challenge \"+challenger+\" \"+other1+\" \"+other2);\n \t}\n \n \t/**\n@@ -427,7 +427,7 @@ public void challenge(String challenger, String other1, String other2) throws IO\n \t* @param other2 Andere gebruiker 2\n \t*/\n \tpublic void challenge(String challenger, String other1, String other2, String other3) throws IOException {\n-\t\tLogger.log(5, \"challenge \"+challenger+\" \"+other1+\" \"+other2+\" \"+other3);\n+\t\tLogger.log(Logger.COMMAND, \"challenge \"+challenger+\" \"+other1+\" \"+other2+\" \"+other3);\n \t}\n \n \t/**\n@@ -438,7 +438,7 @@ public void challenge(String challenger, String other1, String other2, String ot\n \t* @param accept Of deze persoon accepteert.\n \t*/\n \tpublic void challengeResponse(String name, boolean accept) throws IOException {\n-\t\tLogger.log(5, \"challengeresponse \"+name+\" \"+String.valueOf(accept));\n+\t\tLogger.log(Logger.COMMAND, \"challengeresponse \"+name+\" \"+String.valueOf(accept));\n \t}\n \n \t/**\n@@ -449,7 +449,7 @@ public void challengeResponse(String name, boolean accept) throws IOException {\n \t* @param flag Of hij kan worden uitgedaagd.\n \t*/\n \tpublic void canBeChallenged(String name, boolean flag) throws IOException {\n-\t\tLogger.log(5, \"canbechallenged \"+name+\" \"+String.valueOf(flag));\n+\t\tLogger.log(Logger.COMMAND, \"canbechallenged \"+name+\" \"+String.valueOf(flag));\n \t}\n \n \t/**\n@@ -463,7 +463,7 @@ public void highscore(String[] args) throws IOException {\n \t\tfor(String arg : args){\n \t\t\targString \u003d argString + arg;\n \t\t}\n-\t\tLogger.log(5, \"highscore \"+argString);\n+\t\tLogger.log(Logger.COMMAND, \"highscore \"+argString);\n \t}\n \n \t/**\n@@ -474,7 +474,7 @@ public void highscore(String[] args) throws IOException {\n \t* zonder chat.\n \t*/\n \tpublic void online(String name, boolean isOnline) throws IOException {\n-\t\tLogger.log(5, \"online \"+name+\" \"+String.valueOf(isOnline));\n+\t\tLogger.log(Logger.COMMAND, \"online \"+name+\" \"+String.valueOf(isOnline));\n \t}\n \t\n \tpublic ClientProtocol(){"
        },
        {
          "file_name": "Rolit/src/rolit/network/NetworkGame.java",
          "patch": "@@ -1,25 +1,99 @@\n package rolit.network;\n \n import java.util.ArrayList;\n+import java.util.HashMap;\n \n+import rolit.Board;\n import rolit.Game;\n+import rolit.Logger;\n+import rolit.Mark;\n+import rolit.NetworkPlayer;\n+import rolit.Player;\n import rolit.server.ClientHandler;\n \n public class NetworkGame {\n \tpublic ClientHandler ownerClient \u003d null;\n \tpublic ArrayList\u003cClientHandler\u003e participants \u003d new ArrayList\u003cClientHandler\u003e();\n+\tpublic ArrayList\u003cNetworkPlayer\u003e networkPlayers \u003d new ArrayList\u003cNetworkPlayer\u003e();\n+\tpublic ArrayList\u003cPlayer\u003e players \u003d new ArrayList\u003cPlayer\u003e();\n+\tpublic String[] playerNames;\n \tpublic Game game \u003d null;\n \tpublic boolean hasStarted \u003d false;\n+\tpublic NetworkPlayer currentPlayer \u003d null;\n \t\n \tpublic boolean isFull() {\n-\t\treturn (participants.size() \u003d\u003d Game.MAX_PLAYERS \u0026\u0026 participants.size() \u003c\u003d Game.MAX_PLAYERS);\n+\t\treturn (this.participants.size() \u003d\u003d Game.MAX_PLAYERS \u0026\u0026 this.participants.size() \u003c\u003d Game.MAX_PLAYERS);\n \t}\n \t\n \tpublic void addPlayer(String name){\n-\t\tparticipants.add(this.ownerClient.parentServer.getClient(name));\n+\t\tthis.participants.add(this.ownerClient.parentServer.getClient(name));\n \t}\n \n \tpublic void removePlayer(ClientHandler clientHandler) {\n-\t\tparticipants.remove(clientHandler);\n+\t\tthis.participants.remove(clientHandler);\n+\t}\n+\t\n+\t/*\n+\t * Game functionality\n+\t */\n+\t\n+\tpublic void setupGame(){\n+\t\tLogger.log(0, \"Setting up network game\");\n+\t\tMark[] marks \u003d Mark.getMarkList(this.participants.size());\n+\t\tthis.playerNames \u003d new String[this.participants.size()];\n+\t\tfor(int i \u003d 0; i \u003c this.participants.size(); i++){\n+\t\t\tClientHandler client \u003d this.participants.get(i);\n+\t\t\tNetworkPlayer player \u003d new NetworkPlayer(client, marks[i]);\n+\t\t\tplayers.add(player);\n+\t\t\tnetworkPlayers.add(player);\n+\t\t\tLogger.log(0, \"Added player \"+client.getNick());\n+\t\t\tthis.playerNames[i] \u003d client.getNick();\n+\t\t}\n+\t\tthis.game \u003d new Game(players);\n+\t}\n+\t\n+\tpublic void startGame(){\n+\t\tif(!this.hasStarted){\n+\t\t\tLogger.log(0, \"Starting game\");\n+\t\t\tthis.hasStarted \u003d true;\n+\t\t\tfor(Player player : players){\n+\t\t\t\tNetworkPlayer p \u003d (NetworkPlayer) player;\n+\t\t\t\tLogger.log(0, \"Sending start command to \"+p.getName());\n+\t\t\t\tp.getClient().sendCommand(ClientProtocol.START, this.playerNames);\n+\t\t\t}\n+\t\t\tthis.game.start();\n+\t\t}else{\n+\t\t\tLogger.log(0, \"Game has already started, not starting again.\");\n+\t\t}\n+\t}\n+\t\n+\tpublic void determineMove(NetworkPlayer p){\n+\t\tLogger.log(0, \"Sending move request to player \"+p.getName());\n+\t\tthis.currentPlayer \u003d p;\n+\t\tp.getClient().sendCommand(ClientProtocol.MOVE, new String[0]);\n+\t\tString validMoves \u003d this.game.getBoard().getValidMovesString(p.getMark());\n+\t\tLogger.log(Logger.GAMEINFO, \"Game\u0027s valid moves are: \"+validMoves);\n+\t}\n+\t\n+\tpublic void chooseMove(String name, int x, int y){\n+\t\tLogger.log(0, \"Relaying chosen move \"+x+\", \"+y+\" for player \"+name+\" to game.\");\n+\t\tString currentPlayerName \u003d this.currentPlayer.getName();\n+\t\tint move \u003d this.game.getBoard().index(x, y);\n+\t\tif(currentPlayerName.equals(name) \u0026\u0026 this.currentPlayer.isMoveValid(move, this.game.getBoard())){\n+\t\t\tbroadcastMove(this.currentPlayer, x, y);\n+\t\t\tLogger.log(Logger.DEBUG, \"Move broadcast, sending it to game\");\n+\t\t\tthis.currentPlayer.chooseMove(move);\n+\t\t\tLogger.log(Logger.DEBUG, \"Move sent to game, nullifying player.\");\n+\t\t\tthis.currentPlayer \u003d null;\n+\t\t\tLogger.log(Logger.DEBUG, \"Player nullified. Ready for next player\");\n+\t\t}else{\n+\t\t\tthis.currentPlayer.getClient().protocol.sendError(ClientProtocol.ERROR_INVALID_MOVE);\n+\t\t}\n+\t}\n+\t\n+\tpublic void broadcastMove(Player p, int x, int y){\n+\t\tLogger.log(0, \"Broadcasting move \"+x+\", \"+y+\" for player \"+p.getName()+\" to rest of players.\");\n+\t\tNetworkPlayer np \u003d (NetworkPlayer) p;\n+\t\tnp.getClient().sendCommand(ClientProtocol.MOVE_DONE, new String[]{np.getName(), String.valueOf(x), String.valueOf(y)});\n \t}\n }"
        },
        {
          "file_name": "Rolit/src/rolit/network/Security.java",
          "patch": "@@ -39,11 +39,11 @@ public static PublicKey getPublicKey(String user) {\n \t\t\tKeyFactory keyFactory \u003d KeyFactory.getInstance(\"RSA\");\n \t\t\treturn keyFactory.generatePublic(keySpec);\n \t\t} catch (InvalidKeySpecException e) {\n-\t\t\tLogger.log(3, \"Could not convert received data into key specification [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Could not convert received data into key specification [\"+e.getMessage()+\"]\");\n \t\t} catch (NoSuchAlgorithmException e) {\n-\t\t\tLogger.log(3, \"Could not convert received data into Public Key [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Could not convert received data into Public Key [\"+e.getMessage()+\"]\");\n \t\t} catch (IOException e) {\n-\t\t\tLogger.log(3, \"Error communicating with Security Server [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Error communicating with Security Server [\"+e.getMessage()+\"]\");\n \t\t}\n \t\treturn null;\n \t}\n@@ -56,11 +56,11 @@ public static PrivateKey getPrivateKey(String user, String pass){\n \t\t\tkeyFactory \u003d KeyFactory.getInstance(\"RSA\");\n \t\t\treturn keyFactory.generatePrivate(keySpec);\n \t\t} catch (NoSuchAlgorithmException e) {\n-\t\t\tLogger.log(3, \"Could not convert data into Private Key [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Could not convert data into Private Key [\"+e.getMessage()+\"]\");\n \t\t} catch (InvalidKeySpecException e) {\n-\t\t\tLogger.log(3, \"Could not convert data into key specification [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Could not convert data into key specification [\"+e.getMessage()+\"]\");\n \t\t} catch (IOException e) {\n-\t\t\tLogger.log(3, \"Error communicating with Security Server [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Error communicating with Security Server [\"+e.getMessage()+\"]\");\n \t\t}\n \t\treturn null;\n \t\t\n@@ -96,11 +96,11 @@ public static boolean verify(byte[] cypherText, byte[] original, PublicKey publi\n \t\t\tsignature.update(original);\n \t\t\treturn signature.verify(cypherText);\n \t\t} catch (NoSuchAlgorithmException e) {\n-\t\t\tLogger.log(3, \"Could not verify key [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Could not verify key [\"+e.getMessage()+\"]\");\n \t\t} catch (InvalidKeyException e) {\n-\t\t\tLogger.log(3, \"Invalid key [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Invalid key [\"+e.getMessage()+\"]\");\n \t\t} catch (SignatureException e) {\n-\t\t\tLogger.log(3, \"Signature exception [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Signature exception [\"+e.getMessage()+\"]\");\n \t\t}\n \t\treturn false;\n \t}\n@@ -113,11 +113,11 @@ public static boolean verify(byte[] cypherText, byte[] original, PublicKey publi\n \t\t\tsign.update(original);\n \t\t\treturn sign.sign();\n \t\t} catch (NoSuchAlgorithmException e) {\n-\t\t\tLogger.log(3, \"Could not verify key [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Could not verify key [\"+e.getMessage()+\"]\");\n \t\t} catch (InvalidKeyException e) {\n-\t\t\tLogger.log(3, \"Invalid key [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Invalid key [\"+e.getMessage()+\"]\");\n \t\t} catch (SignatureException e) {\n-\t\t\tLogger.log(3, \"Signature exception [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Signature exception [\"+e.getMessage()+\"]\");\n \t\t}\n \t\treturn null;\n \t\t"
        },
        {
          "file_name": "Rolit/src/rolit/network/ServerProtocol.java",
          "patch": "@@ -108,8 +108,8 @@\n \t* @param version Een beschrijving van wat de client kan.\n \t*/\n \tpublic void hello(String clientName, int supports, String version) {\n-\t\tLogger.log(5, ServerProtocol.HANDSHAKE+\" \"+clientName+\" \"+supports+\" \"+version);\n-\t\tLogger.log(0, \"Client exists? \"+this.parentHandler.parentServer.hasClient(clientName));\n+\t\tLogger.log(Logger.COMMAND, ServerProtocol.HANDSHAKE+\" \"+clientName+\" \"+supports+\" \"+version);\n+\t\tLogger.log(Logger.DEBUG, \"Client exists? \"+this.parentHandler.parentServer.hasClient(clientName));\n \t\tif(!this.parentHandler.clientInfo.hasAuthed \u0026\u0026 !this.parentHandler.clientInfo.hasHandshaked \u0026\u0026 !this.parentHandler.parentServer.hasClient(clientName)){\n \t\t\tthis.setNickname(clientName);\n \t\t\tthis.setSupports(supports);\n@@ -122,13 +122,14 @@ public void hello(String clientName, int supports, String version) {\n \t\t\t\tthis.setNeedsAuth(true);\n \t\t\t\tthis.parentHandler.sendCommand(ClientProtocol.HANDSHAKE, new String[]{String.valueOf(this.getServerSupports()), this.getServerVersion(), this.getNonce()});\n \t\t\t\tthis.setSentNonce(true);\n-\t\t\t\tLogger.log(0, \"The nonce signed with your private key, converted to base64 is:\");\n-\t\t\t\tLogger.log(0, Security.base64Encode(Security.sign(this.getNonce().getBytes(), this.parentHandler.clientInfo.privateKey)));\n+\t\t\t\tLogger.log(Logger.DEBUG, \"The nonce signed with your private key, converted to base64 is:\");\n+\t\t\t\tLogger.log(Logger.DEBUG, Security.base64Encode(Security.sign(this.getNonce().getBytes(), this.parentHandler.clientInfo.privateKey)));\n \t\t\t}else{\n \t\t\t\t// Needs no authing\n \t\t\t\tthis.setNeedsAuth(false);\n \t\t\t\tthis.setAuthDone(true);\n \t\t\t\tthis.parentHandler.sendCommand(ClientProtocol.HANDSHAKE, new String[]{String.valueOf(this.getServerSupports()), this.getServerVersion()});\n+\t\t\t\tthis.sendGames();\n \t\t\t}\n \t\t\tthis.setHandshakeDone(true);\n \t\t}else if(this.isAuthDone()){\n@@ -145,8 +146,8 @@ public void hello(String clientName, int supports, String version) {\n \t * @param errorcode Errorcode (-1 voor generic error)\n \t */\n \tpublic void error(int errorCode){\n-\t\tLogger.log(5, ServerProtocol.ERROR+\" \"+errorCode);\n-\t\tLogger.log(3, Errors.getError(1, errorCode));\n+\t\tLogger.log(Logger.COMMAND, ServerProtocol.ERROR+\" \"+errorCode);\n+\t\tLogger.log(Logger.ERROR, Errors.getError(1, errorCode));\n \t\tthis.parentHandler.parentServer.handleError(1, errorCode);\n \t}\n \n@@ -159,19 +160,20 @@ public void error(int errorCode){\n \t* @param signature De gesignde nonce\n \t*/\n \tpublic void auth(String signature) {\n-\t\tLogger.log(5, ServerProtocol.AUTH+\" \"+signature);\n+\t\tLogger.log(Logger.COMMAND, ServerProtocol.AUTH+\" \"+signature);\n \t\tif(this.isHandshakeDone() \u0026\u0026 this.hasSentNonce() \u0026\u0026 this.needsAuth() \u0026\u0026 !this.isAuthDone()){\n-\t\t\tLogger.log(0, \"Validating signature\");\n+\t\t\tLogger.log(Logger.DEBUG, \"Validating signature\");\n \t\t\tif(this.checkAuth(signature)){\n \t\t\t\tthis.setAuthDone(true);\n \t\t\t\tthis.parentHandler.sendCommand(ClientProtocol.AUTH_OK, new String[0]);\n+\t\t\t\tthis.sendGames();\n \t\t\t}else{\n \t\t\t\tthis.sendError(Errors.ERROR_INVALID_LOGIN);\n \t\t\t\ttry {\n-\t\t\t\t\tLogger.log(2, \"Invalid signed nonce. Closing connection.\");\n+\t\t\t\t\tLogger.log(Logger.WARNING, \"Invalid signed nonce. Closing connection.\");\n \t\t\t\t\tthis.parentHandler.close();\n \t\t\t\t} catch (IOException e) {\n-\t\t\t\t\tLogger.log(3, \"Could not close connection. [\"+e.getMessage()+\"]\");\n+\t\t\t\t\tLogger.log(Logger.ERROR, \"Could not close connection. [\"+e.getMessage()+\"]\");\n \t\t\t\t}\n \t\t\t}\n \t\t}else if(!this.parentHandler.clientInfo.hasHandshaked){\n@@ -189,7 +191,7 @@ public void auth(String signature) {\n \t* @requires Dat de client nog geen spel is begonnen\n \t*/\n \tpublic void createGame() {\n-\t\tLogger.log(5, ServerProtocol.CREATE_GAME);\n+\t\tLogger.log(Logger.COMMAND, ServerProtocol.CREATE_GAME);\n \t\tif(this.isHandshakeDone() \u0026\u0026 !this.hasGame()){\n \t\t\tthis.setNetworkGame(new NetworkGame(), true);\n \t\t\tthis.setOwnsGame(true);\n@@ -212,7 +214,7 @@ public void createGame() {\n \t* @param creator De maker van het spel\n \t*/\n \tpublic void joinGame(String creator) {\n-\t\tLogger.log(5, ServerProtocol.JOIN_GAME+\" \"+creator);\n+\t\tLogger.log(Logger.COMMAND, ServerProtocol.JOIN_GAME+\" \"+creator);\n \t\ttry{\n \t\t\tif(this.isHandshakeDone() \u0026\u0026 !this.hasGame() \u0026\u0026 this.parentHandler.parentServer.getClient(creator).clientInfo.hasGame \u0026\u0026 !this.getGameForClient(creator).isFull()){\n \t\t\t\tthis.getGameForClient(creator).addPlayer(this.getNick());\n@@ -243,9 +245,10 @@ public void joinGame(String creator) {\n \t* Start het spel waarvan de gebruiker de creator is.\n \t*/\n \tpublic void startGame() {\n-\t\tLogger.log(5, ServerProtocol.START_GAME);\n-\t\tif(this.isHandshakeDone() \u0026\u0026 this.hasGame() \u0026\u0026 this.getNetworkGame().ownerClient.getNick().toLowerCase().equals(this.getNick().toLowerCase()) \u0026\u0026 this.getNetworkGame().hasStarted \u003d\u003d false){\n-\t\t\t\n+\t\tLogger.log(Logger.COMMAND, ServerProtocol.START_GAME);\n+\t\tif(this.isHandshakeDone() \u0026\u0026 this.hasGame() \u0026\u0026 this.getNetworkGame().ownerClient.getNick().toLowerCase().equals(this.getNick().toLowerCase()) \u0026\u0026 this.getNetworkGame().hasStarted \u003d\u003d false \u0026\u0026 this.getNetworkGame().participants.size() \u003e\u003d 2 \u0026\u0026 this.getNetworkGame().participants.size() \u003c\u003d 4){\n+\t\t\tthis.getNetworkGame().setupGame();\n+\t\t\tthis.getNetworkGame().startGame();\n \t\t}else if(!this.isHandshakeDone()){\n \t\t\tthis.sendError(ClientProtocol.ERROR_HANDSHAKE_MISSING);\n \t\t}else if(!this.hasGame()){\n@@ -254,6 +257,8 @@ public void startGame() {\n \t\t\tthis.sendGenericError();\n \t\t}else if(this.getNetworkGame().hasStarted \u003d\u003d true){\n \t\t\tthis.sendError(ClientProtocol.ERROR_GAME_FULL);\n+\t\t}else if(this.getNetworkGame().participants.size() \u003c 2){\n+\t\t\tthis.sendError(ClientProtocol.ERROR_TOO_FEW_PLAYERS);\n \t\t}else{\n \t\t\tthis.sendGenericError();\n \t\t}\n@@ -268,25 +273,22 @@ public void startGame() {\n \t* @param y Y-coördinaat\n \t*/\n \tpublic void move(int x, int y) {\n-\t\tLogger.log(5, ServerProtocol.MOVE+\" \"+x+\" \"+y);\n-\t\tif(this.isHandshakeDone() \u0026\u0026 this.hasGame() \u0026\u0026 this.getNetworkGame().game.getCurrentPlayer() \u003d\u003d this.parentHandler.clientInfo.mark){\n-\t\t\tGUIPlayer p \u003d (GUIPlayer) this.getNetworkGame().game.getPlayer();\n-\t\t\tBoard b \u003d this.getNetworkGame().game.getBoard();\n-\t\t\tint index \u003d b.index(x, y);\n-\t\t\tif(p.isMoveValid(index, b)){\n-\t\t\t\tp.chooseMove(index);\n-\t\t\t\tthis.parentHandler.sendCommand(ClientProtocol.MOVE_DONE, new String[]{String.valueOf(x), String.valueOf(y)});\n-\t\t\t}else{\n+\t\tLogger.log(Logger.COMMAND, ServerProtocol.MOVE+\" \"+x+\" \"+y);\n+\t\ttry{\n+\t\t\tif(this.isHandshakeDone() \u0026\u0026 this.hasGame() \u0026\u0026 this.getNetworkGame().currentPlayer.getName() \u003d\u003d this.getNick()){\n+\t\t\t\tthis.getNetworkGame().chooseMove(this.getNick(), x, y);\n+\t\t\t}else if(!this.isHandshakeDone()){\n+\t\t\t\tthis.sendError(ClientProtocol.ERROR_HANDSHAKE_MISSING);\n+\t\t\t}else if(!this.hasGame()){\n+\t\t\t\tthis.sendError(ClientProtocol.ERROR_NO_SUCH_GAME);\n+\t\t\t}else if(this.getNetworkGame().currentPlayer.getName() !\u003d this.getNick()){\n \t\t\t\tthis.sendError(ClientProtocol.ERROR_INVALID_MOVE);\n+\t\t\t}else{\n+\t\t\t\tthis.sendGenericError();\n \t\t\t}\n-\t\t}else if(!this.isHandshakeDone()){\n-\t\t\tthis.sendError(ClientProtocol.ERROR_HANDSHAKE_MISSING);\n-\t\t}else if(!this.hasGame()){\n-\t\t\tthis.sendError(ClientProtocol.ERROR_NO_SUCH_GAME);\n-\t\t}else if(this.getNetworkGame().game.getCurrentPlayer() !\u003d this.parentHandler.clientInfo.mark){\n+\t\t}catch(NullPointerException npe){\n+\t\t\tLogger.log(Logger.ERROR, \"Client is not the current player.\");\n \t\t\tthis.sendError(ClientProtocol.ERROR_INVALID_MOVE);\n-\t\t}else{\n-\t\t\tthis.sendGenericError();\n \t\t}\n \t}\n \n@@ -297,7 +299,7 @@ public void move(int x, int y) {\n \t* @param body Het bericht\n \t*/\n \tpublic void message(String body) {\n-\t\tLogger.log(5, ServerProtocol.MESSAGE+\" \"+body);\n+\t\tLogger.log(Logger.COMMAND, ServerProtocol.MESSAGE+\" \"+body);\n \t\tint s \u003d this.parentHandler.parentServer.serverInfo.supports;\n \t\tif(this.isHandshakeDone() \u0026\u0026 (s \u003d\u003d ServerProtocol.SERVER_SUPPORTS_CHAT || s \u003d\u003d ServerProtocol.SERVER_SUPPORTS_CHATCHALLENGE)){\n \t\t\t// Prepend nickname to message as our protocol\n@@ -334,7 +336,7 @@ public void challenge(String[] others){\n \t\t\tlog \u003d log+\" \"+others[i];\n \t\t}\n \t\t\n-\t\tLogger.log(5, log);\n+\t\tLogger.log(Logger.COMMAND, log);\n \t\tint s \u003d this.parentHandler.parentServer.serverInfo.supports;\n \t\tif(this.isHandshakeDone() \u0026\u0026 !this.hasGame() \u0026\u0026 this.isChallenger() \u0026\u0026 this.isChallenged() \u0026\u0026 this.canBeChallenged(os) \u0026\u0026 (s \u003d\u003d ServerProtocol.SERVER_SUPPORTS_CHALLENGE || s \u003d\u003d ServerProtocol.SERVER_SUPPORTS_CHATCHALLENGE)){\n \t\t\tfor(ClientHandler client : os){\n@@ -364,7 +366,7 @@ public void challenge(String[] others){\n \t* @param accept Of de client accepteert\n \t*/\n \tpublic void challengeResponse(boolean accept) {\n-\t\tLogger.log(5, ServerProtocol.CHALLENGE_RESPONSE+\" \"+String.valueOf(accept));\n+\t\tLogger.log(Logger.COMMAND, ServerProtocol.CHALLENGE_RESPONSE+\" \"+String.valueOf(accept));\n \t\tif(this.isHandshakeDone() \u0026\u0026 this.isChallenged()){\n \t\t\tString challenger \u003d this.getChallenger();\n \t\t\tString[] args \u003d new String[]{challenger, String.valueOf(accept)};\n@@ -388,7 +390,7 @@ public void challengeResponse(boolean accept) {\n \t* @param arg Een argument (bijv. 2014-01-01)\n \t*/\n \tpublic void highscore(String type, String arg) {\n-\t\tLogger.log(5, ServerProtocol.HIGHSCORE+\" \"+type+\" \"+arg);\n+\t\tLogger.log(Logger.COMMAND, ServerProtocol.HIGHSCORE+\" \"+type+\" \"+arg);\n \t\tif(this.isHandshakeDone()){\n \t\t\t// TODO: Implement leaderboard.\n \t\t\t//this.parentHandler.parentServer.getLeaderboard().getScore(type, arg);\t\n@@ -404,7 +406,7 @@ public void highscore(String type, String arg) {\n \t* @requires Dat de handshake is gedaan\n \t*/\n \tpublic void customListGames(){\n-\t\tLogger.log(6, ServerProtocol.CUSTOM_LIST_GAMES);\n+\t\tLogger.log(Logger.CUSTOMCMD, ServerProtocol.CUSTOM_LIST_GAMES);\n \t\tif(this.isHandshakeDone()){\n \t\t\tArrayList\u003cNetworkGame\u003e games \u003d this.parentHandler.parentServer.getGames();\n \t\t\t\n@@ -431,15 +433,15 @@ public void customListGames(){\n \n \tpublic boolean isValidCommand(String msg) {\n \t\t\n-\t\tLogger.log(0, \"Checking command \"+msg+\" for validity\");\n+\t\tLogger.log(Logger.DEBUG, \"Checking command \"+msg+\" for validity\");\n \t\t\n \t\tString[] splitCommand \u003d msg.split(\" \");\n \t\tString command \u003d splitCommand[0].toLowerCase();\n \t\tint numArgs \u003d splitCommand.length-1;\n \t\t\n \t\tif(serverCommands.containsKey(command)){\n \t\t\tfor(int possibleArgs : serverCommands.get(command)){\n-\t\t\t\tLogger.log(0, \"Command has \"+numArgs+\" arguments and can have \"+possibleArgs);\n+\t\t\t\tLogger.log(Logger.DEBUG, \"Command has \"+numArgs+\" arguments and can have \"+possibleArgs);\n \t\t\t\tif(numArgs \u003d\u003d possibleArgs){\n \t\t\t\t\treturn true;\n \t\t\t\t}\n@@ -448,7 +450,7 @@ public boolean isValidCommand(String msg) {\n \t\t\t\t}\n \t\t\t}\n \t\t}\n-\t\tLogger.log(0, \"Invalid command.\");\n+\t\tLogger.log(Logger.DEBUG, \"Invalid command.\");\n \t\treturn false;\n \t}\n \t\n@@ -654,12 +656,12 @@ private String generateNonce() {\n \t\n \t// Command helper functions\n \tpublic void sendGenericError(){\n-\t\tLogger.log(3, \"Sending generic error to client.\");\n+\t\tLogger.log(Logger.ERROR, \"Sending generic error to client.\");\n \t\tthis.parentHandler.sendCommand(ClientProtocol.ERROR, new String[]{String.valueOf(ClientProtocol.ERROR_GENERIC)});\n \t}\n \t\n \tpublic void sendError(int errorcode){\n-\t\tLogger.log(3, \"Sending error to client. [\"+Errors.getError(1, errorcode)+\"]\");\n+\t\tLogger.log(Logger.ERROR, \"Sending error to client. [\"+Errors.getError(1, errorcode)+\"]\");\n \t\tthis.parentHandler.sendCommand(ClientProtocol.ERROR, new String[]{String.valueOf(errorcode)});\n \t}\n \t\n@@ -686,6 +688,21 @@ public void broadcastGame(NetworkGame game){\n \t\tthis.parentHandler.sendCommand(ClientProtocol.GAME, new String[]{creator, status, numPlayers});\n \t}\n \t\n+\t/**\n+\t * Sends a list of all current games to this client.\n+\t */\n+\tpublic void sendGames(){\n+\t\tArrayList\u003cNetworkGame\u003e games \u003d this.parentHandler.parentServer.getGames();\n+\n+\t\tfor(NetworkGame game : games){\n+\t\t\tString[] cmdString \u003d new String[3];\n+\t\t\tcmdString[0] \u003d game.ownerClient.getNick();\n+\t\t\tcmdString[1] \u003d String.valueOf(game.hasStarted);\n+\t\t\tcmdString[2] \u003d String.valueOf(game.participants.size());\n+\t\t\tthis.parentHandler.sendCommand(ClientProtocol.GAME, cmdString);\t\n+\t\t}\n+\t}\n+\t\n \tpublic ServerProtocol(ClientHandler handler){\n \t\t// Add commands to serverCommands Map\n \t\t// to help with command detection and"
        },
        {
          "file_name": "Rolit/src/rolit/server/ClientHandler.java",
          "patch": "@@ -40,7 +40,7 @@ public ClientHandler(Server server, Socket client){\n \t\tthis.parentServer \u003d server;\n \t\tthis.socket \u003d client;\n \t\t\n-\t\tLogger.log(0, \"ClientHandler breaking off into own thread\");\n+\t\tLogger.log(Logger.DEBUG, \"ClientHandler breaking off into own thread\");\n \t\tthis.thread \u003d new Thread(this);\n \t\tthis.thread.start();\n \t}\n@@ -54,7 +54,7 @@ public String getNick(){\n \t}\n \t\n \tpublic void listen(){\n-\t\tLogger.log(0, \"Started listening to client \"+this.clientInfo.nickName);\n+\t\tLogger.log(Logger.DEBUG, \"Started listening to client \"+this.clientInfo.nickName);\n \t\twhile(!finished){\n \t\t\ttry {\n                 this.lastMessage \u003d this.inReader.readLine();\n@@ -64,40 +64,40 @@ public void listen(){\n                 \n \t        } catch (IOException e) {\n \t        \tif(!this.finished){\n-\t                Logger.log(3, \"Could not receive messages from client [\"+e.getMessage()+\"]\");\n+\t                Logger.log(Logger.ERROR, \"Could not receive messages from client [\"+e.getMessage()+\"]\");\n \t                try {\n \t                \t\tthis.close();\n \t\t\t\t\t} catch (IOException e1) {\n-\t\t\t\t\t\tLogger.log(3, \"Could not close ClientHandler [\"+e.getMessage()+\"]\");\n+\t\t\t\t\t\tLogger.log(Logger.ERROR, \"Could not close ClientHandler [\"+e.getMessage()+\"]\");\n \t\t\t\t\t}\n \t        \t}\n \t        } catch (NullPointerException npe){\n \t        \tfor(StackTraceElement e : npe.getStackTrace()){\n-\t        \t\tLogger.log(0, e.toString());\n+\t        \t\tLogger.log(Logger.DEBUG, e.toString());\n \t        \t}\n-\t        \tLogger.log(3, \"Unexpected client disconnect! [\"+npe.getMessage()+\"]\");\n+\t        \tLogger.log(Logger.ERROR, \"Unexpected client disconnect! [\"+npe.getMessage()+\"]\");\n \t        \ttry {\n \t        \t\tif(!this.finished){\n \t        \t\t\tthis.close();\n \t        \t\t}\n \t        \t} catch (IOException e) {\n-\t        \t\tLogger.log(3, \"Could not close ClientHandler [\"+e.getMessage()+\"]\");\n+\t        \t\tLogger.log(Logger.ERROR, \"Could not close ClientHandler [\"+e.getMessage()+\"]\");\n \t        \t}\n \t        }\n \t\t}\n \t}\n \t\n \tpublic void run(){\n-\t\tLogger.log(0, \"Trying to open channel to client\");\n-        Logger.log(1, \"Client has been assigned the name \"+this.clientInfo.nickName);\n+\t\tLogger.log(Logger.DEBUG, \"Trying to open channel to client\");\n+        Logger.log(Logger.INFO, \"Client has been assigned the name \"+this.clientInfo.nickName);\n         try {\n                 this.inStream \u003d this.socket.getInputStream();\n                 this.inReader \u003d new BufferedReader(new InputStreamReader(this.inStream));\n                 this.outStream \u003d this.socket.getOutputStream();\n                 this.outWriter \u003d new BufferedWriter(new OutputStreamWriter(this.outStream));\n-                Logger.log(1, \"Opened channel\");\n+                Logger.log(Logger.INFO, \"Opened channel\");\n         } catch (IOException e) {\n-                Logger.log(3, \"Unable to open channel [\"+e.getMessage()+\"]\");\n+                Logger.log(Logger.ERROR, \"Unable to open channel [\"+e.getMessage()+\"]\");\n         }\n         this.listen();\n \t}\n@@ -107,13 +107,13 @@ public void send(String msg) {\n                 this.outWriter.write(msg+\"\\n\");\n                 this.outWriter.flush();\n         } catch (IOException e) {\n-                Logger.log(3, \"Could not send message \"+msg+\" [\"+e.getMessage()+\"]\");\n+                Logger.log(Logger.ERROR, \"Could not send message \"+msg+\" [\"+e.getMessage()+\"]\");\n                 try {\n                 \tif(!this.finished){\n                 \t\tthis.close();\n                 \t}\n \t\t\t\t} catch (IOException e1) {\n-\t\t\t\t\tLogger.log(3, \"Could not close connection with client \"+this.getNick()+\" [\"+e1.getMessage()+\"]\");\n+\t\t\t\t\tLogger.log(Logger.ERROR, \"Could not close connection with client \"+this.getNick()+\" [\"+e1.getMessage()+\"]\");\n \t\t\t\t}\n         }\n \t}\n@@ -133,11 +133,11 @@ public void sendCommand(String string, String[] args){\n \t\t\tcase ClientProtocol.GAME:\n \t\t\tcase ClientProtocol.MESSAGE:\n \t\t\tcase ClientProtocol.ONLINE:\n-\t\t\t\tLogger.log(1, \"Server Broadcasted: \"+string+body);\n+\t\t\t\tLogger.log(Logger.INFO, \"Server Broadcasted: \"+string+body);\n \t\t\t\tbroadcast(string+body);\n \t\t\t\tbreak;\n \t\t\tdefault:\n-\t\t\t\tLogger.log(1, \"Server sent to \"+this.getNick()+\": \"+string+body);\n+\t\t\t\tLogger.log(Logger.INFO, \"Server sent to \"+this.getNick()+\": \"+string+body);\n \t\t\t\tsend(string+body);\n \t\t}\n \t}"
        },
        {
          "file_name": "Rolit/src/rolit/server/ClientInformation.java",
          "patch": "@@ -31,7 +31,6 @@\n \tpublic boolean hasGame \u003d false;\n \tpublic boolean ownsGame \u003d false;\n \tpublic NetworkGame networkGame \u003d null;\n-\tpublic Mark mark \u003d null;\n \t\n \t// Challenge\n \tpublic boolean isChallenged \u003d false;"
        },
        {
          "file_name": "Rolit/src/rolit/server/InputHandler.java",
          "patch": "@@ -27,20 +27,20 @@\n \tpublic InputHandler(Server server) {\n \t\tthis.parentServer \u003d server;\n \t\t\n-\t\tLogger.log(0, \"InputHandler breaking off into own thread\");\n+\t\tLogger.log(Logger.DEBUG, \"InputHandler breaking off into own thread\");\n \t\tthis.thread \u003d new Thread(this);\n \t\tthis.thread.start();\n \t}\n \t\n \tpublic void listen(){\n-\t\tLogger.log(0, \"Started listening to console input\");\n+\t\tLogger.log(Logger.DEBUG, \"Started listening to console input\");\n \t\twhile(!finished){\n \t\t\ttry {\n \t\t\t\tthis.lastMessage \u003d this.consoleInReader.readLine();\n-\t\t\t\tLogger.log(0, \"Received console input: \"+this.lastMessage);\n+\t\t\t\tLogger.log(Logger.DEBUG, \"Received console input: \"+this.lastMessage);\n \t\t\t\tthis.parentServer.handleInput(this.lastMessage);\n \t\t\t} catch (IOException e) {\n-\t\t\t\tLogger.log(3, \"Could not read from console. [\"+e.getMessage()+\"]\");\n+\t\t\t\tLogger.log(Logger.ERROR, \"Could not read from console. [\"+e.getMessage()+\"]\");\n \t\t\t}\n \t\t}\n \t}"
        },
        {
          "file_name": "Rolit/src/rolit/server/Server.java",
          "patch": "@@ -30,7 +30,7 @@ public InetAddress getLocalIp(){\n         \ttry{\n         \t\taddr \u003d InetAddress.getLocalHost();\n         \t}catch(Exception e){\n-        \t\tLogger.log(3, e.getMessage());\n+        \t\tLogger.log(Logger.ERROR, e.getMessage());\n         \t}\n         \treturn addr;        \n         }\n@@ -41,24 +41,24 @@ public int getPort(){\n \t}\n \t\n \tpublic void run() {\n-\t\tLogger.log(1, \"Starting server on port \"+this.serverInfo.port);\n-\t\tLogger.log(0, \"Local IP: \"+this.serverInfo.localIp.getHostAddress()+\" - Port: \"+String.valueOf(this.serverInfo.port));\n+\t\tLogger.log(Logger.INFO, \"Starting server on port \"+this.serverInfo.port);\n+\t\tLogger.log(Logger.DEBUG, \"Local IP: \"+this.serverInfo.localIp.getHostAddress()+\" - Port: \"+String.valueOf(this.serverInfo.port));\n \t\t\n \t\ttry {\n \t\t\tthis.server \u003d new ServerSocket(this.serverInfo.port);\n-\t\t\tLogger.log(0, \"ServerSocket created on port \"+this.serverInfo.port);\n+\t\t\tLogger.log(Logger.DEBUG, \"ServerSocket created on port \"+this.serverInfo.port);\n \t\t\t\n \t\t\tinputHandler \u003d new InputHandler(this);\n \t\t\t\n \t\t\twhile(!finished){\n \t\t\t\tSocket client \u003d this.server.accept();\n-\t\t\t\tLogger.log(1, \"New client connected from \"+client.getInetAddress().getHostAddress()+\":\"+String.valueOf(client.getPort()));\n+\t\t\t\tLogger.log(Logger.INFO, \"New client connected from \"+client.getInetAddress().getHostAddress()+\":\"+String.valueOf(client.getPort()));\n \t\t\t\tClientHandler clientHandler \u003d new ClientHandler(this, client);\n \t\t\t\tconnectedClients.add(clientHandler);\n \t\t\t}\n \t\t\tSystem.exit(0);\n \t\t} catch (IOException e) {\n-\t\t\tLogger.log(3, \"Failed to start server [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Failed to start server [\"+e.getMessage()+\"]\");\n \t\t}\n \t}\n \t\n@@ -67,7 +67,7 @@ public Server(int port){\n \t\tthis.serverInfo.port \u003d port;\n \t\tthis.serverInfo.localIp \u003d getLocalIp();\n \n-\t\tLogger.log(0, \"Server breaking off into own thread\");\n+\t\tLogger.log(Logger.DEBUG, \"Server breaking off into own thread\");\n \t\tthis.thread \u003d new Thread(this);\n \t\tthis.thread.start();\n \t}\n@@ -81,22 +81,22 @@ public static void main(String[] args){\n \t}\n \t\n \tpublic void messageReceived(ClientHandler clientHandler, String msg){\n-\t\tLogger.log(4, msg);\n+\t\tLogger.log(Logger.MESSAGE, msg);\n \t\tif(clientHandler.protocol.isValidCommand(msg)){\n \t\t\ttry {\n \t\t\t\tclientHandler.protocol.executeCommand(msg);\n \t\t\t} catch (IllegalArgumentException e) {\n-\t\t\t\tLogger.log(3, \"Illegal arguments in command \"+msg+\" [\"+e.getMessage()+\"]\");\n+\t\t\t\tLogger.log(Logger.ERROR, \"Illegal arguments in command \"+msg+\" [\"+e.getMessage()+\"]\");\n \t\t\t} catch (IOException e) {\n-\t\t\t\tLogger.log(3, \"Error while processing command \"+msg+\" [\"+e.getMessage()+\"]\");\n+\t\t\t\tLogger.log(Logger.ERROR, \"Error while processing command \"+msg+\" [\"+e.getMessage()+\"]\");\n \t\t\t}\n \t\t}\n \t}\n \t\n \tpublic void broadcast(String msg){\n \t\tfor(ClientHandler client : this.connectedClients){\n \t\t\tif(client.protocol.isHandshakeDone() \u0026\u0026 client.protocol.isAuthDone()){\n-\t\t\t\tLogger.log(0, \"Sending msg to client \"+client.getNick());\n+\t\t\t\tLogger.log(Logger.DEBUG, \"Sending msg to client \"+client.getNick());\n \t\t\t\tclient.send(msg);\t\n \t\t\t}\n \t\t}\n@@ -126,19 +126,19 @@ public void setupConsoleCommands(){\n \t}\n \t\n \tpublic void executeConsoleCommand(String cmd){\n-\t\tLogger.log(0, \"Executing console command \"+cmd);\n+\t\tLogger.log(Logger.DEBUG, \"Executing console command \"+cmd);\n \t\tswitch(cmd.split(\" \")[0]){\n \t\t\tcase \"exit\":\n \t\t\tcase \"quit\":\n \t\t\tcase \"stop\":\n-\t\t\t\tLogger.log(2, \"Stopping server!\");\n+\t\t\t\tLogger.log(Logger.WARNING, \"Stopping server!\");\n \t\t\t\tthis.close();\n \t\t\t\tbreak;\n \t\t\tcase \"kick\":\n \t\t\t\tthis.kick(cmd.split(\" \")[1]);\n \t\t\t\tbreak;\n \t\t\tdefault:\n-\t\t\t\tLogger.log(3, \"Command not implemented: \"+cmd);\n+\t\t\t\tLogger.log(Logger.ERROR, \"Command not implemented: \"+cmd);\n \t\t\t\tbreak;\n \t\t\t\t\n \t\t}\n@@ -178,32 +178,32 @@ public ClientHandler getClient(String name) {\n \t}\n \t\n \tpublic void kick(String clientName){\n-\t\tLogger.log(1, \"Kicking client \"+clientName);\n+\t\tLogger.log(Logger.INFO, \"Kicking client \"+clientName);\n \t\ttry {\n \t\t\tthis.getClient(clientName).close();\n \t\t} catch (IOException e) {\n-\t\t\tLogger.log(3, \"Couldn\u0027t kick client. [\"+e.getMessage()+\"]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Couldn\u0027t kick client. [\"+e.getMessage()+\"]\");\n \t\t} catch (NullPointerException e){\n-\t\t\tLogger.log(3, \"Couldn\u0027t kick client. [No such client]\");\n+\t\t\tLogger.log(Logger.ERROR, \"Couldn\u0027t kick client. [No such client]\");\n \t\t}\n \t}\n \t\n \tpublic void close(){\n \t\tthis.finished \u003d true;\n-\t\tLogger.log(1, \"Stopped listening for clients.\");\n+\t\tLogger.log(Logger.INFO, \"Stopped listening for clients.\");\n \t\tArrayList\u003cClientHandler\u003e tempList \u003d new ArrayList\u003cClientHandler\u003e();\n \t\tfor(ClientHandler c : this.connectedClients){\n \t\t\ttempList.add(c);\n \t\t}\n-\t\tLogger.log(1, \"Disconnecting connected clients\");\n+\t\tLogger.log(Logger.INFO, \"Disconnecting connected clients\");\n \t\tfor(ClientHandler c : tempList){\n \t\t\ttry {\n \t\t\t\tc.close();\n \t\t\t} catch (IOException e) {\n-\t\t\t\tLogger.log(3, \"Error closing client.\"+e.getMessage());\n+\t\t\t\tLogger.log(Logger.ERROR, \"Error closing client.\"+e.getMessage());\n \t\t\t}\n \t\t}\n-\t\tLogger.log(1, \"Stopping process.\");\n+\t\tLogger.log(Logger.INFO, \"Stopping process.\");\n \t\tSystem.exit(0);\n \t}\n }"
        },
        {
          "file_name": "Rolit/src/rolit/server/ServerInformation.java",
          "patch": "@@ -11,5 +11,5 @@\n \t\n \t// Server info\n \tpublic int supports \u003d 1;\n-\tpublic String version \u003d \"KSS_v0.1\";\n+\tpublic String version \u003d \"KSS_0.1\";\n }"
        }
      ]
    }
  },
  {
    "name": "Race-condition in RenderList.constructor",
    "url": "https://github.com/jtrfp/terminal-recall/issues/2",
    "description": "Race-condition in RenderList.constructor when initializing hostRenderListPageTable[i] inside of anonymously-declared GLEventListener (RenderList.java:98) which depends on initialization of tr.objectListWindow which also uses a GLEventListener to initialize without guarantee of precedence to aforementioned dependent call.\n\nNeed a redesign to ensure cleaner, more centralized of GPU management resources on startup of TR.java, perhaps instantiate tr.renderer,etc as a part of a single GLEventListener.init() instead of dangerous listeners whose order is indeterminate.\n",
    "keywords": [
      "renderlist",
      "gleventlistener",
      "tr"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/jtrfp/terminal-recall/commit/b74e1c943cd8bbf58f9f1dbb2582b114bfed6295",
      "files": [
        {
          "file_name": "src/main/java/org/jtrfp/trcl/core/RenderList.java",
          "patch": "@@ -28,7 +28,6 @@\n import org.jtrfp.trcl.Submitter;\n import org.jtrfp.trcl.gpu.GLProgram;\n import org.jtrfp.trcl.gpu.GLUniform;\n-import org.jtrfp.trcl.gpu.GlobalDynamicTextureBuffer;\n import org.jtrfp.trcl.mem.PagedByteBuffer;\n import org.jtrfp.trcl.obj.PositionedRenderable;\n import org.jtrfp.trcl.obj.WorldObject;\n@@ -89,24 +88,16 @@ public RenderList(GL3 gl, GLProgram prg, TR tr){\n \t\trenderModeUniform\u003dprg.getUniform(\"renderFlags\");\n \t\trenderListPageTable\u003dprg.getUniform(\"renderListPageTable\");\n \t\thostRenderListPageTable\u003dnew int[ObjectListWindow.OBJECT_LIST_SIZE_BYTES_PER_PASS*RenderList.NUM_RENDER_PASSES/PagedByteBuffer.PAGE_SIZE_BYTES];\n-\t\t\n-\t\ttr.getGPU().addGLEventListener(new GLEventListener(){\n+\t\ttr.getThreadManager().addRunnableWhenFirstStarted(new Runnable(){\n \t\t    @Override\n-\t\t    public void init(GLAutoDrawable drawable) {\n+\t\t    public void run() {\n \t\t\tSystem.out.println(\"hostRenderListPageTable length\u003d\"+hostRenderListPageTable.length);\n \t\t\tfor(int i\u003d0; i\u003chostRenderListPageTable.length;i++){\n \t\t\t    hostRenderListPageTable[i]\u003dRenderList.this.tr.getObjectListWindow().logicalPage2PhysicalPage(i);\n \t\t\t}//end for(hostRenderListPageTable.length)\n \t\t\trenderListPageTable.setArrayui(hostRenderListPageTable);\n \t\t\tmodulusUintOffset \u003d (RenderList.this.tr.getObjectListWindow().getPhysicalAddressInBytes(0)%PagedByteBuffer.PAGE_SIZE_BYTES)/4;\n-\t\t    }\n-\t\t    @Override\n-\t\t    public void dispose(GLAutoDrawable drawable) {}\n-\t\t    @Override\n-\t\t    public void display(GLAutoDrawable drawable) {}\n-\t\t    @Override\n-\t\t    public void reshape(GLAutoDrawable drawable, int x, int y,\n-\t\t\t    int width, int height) {}});\n+\t\t    }});\n \t    }\n \tprivate static int frameCounter\u003d0;\n \t"
        },
        {
          "file_name": "src/main/java/org/jtrfp/trcl/core/TR.java",
          "patch": "@@ -147,6 +147,7 @@ public void run(){\n \t\t\t//frame.pack();\n \t\t\t}});\n \t\t}catch(Exception e){e.printStackTrace();}\n+\t\tthreadManager \u003d new ThreadManager(this);\n \t\tgpu.takeGL();\n \t\trenderer\u003dnew Renderer(gpu);\n \t\tgpu.releaseGL();\n@@ -157,7 +158,6 @@ public void run(){\n \t\t\t\t256*mapSquareSize,\n \t\t\t\tmapSquareSize*visibilityDiameterInMapSquares/2., this);\n \t\tgetRenderer().setRootGrid(world);\n-\t\tthreadManager \u003d new ThreadManager(this);\n \t\t}//end constructor\n \t\n \tpublic void showStopper(final Exception e)"
        },
        {
          "file_name": "src/main/java/org/jtrfp/trcl/core/ThreadManager.java",
          "patch": "@@ -1,9 +1,8 @@\n package org.jtrfp.trcl.core;\n \n+import java.util.ArrayList;\n import java.util.List;\n import java.util.Timer;\n-import java.util.TimerTask;\n-import java.util.concurrent.ScheduledThreadPoolExecutor;\n \n import javax.media.opengl.GLAutoDrawable;\n import javax.media.opengl.GLEventListener;\n@@ -15,81 +14,94 @@\n \n import com.jogamp.opengl.util.FPSAnimator;\n \n+public class ThreadManager {\n+    public static final int RENDER_FPS \u003d 60;\n+    public static final int GAMEPLAY_FPS \u003d RENDER_FPS;\n+    public static final int RENDERLIST_REFRESH_FPS \u003d 5;\n+    public static final int RENDERING_PRIORITY \u003d 6;\n+    public static final int SOUND_PRIORITY \u003d 8;\n+    private final TR tr;\n+    private final FPSAnimator renderingAnimator;\n+    private final Timer gameplayTimer \u003d new Timer(\"GameplayTimer\");\n+    private long lastGameplayTickTime \u003d 0;\n+    private long timeInMillisSinceLastGameTick \u003d 0L;\n+    private ArrayList\u003cRunnable\u003e runWhenFirstStarted \u003d new ArrayList\u003cRunnable\u003e();\n+    private boolean firstRun \u003d true;\n \n-public class ThreadManager\n-\t{\n-\tpublic static final int RENDER_FPS\u003d60;\n-\tpublic static final int GAMEPLAY_FPS\u003dRENDER_FPS;\n-\tpublic static final int RENDERLIST_REFRESH_FPS\u003d5;\n-\tpublic static final int RENDERING_PRIORITY\u003d6;\n-\tpublic static final int SOUND_PRIORITY\u003d8;\n-\tprivate final TR tr;\n-\tprivate final FPSAnimator renderingAnimator;\n-\tprivate final Timer gameplayTimer \u003d new Timer(\"GameplayTimer\");\n-\tprivate long lastGameplayTickTime\u003d0;\n-\tprivate long timeInMillisSinceLastGameTick\u003d0L;\n-\t\n-\tprivate int counter\u003d0;\n-\t\n-\tThreadManager(TR tr)\n-\t\t{this.tr\u003dtr;\n-\t\trenderingAnimator \u003d new FPSAnimator((GLCanvas)tr.getGPU().getComponent(),RENDER_FPS);\n-\t\ttr.getGPU().addGLEventListener(new GLEventListener()\n-\t\t\t{\n-\t\t\t@Override\n-\t\t\tpublic void init(GLAutoDrawable drawable)\n-\t\t\t\t{}\n-\n-\t\t\t@Override\n-\t\t\tpublic void dispose(GLAutoDrawable drawable)\n-\t\t\t\t{}\n-\n-\t\t\t@Override\n-\t\t\tpublic void display(GLAutoDrawable drawable)\n-\t\t\t\t{\n-\t\t\t\tThread.currentThread().setPriority(RENDERING_PRIORITY);\n-\t\t\t\tThreadManager.this.tr.getGPU().getMemoryManager().map();\n-\t\t\t\tif(counter++%(RENDER_FPS/RENDERLIST_REFRESH_FPS)\u003d\u003d0)visibilityCalc();\n-\t\t\t\tgameplay();\n-\t\t\t\tThreadManager.this.tr.getRenderer().render();\n-\t\t\t\t}\n-\n-\t\t\t@Override\n-\t\t\tpublic void reshape(GLAutoDrawable drawable, int x, int y,\n-\t\t\t\t\tint width, int height)\n-\t\t\t\t{display(drawable);}\n-\t\t\t});\n-\t\t\n-\t\t}//end constructor\n-\t\n-\tprivate void gameplay(){\n-\t // Ticks\n-\t\tfinal long tickTimeInMillis \u003d System.currentTimeMillis();\n-\t\ttimeInMillisSinceLastGameTick\u003dtickTimeInMillis-lastGameplayTickTime;\n-\t\t\tList\u003cWorldObject\u003e vl \u003d tr.getCollisionManager().getVisibilityList();\n-\t\t    \tfor(WorldObject wo:vl){\n-\t\t    \t    if(wo.isActive()\u0026\u0026\n-\t\t\t\t    (TR.twosComplimentDistance(wo.getPosition(), tr.getPlayer().getPosition())\n-\t\t\t\t    \u003cCollisionManager.MAX_CONSIDERATION_DISTANCE)||wo instanceof VisibleEverywhere)\n-\t\t\t\t       wo.tick(tickTimeInMillis);\n-\t\t    \t    }//end for(worldObjects)\n-\t\t    \t  tr.getCollisionManager().performCollisionTests();\n-\t\tlastGameplayTickTime\u003dtickTimeInMillis;\n-\t}//end gameplay()\n-\t\n-\tprivate void visibilityCalc(){\n-\t\ttr.getRenderer().updateVisibilityList();\n-\t\ttr.getCollisionManager().updateVisibilityList();\n-\t}\n-\t\n-\tpublic void start(){\n-\t\trenderingAnimator.start();\n-\t\tlastGameplayTickTime\u003dSystem.currentTimeMillis();\n-\t\t}//end constructor\n-\t\n-\tpublic long getElapsedTimeInMillisSinceLastGameTick(){return timeInMillisSinceLastGameTick;}\n-\n-\tpublic Timer getGameplayTimer() {\n-\t    return gameplayTimer;\n-\t}\n-\t}//end ThreadManager\n+    private int counter \u003d 0;\n+\n+    ThreadManager(TR tr) {\n+\tthis.tr \u003d tr;\n+\trenderingAnimator \u003d new FPSAnimator((GLCanvas) tr.getGPU()\n+\t\t.getComponent(), RENDER_FPS);\n+    }// end constructor\n+\n+    private void gameplay() {\n+\t// Ticks\n+\tfinal long tickTimeInMillis \u003d System.currentTimeMillis();\n+\ttimeInMillisSinceLastGameTick \u003d tickTimeInMillis - lastGameplayTickTime;\n+\tList\u003cWorldObject\u003e vl \u003d tr.getCollisionManager().getVisibilityList();\n+\tfor (WorldObject wo : vl) {\n+\t    if (wo.isActive()\n+\t\t    \u0026\u0026 (TR.twosComplimentDistance(wo.getPosition(), tr\n+\t\t\t    .getPlayer().getPosition()) \u003c CollisionManager.MAX_CONSIDERATION_DISTANCE)\n+\t\t    || wo instanceof VisibleEverywhere)\n+\t\two.tick(tickTimeInMillis);\n+\t}// end for(worldObjects)\n+\ttr.getCollisionManager().performCollisionTests();\n+\tlastGameplayTickTime \u003d tickTimeInMillis;\n+    }// end gameplay()\n+\n+    private void visibilityCalc() {\n+\ttr.getRenderer().updateVisibilityList();\n+\ttr.getCollisionManager().updateVisibilityList();\n+    }\n+\n+    public void start() {\n+\ttr.getGPU().addGLEventListener(new GLEventListener() {\n+\t    @Override\n+\t    public void init(GLAutoDrawable drawable) {\n+\t\tSystem.out.println(\"GLEventListener.init()\");\n+\t    }\n+\n+\t    @Override\n+\t    public void dispose(GLAutoDrawable drawable) {\n+\t    }\n+\n+\t    @Override\n+\t    public void display(GLAutoDrawable drawable) {\n+\t\tif (firstRun) {\n+\t\t    for (Runnable r : runWhenFirstStarted) {\n+\t\t\tr.run();\n+\t\t    }\n+\t\t}\n+\t\tThread.currentThread().setPriority(RENDERING_PRIORITY);\n+\t\tThreadManager.this.tr.getGPU().getMemoryManager().map();\n+\t\tif (counter++ % (RENDER_FPS / RENDERLIST_REFRESH_FPS) \u003d\u003d 0)\n+\t\t    visibilityCalc();\n+\t\tgameplay();\n+\t\tThreadManager.this.tr.getRenderer().render();\n+\t\tfirstRun \u003d false;\n+\t    }\n+\n+\t    @Override\n+\t    public void reshape(GLAutoDrawable drawable, int x, int y,\n+\t\t    int width, int height) {\n+\t    }\n+\t});\n+\trenderingAnimator.start();\n+\tlastGameplayTickTime \u003d System.currentTimeMillis();\n+    }// end constructor\n+\n+    public long getElapsedTimeInMillisSinceLastGameTick() {\n+\treturn timeInMillisSinceLastGameTick;\n+    }\n+\n+    public Timer getGameplayTimer() {\n+\treturn gameplayTimer;\n+    }\n+\n+    public void addRunnableWhenFirstStarted(Runnable r) {\n+\trunWhenFirstStarted.add(r);\n+    }\n+}// end ThreadManager"
        }
      ]
    }
  },
  {
    "name": "Race condition in TransactorIT.testFailures()",
    "url": "https://github.com/apache/fluo/issues/100",
    "description": "Sometimes seeing the following failure.  I think sometimes the test is deleting a node in zookeeper and then scanning zookeeper before curator can respond to the notification and recreate the node.  As an experiment I added a sleep after the delete and the test passes reliably. \n\n```\nTests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 4.264 sec \u003c\u003c\u003c FAILURE! - in io.fluo.impl.TransactorIT\ntestFailures(io.fluo.impl.TransactorIT)  Time elapsed: 1.983 sec  \u003c\u003c\u003c FAILURE!\njava.lang.AssertionError: expected:\u003c1\u003e but was:\u003c0\u003e\n    at org.junit.Assert.fail(Assert.java:88)\n    at org.junit.Assert.failNotEquals(Assert.java:743)\n    at org.junit.Assert.assertEquals(Assert.java:118)\n    at org.junit.Assert.assertEquals(Assert.java:555)\n    at org.junit.Assert.assertEquals(Assert.java:542)\n    at io.fluo.impl.TransactorIT.testFailures(TransactorIT.java:95)\n```\n",
    "keywords": [
      "fluo",
      "impl",
      "junit",
      "transactorit",
      "org",
      "assert",
      "io",
      "failure",
      "testfailures",
      "org junit",
      "assertequals"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/apache/fluo/commit/c9289f84d71326a5c3608b7263325df66686b43e",
      "files": [
        {
          "file_name": "modules/core/src/test/java/io/fluo/impl/TransactorIT.java",
          "patch": "@@ -21,12 +21,14 @@\n import org.junit.Test;\n import org.junit.rules.ExpectedException;\n \n-/** Tests transactor class\n+/** \n+ * Tests transactor class\n  */\n public class TransactorIT extends Base {\n   \n   public static Long id1 \u003d new Long(1);\n   public static Long id2 \u003d new Long(2);\n+  public static long NUM_OPEN_TIMEOUT_MS \u003d 1000;\n   \n   @Rule\n   public ExpectedException exception \u003d ExpectedException.none();\n@@ -43,7 +45,7 @@ public void testTransactorAndCache() throws Exception {\n     TransactorID t2 \u003d new TransactorID(config);\n \n     // verify that they were created correctly\n-    Assert.assertEquals(2, getNumOpen());\n+    assertNumOpen(2);\n     Assert.assertEquals(id1, t1.getLongID());\n     Assert.assertEquals(id2, t2.getLongID());\n     Assert.assertTrue(checkExists(t1));\n@@ -59,7 +61,7 @@ public void testTransactorAndCache() throws Exception {\n     t1.close();\n     \n     // verify that t1 was closed\n-    Assert.assertEquals(1, getNumOpen());\n+    assertNumOpen(1);\n     Assert.assertFalse(checkExists(t1));\n     Assert.assertTrue(checkExists(t2));\n     Assert.assertFalse(cache.checkExists(id1));\n@@ -69,7 +71,7 @@ public void testTransactorAndCache() throws Exception {\n     t2.close();\n     \n     // verify that t2 closed\n-    Assert.assertEquals(0, getNumOpen());\n+    assertNumOpen(0);\n     Assert.assertFalse(checkExists(t2));\n     \n     // verify the cache\n@@ -84,20 +86,20 @@ public void testFailures() throws Exception {\n     \n     TransactorID t1 \u003d new TransactorID(config);  \n     \n-    Assert.assertEquals(1, getNumOpen());\n+    assertNumOpen(1);\n     Assert.assertEquals(id1, t1.getLongID());\n     Assert.assertTrue(checkExists(t1));\n    \n     // Test that node will be recreated if removed\n     curator.delete().forPath(t1.getNodePath());\n     \n     Assert.assertEquals(id1, t1.getLongID());\n-    Assert.assertEquals(1, getNumOpen());\n+    assertNumOpen(1);\n     Assert.assertTrue(checkExists(t1));\n     \n     t1.close();\n     \n-    Assert.assertEquals(0, getNumOpen());\n+    assertNumOpen(0);\n     Assert.assertFalse(checkExists(t1));\n     \n     // Test for exception to be called\n@@ -112,4 +114,14 @@ private boolean checkExists(TransactorID t) throws Exception {\n   private int getNumOpen() throws Exception {\n     return curator.getChildren().forPath(config.getZookeeperRoot()+Constants.Zookeeper.TRANSACTOR_NODES).size();\n   }\n+  \n+  private void assertNumOpen(int expected) throws Exception {\n+    long startTime \u003d System.currentTimeMillis();\n+    while (getNumOpen() !\u003d expected) {\n+      Thread.sleep(50);\n+      if ((System.currentTimeMillis() - startTime) \u003e NUM_OPEN_TIMEOUT_MS) {\n+        Assert.fail(\"Timed out waiting for correct transactor number in Zookeeper\");\n+      }\n+    }\n+  }\n }"
        }
      ]
    }
  },
  {
    "name": "Fix WS Sending race condition.",
    "url": "https://github.com/DV8FromTheWorld/JDA/pull/348",
    "description": "Fixed bug where packets sent by the WS ratelimit system were sent before IDENTIFY due to racecondition.",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/DV8FromTheWorld/JDA/commit/62d7b8951c7eaea0e707e8fe86f10ebed7ec74df",
      "files": [
        {
          "file_name": "src/main/java/net/dv8tion/jda/core/requests/WebSocketClient.java",
          "patch": "@@ -218,6 +218,13 @@ public void run()\n                 {\n                     try\n                     {\n+                        //Make sure that we don\u0027t send any packets while attempting to connect.\n+                        if (!connected || initiating)\n+                        {\n+                            Thread.sleep(1000);\n+                            continue;\n+                        }\n+\n                         attemptedToSend \u003d false;\n                         needRatelimit \u003d false;\n "
        }
      ]
    }
  },
  {
    "name": "MemoryStore race condition with parallel commits and sync",
    "url": "https://github.com/eclipse/rdf4j/issues/655",
    "description": "Observed: parallel commits in MemoryStoreConnection may result in inconsistent data on disk when MemoryStore persists its data. Difficult to reproduce since it\u0027s a race condition. Originally observed as adding multiple repos to the SYSTEM repository in parallel and not finding all of them after a restart.\r\n\r\nCause: Persisted MemoryStore calls sync() on commit(), syncs to disk if contentsChanged is true and resets contentsChanged to false. This is done inside a synchronized (syncSemaphor) block so multiple threads will wait and do this sequentially. However, notifySailChanged() sets contentsChanged outside of synchronized and hence a thread may reach sync() after another thread has reset contentsChanged to false.",
    "keywords": [
      "contentschanged",
      "parallel",
      "memorystore",
      "sync"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/eclipse/rdf4j/commit/d733512f547e6cf594095b0f30b7ecb7d86f7cc9",
      "files": [
        {
          "file_name": "core/sail/memory/src/main/java/org/eclipse/rdf4j/sail/memory/MemoryStore.java",
          "patch": "@@ -381,7 +381,9 @@ public ValueFactory getValueFactory() {\n \t@Override\n \tpublic void notifySailChanged(SailChangedEvent event) {\n \t\tsuper.notifySailChanged(event);\n-\t\tcontentsChanged \u003d true;\n+\t\tsynchronized (syncSemaphore) {\n+\t\t\tcontentsChanged \u003d true;\n+\t\t}\n \t}\n \n \tprotected void scheduleSyncTask()"
        }
      ]
    }
  },
  {
    "name": "Race condition between GCM registration and RemoteMotion API registration",
    "url": "https://github.com/tomfitzhenry/MotionRemote/issues/4",
    "description": "Steps to reproduce:\n1. Wipe all application state.\n2. Open MotionRemote\n\nWhat should happen:\nGCM registration ID is retrieved, which is then used in the RemoteMotion API registration.\n\nWhat actually happens:\nSometimes, the RemoteMotion API registration happens before GCM registration, so the RemoteMotion API does thinks the GCM registration ID is the empty string!\n",
    "keywords": [
      "gcm",
      "registration",
      "api",
      "remotemotion"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/tomfitzhenry/MotionRemote/commit/9a9ae6a17f8b5b5bbc3fedcfd522a33909a993a6",
      "files": [
        {
          "file_name": "src/uk/me/tom_fitzhenry/motionremote/ApiRegistration.java",
          "patch": "@@ -15,6 +15,11 @@\n \tprivate final ApiClient apiClient \u003d new ApiClient();\n \t\n \tprivate ChooseStreamActivity chooseStreamActivity;\n+\tprivate Context applicationContext;\n+\t\n+\tpublic void init(Context applicationContext) {\n+\t\tthis.applicationContext \u003d applicationContext;\n+\t}\n \t\n \tpublic String getApiKey() {\n \t\treturn getApiPreferences().getString(PROPERTY_API_KEY, null);\n@@ -64,9 +69,11 @@ private void storeApiKey(String apiKey) {\n \t}\n \t\n \tprivate SharedPreferences getApiPreferences() {\n-\t    return this.chooseStreamActivity.getSharedPreferences(ApiRegistration.class.getSimpleName(), Context.MODE_PRIVATE);\n+\t    return this.applicationContext.getSharedPreferences(ApiRegistration.class.getSimpleName(), Context.MODE_PRIVATE);\n \t}\n \n \n+\n+\n \t\n }"
        },
        {
          "file_name": "src/uk/me/tom_fitzhenry/motionremote/ChooseStreamActivity.java",
          "patch": "@@ -12,8 +12,8 @@\n \n public class ChooseStreamActivity extends Activity {\n \t\n-\tprivate final GcmRegistration gcmRegistration \u003d new GcmRegistration();\n \tprivate final ApiRegistration apiRegistration \u003d new ApiRegistration();\n+\tprivate final GcmRegistration gcmRegistration \u003d new GcmRegistration(apiRegistration);\n \t\n \tpublic final static String EXTRA_URL \u003d extra(\"URL\");\n \t\n@@ -25,7 +25,7 @@ protected void onCreate(Bundle savedInstanceState) {\n \t\tsuper.onCreate(savedInstanceState);\n \t\tsetContentView(R.layout.activity_choose_stream);\n \t\t\n-\t\tapiRegistration.ensureRegistered(this, GcmRegistration.getRegistrationId(this));\n+\t\tapiRegistration.init(getApplicationContext());\n \t\tgcmRegistration.ensureRegistered(this);\n \t\t\n \t\turlEditText \u003d (EditText) findViewById(R.id.url);"
        },
        {
          "file_name": "src/uk/me/tom_fitzhenry/motionremote/gcm/GcmRegistration.java",
          "patch": "@@ -3,6 +3,7 @@\n import java.io.IOException;\n import java.sql.Timestamp;\n \n+import uk.me.tom_fitzhenry.motionremote.ApiRegistration;\n import uk.me.tom_fitzhenry.motionremote.ChooseStreamActivity;\n \n import com.google.android.gms.gcm.GoogleCloudMessaging;\n@@ -24,12 +25,18 @@\n     private static final String PROPERTY_ON_SERVER_EXPIRATION_TIME \u003d \"onServerExpirationTimeMs\";\n     private static final long REGISTRATION_EXPIRY_TIME_MS \u003d 1000 * 3600 * 24 * 7;\n     \n+    private final ApiRegistration apiRegistration;\n+    \n     private final String SENDER_ID \u003d \"416185604969\";\n     private GoogleCloudMessaging gcm;\n-    private Context context;\n+    private ChooseStreamActivity context;\n     private String regid;\n     \n-\tpublic void ensureRegistered(Context context) {\n+    public GcmRegistration(ApiRegistration apiRegistration) {\n+    \tthis.apiRegistration \u003d apiRegistration;\n+    }\n+    \n+\tpublic void ensureRegistered(ChooseStreamActivity context) {\n \t\tthis.context \u003d context;\n \t\tif (!registered(context)) {\n \t\t\tgcm \u003d GoogleCloudMessaging.getInstance(context);\n@@ -45,29 +52,19 @@ private void registerBackground() {\n \t    new AsyncTask\u003cVoid, Void, String\u003e() {\n \t        @Override\n \t        protected String doInBackground(Void... params) {\n-\t            String msg \u003d \"\";\n \t            try {\n \t                regid \u003d gcm.register(SENDER_ID);\n-\t                msg \u003d \"Device registered, registration id\u003d\" + regid;\n-\n-\t                // You should send the registration ID to your server over HTTP,\n-\t                // so it can use GCM/HTTP or CCS to send messages to your app.\n-\n-\t                // For this demo: we don\u0027t need to send it because the device\n-\t                // will send upstream messages to a server that echo back the message\n-\t                // using the \u0027from\u0027 address in the message.\n-\n-\t                // Save the regid - no need to register again.\n \t                setRegistrationId(context, regid);\n-\t            } catch (IOException ex) {\n-\t                msg \u003d \"Error :\" + ex.getMessage();\n+\t            } catch (IOException e) {\n+\t            \tLog.e(TAG, \"\", e);\n+\t            \tthrow new RuntimeException(e);\n \t            }\n-\t            return msg;\n+\t            return regid;\n \t        }\n \n \t        @Override\n-\t        protected void onPostExecute(String msg) {\n-\t            //mDisplay.append(msg + \"\\n\");\n+\t        protected void onPostExecute(String regId) {\n+\t        \tapiRegistration.ensureRegistered(context, regId);\n \t        }\n \t    }.execute(null, null, null);\n \t}"
        }
      ]
    }
  },
  {
    "name": "race condition in DownloadManagerDialog",
    "url": "https://github.com/cismet/cismet-gui-commons/issues/78",
    "description": "the close() method of the DownloadManagerDialog causes a race condition while adding new downloads when invoked outside of the edt.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/cismet/cismet-gui-commons/commit/ae28eee3d01728e6e3999385d3b4952d282b6534",
      "files": [
        {
          "file_name": "src/main/java/de/cismet/tools/gui/downloadmanager/DownloadManagerDialog.java",
          "patch": "@@ -288,14 +288,16 @@ public static void showExceptionDialog(final Download download) {\n      * Closes the DownloadManagerDialog.\n      */\n     public static void close() {\n-        if (SwingUtilities.isEventDispatchThread()) {\n+        if (!SwingUtilities.isEventDispatchThread()) {\n             SwingUtilities.invokeLater(new Runnable() {\n \n                     @Override\n                     public void run() {\n                         instance.dispatchEvent(new WindowEvent(instance, WindowEvent.WINDOW_CLOSING));\n                     }\n                 });\n+        } else {\n+            instance.dispatchEvent(new WindowEvent(instance, WindowEvent.WINDOW_CLOSING));\n         }\n     }\n "
        }
      ]
    }
  },
  {
    "name": "Fixed race condition that was preventing creation of brooklyn-ssh-tmp",
    "url": "https://github.com/brooklyncentral/brooklyn/pull/1354",
    "description": "",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/brooklyncentral/brooklyn/commit/38099675d60913dc5f108a2260faafaa0ee13774",
      "files": [
        {
          "file_name": "utils/common/src/main/java/brooklyn/util/os/Os.java",
          "patch": "@@ -313,11 +313,12 @@ public static void deleteOnExitRecursivelyAndEmptyParentsUpTo(File directoryToCl\n \n     /** as {@link File#mkdirs()} but throwing on failure and returning the directory made for fluent convenience */\n     public static File mkdirs(File dir) {\n-        if (dir.isDirectory()) return dir;\n-        boolean success \u003d dir.mkdirs();\n-        if (!success) throw Exceptions.propagate(new IOException(\"Failed to create directory \" + dir + \n+        dir.mkdirs();\n+        if (dir.isDirectory()) {\n+            return dir;\n+        }\n+        throw Exceptions.propagate(new IOException(\"Failed to create directory \" + dir + \n                 (dir.isFile() ? \"(is file)\" : \"\")));\n-        return dir;\n     }\n \n     /** writes given contents to a temporary file which will be deleted on exit */"
        }
      ]
    }
  },
  {
    "name": "Possible Race Condition on Shutdown",
    "url": "https://github.com/brettwooldridge/HikariCP/issues/128",
    "description": "Hi,\n\nContinuing on from the forums, thought I might as well open an issue for tracking purposes. \n\nI\u0027m seeing this now and again when I shutdown (ctrl+c) my Spring application (using HikariCP as the datasource provider):\n\n```\n[2014-07-30 18:06:55.004][               ][DEVELOPMENT][WARN ][com.zaxxer.hikari.pool.HikariPool       ][279 ] - Internal accounting inconsistency, totalConnections\u003d-2\njava.lang.Exception: null\n    at com.zaxxer.hikari.pool.HikariPool.closeConnection(HikariPool.java:279) [HikariCP-2.0.1.jar:na]\n    at com.zaxxer.hikari.pool.HikariPool.releaseConnection(HikariPool.java:221) [HikariCP-2.0.1.jar:na]\n    at com.zaxxer.hikari.proxy.ConnectionProxy.close(ConnectionProxy.java:343) [HikariCP-2.0.1.jar:na]\n    at com.zaxxer.hikari.util.PoolUtilities.quietlyCloseConnection(PoolUtilities.java:18) [HikariCP-2.0.1.jar:na]\n    at com.zaxxer.hikari.pool.HikariPool.lambda$abortActiveConnections$5(HikariPool.java:478) [HikariCP-2.0.1.jar:na]\n    at com.zaxxer.hikari.pool.HikariPool$$Lambda$63/633170599.accept(Unknown Source) [HikariCP-2.0.1.jar:na]\n    at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183) [na:1.8.0_11]\n    at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1359) [na:1.8.0_11]\n    at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:512) [na:1.8.0_11]\n    at java.util.stream.ForEachOps$ForEachTask.compute(ForEachOps.java:290) [na:1.8.0_11]\n    at java.util.concurrent.CountedCompleter.exec(CountedCompleter.java:731) [na:1.8.0_11]\n    at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289) [na:1.8.0_11]\n    at java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:902) [na:1.8.0_11]\n    at java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1689) [na:1.8.0_11]\n    at java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1644) [na:1.8.0_11]\n    at java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:157) [na:1.8.0_11]\n[2014-07-30 18:06:55.007][               ][DEVELOPMENT][INFO ][o.s.s.concurrent.ThreadPoolTaskScheduler][203 ] - Shutting down ExecutorService \u0027taskScheduler\u0027\n```\n\nComments from Brett suggest that this could be a race condition.\n\nhttps://groups.google.com/forum/?hl\u003den-GB#!topic/hikari-cp/Dfpn8iaZxkA\n\n-\u003ddavid\u003d-\n",
    "keywords": [
      "com",
      "0 1",
      "[hikaricp-2 0",
      "1 jar:na]",
      "java util",
      "concurrent",
      "8 0_11]",
      "java",
      "stream",
      "jar:na]",
      "util concurrent",
      "[na:1 8",
      "pool",
      "zaxxer",
      "com zaxxer",
      "hikaripool",
      "[na:1",
      "0",
      "hikari pool",
      "1",
      "util",
      "forkjoinpool",
      "[hikaricp-2",
      "8",
      "zaxxer hikari",
      "0_11]",
      "hikari"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/brettwooldridge/HikariCP/commit/281c2872880bd67e294fc8cc41bffb89857a9c66",
      "files": [
        {
          "file_name": "hikaricp-java6/src/main/java/com/zaxxer/hikari/pool/HikariPool.java",
          "patch": "@@ -484,6 +484,7 @@ private void abortActiveConnections() throws InterruptedException\n       for (IHikariConnectionProxy connectionProxy : connectionBag.values(STATE_IN_USE)) {\n          try {\n             connectionProxy.abort(assassinExecutor);\n+            totalConnections.decrementAndGet();\n          }\n          catch (AbstractMethodError e) {\n             quietlyCloseConnection(connectionProxy);\n@@ -492,7 +493,6 @@ private void abortActiveConnections() throws InterruptedException\n             quietlyCloseConnection(connectionProxy);\n          }\n          finally {\n-            totalConnections.decrementAndGet();\n             try {\n                connectionBag.remove(connectionProxy);\n             }"
        },
        {
          "file_name": "hikaricp-java6/src/test/java/com/zaxxer/hikari/ShutdownTest.java",
          "patch": "@@ -16,6 +16,7 @@\n \n package com.zaxxer.hikari;\n \n+import java.sql.Connection;\n import java.sql.SQLException;\n import java.util.concurrent.TimeUnit;\n \n@@ -33,161 +34,187 @@\n  */\n public class ShutdownTest\n {\n-    @Before\n-    public void beforeTest()\n-    {\n-        StubConnection.count.set(0);\n-    }\n-\n-    @After\n-    public void afterTest()\n-    {\n-        StubConnection.slowCreate \u003d false;\n-    }\n-\n-    @Test\n-    public void testShutdown1() throws SQLException\n-    {\n-        Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n-\n-        StubConnection.slowCreate \u003d true;\n-\n-        HikariConfig config \u003d new HikariConfig();\n-        config.setMinimumIdle(0);\n-        config.setMaximumPoolSize(10);\n-        config.setInitializationFailFast(true);\n-        config.setConnectionTestQuery(\"VALUES 1\");\n-        config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-        final HikariDataSource ds \u003d new HikariDataSource(config);\n-        HikariPool pool \u003d TestElf.getPool(ds);\n-\n-        Thread[] threads \u003d new Thread[10];\n-        for (int i \u003d 0; i \u003c 10; i++)\n-        {\n-            threads[i] \u003d new Thread() {\n-                public void run() {\n-                    try\n-                    {\n-                        if (ds.getConnection() !\u003d null)\n-                        {\n-                            PoolUtilities.quietlySleep(TimeUnit.SECONDS.toMillis(1));\n-                        }\n-                    }\n-                    catch (SQLException e)\n-                    {\n-                    }\n-                }\n-            };\n-            threads[i].setDaemon(true);\n-            threads[i].start();\n-        }\n-\n-        PoolUtilities.quietlySleep(300);\n-\n-        Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003e 0);\n-        \n-        ds.close();\n-\n-        Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n-        Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n-        Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n-    }\n-\n-    @Test\n-    public void testShutdown2() throws SQLException\n-    {\n-        Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n-\n-        StubConnection.slowCreate \u003d true;\n-\n-        HikariConfig config \u003d new HikariConfig();\n-        config.setMinimumIdle(10);\n-        config.setMaximumPoolSize(10);\n-        config.setInitializationFailFast(false);\n-        config.setConnectionTestQuery(\"VALUES 1\");\n-        config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-        HikariDataSource ds \u003d new HikariDataSource(config);\n-        HikariPool pool \u003d TestElf.getPool(ds);\n-\n-        PoolUtilities.quietlySleep(300);\n-\n-        Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003e 0);\n-        \n-        ds.close();\n-\n-        Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n-        Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n-        Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n-    }\n-\n-    @Test\n-    public void testShutdown3() throws SQLException\n-    {\n-        Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n-\n-        StubConnection.slowCreate \u003d true;\n-\n-        HikariConfig config \u003d new HikariConfig();\n-        config.setMinimumIdle(5);\n-        config.setMaximumPoolSize(5);\n-        config.setInitializationFailFast(true);\n-        config.setConnectionTestQuery(\"VALUES 1\");\n-        config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-        HikariDataSource ds \u003d new HikariDataSource(config);\n-        HikariPool pool \u003d TestElf.getPool(ds);\n-\n-        PoolUtilities.quietlySleep(300);\n-\n-        Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003d\u003d 5);\n-        \n-        ds.close();\n-\n-        Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n-        Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n-        Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n-    }\n-    \n-    @Test\n-    public void testShutdown4() throws SQLException\n-    {\n-        StubConnection.slowCreate \u003d true;\n-        \n-        HikariConfig config \u003d new HikariConfig();\n-        config.setMinimumIdle(10);\n-        config.setMaximumPoolSize(10);\n-        config.setInitializationFailFast(false);\n-        config.setConnectionTestQuery(\"VALUES 1\");\n-        config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-        HikariDataSource ds \u003d new HikariDataSource(config);\n-\n-        PoolUtilities.quietlySleep(300);\n-\n-        ds.close();\n-\n-        long start \u003d System.currentTimeMillis();\n-        while (PoolUtilities.elapsedTimeMs(start) \u003c TimeUnit.SECONDS.toMillis(5) \u0026\u0026 threadCount() \u003e 0)\n-        {\n-            PoolUtilities.quietlySleep(250);\n-        }\n-\n-        Assert.assertSame(\"Thread was leaked\", 0, threadCount());\n-    }\n-\n-\tprivate int threadCount()\n-\t{\n-\t    Thread[] threads \u003d new Thread[Thread.activeCount() * 2];\n-\t    Thread.enumerate(threads);\n-\n-\t    int count \u003d 0;\n-\t    for (Thread thread : threads)\n-\t    {\n-\t        count +\u003d (thread !\u003d null \u0026\u0026 thread.getName().startsWith(\"Hikari\")) ? 1 : 0;\n-\t    }\n-\n-\t    return count;\n-\t}\n+   @Before\n+   public void beforeTest()\n+   {\n+      StubConnection.count.set(0);\n+   }\n+\n+   @After\n+   public void afterTest()\n+   {\n+      StubConnection.slowCreate \u003d false;\n+   }\n+\n+   @Test\n+   public void testShutdown1() throws SQLException\n+   {\n+      Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n+\n+      StubConnection.slowCreate \u003d true;\n+\n+      HikariConfig config \u003d new HikariConfig();\n+      config.setMinimumIdle(0);\n+      config.setMaximumPoolSize(10);\n+      config.setInitializationFailFast(true);\n+      config.setConnectionTestQuery(\"VALUES 1\");\n+      config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+      final HikariDataSource ds \u003d new HikariDataSource(config);\n+      HikariPool pool \u003d TestElf.getPool(ds);\n+\n+      Thread[] threads \u003d new Thread[10];\n+      for (int i \u003d 0; i \u003c 10; i++) {\n+         threads[i] \u003d new Thread() {\n+            public void run()\n+            {\n+               try {\n+                  if (ds.getConnection() !\u003d null) {\n+                     PoolUtilities.quietlySleep(TimeUnit.SECONDS.toMillis(1));\n+                  }\n+               }\n+               catch (SQLException e) {\n+               }\n+            }\n+         };\n+         threads[i].setDaemon(true);\n+         threads[i].start();\n+      }\n+\n+      PoolUtilities.quietlySleep(300);\n+\n+      Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003e 0);\n+\n+      ds.close();\n+\n+      Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n+      Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n+      Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n+   }\n+\n+   @Test\n+   public void testShutdown2() throws SQLException\n+   {\n+      Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n+\n+      StubConnection.slowCreate \u003d true;\n+\n+      HikariConfig config \u003d new HikariConfig();\n+      config.setMinimumIdle(10);\n+      config.setMaximumPoolSize(10);\n+      config.setInitializationFailFast(false);\n+      config.setConnectionTestQuery(\"VALUES 1\");\n+      config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+      HikariDataSource ds \u003d new HikariDataSource(config);\n+      HikariPool pool \u003d TestElf.getPool(ds);\n+\n+      PoolUtilities.quietlySleep(300);\n+\n+      Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003e 0);\n+\n+      ds.close();\n+\n+      Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n+      Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n+      Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n+   }\n+\n+   @Test\n+   public void testShutdown3() throws SQLException\n+   {\n+      Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n+\n+      StubConnection.slowCreate \u003d true;\n+\n+      HikariConfig config \u003d new HikariConfig();\n+      config.setMinimumIdle(5);\n+      config.setMaximumPoolSize(5);\n+      config.setInitializationFailFast(true);\n+      config.setConnectionTestQuery(\"VALUES 1\");\n+      config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+      HikariDataSource ds \u003d new HikariDataSource(config);\n+      HikariPool pool \u003d TestElf.getPool(ds);\n+\n+      PoolUtilities.quietlySleep(300);\n+\n+      Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003d\u003d 5);\n+\n+      ds.close();\n+\n+      Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n+      Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n+      Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n+   }\n+\n+   @Test\n+   public void testShutdown4() throws SQLException\n+   {\n+      StubConnection.slowCreate \u003d true;\n+\n+      HikariConfig config \u003d new HikariConfig();\n+      config.setMinimumIdle(10);\n+      config.setMaximumPoolSize(10);\n+      config.setInitializationFailFast(false);\n+      config.setConnectionTestQuery(\"VALUES 1\");\n+      config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+      HikariDataSource ds \u003d new HikariDataSource(config);\n+\n+      PoolUtilities.quietlySleep(300);\n+\n+      ds.close();\n+\n+      long start \u003d System.currentTimeMillis();\n+      while (PoolUtilities.elapsedTimeMs(start) \u003c TimeUnit.SECONDS.toMillis(5) \u0026\u0026 threadCount() \u003e 0) {\n+         PoolUtilities.quietlySleep(250);\n+      }\n+\n+      Assert.assertSame(\"Thread was leaked\", 0, threadCount());\n+   }\n+\n+   @Test\n+   public void testShutdown5() throws SQLException\n+   {\n+      Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n+\n+      StubConnection.slowCreate \u003d false;\n+\n+      HikariConfig config \u003d new HikariConfig();\n+      config.setMinimumIdle(5);\n+      config.setMaximumPoolSize(5);\n+      config.setInitializationFailFast(true);\n+      config.setConnectionTestQuery(\"VALUES 1\");\n+      config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+      HikariDataSource ds \u003d new HikariDataSource(config);\n+      HikariPool pool \u003d TestElf.getPool(ds);\n+\n+      Connection[] connections \u003d new Connection[5];\n+      for (int i \u003d 0; i \u003c 5; i++) {\n+         connections[i] \u003d ds.getConnection();\n+      }\n+\n+      Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003d\u003d 5);\n+\n+      ds.close();\n+\n+      Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n+      Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n+      Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n+   }\n+\n+   private int threadCount()\n+   {\n+      Thread[] threads \u003d new Thread[Thread.activeCount() * 2];\n+      Thread.enumerate(threads);\n+\n+      int count \u003d 0;\n+      for (Thread thread : threads) {\n+         count +\u003d (thread !\u003d null \u0026\u0026 thread.getName().startsWith(\"Hikari\")) ? 1 : 0;\n+      }\n+\n+      return count;\n+   }\n }"
        },
        {
          "file_name": "hikaricp-java6/src/test/java/com/zaxxer/hikari/mocks/StubConnection.java",
          "patch": "@@ -402,6 +402,7 @@ public String getSchema() throws SQLException\n     /** {@inheritDoc} */\n     public void abort(Executor executor) throws SQLException\n     {\n+       throw new SQLException(\"Intentianal exception during abort\");\n     }\n \n     /** {@inheritDoc} */"
        },
        {
          "file_name": "hikaricp/src/main/java/com/zaxxer/hikari/pool/HikariPool.java",
          "patch": "@@ -473,12 +473,12 @@ private void abortActiveConnections() throws InterruptedException\n       connectionBag.values(STATE_IN_USE).parallelStream().forEach(connectionProxy -\u003e {\n          try {\n             connectionProxy.abort(assassinExecutor);\n+            totalConnections.decrementAndGet();\n          }\n          catch (SQLException | AbstractMethodError e) {\n             quietlyCloseConnection(connectionProxy);\n          }\n          finally {\n-            totalConnections.decrementAndGet();\n             try {\n                connectionBag.remove(connectionProxy);\n             }"
        },
        {
          "file_name": "hikaricp/src/test/java/com/zaxxer/hikari/ShutdownTest.java",
          "patch": "@@ -16,6 +16,7 @@\n \n package com.zaxxer.hikari;\n \n+import java.sql.Connection;\n import java.sql.SQLException;\n import java.util.concurrent.TimeUnit;\n \n@@ -33,161 +34,187 @@\n  */\n public class ShutdownTest\n {\n-    @Before\n-    public void beforeTest()\n-    {\n-        StubConnection.count.set(0);\n-    }\n-\n-    @After\n-    public void afterTest()\n-    {\n-        StubConnection.slowCreate \u003d false;\n-    }\n-\n-    @Test\n-    public void testShutdown1() throws SQLException\n-    {\n-        Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n-\n-        StubConnection.slowCreate \u003d true;\n-\n-        HikariConfig config \u003d new HikariConfig();\n-        config.setMinimumIdle(0);\n-        config.setMaximumPoolSize(10);\n-        config.setInitializationFailFast(true);\n-        config.setConnectionTestQuery(\"VALUES 1\");\n-        config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-        final HikariDataSource ds \u003d new HikariDataSource(config);\n-        HikariPool pool \u003d TestElf.getPool(ds);\n-\n-        Thread[] threads \u003d new Thread[10];\n-        for (int i \u003d 0; i \u003c 10; i++)\n-        {\n-            threads[i] \u003d new Thread() {\n-                public void run() {\n-                    try\n-                    {\n-                        if (ds.getConnection() !\u003d null)\n-                        {\n-                            PoolUtilities.quietlySleep(TimeUnit.SECONDS.toMillis(1));\n-                        }\n-                    }\n-                    catch (SQLException e)\n-                    {\n-                    }\n-                }\n-            };\n-            threads[i].setDaemon(true);\n-            threads[i].start();\n-        }\n-\n-        PoolUtilities.quietlySleep(300);\n-\n-        Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003e 0);\n-        \n-        ds.close();\n-\n-        Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n-        Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n-        Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n-    }\n-\n-    @Test\n-    public void testShutdown2() throws SQLException\n-    {\n-        Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n-\n-        StubConnection.slowCreate \u003d true;\n-\n-        HikariConfig config \u003d new HikariConfig();\n-        config.setMinimumIdle(10);\n-        config.setMaximumPoolSize(10);\n-        config.setInitializationFailFast(false);\n-        config.setConnectionTestQuery(\"VALUES 1\");\n-        config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-        HikariDataSource ds \u003d new HikariDataSource(config);\n-        HikariPool pool \u003d TestElf.getPool(ds);\n-\n-        PoolUtilities.quietlySleep(300);\n-\n-        Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003e 0);\n-        \n-        ds.close();\n-\n-        Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n-        Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n-        Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n-    }\n-\n-    @Test\n-    public void testShutdown3() throws SQLException\n-    {\n-        Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n-\n-        StubConnection.slowCreate \u003d true;\n-\n-        HikariConfig config \u003d new HikariConfig();\n-        config.setMinimumIdle(5);\n-        config.setMaximumPoolSize(5);\n-        config.setInitializationFailFast(true);\n-        config.setConnectionTestQuery(\"VALUES 1\");\n-        config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-        HikariDataSource ds \u003d new HikariDataSource(config);\n-        HikariPool pool \u003d TestElf.getPool(ds);\n-\n-        PoolUtilities.quietlySleep(300);\n-\n-        Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003d\u003d 5);\n-        \n-        ds.close();\n-\n-        Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n-        Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n-        Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n-    }\n-    \n-    @Test\n-    public void testShutdown4() throws SQLException\n-    {\n-        StubConnection.slowCreate \u003d true;\n-        \n-        HikariConfig config \u003d new HikariConfig();\n-        config.setMinimumIdle(10);\n-        config.setMaximumPoolSize(10);\n-        config.setInitializationFailFast(false);\n-        config.setConnectionTestQuery(\"VALUES 1\");\n-        config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n-\n-        HikariDataSource ds \u003d new HikariDataSource(config);\n-\n-        PoolUtilities.quietlySleep(300);\n-\n-        ds.close();\n-\n-        long start \u003d System.currentTimeMillis();\n-        while (PoolUtilities.elapsedTimeMs(start) \u003c TimeUnit.SECONDS.toMillis(5) \u0026\u0026 threadCount() \u003e 0)\n-        {\n-            PoolUtilities.quietlySleep(250);\n-        }\n-\n-        Assert.assertSame(\"Thread was leaked\", 0, threadCount());\n-    }\n-\n-\tprivate int threadCount()\n-\t{\n-\t    Thread[] threads \u003d new Thread[Thread.activeCount() * 2];\n-\t    Thread.enumerate(threads);\n-\n-\t    int count \u003d 0;\n-\t    for (Thread thread : threads)\n-\t    {\n-\t        count +\u003d (thread !\u003d null \u0026\u0026 thread.getName().startsWith(\"Hikari\")) ? 1 : 0;\n-\t    }\n-\n-\t    return count;\n-\t}\n+   @Before\n+   public void beforeTest()\n+   {\n+      StubConnection.count.set(0);\n+   }\n+\n+   @After\n+   public void afterTest()\n+   {\n+      StubConnection.slowCreate \u003d false;\n+   }\n+\n+   @Test\n+   public void testShutdown1() throws SQLException\n+   {\n+      Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n+\n+      StubConnection.slowCreate \u003d true;\n+\n+      HikariConfig config \u003d new HikariConfig();\n+      config.setMinimumIdle(0);\n+      config.setMaximumPoolSize(10);\n+      config.setInitializationFailFast(true);\n+      config.setConnectionTestQuery(\"VALUES 1\");\n+      config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+      final HikariDataSource ds \u003d new HikariDataSource(config);\n+      HikariPool pool \u003d TestElf.getPool(ds);\n+\n+      Thread[] threads \u003d new Thread[10];\n+      for (int i \u003d 0; i \u003c 10; i++) {\n+         threads[i] \u003d new Thread() {\n+            public void run()\n+            {\n+               try {\n+                  if (ds.getConnection() !\u003d null) {\n+                     PoolUtilities.quietlySleep(TimeUnit.SECONDS.toMillis(1));\n+                  }\n+               }\n+               catch (SQLException e) {\n+               }\n+            }\n+         };\n+         threads[i].setDaemon(true);\n+         threads[i].start();\n+      }\n+\n+      PoolUtilities.quietlySleep(300);\n+\n+      Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003e 0);\n+\n+      ds.close();\n+\n+      Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n+      Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n+      Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n+   }\n+\n+   @Test\n+   public void testShutdown2() throws SQLException\n+   {\n+      Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n+\n+      StubConnection.slowCreate \u003d true;\n+\n+      HikariConfig config \u003d new HikariConfig();\n+      config.setMinimumIdle(10);\n+      config.setMaximumPoolSize(10);\n+      config.setInitializationFailFast(false);\n+      config.setConnectionTestQuery(\"VALUES 1\");\n+      config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+      HikariDataSource ds \u003d new HikariDataSource(config);\n+      HikariPool pool \u003d TestElf.getPool(ds);\n+\n+      PoolUtilities.quietlySleep(300);\n+\n+      Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003e 0);\n+\n+      ds.close();\n+\n+      Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n+      Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n+      Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n+   }\n+\n+   @Test\n+   public void testShutdown3() throws SQLException\n+   {\n+      Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n+\n+      StubConnection.slowCreate \u003d true;\n+\n+      HikariConfig config \u003d new HikariConfig();\n+      config.setMinimumIdle(5);\n+      config.setMaximumPoolSize(5);\n+      config.setInitializationFailFast(true);\n+      config.setConnectionTestQuery(\"VALUES 1\");\n+      config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+      HikariDataSource ds \u003d new HikariDataSource(config);\n+      HikariPool pool \u003d TestElf.getPool(ds);\n+\n+      PoolUtilities.quietlySleep(300);\n+\n+      Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003d\u003d 5);\n+\n+      ds.close();\n+\n+      Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n+      Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n+      Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n+   }\n+\n+   @Test\n+   public void testShutdown4() throws SQLException\n+   {\n+      StubConnection.slowCreate \u003d true;\n+\n+      HikariConfig config \u003d new HikariConfig();\n+      config.setMinimumIdle(10);\n+      config.setMaximumPoolSize(10);\n+      config.setInitializationFailFast(false);\n+      config.setConnectionTestQuery(\"VALUES 1\");\n+      config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+      HikariDataSource ds \u003d new HikariDataSource(config);\n+\n+      PoolUtilities.quietlySleep(300);\n+\n+      ds.close();\n+\n+      long start \u003d System.currentTimeMillis();\n+      while (PoolUtilities.elapsedTimeMs(start) \u003c TimeUnit.SECONDS.toMillis(5) \u0026\u0026 threadCount() \u003e 0) {\n+         PoolUtilities.quietlySleep(250);\n+      }\n+\n+      Assert.assertSame(\"Thread was leaked\", 0, threadCount());\n+   }\n+\n+   @Test\n+   public void testShutdown5() throws SQLException\n+   {\n+      Assert.assertSame(\"StubConnection count not as expected\", 0, StubConnection.count.get());\n+\n+      StubConnection.slowCreate \u003d false;\n+\n+      HikariConfig config \u003d new HikariConfig();\n+      config.setMinimumIdle(5);\n+      config.setMaximumPoolSize(5);\n+      config.setInitializationFailFast(true);\n+      config.setConnectionTestQuery(\"VALUES 1\");\n+      config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+      HikariDataSource ds \u003d new HikariDataSource(config);\n+      HikariPool pool \u003d TestElf.getPool(ds);\n+\n+      Connection[] connections \u003d new Connection[5];\n+      for (int i \u003d 0; i \u003c 5; i++) {\n+         connections[i] \u003d ds.getConnection();\n+      }\n+\n+      Assert.assertTrue(\"Totals connection count not as expected, \", pool.getTotalConnections() \u003d\u003d 5);\n+\n+      ds.close();\n+\n+      Assert.assertSame(\"Active connection count not as expected, \", 0, pool.getActiveConnections());\n+      Assert.assertSame(\"Idle connection count not as expected, \", 0, pool.getIdleConnections());\n+      Assert.assertSame(\"Total connection count not as expected\", 0, pool.getTotalConnections());\n+   }\n+\n+   private int threadCount()\n+   {\n+      Thread[] threads \u003d new Thread[Thread.activeCount() * 2];\n+      Thread.enumerate(threads);\n+\n+      int count \u003d 0;\n+      for (Thread thread : threads) {\n+         count +\u003d (thread !\u003d null \u0026\u0026 thread.getName().startsWith(\"Hikari\")) ? 1 : 0;\n+      }\n+\n+      return count;\n+   }\n }"
        },
        {
          "file_name": "hikaricp/src/test/java/com/zaxxer/hikari/mocks/StubConnection.java",
          "patch": "@@ -402,6 +402,7 @@ public String getSchema() throws SQLException\n     /** {@inheritDoc} */\n     public void abort(Executor executor) throws SQLException\n     {\n+       throw new SQLException(\"Intentianal exception during abort\");\n     }\n \n     /** {@inheritDoc} */"
        }
      ]
    }
  },
  {
    "name": "Fix closestGroup race condition in RemoteResourceIndex",
    "url": "https://github.com/iipc/openwayback/pull/239",
    "description": "Pull request #194 introduced a closestGroup field in RemoteResourceIndex. However the group object is request-specific and so the values should not be shared between multiple threads.  The resulting race condition frequently causes intermittent 404 errors preventing resources from loading with this message logged:\n\n```\nApr 19, 2015 10:52:03 PM org.archive.wayback.webapp.AccessPoint handleReplay\nWARNING: (1)LOADFAIL: Self-Redirect: No Closest Match Found /20140309082106/http://catalogue.nla.gov.au/js/barcode.js?1225315091\nApr 19, 2015 10:52:03 PM org.archive.wayback.webapp.AccessPoint logError\nWARNING: Runtime Error org.archive.wayback.exception.ResourceNotAvailableException: Self-Redirect: No Closest Match Found\n```\n\nThis change replaces the closestGroup field with a local variable thus ensuring it cannot be overwritten by other threads.\n",
    "keywords": [
      "wayback",
      "org",
      "archive",
      "closestgroup"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/iipc/openwayback/commit/c343bfeeed3811e6da6dab1949795fca4488f475",
      "files": [
        {
          "file_name": "wayback-core/src/main/java/org/archive/wayback/resourceindex/RemoteResourceIndex.java",
          "patch": "@@ -75,8 +75,6 @@\n \t\n \tprivate DocumentBuilderFactory factory \u003d DocumentBuilderFactory.newInstance();\n \n-    private ClosestTrackingCaptureFilterGroup closestGroup;\n-\n \tprivate static final String WB_XML_REQUEST_TAGNAME \u003d \"request\";\n \n \n@@ -127,9 +125,9 @@ public SearchResults query(WaybackRequest wbRequest)\n \t\tResourceNotInArchiveException, BadQueryException,\n \t\tAccessControlException {\n //\t\tthrow new ResourceIndexNotAvailableException(\"oops\");\n-        closestGroup \u003d new ClosestTrackingCaptureFilterGroup(wbRequest, canonicalizer);\n+\t\tClosestTrackingCaptureFilterGroup closestGroup \u003d new ClosestTrackingCaptureFilterGroup(wbRequest, canonicalizer);\n \t\tSearchResults results \u003d urlToSearchResults(getRequestUrl(wbRequest),\n-\t\t\t\tgetSearchResultFilters(wbRequest));\n+\t\t\t\tgetSearchResultFilters(wbRequest, closestGroup));\n         closestGroup.annotateResults(results);\n         return results;\n \t}\n@@ -206,7 +204,7 @@ private String getNodeTextValue(Node n) {\n \t}\n \t\n \tprotected ObjectFilter\u003cCaptureSearchResult\u003e getSearchResultFilters(\n-\t\t\tWaybackRequest wbRequest) {\n+\t\t\tWaybackRequest wbRequest, ClosestTrackingCaptureFilterGroup closestGroup) {\n \t\tObjectFilterChain\u003cCaptureSearchResult\u003e filters \u003d null;\n \t\tif (wbRequest.isReplayRequest()) {\n \t\t\tfilters \u003d new ObjectFilterChain\u003cCaptureSearchResult\u003e();"
        }
      ]
    }
  },
  {
    "name": "Away presence race condition",
    "url": "https://github.com/kontalk/androidclient/issues/787",
    "description": "In certain situations, the initial presence is sent with show\u003daway and never becomes fully available, even after opening the chat window. This is probably due to the recently introduced `mFirstStart`.\r\n\r\n---\r\n\r\nFound cause: when the message center restarts and reference counting is zero (e.g. out of the app), show\u003daway is sent at login while the state is still \"active\". This will be rectified after an inactive/active cycle, but until then the information sent is wrong. Although it should also be fixed when HOLDing to the message center, however because state is active, no available presence will be sent.\r\n",
    "keywords": [
      "presence",
      "sent"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/kontalk/androidclient/commit/e5e262b17c2d6b25cb71b9543a148a19a7399028",
      "files": [
        {
          "file_name": "app/src/main/java/org/kontalk/service/msgcenter/MessageCenterService.java",
          "patch": "@@ -343,7 +343,7 @@\n     /** Server push sender id. This is static so the {@link IPushListener} can see it. */\n     static String sPushSenderId;\n     /** Push registration id. */\n-    private String mPushRegistrationId;\n+    String mPushRegistrationId;\n     /** Flag marking a currently ongoing push registration cycle (unregister/register) */\n     boolean mPushRegistrationCycle;\n \n@@ -358,7 +358,7 @@\n     /** Cached last used server. */\n     EndpointServer mServer;\n     /** The connection helper instance. */\n-    private XMPPConnectionHelper mHelper;\n+    XMPPConnectionHelper mHelper;\n     /** The connection instance. */\n     KontalkConnection mConnection;\n     /** My username (account name). */\n@@ -404,9 +404,9 @@\n         private final static int INACTIVE_TIME \u003d 30000;\n \n         /** A reference to the message center. */\n-        private WeakReference\u003cMessageCenterService\u003e s;\n+        WeakReference\u003cMessageCenterService\u003e s;\n         /** Reference counter. */\n-        private int mRefCount;\n+        int mRefCount;\n \n         public IdleConnectionHandler(MessageCenterService service, int refCount, Looper looper) {\n             super(looper);\n@@ -547,7 +547,7 @@ public void quit() {\n         }\n \n         /** Aborts any idle message because we are using the service or quitting. */\n-        private void abortIdle() {\n+        void abortIdle() {\n             Looper.myQueue().removeIdleHandler(IdleConnectionHandler.this);\n             removeMessages(MSG_IDLE);\n             removeMessages(MSG_INACTIVE);\n@@ -556,11 +556,12 @@ private void abortIdle() {\n                 service.cancelIdleAlarm();\n         }\n \n-        public void queueInactiveIfNeeded() {\n+        public void forceInactiveIfNeeded() {\n             post(new Runnable() {\n                 public void run() {\n-                    if (mRefCount \u003c\u003d 0 \u0026\u0026 !hasMessages(MSG_INACTIVE)) {\n-                        queueInactive();\n+                    MessageCenterService service \u003d s.get();\n+                    if (service !\u003d null \u0026\u0026 mRefCount \u003c\u003d 0 \u0026\u0026 !service.isInactive()) {\n+                        forceInactive();\n                     }\n                 }\n             });\n@@ -574,7 +575,7 @@ public void forceInactive() {\n             }\n         }\n \n-        private void queueInactive() {\n+        void queueInactive() {\n             // send inactive state message only if connected\n             MessageCenterService service \u003d s.get();\n             if (service !\u003d null \u0026\u0026 service.isConnected()) {\n@@ -1523,8 +1524,8 @@ public void authenticated(XMPPConnection connection, boolean resumed) {\n         // we can now release any pending push notification\n         Preferences.setLastPushNotification(this, -1);\n \n-        // queue inactive message if needed\n-        mIdleHandler.queueInactiveIfNeeded();\n+        // force inactive state if needed\n+        mIdleHandler.forceInactiveIfNeeded();\n \n         // update alarm manager\n         AndroidAdaptiveServerPingManager\n@@ -1582,7 +1583,7 @@ private void discovery() {\n         sendPacket(items);\n     }\n \n-    private synchronized void active(boolean available) {\n+    synchronized void active(boolean available) {\n         final XMPPConnection connection \u003d mConnection;\n         if (connection !\u003d null) {\n             cancelIdleAlarm();\n@@ -1606,7 +1607,7 @@ private synchronized void active(boolean available) {\n         }\n     }\n \n-    private synchronized void inactive() {\n+    synchronized void inactive() {\n         final XMPPConnection connection \u003d mConnection;\n         if (connection !\u003d null) {\n             if (!mInactive) {\n@@ -1628,11 +1629,11 @@ private synchronized void inactive() {\n         }\n     }\n \n-    private boolean isInactive() {\n+    boolean isInactive() {\n         return mInactive;\n     }\n \n-    private boolean fastReply() {\n+    boolean fastReply() {\n         if (!isConnected()) return false;\n \n         try {\n@@ -1644,7 +1645,7 @@ private boolean fastReply() {\n         }\n     }\n \n-    private long getLastReceivedStanza() {\n+    long getLastReceivedStanza() {\n         return mConnection !\u003d null ? mConnection.getLastStanzaReceived() : 0;\n     }\n \n@@ -3101,7 +3102,7 @@ public static String getPushSenderId() {\n         return sPushSenderId;\n     }\n \n-    private void setWakeupAlarm() {\n+    void setWakeupAlarm() {\n         long delay \u003d Preferences.getWakeupTimeMillis(this,\n             MIN_WAKEUP_TIME);\n \n@@ -3127,7 +3128,7 @@ private void ensureIdleAlarm() {\n         }\n     }\n \n-    private void cancelIdleAlarm() {\n+    void cancelIdleAlarm() {\n         ensureIdleAlarm();\n         mAlarmManager.cancel(mIdleIntent);\n     }"
        }
      ]
    }
  },
  {
    "name": "Race condition",
    "url": "https://github.com/torakiki/event-studio/issues/1",
    "description": "There\u0027s a race condition that can lead to an infinite loop if a thread removes all the registered listeners on a station for a given class while another thread is polling the undelivered event queue. In this case events are polled and offered infinitely.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/torakiki/event-studio/commit/860d6e88d3b942faee6cfd32a88809e95b8f639d",
      "files": [
        {
          "file_name": "src/main/java/org/sejda/eventstudio/Station.java",
          "patch": "@@ -69,14 +69,15 @@\n     }\n \n     public void broadcast(Object event) {\n+        LOG.debug(\"{}: Broadcasting {}\", this, event);\n         requireNotNull(event);\n         LOG.trace(\"{}: Supervisor {} about to inspect\", this, supervisor);\n         supervisor.inspect(event);\n         LOG.trace(\"{}: Listeners about to listen\", this);\n         doBroadcast(event);\n     }\n \n-    private void doBroadcast(Object event) {\n+    private boolean doBroadcast(Object event) {\n         List\u003cListenerReferenceHolder\u003e eventListeners \u003d listeners.nullSafeGetListeners(event.getClass());\n         Envelope enveloped \u003d new Envelope(event);\n         for (ListenerReferenceHolder holder : eventListeners) {\n@@ -85,7 +86,7 @@ private void doBroadcast(Object event) {\n                 LOG.trace(\"{}: Notifing event {} to {}\", this, event, listener);\n                 listener.onEvent(enveloped);\n             } else {\n-                LOG.trace(\"{}: Removing garbage collected listener from the station\", this);\n+                LOG.debug(\"{}: Removing garbage collected listener from the station\", this);\n                 listeners.remove(event.getClass(), holder);\n             }\n         }\n@@ -96,6 +97,7 @@ private void doBroadcast(Object event) {\n                 LOG.warn(\"{}: Unable to store unlistened event, it\u0027s going to be lost {}\", this, event);\n             }\n         }\n+        return enveloped.isNotified();\n     }\n \n     \u003cT\u003e void add(Listener\u003cT\u003e listener, int priority, ReferenceStrength strength) {\n@@ -111,14 +113,14 @@ private void doBroadcast(Object event) {\n     \u003cT\u003e void add(Class\u003cT\u003e eventClass, Listener\u003cT\u003e listener, int priority, ReferenceStrength strength) {\n         requireNotNull(eventClass);\n         requireNotNull(listener);\n-        LOG.trace(\"{}: Adding listener {} [priority\u003d{} strength\u003d{}]\", this, listener, priority, strength);\n+        LOG.debug(\"{}: Adding listener {} [priority\u003d{} strength\u003d{}]\", this, listener, priority, strength);\n         listeners.add(eventClass, listener, priority, strength);\n         broadcastEnqueuedEventsFor(eventClass);\n     }\n \n     void addAll(Object bean, List\u003cReflectiveListenerDescriptor\u003e descriptors) {\n         requireNotNull(descriptors);\n-        LOG.trace(\"{}: Adding {} reflective listeners for {}\", this, descriptors.size(), bean);\n+        LOG.debug(\"{}: Adding {} reflective listeners for {}\", this, descriptors.size(), bean);\n         Set\u003cClass\u003c?\u003e\u003e updatedEventClasses \u003d listeners.addAll(bean, descriptors);\n         for (Class\u003c?\u003e updatedClass : updatedEventClasses) {\n             broadcastEnqueuedEventsFor(updatedClass);\n@@ -128,9 +130,10 @@ void addAll(Object bean, List\u003cReflectiveListenerDescriptor\u003e descriptors) {\n     private void broadcastEnqueuedEventsFor(Class\u003c?\u003e updatedClass) {\n         BlockingQueue\u003cObject\u003e queue \u003d getQueue(updatedClass);\n         Object event \u003d null;\n-        while ((event \u003d queue.poll()) !\u003d null) {\n+        boolean keepBroadcasting \u003d true;\n+        while (keepBroadcasting \u0026\u0026 (event \u003d queue.poll()) !\u003d null) {\n             LOG.debug(\"{}: Found enqueued event {}, now broadcasting it.\", this, event);\n-            doBroadcast(event);\n+            keepBroadcasting \u003d doBroadcast(event);\n         }\n     }\n \n@@ -147,6 +150,7 @@ private void broadcastEnqueuedEventsFor(Class\u003c?\u003e updatedClass) {\n     \u003cT\u003e boolean remove(Class\u003cT\u003e eventClass, Listener\u003cT\u003e listener) {\n         requireNotNull(eventClass);\n         requireNotNull(listener);\n+        LOG.debug(\"{}: Removing listener {} [eventClass\u003d{}]\", this, listener, eventClass);\n         return listeners.remove(eventClass, listener);\n     }\n "
        },
        {
          "file_name": "src/test/java/org/sejda/eventstudio/shakedown/AnnotatedTestListener.java",
          "patch": "@@ -0,0 +1,40 @@\n+/* \n+ * This file is part of the EventStudio source code\n+ * Created on 20/nov/2013\n+ * Copyright 2013 by Andrea Vacondio (andrea.vacondio@gmail.com).\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); \n+ * you may not use this file except in compliance with the License. \n+ * You may obtain a copy of the License at \n+ * \n+ * http://www.apache.org/licenses/LICENSE-2.0 \n+ * \n+ * Unless required by applicable law or agreed to in writing, software \n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \n+ * See the License for the specific language governing permissions and \n+ * limitations under the License. \n+ */\n+package org.sejda.eventstudio.shakedown;\n+\n+import java.util.Random;\n+\n+import org.sejda.eventstudio.ReferenceStrength;\n+import org.sejda.eventstudio.annotation.EventListener;\n+\n+/**\n+ * @author Andrea Vacondio\n+ * \n+ */\n+public class AnnotatedTestListener {\n+\n+    @EventListener(priority \u003d 1)\n+    public void first(AnotherMyEvent event) {\n+        System.out.println(new Random().nextInt());\n+    }\n+\n+    @EventListener(priority \u003d 2, strength \u003d ReferenceStrength.WEAK)\n+    public void second(MyEvent event) {\n+        System.out.println(new Random().nextInt());\n+    }\n+}"
        },
        {
          "file_name": "src/test/java/org/sejda/eventstudio/shakedown/AnotherAnnotatedListener.java",
          "patch": "@@ -0,0 +1,43 @@\n+/* \n+ * This file is part of the EventStudio source code\n+ * Created on 20/nov/2013\n+ * Copyright 2013 by Andrea Vacondio (andrea.vacondio@gmail.com).\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); \n+ * you may not use this file except in compliance with the License. \n+ * You may obtain a copy of the License at \n+ * \n+ * http://www.apache.org/licenses/LICENSE-2.0 \n+ * \n+ * Unless required by applicable law or agreed to in writing, software \n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \n+ * See the License for the specific language governing permissions and \n+ * limitations under the License. \n+ */\n+package org.sejda.eventstudio.shakedown;\n+\n+import java.util.Random;\n+\n+import org.sejda.eventstudio.ReferenceStrength;\n+import org.sejda.eventstudio.annotation.EventListener;\n+import org.sejda.eventstudio.annotation.EventStation;\n+\n+/**\n+ * @author Andrea Vacondio\n+ *\n+ */\n+public class AnotherAnnotatedListener {\n+    @EventStation\n+    private static final String STATION \u003d \"station\";\n+\n+    @EventListener\n+    public void listener(MyEvent event) {\n+        System.out.println(new Random().nextInt());\n+    }\n+\n+    @EventListener(station \u003d \"anotherStation\", priority \u003d 2, strength \u003d ReferenceStrength.SOFT)\n+    public void anotherListener(OtherMyEvent event) {\n+        System.out.println(new Random().nextInt());\n+    }\n+}"
        },
        {
          "file_name": "src/test/java/org/sejda/eventstudio/shakedown/AnotherMyEvent.java",
          "patch": "@@ -0,0 +1,26 @@\n+/* \n+ * This file is part of the EventStudio source code\n+ * Created on 20/nov/2013\n+ * Copyright 2013 by Andrea Vacondio (andrea.vacondio@gmail.com).\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); \n+ * you may not use this file except in compliance with the License. \n+ * You may obtain a copy of the License at \n+ * \n+ * http://www.apache.org/licenses/LICENSE-2.0 \n+ * \n+ * Unless required by applicable law or agreed to in writing, software \n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \n+ * See the License for the specific language governing permissions and \n+ * limitations under the License. \n+ */\n+package org.sejda.eventstudio.shakedown;\n+\n+/**\n+ * @author Andrea Vacondio\n+ *\n+ */\n+public class AnotherMyEvent extends MyEvent {\n+\n+}"
        },
        {
          "file_name": "src/test/java/org/sejda/eventstudio/shakedown/MyEvent.java",
          "patch": "@@ -0,0 +1,26 @@\n+/* \n+ * This file is part of the EventStudio source code\n+ * Created on 20/nov/2013\n+ * Copyright 2013 by Andrea Vacondio (andrea.vacondio@gmail.com).\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); \n+ * you may not use this file except in compliance with the License. \n+ * You may obtain a copy of the License at \n+ * \n+ * http://www.apache.org/licenses/LICENSE-2.0 \n+ * \n+ * Unless required by applicable law or agreed to in writing, software \n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \n+ * See the License for the specific language governing permissions and \n+ * limitations under the License. \n+ */\n+package org.sejda.eventstudio.shakedown;\n+\n+/**\n+ * @author Andrea Vacondio\n+ *\n+ */\n+public class MyEvent {\n+\n+}"
        },
        {
          "file_name": "src/test/java/org/sejda/eventstudio/shakedown/OtherMyEvent.java",
          "patch": "@@ -0,0 +1,26 @@\n+/* \n+ * This file is part of the EventStudio source code\n+ * Created on 20/nov/2013\n+ * Copyright 2013 by Andrea Vacondio (andrea.vacondio@gmail.com).\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); \n+ * you may not use this file except in compliance with the License. \n+ * You may obtain a copy of the License at \n+ * \n+ * http://www.apache.org/licenses/LICENSE-2.0 \n+ * \n+ * Unless required by applicable law or agreed to in writing, software \n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \n+ * See the License for the specific language governing permissions and \n+ * limitations under the License. \n+ */\n+package org.sejda.eventstudio.shakedown;\n+\n+/**\n+ * @author Andrea Vacondio\n+ *\n+ */\n+public class OtherMyEvent extends MyEvent {\n+\n+}"
        },
        {
          "file_name": "src/test/java/org/sejda/eventstudio/shakedown/ShakedownTest.java",
          "patch": "@@ -0,0 +1,138 @@\n+/* \n+ * This file is part of the EventStudio source code\n+ * Created on 20/nov/2013\n+ * Copyright 2013 by Andrea Vacondio (andrea.vacondio@gmail.com).\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); \n+ * you may not use this file except in compliance with the License. \n+ * You may obtain a copy of the License at \n+ * \n+ * http://www.apache.org/licenses/LICENSE-2.0 \n+ * \n+ * Unless required by applicable law or agreed to in writing, software \n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \n+ * See the License for the specific language governing permissions and \n+ * limitations under the License. \n+ */\n+package org.sejda.eventstudio.shakedown;\n+\n+import static org.sejda.eventstudio.StaticStudio.eventStudio;\n+\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Random;\n+import java.util.Set;\n+import java.util.concurrent.Callable;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.sejda.eventstudio.DefaultEventStudio;\n+import org.sejda.eventstudio.ReferenceStrength;\n+\n+/**\n+ * @author Andrea Vacondio\n+ * \n+ */\n+public class ShakedownTest {\n+\n+    private ExecutorService executor \u003d Executors.newFixedThreadPool(10);\n+    private List\u003cString\u003e stations \u003d new ArrayList\u003cString\u003e();\n+    private Set\u003cCallable\u003cVoid\u003e\u003e tasks \u003d new HashSet\u003cCallable\u003cVoid\u003e\u003e();\n+\n+    @Before\n+    public void setUp() {\n+        stations.add(\"station\");\n+        stations.add(\"anotherStation\");\n+        stations.add(DefaultEventStudio.HIDDEN_STATION);\n+        TestListener listener \u003d new TestListener();\n+        for (int i \u003d 0; i \u003c 2000; i++) {\n+            tasks.add(new BroadcastTask(new MyEvent()));\n+            tasks.add(new BroadcastTask(new AnotherMyEvent()));\n+            tasks.add(new BroadcastTask(new OtherMyEvent()));\n+        }\n+        for (int i \u003d 0; i \u003c 200; i++) {\n+            tasks.add(new RemoveTask(listener));\n+            tasks.add(new AddTask(listener));\n+            tasks.add(new AddAnnotatedTask(new AnnotatedTestListener()));\n+            tasks.add(new AddAnnotatedTask(new AnotherAnnotatedListener()));\n+            tasks.add(new ClearTask());\n+        }\n+    }\n+\n+    @After\n+    public void tearDown() throws InterruptedException {\n+        executor.shutdown();\n+        executor.awaitTermination(5, TimeUnit.MINUTES);\n+    }\n+\n+    @Test\n+    public void shakedown() throws InterruptedException {\n+        executor.invokeAll(tasks);\n+    }\n+\n+    private class RemoveTask implements Callable\u003cVoid\u003e {\n+        private TestListener listener;\n+\n+        public RemoveTask(TestListener listener) {\n+            this.listener \u003d listener;\n+        }\n+\n+        public Void call() {\n+            eventStudio().remove(listener, stations.get(new Random().nextInt(3)));\n+            return null;\n+        }\n+    }\n+\n+    private class AddTask implements Callable\u003cVoid\u003e {\n+        private TestListener listener;\n+\n+        public AddTask(TestListener listener) {\n+            this.listener \u003d listener;\n+        }\n+\n+        public Void call() {\n+            Random rand \u003d new Random();\n+            eventStudio().add(listener, stations.get(rand.nextInt(3)), rand.nextInt(1000), ReferenceStrength.STRONG);\n+            return null;\n+        }\n+    }\n+\n+    private class AddAnnotatedTask implements Callable\u003cVoid\u003e {\n+        private Object bean;\n+\n+        public AddAnnotatedTask(Object bean) {\n+            this.bean \u003d bean;\n+        }\n+\n+        public Void call() {\n+            eventStudio().addAnnotatedListeners(bean);\n+            return null;\n+        }\n+    }\n+\n+    private class BroadcastTask implements Callable\u003cVoid\u003e {\n+        private MyEvent event;\n+\n+        public BroadcastTask(MyEvent event) {\n+            this.event \u003d event;\n+        }\n+\n+        public Void call() {\n+            eventStudio().broadcast(this.event, stations.get(new Random().nextInt(3)));\n+            return null;\n+        }\n+    }\n+\n+    private class ClearTask implements Callable\u003cVoid\u003e {\n+        public Void call() {\n+            eventStudio().clear(stations.get(new Random().nextInt(3)));\n+            return null;\n+        }\n+    }\n+}"
        },
        {
          "file_name": "src/test/java/org/sejda/eventstudio/shakedown/TestListener.java",
          "patch": "@@ -0,0 +1,35 @@\n+/* \n+ * This file is part of the EventStudio source code\n+ * Created on 20/nov/2013\n+ * Copyright 2013 by Andrea Vacondio (andrea.vacondio@gmail.com).\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); \n+ * you may not use this file except in compliance with the License. \n+ * You may obtain a copy of the License at \n+ * \n+ * http://www.apache.org/licenses/LICENSE-2.0 \n+ * \n+ * Unless required by applicable law or agreed to in writing, software \n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \n+ * See the License for the specific language governing permissions and \n+ * limitations under the License. \n+ */\n+package org.sejda.eventstudio.shakedown;\n+\n+import java.util.Random;\n+\n+import org.sejda.eventstudio.Listener;\n+\n+/**\n+ * @author Andrea Vacondio\n+ *\n+ */\n+public class TestListener implements Listener\u003cMyEvent\u003e {\n+\n+    private Random rand \u003d new Random();\n+    public void onEvent(MyEvent event) {\n+        System.out.println(rand.nextInt());\n+    }\n+\n+}"
        },
        {
          "file_name": "src/test/resources/logback-test.xml",
          "patch": "@@ -7,9 +7,9 @@\n \t\t\u003c/encoder\u003e\n \t\u003c/appender\u003e\n \n-\t\u003clogger name\u003d\"org.eventstudio\" level\u003d\"TRACE\" /\u003e\n+\t\u003clogger name\u003d\"org.sejda.eventstudio\" level\u003d\"DEBUG\" /\u003e\n \n-\t\u003croot level\u003d\"WARN\"\u003e\n+\t\u003croot level\u003d\"DEBUG\"\u003e\n \t\t\u003cappender-ref ref\u003d\"STDOUT\" /\u003e\n \t\u003c/root\u003e\n \u003c/configuration\u003e\n\\ No newline at end of file"
        }
      ]
    }
  },
  {
    "name": "Dependency cycle or instantiation race condition if user defines @Bean TokenStore",
    "url": "https://github.com/spring-projects/spring-security-oauth/issues/338",
    "description": "The `AuthorizationServerConfiguration`  exposes a\n`TokenStore` as a `@Bean`, mainly as a convenience for a\n`ResourceServerConfiguration` that happens to be in the same context.\nThe problem is that there\u0027s a potential cycle if the user defines\ntheir own `@Bean TokenStore`, and uses it to configure a\nResource Server, when that also happens to be part of an Authorization\nServer.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/spring-projects/spring-security-oauth/commit/b86edc8c73b6391087c77e0053ff520868910d5f",
      "files": [
        {
          "file_name": "spring-security-oauth2/src/main/java/org/springframework/security/oauth2/config/annotation/web/configuration/AuthorizationServerEndpointsConfiguration.java",
          "patch": "@@ -45,7 +45,6 @@\n import org.springframework.security.oauth2.provider.endpoint.WhitelabelErrorEndpoint;\n import org.springframework.security.oauth2.provider.token.AuthorizationServerTokenServices;\n import org.springframework.security.oauth2.provider.token.ConsumerTokenServices;\n-import org.springframework.security.oauth2.provider.token.TokenStore;\n import org.springframework.security.oauth2.provider.token.store.JwtAccessTokenConverter;\n \n /**\n@@ -80,7 +79,7 @@ public void init() {\n \t@Bean\n \tpublic AuthorizationEndpoint authorizationEndpoint() throws Exception {\n \t\tAuthorizationEndpoint authorizationEndpoint \u003d new AuthorizationEndpoint();\n-\t\tFrameworkEndpointHandlerMapping mapping \u003d getEndpoints().getFrameworkEndpointHandlerMapping();\n+\t\tFrameworkEndpointHandlerMapping mapping \u003d getEndpointsConfigurer().getFrameworkEndpointHandlerMapping();\n \t\tauthorizationEndpoint.setUserApprovalPage(extractPath(mapping, \"/oauth/confirm_access\"));\n \t\tauthorizationEndpoint.setErrorPage(extractPath(mapping, \"/oauth/error\"));\n \t\tauthorizationEndpoint.setTokenGranter(tokenGranter());\n@@ -104,8 +103,8 @@ public TokenEndpoint tokenEndpoint() throws Exception {\n \n \t@Bean\n \tpublic CheckTokenEndpoint checkTokenEndpoint() {\n-\t\tCheckTokenEndpoint endpoint \u003d new CheckTokenEndpoint(getEndpoints().getResourceServerTokenServices());\n-\t\tendpoint.setAccessTokenConverter(getEndpoints().getAccessTokenConverter());\n+\t\tCheckTokenEndpoint endpoint \u003d new CheckTokenEndpoint(getEndpointsConfigurer().getResourceServerTokenServices());\n+\t\tendpoint.setAccessTokenConverter(getEndpointsConfigurer().getAccessTokenConverter());\n \t\treturn endpoint;\n \t}\n \n@@ -121,12 +120,12 @@ public WhitelabelErrorEndpoint whitelabelErrorEndpoint() {\n \n \t@Bean\n \tpublic FrameworkEndpointHandlerMapping oauth2EndpointHandlerMapping() throws Exception {\n-\t\treturn getEndpoints().getFrameworkEndpointHandlerMapping();\n+\t\treturn getEndpointsConfigurer().getFrameworkEndpointHandlerMapping();\n \t}\n \n \t@Bean\n \tpublic ConsumerTokenServices consumerTokenServices() throws Exception {\n-\t\treturn getEndpoints().getConsumerTokenServices();\n+\t\treturn getEndpointsConfigurer().getConsumerTokenServices();\n \t}\n \n \t/**\n@@ -141,36 +140,31 @@ public AuthorizationServerTokenServices defaultAuthorizationServerTokenServices(\n \t\treturn endpoints.getDefaultAuthorizationServerTokenServices();\n \t}\n \n-\t@Bean\n-\tpublic TokenStore tokenStore() throws Exception {\n-\t\treturn getEndpoints().getTokenStore();\n-\t}\n-\n-\tprivate AuthorizationServerEndpointsConfigurer getEndpoints() {\n+\tpublic AuthorizationServerEndpointsConfigurer getEndpointsConfigurer() {\n \t\tif (!endpoints.isTokenServicesOverride()) {\n \t\t\tendpoints.tokenServices(defaultAuthorizationServerTokenServices());\n \t\t}\n \t\treturn endpoints;\n \t}\n \n \tprivate OAuth2RequestFactory oauth2RequestFactory() throws Exception {\n-\t\treturn getEndpoints().getOAuth2RequestFactory();\n+\t\treturn getEndpointsConfigurer().getOAuth2RequestFactory();\n \t}\n \n \tprivate UserApprovalHandler userApprovalHandler() throws Exception {\n-\t\treturn getEndpoints().getUserApprovalHandler();\n+\t\treturn getEndpointsConfigurer().getUserApprovalHandler();\n \t}\n \n \tprivate OAuth2RequestValidator oauth2RequestValidator() throws Exception {\n-\t\treturn getEndpoints().getOAuth2RequestValidator();\n+\t\treturn getEndpointsConfigurer().getOAuth2RequestValidator();\n \t}\n \n \tprivate AuthorizationCodeServices authorizationCodeServices() throws Exception {\n-\t\treturn getEndpoints().getAuthorizationCodeServices();\n+\t\treturn getEndpointsConfigurer().getAuthorizationCodeServices();\n \t}\n \n \tprivate TokenGranter tokenGranter() throws Exception {\n-\t\treturn getEndpoints().getTokenGranter();\n+\t\treturn getEndpointsConfigurer().getTokenGranter();\n \t}\n \n \tprivate String extractPath(FrameworkEndpointHandlerMapping mapping, String page) {"
        },
        {
          "file_name": "spring-security-oauth2/src/main/java/org/springframework/security/oauth2/config/annotation/web/configuration/ResourceServerConfiguration.java",
          "patch": "@@ -149,10 +149,11 @@ protected void configure(HttpSecurity http) throws Exception {\n \t\tResourceServerTokenServices services \u003d resolveTokenServices();\n \t\tif (services !\u003d null) {\n \t\t\tresources.tokenServices(services);\n-\t\t}\n-\t\telse {\n+\t\t} else {\n \t\t\tif (tokenStore !\u003d null) {\n \t\t\t\tresources.tokenStore(tokenStore);\n+\t\t\t} else if (endpoints!\u003dnull) {\n+\t\t\t\tresources.tokenStore(endpoints.getEndpointsConfigurer().getTokenStore());\n \t\t\t}\n \t\t}\n \t\tfor (ResourceServerConfigurer configurer : configurers) {"
        },
        {
          "file_name": "spring-security-oauth2/src/test/java/org/springframework/security/oauth2/config/annotation/ResourceServerConfigurationTests.java",
          "patch": "@@ -12,6 +12,8 @@\n  */\n package org.springframework.security.oauth2.config.annotation;\n \n+import java.util.Collections;\n+\n import javax.servlet.Filter;\n import javax.servlet.http.HttpServletRequest;\n \n@@ -80,6 +82,8 @@ public void testDefaults() throws Exception {\n \t\t\t\t.addFilters(new DelegatingFilterProxy(context.getBean(\"springSecurityFilterChain\", Filter.class)))\n \t\t\t\t.build();\n \t\tmvc.perform(MockMvcRequestBuilders.get(\"/\")).andExpect(MockMvcResultMatchers.status().isUnauthorized());\n+\t\tmvc.perform(MockMvcRequestBuilders.get(\"/\").header(\"Authorization\", \"Bearer FOO\")).andExpect(\n+\t\t\t\tMockMvcResultMatchers.status().isNotFound());\n \t\tcontext.close();\n \t}\n \n@@ -94,6 +98,8 @@ public void testCustomTokenServices() throws Exception {\n \t\t\t\t.addFilters(new DelegatingFilterProxy(context.getBean(\"springSecurityFilterChain\", Filter.class)))\n \t\t\t\t.build();\n \t\tmvc.perform(MockMvcRequestBuilders.get(\"/\")).andExpect(MockMvcResultMatchers.status().isUnauthorized());\n+\t\tmvc.perform(MockMvcRequestBuilders.get(\"/\").header(\"Authorization\", \"Bearer FOO\")).andExpect(\n+\t\t\t\tMockMvcResultMatchers.status().isNotFound());\n \t\tcontext.close();\n \t}\n \n@@ -146,7 +152,7 @@ public TokenStore tokenStore() {\n \t\tpublic void configure(HttpSecurity http) throws Exception {\n \t\t\thttp.authorizeRequests().anyRequest().authenticated();\n \t\t}\n-\t\t\n+\n \t\t@Override\n \t\tpublic void configure(ResourceServerSecurityConfigurer resources) throws Exception {\n \t\t\tresources.authenticationEntryPoint(authenticationEntryPoint());\n@@ -170,7 +176,7 @@ public void configure(ResourceServerSecurityConfigurer resources) throws Excepti\n \t\t\t\tpublic Authentication extract(HttpServletRequest request) {\n \t\t\t\t\treturn new PreAuthenticatedAuthenticationToken(\"FOO\", \"N/A\");\n \t\t\t\t}\n-\t\t\t});\n+\t\t\t}).tokenStore(tokenStore());\n \t\t}\n \n \t\t@Override\n@@ -191,7 +197,10 @@ public TokenStore tokenStore() {\n \n \t\t@Bean\n \t\tprotected ClientDetailsService clientDetailsService() {\n-\t\t\treturn new InMemoryClientDetailsService();\n+\t\t\tInMemoryClientDetailsService service \u003d new InMemoryClientDetailsService();\n+\t\t\tservice.setClientDetailsStore(Collections.singletonMap(\"client\", new BaseClientDetails(\"client\", null,\n+\t\t\t\t\tnull, null, null)));\n+\t\t\treturn service;\n \t\t}\n \n \t\t@Bean"
        },
        {
          "file_name": "tests/annotation/jwt/src/test/java/demo/ApplicationTests.java",
          "patch": "@@ -5,12 +5,14 @@\n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Qualifier;\n import org.springframework.boot.test.IntegrationTest;\n import org.springframework.boot.test.SpringApplicationConfiguration;\n-import org.springframework.security.oauth2.provider.token.TokenStore;\n+import org.springframework.security.oauth2.provider.token.DefaultTokenServices;\n import org.springframework.security.oauth2.provider.token.store.JwtTokenStore;\n import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\n import org.springframework.test.context.web.WebAppConfiguration;\n+import org.springframework.test.util.ReflectionTestUtils;\n \n @RunWith(SpringJUnit4ClassRunner.class)\n @SpringApplicationConfiguration(classes \u003d Application.class)\n@@ -19,11 +21,13 @@\n public class ApplicationTests {\n \n \t@Autowired\n-\tprivate TokenStore tokenStore;\n+\t@Qualifier(\"defaultAuthorizationServerTokenServices\")\n+\tprivate DefaultTokenServices tokenServices;\n \n \t@Test\n-\tpublic void contextLoads() {\n-\t\tassertTrue(\"Wrong token store type: \" + tokenStore, tokenStore instanceof JwtTokenStore);\n+\tpublic void tokenStoreIsJwt() {\n+\t\tassertTrue(\"Wrong token store type: \" + tokenServices,\n+\t\t\t\tReflectionTestUtils.getField(tokenServices, \"tokenStore\") instanceof JwtTokenStore);\n \t}\n \n }"
        }
      ]
    }
  },
  {
    "name": "Null pointer (race condition - audio view)",
    "url": "https://github.com/kontalk/androidclient/issues/769",
    "description": "```\njava.lang.NullPointerException\n       at org.kontalk.ui.view.AudioContentView.onClick(AudioContentView.java:143)\n       at android.view.View.performClick(View.java:2533)\n       at android.view.View$PerformClick.run(View.java:9320)\n       at android.os.Handler.handleCallback(Handler.java:587)\n       at android.os.Handler.dispatchMessage(Handler.java:92)\n       at android.os.Looper.loop(Looper.java:150)\n       at android.app.ActivityThread.main(ActivityThread.java:4389)\n       at java.lang.reflect.Method.invokeNative(Method.java)\n       at java.lang.reflect.Method.invoke(Method.java:507)\n       at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:849)\n       at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:607)\n       at dalvik.system.NativeStart.main(NativeStart.java)\n```\n",
    "keywords": [
      "handler",
      "view",
      "java",
      "os",
      "method",
      "android",
      "main",
      "lang",
      "zygoteinit"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/kontalk/androidclient/commit/c9e6e3dd3a13e76bc9c749333ec917437b4ed868",
      "files": [
        {
          "file_name": "app/src/main/java/org/kontalk/ui/view/AudioContentView.java",
          "patch": "@@ -140,7 +140,9 @@ private void setTheme(MessageListItemTheme theme) {\n \n     @Override\n     public void onClick(View v) {\n-        mAudioPlayerControl.buttonClick(new File(mComponent.getLocalUri().getPath()), this, mMessageId);\n+        Uri localUri \u003d mComponent.getLocalUri();\n+        if (localUri !\u003d null)\n+            mAudioPlayerControl.buttonClick(new File(localUri.getPath()), this, mMessageId);\n     }\n \n     @Override"
        }
      ]
    }
  },
  {
    "name": "Fix #39: not even a race condition",
    "url": "https://github.com/okitec/mpmp/pull/61",
    "description": "We simply forgot to remove non-existing players from the list, AFAIK. To deal with it, I added a `remove` method in `Player` that is called when its Client is removed (connection breaks), its Player is replaced by a spectator (ragequits), or when the user resubscribes.\n\nWhereever `new Player()` appears, we need to take care to remove the old instance if there is one. Garbage collection doesn\u0027t work here because there is always reference in `Player.players`.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/okitec/mpmp/commit/2ed54224efd4ba88ea81c21ab39a5b31559a6165",
      "files": [
        {
          "file_name": "mpmp/src/cmds/ClientlistUpdate.java",
          "patch": "@@ -30,6 +30,7 @@ public void exec(String line, Conn conn) {\n \t\t}\n \n \t\td.reset();\n+\t\tPlayer.reset();\n \t\twhile(nclients --\u003e 0) {\n \t\t\tString s;\n \t\t\tString fields[];"
        },
        {
          "file_name": "mpmp/src/controller/Controller.java",
          "patch": "@@ -32,7 +32,7 @@ public Controller(String addr, int port, String mode, String color, String name)\n \t\tFrame frame \u003d new Frame(m);\n \t\tConn conn \u003d new Conn(new Socket(addr, port));\n \n-\t\tPlayer.init();\n+\t\tPlayer.reset();\n \n \t\t((ChatUpdate) Cmd.ChatUpdate.getFn()).addDisplayer(frame.chatDisp);\n \t\t((ClientlistUpdate) Cmd.ClientlistUpdate.getFn()).addDisplayer(frame.playerDisp);"
        },
        {
          "file_name": "mpmp/src/main/Client.java",
          "patch": "@@ -29,6 +29,10 @@ public Client(Socket sock) throws IOException {\n \t * @return false on failure (name already used or nil), true otherwise\n \t */\n \tpublic boolean subscribe(String color, Mode mode, String name) {\n+\t\t/* remove old Player from player list */\n+\t\tif(player !\u003d null)\n+\t\t\tplayer.remove();\n+\n \t\tif(name \u003d\u003d null)\n \t\t\treturn false;\n \n@@ -37,7 +41,7 @@ public boolean subscribe(String color, Mode mode, String name) {\n \t\t\t\treturn false;\n \n \n-\t\tthis.player \u003d new Player(Player.parseColor(color), mode, name);\n+\t\tplayer \u003d new Player(Player.parseColor(color), mode, name);\n \t\treturn true;\n \t}\n \n@@ -68,6 +72,7 @@ public boolean isSubscribed() {\n \t */\n \tpublic void remove() {\n \t\tclients.remove(this);\n+\t\tplayer.remove();\n \t\tlistClients();\n \t}\n \n@@ -96,9 +101,9 @@ public static void broadcast(String s) {\n \t}\n \n \t/**\n-\t * Initialise the client table.\n+\t * Reset the client table.\n \t */\n-\tpublic static void init() {\n+\tpublic static void reset() {\n \t\tclients \u003d new HashSet\u003c\u003e();\n \t}\n \t"
        },
        {
          "file_name": "mpmp/src/main/SrvMain.java",
          "patch": "@@ -1,8 +1,3 @@\n-/*\n- * To change this license header, choose License Headers in Project Properties.\n- * To change this template file, choose Tools | Templates\n- * and open the template in the editor.\n- */\n package main;\n \n import java.io.IOException;\n@@ -12,14 +7,15 @@\n import model.Player;\n \n /**\n+ * Main class of the server.\n  *\n- * @author leander.dreier\n+ * @author Leander, oki\n  */\n public class SrvMain {\n \tpublic static void srvmain(String[] args) {\n \t\tServerSocket listener;\n-\t\tClient.init();\n-\t\tPlayer.init();\n+\t\tClient.reset();\n+\t\tPlayer.reset();\n \n \t\ttry {\n \t\t\tlistener \u003d new ServerSocket(1918);"
        },
        {
          "file_name": "mpmp/src/model/Player.java",
          "patch": "@@ -26,10 +26,9 @@\n \tprivate String name;\n \tprivate Color color;\n \tprivate Mode mode;\n-\n-\t/* only active players */\n \tprivate static HashSet\u003cPlayer\u003e players;\n \n+\t/* only active players */\n \tprivate HashSet\u003cPlot\u003e plots;\n \tprivate HashSet\u003cPlot\u003e hypothecs;\n \tprivate int cash;                         /* actual liquid money */\n@@ -42,8 +41,10 @@ public Player(Color color, Mode mode, String name) {\n \t\tthis.name \u003d name;\n \t\tthis.color \u003d color;\n \t\tthis.mode \u003d mode;\n-\t\t\n-\t\tplayers.add(this);\n+\n+\t\tsynchronized(players) {\n+\t\t\tplayers.add(this);\n+\t\t}\n \t\t\n \t\tif(mode \u003d\u003d Mode.Player) {\n \t\t\tplots \u003d new HashSet\u003c\u003e();\n@@ -68,6 +69,12 @@ public String toString() {\n \t\treturn col + \": \" + mode + \": \" + name;\n \t}\n \n+\tpublic void remove() {\n+\t\tsynchronized(players) {\n+\t\t\tplayers.remove(this);\n+\t\t}\n+\t}\n+\n \t/* GAME LOGIC */\n \n \t/**\n@@ -127,10 +134,12 @@ public void hypothec(Plot p, boolean addhyp) {\n \t}\n \n \t/**\n-\t * Give up and auction everything of value.\n+\t * Give up and auction everything of value and delete from player list.\n \t */\n \tpublic void ragequit() {\n-\t\t// XXX auction all the plots and houses the player had \n+\t\t// XXX auction all the plots and houses the player had\n+\t\t// We\u0027ll be replaced by a fresh spectator Player, so remove ourselves.\n+\t\tremove();\n \t}\n \n \t\n@@ -230,9 +239,10 @@ public void prison(boolean enter) {\n \t/* STATIC */\n \n \t/**\n-\t * Initialise the player table.\n+\t * Reset the player table. Called on start. In the client, this is also called\n+\t * when a clientlist-update comes in.\n \t */\n-\tpublic static void init() {\n+\tpublic static void reset() {\n \t\tplayers \u003d new HashSet\u003c\u003e();\n \t}\n \n@@ -246,7 +256,7 @@ public static Color parseColor(String s) {\n \t\t\treturn Color.BLACK;  // XXX default color - randomise\n \t\t}\n \t}\n-\t\n+\n \tpublic static int numPlayers() {\n \t\treturn players.size();\n \t}"
        }
      ]
    }
  },
  {
    "name": "Avoid race condition in event stream append",
    "url": "https://github.com/CJSCommonPlatform/microservice_framework/pull/360",
    "description": "Fixes #356 by using the maximum version number in the events that have been read instead of getting the version number from the database",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/CJSCommonPlatform/microservice_framework/commit/666db2f0e71c7d9f3b9c13d1db90c0f5a594993d",
      "files": [
        {
          "file_name": "aggregate-snapshot/aggregate-snapshot-service/src/main/java/uk/gov/justice/services/eventsourcing/source/core/SnapshotAwareEnvelopeEventStream.java",
          "patch": "@@ -28,13 +28,6 @@ public void registerAggregates(final Class\u003cT\u003e aggregateClass, final T aggregate)\n     }\n \n     @Override\n-    public long append(final Stream\u003cJsonEnvelope\u003e events) throws EventStreamException {\n-        final long currentVersion \u003d super.append(events);\n-        createAggregateSnapshotsFor(currentVersion);\n-        return currentVersion;\n-    }\n-\n-    @Override\n     public long append(final Stream\u003cJsonEnvelope\u003e events, final Tolerance tolerance) throws EventStreamException {\n         final long currentVersion \u003d super.append(events, tolerance);\n         if (tolerance \u003d\u003d CONSECUTIVE) {"
        },
        {
          "file_name": "aggregate-snapshot/aggregate-snapshot-service/src/test/java/uk/gov/justice/services/core/aggregate/SnapshotAwareAggregateServiceIT.java",
          "patch": "@@ -5,9 +5,10 @@\n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.equalTo;\n import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.notNullValue;\n import static org.hamcrest.Matchers.nullValue;\n-import static uk.gov.justice.services.messaging.DefaultJsonEnvelope.envelope;\n import static uk.gov.justice.services.messaging.JsonObjectMetadata.metadataWithRandomUUID;\n+import static uk.gov.justice.services.test.utils.core.messaging.JsonEnvelopeBuilder.envelope;\n \n import uk.gov.justice.domain.aggregate.Aggregate;\n import uk.gov.justice.domain.aggregate.TestAggregate;\n@@ -42,6 +43,7 @@\n import uk.gov.justice.services.eventsourcing.source.core.EventStreamManager;\n import uk.gov.justice.services.eventsourcing.source.core.SnapshotAwareEnvelopeEventStream;\n import uk.gov.justice.services.eventsourcing.source.core.SnapshotAwareEventSource;\n+import uk.gov.justice.services.eventsourcing.source.core.exception.EventStreamException;\n import uk.gov.justice.services.eventsourcing.source.core.snapshot.DefaultSnapshotService;\n import uk.gov.justice.services.eventsourcing.source.core.snapshot.DefaultSnapshotStrategy;\n import uk.gov.justice.services.messaging.JsonEnvelope;\n@@ -179,7 +181,7 @@ public void shouldStoreABrandNewSnapshotWhenEventCountInTheStreamReachesThreshol\n \n         final EventStream stream \u003d eventSource.getStreamById(STREAM_ID);\n \n-        rebuildAggregateAndApplyEvents(stream, SNAPSHOT_THRESHOLD);\n+        appendEventsViaAggregate(SNAPSHOT_THRESHOLD);\n \n         final Optional\u003cAggregateSnapshot\u003cTestAggregate\u003e\u003e snapshot \u003d snapshotRepository.getLatestSnapshot(STREAM_ID, TestAggregate.class);\n \n@@ -202,7 +204,7 @@ public void shouldNotStoreABrandNewSnapshotWhenEventCountInTheStreamReachesThres\n \n         final EventStream stream \u003d eventSource.getStreamById(STREAM_ID);\n \n-        rebuildAggregateAndApplyEvents(stream, SNAPSHOT_THRESHOLD - 2);\n+        appendEventsViaAggregate(SNAPSHOT_THRESHOLD - 2);\n \n         final Optional\u003cAggregateSnapshot\u003cTestAggregate\u003e\u003e snapshot \u003d snapshotRepository.getLatestSnapshot(STREAM_ID, TestAggregate.class);\n \n@@ -218,15 +220,16 @@ public void shouldNotCreateNewSnapshotOnAggregateChangeWhenWeJustOneExistingSnap\n         final EventStream stream \u003d eventSource.getStreamById(STREAM_ID);\n         final Class aggregateClass \u003d TestAggregate.class;\n \n-        rebuildAggregateAndApplyEvents(stream, SNAPSHOT_THRESHOLD);\n+        appendEventsViaAggregate(SNAPSHOT_THRESHOLD);\n \n         final Optional\u003cAggregateSnapshot\u003e snapshot \u003d snapshotRepository.getLatestSnapshot(STREAM_ID, aggregateClass);\n \n         assertThat(snapshot, IsNot.not(nullValue()));\n         assertThat(snapshot.isPresent(), equalTo(true));\n         assertThat(snapshotRepository.snapshotCount(STREAM_ID), is(1L));\n \n-        rebuildAggregateAndApplyEvents(stream, SNAPSHOT_THRESHOLD - 2);\n+        final EventStream updatedStream \u003d eventSource.getStreamById(STREAM_ID);\n+        appendEventsViaAggregate(SNAPSHOT_THRESHOLD - 2);\n \n         final Optional\u003cAggregateSnapshot\u003cTestAggregate\u003e\u003e snapshotChanged \u003d snapshotRepository.getLatestSnapshot(STREAM_ID, aggregateClass);\n         assertThat(snapshotChanged, IsNot.not(nullValue()));\n@@ -250,7 +253,7 @@ public void shouldCreateNewSnapshotOnAggregateChangeWhenWeHaveMultipleExistingSn\n \n         final long initialNumberOfSnapshots \u003d 4;\n         for (int i \u003d 0; i \u003c initialNumberOfSnapshots; i++) {\n-            rebuildAggregateAndApplyEvents(stream, SNAPSHOT_THRESHOLD);\n+            appendEventsViaAggregate(SNAPSHOT_THRESHOLD);\n         }\n \n         final Optional\u003cAggregateSnapshot\u003e snapshot \u003d snapshotRepository.getLatestSnapshot(STREAM_ID, aggregateClass);\n@@ -260,7 +263,7 @@ public void shouldCreateNewSnapshotOnAggregateChangeWhenWeHaveMultipleExistingSn\n \n         assertThat(snapshotRepository.snapshotCount(STREAM_ID), is(initialNumberOfSnapshots));\n \n-        rebuildAggregateAndApplyEvents(stream, SNAPSHOT_THRESHOLD - 2);\n+        appendEventsViaAggregate(SNAPSHOT_THRESHOLD - 2);\n \n \n         final Optional\u003cAggregateSnapshot\u003e newSnapshot \u003d snapshotRepository.getLatestSnapshot(STREAM_ID, aggregateClass);\n@@ -283,7 +286,7 @@ public void shouldNotStoreABrandNewSnapshotWhenStrategyDoesNotMandateSavingSnaps\n         final EventStream stream \u003d eventSource.getStreamById(STREAM_ID);\n \n         TestAggregate aggregate \u003d aggregateService.get(stream, TestAggregate.class);\n-        stream.append(createEventAndApply(24, \"context.eventA\", aggregate));\n+        stream.append(createEventAndApply(24, aggregate));\n \n \n         final Optional\u003cAggregateSnapshot\u003cTestAggregate\u003e\u003e snapshot \u003d snapshotRepository.getLatestSnapshot(STREAM_ID, TestAggregate.class);\n@@ -298,16 +301,16 @@ public void shouldNotStoreABrandNewSnapshotWhenStrategyDoesNotMandateSavingSnaps\n     public void shouldNotStoreANewSnapshotOnTopOfExistingSnapshotsWhenThresholdNotMet() throws Exception {\n         assertThat(snapshotRepository.snapshotCount(STREAM_ID), is(0L));\n \n-        final EventStream stream \u003d eventSource.getStreamById(STREAM_ID);\n+        appendEventsViaAggregate(SNAPSHOT_THRESHOLD);\n \n-        rebuildAggregateAndApplyEvents(stream, SNAPSHOT_THRESHOLD);\n+        assertThat(snapshotRepository.snapshotCount(STREAM_ID), is(1L));\n \n+        final EventStream stream \u003d eventSource.getStreamById(STREAM_ID);\n         TestAggregate aggregate \u003d aggregateService.get(stream, TestAggregate.class);\n-\n-        stream.append(createEventAndApply(SNAPSHOT_THRESHOLD - 2, \"context.eventA\", aggregate));\n+        stream.append(createEventAndApply(SNAPSHOT_THRESHOLD - 2, aggregate));\n \n         final Optional\u003cAggregateSnapshot\u003cTestAggregate\u003e\u003e snapshot \u003d snapshotRepository.getLatestSnapshot(STREAM_ID, TestAggregate.class);\n-        assertThat(snapshot, IsNot.not(Matchers.nullValue()));\n+        assertThat(snapshot, notNullValue());\n         assertThat(snapshot.isPresent(), equalTo(true));\n         assertThat(snapshot.get().getType(), equalTo(TYPE));\n         assertThat(snapshot.get().getStreamId(), equalTo(STREAM_ID));\n@@ -327,9 +330,9 @@ public void shouldStoreANewSnapshotOnTopOfExistingSnapshot() throws Exception {\n \n         final EventStream eventStream \u003d eventSource.getStreamById(STREAM_ID);\n \n-        rebuildAggregateAndApplyEvents(eventStream, SNAPSHOT_THRESHOLD);\n+        appendEventsViaAggregate(SNAPSHOT_THRESHOLD);\n \n-        rebuildAggregateAndApplyEvents(eventStream, SNAPSHOT_THRESHOLD);\n+        appendEventsViaAggregate(SNAPSHOT_THRESHOLD);\n \n         final Optional\u003cAggregateSnapshot\u003cTestAggregate\u003e\u003e snapshot \u003d snapshotRepository.getLatestSnapshot(STREAM_ID, TestAggregate.class);\n         assertThat(snapshot, IsNot.not(Matchers.nullValue()));\n@@ -347,19 +350,16 @@ public void shouldStoreANewSnapshotOnTopOfExistingSnapshot() throws Exception {\n     @Test\n     public void shouldRebuildSnapshotOnAggregateModelChange() throws Exception {\n \n-        final EventStream eventStream \u003d eventSource.getStreamById(STREAM_ID);\n-\n         DynamicAggregateTestClassGenerator classGenerator \u003d new DynamicAggregateTestClassGenerator();\n \n         final Class oldAggregateClass \u003d classGenerator.generatedTestAggregateClassOf(1L, TEST_AGGREGATE_PACKAGE, TEST_AGGREGATE_CLASS_NAME);\n \n         final long initialNumberOfSnapshots \u003d 4;\n \n         for (int i \u003d 1; i \u003c\u003d initialNumberOfSnapshots; i++) {\n-            eventStream.append(createEventStreamAndApply(SNAPSHOT_THRESHOLD, \"context.eventA\", aggregateService.get(eventStream, oldAggregateClass)));\n+            createEventStreamAndApply(SNAPSHOT_THRESHOLD, \"context.eventA\", oldAggregateClass);\n         }\n \n-\n         final Optional\u003cAggregateSnapshot\u003e snapshot \u003d snapshotRepository.getLatestSnapshot(STREAM_ID, oldAggregateClass);\n \n         assertThat(snapshot, IsNot.not(Matchers.nullValue()));\n@@ -373,7 +373,7 @@ public void shouldRebuildSnapshotOnAggregateModelChange() throws Exception {\n         snapshotService.setStreamStrategy(\n                 new CustomClassLoaderObjectInputStreamStrategy(classLoaderWithGeneratedAggregateLoaded()));\n \n-        eventStream.append(createEventStreamAndApply(SNAPSHOT_THRESHOLD - 2, \"context.eventA\", aggregateService.get(eventStream, newAggregateClass)));\n+        createEventStreamAndApply(SNAPSHOT_THRESHOLD - 2, \"context.eventA\", newAggregateClass);\n \n         final Optional\u003cAggregateSnapshot\u003e newSnapshot \u003d snapshotRepository.getLatestSnapshot(STREAM_ID, newAggregateClass);\n         assertThat(newSnapshot, IsNot.not(Matchers.nullValue()));\n@@ -406,36 +406,38 @@ private DynamicallyLoadingClassLoader classLoaderWithGeneratedAggregateLoaded()\n         return classLoader;\n     }\n \n-    private \u003cT extends Aggregate\u003e void rebuildAggregateAndApplyEvents(final EventStream eventStream, long eventCount) throws Exception {\n+    private void appendEventsViaAggregate(final long eventCount) throws Exception {\n \n+        final EventStream eventStream \u003d eventSource.getStreamById(STREAM_ID);\n         TestAggregate aggregateRebuilt \u003d aggregateService.get(eventStream, TestAggregate.class);\n-\n-        eventStream.append(createEventAndApply(eventCount, \"context.eventA\", aggregateRebuilt));\n+        eventStream.append(createEventAndApply(eventCount, aggregateRebuilt));\n     }\n \n-    private Stream\u003cJsonEnvelope\u003e createEventAndApply(long count, String eventName, TestAggregate aggregate) {\n-        List\u003cObject\u003e envelopes \u003d new LinkedList\u003c\u003e();\n+    private Stream\u003cJsonEnvelope\u003e createEventAndApply(long count, final TestAggregate aggregate) {\n+        List\u003cJsonEnvelope\u003e envelopes \u003d new LinkedList\u003c\u003e();\n         for (int i \u003d 1; i \u003c\u003d count; i++) {\n-            JsonEnvelope envelope \u003d\n-                    envelope()\n-                    .with(metadataWithRandomUUID(eventName)\n+            JsonEnvelope envelope \u003d envelope()\n+                    .with(metadataWithRandomUUID(\"context.eventA\")\n                             .createdAt(clock.now())\n                             .withStreamId(STREAM_ID))\n                     .withPayloadOf(\"value\", \"name\")\n                     .build();\n             aggregate.addEvent(envelope);\n             envelopes.add(envelope);\n         }\n-        return envelopes.stream().map(x -\u003e (JsonEnvelope) x);\n+        return envelopes.stream();\n     }\n \n-    private \u003cT extends Aggregate\u003e Stream\u003cJsonEnvelope\u003e createEventStreamAndApply(long count, String eventName, T aggregate) {\n-        List\u003cObject\u003e envelopes \u003d new LinkedList\u003c\u003e();\n+    private \u003cT extends Aggregate\u003e void createEventStreamAndApply(long count, String eventName, Class\u003cT\u003e aggregateClass) throws EventStreamException {\n+\n+        final EventStream eventStream \u003d eventSource.getStreamById(STREAM_ID);\n+        final T aggregate \u003d aggregateService.get(eventStream, aggregateClass);\n+\n+        List\u003cJsonEnvelope\u003e envelopes \u003d new LinkedList\u003c\u003e();\n \n         for (int i \u003d 1; i \u003c\u003d count; i++) {\n \n-            JsonEnvelope envelope \u003d\n-                    envelope()\n+            JsonEnvelope envelope \u003d envelope()\n                     .with(metadataWithRandomUUID(eventName)\n                             .createdAt(clock.now())\n                             .withStreamId(STREAM_ID))\n@@ -445,7 +447,7 @@ private DynamicallyLoadingClassLoader classLoaderWithGeneratedAggregateLoaded()\n             aggregate.apply(new EventA(String.valueOf(i)));\n             envelopes.add(envelope);\n         }\n-        return envelopes.stream().map(x -\u003e (JsonEnvelope) x);\n+        eventStream.append( envelopes.stream());\n     }\n \n     @ApplicationScoped\n@@ -479,4 +481,4 @@ public EventLogInsertionStrategy eventLogInsertionStrategy() {\n             return new AnsiSQLEventLogInsertionStrategy();\n         }\n     }\n-}\n\\ No newline at end of file\n+}"
        },
        {
          "file_name": "aggregate-snapshot/aggregate-snapshot-service/src/test/java/uk/gov/justice/services/eventsourcing/source/core/SnapshotAwareEnvelopeEventStreamTest.java",
          "patch": "@@ -1,20 +1,28 @@\n package uk.gov.justice.services.eventsourcing.source.core;\n \n+import static java.util.stream.Collectors.toList;\n import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.Matchers.hasSize;\n import static org.hamcrest.core.Is.is;\n import static org.junit.Assert.assertThat;\n import static org.mockito.Mockito.verify;\n import static org.mockito.Mockito.verifyZeroInteractions;\n import static org.mockito.Mockito.when;\n+import static uk.gov.justice.services.messaging.JsonObjectMetadata.metadataWithDefaults;\n import static uk.gov.justice.services.test.utils.core.messaging.JsonEnvelopeBuilder.envelope;\n \n import uk.gov.justice.domain.aggregate.TestAggregate;\n import uk.gov.justice.services.eventsourcing.source.core.snapshot.SnapshotService;\n import uk.gov.justice.services.messaging.JsonEnvelope;\n+import uk.gov.justice.services.messaging.Metadata;\n \n+import java.util.List;\n import java.util.UUID;\n+import java.util.stream.Collectors;\n import java.util.stream.Stream;\n \n+import org.hamcrest.Matchers;\n+import org.hibernate.metamodel.MetadataBuilder;\n import org.junit.Before;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n@@ -42,19 +50,30 @@ public void setup() {\n \n     @Test\n     public void shouldReturnStreamOfEnvelopes() throws Exception {\n-        final Stream\u003cJsonEnvelope\u003e stream \u003d Stream.of(envelope().build());\n-        when(eventStreamManager.read(STREAM_ID)).thenReturn(stream);\n+        final JsonEnvelope event \u003d envelope().with(metadataWithDefaults().withVersion(1L)).build();\n+\n+        when(eventStreamManager.read(STREAM_ID)).thenReturn(Stream.of(event));\n \n-        assertThat(eventStream.read(), is(stream));\n+        Stream\u003cJsonEnvelope\u003e stream \u003d eventStream.read();\n+\n+        List\u003cJsonEnvelope\u003e events \u003d stream.collect(toList());\n+        assertThat(events, hasSize(1));\n+        assertThat(events.get(0), is(event));\n     }\n \n     @Test\n     public void shouldReturnStreamFromVersion() throws Exception {\n-        final Stream\u003cJsonEnvelope\u003e stream \u003d Stream.of(envelope().build());\n+\n         final long version \u003d 10L;\n-        when(eventStreamManager.readFrom(STREAM_ID, version)).thenReturn(stream);\n+        final JsonEnvelope event \u003d envelope().with(metadataWithDefaults().withVersion(1L)).build();\n+\n+        when(eventStreamManager.readFrom(STREAM_ID, version)).thenReturn(Stream.of(event));\n+\n+        Stream\u003cJsonEnvelope\u003e stream \u003d eventStream.readFrom(version);\n \n-        assertThat(eventStream.readFrom(version), is(stream));\n+        List\u003cJsonEnvelope\u003e events \u003d stream.collect(toList());\n+        assertThat(events, hasSize(1));\n+        assertThat(events.get(0), is(event));\n     }\n \n     @Test\n@@ -145,4 +164,4 @@ public void shouldAttemptSnapshotCreationOnAppendingEventsFrom() throws Exceptio\n \n     }\n \n-}\n\\ No newline at end of file\n+}"
        },
        {
          "file_name": "aggregate/src/test/java/uk/gov/justice/services/core/aggregate/DefaultAggregateServiceIT.java",
          "patch": "@@ -42,8 +42,6 @@\n import uk.gov.justice.services.messaging.jms.JmsEnvelopeSender;\n import uk.gov.justice.services.repository.EventLogOpenEjbAwareJdbcRepository;\n \n-import java.util.LinkedList;\n-import java.util.List;\n import java.util.UUID;\n import java.util.stream.Stream;\n \n@@ -75,8 +73,6 @@\n \n     private static final String TEST_AGGREGATE_PACKAGE \u003d \"uk.gov.justice.services.core.aggregate\";\n \n-    private static final String TYPE \u003d TEST_AGGREGATE_PACKAGE + \".DefaultAggregateServiceIT$TestAggregate\";\n-\n     @Resource(name \u003d \"openejb/Resource/eventStore\")\n     private DataSource dataSource;\n \n@@ -154,9 +150,9 @@ public void shouldCreateAggregateFromSingletonStream() throws EventStreamExcepti\n \n         aggregateService.get(eventStream, TestAggregate.class);\n \n-        eventStream.append(envelopes(1, \"context.eventA\"));\n+        eventStream.append(Stream.of(envelopeFrom(\"context.eventA\")));\n \n-        final TestAggregate aggregate \u003d aggregateService.get(eventStream, TestAggregate.class);\n+        final TestAggregate aggregate \u003d aggregateService.get(eventSource.getStreamById(STREAM_ID), TestAggregate.class);\n \n         assertThat(aggregate, notNullValue());\n         assertThat(aggregate.recordedEvents(), hasSize(1));\n@@ -175,10 +171,9 @@ public void shouldCreateAggregateFromStreamOfTwo() throws EventStreamException {\n \n         aggregateService.get(eventStream, TestAggregate.class);\n \n-        eventStream.append(envelopes(1, \"context.eventA\"));\n-        eventStream.append(envelopes(1, \"context.eventB\"));\n+        eventStream.append(Stream.of(envelopeFrom(\"context.eventA\"), envelopeFrom(\"context.eventB\")));\n \n-        final TestAggregate aggregate \u003d aggregateService.get(eventStream, TestAggregate.class);\n+        final TestAggregate aggregate \u003d aggregateService.get(eventSource.getStreamById(STREAM_ID), TestAggregate.class);\n \n         assertThat(aggregate, notNullValue());\n         assertThat(aggregate.recordedEvents(), hasSize(2));\n@@ -192,7 +187,7 @@ public void shouldThrowExceptionForUnregisteredEvent() throws EventStreamExcepti\n \n         final EventStream eventStream \u003d eventSource.getStreamById(STREAM_ID);\n \n-        eventStream.append(envelopes(1, \"context.eventA\"));\n+        eventStream.append(Stream.of(envelopeFrom(\"context.eventA\")));\n \n         aggregateService.get(eventStream, TestAggregate.class);\n \n@@ -217,16 +212,13 @@ private void initDatabase() throws Exception {\n \n     }\n \n-    private Stream\u003cJsonEnvelope\u003e envelopes(final int numberOfEnvelopes, String eventName) {\n-        List\u003cJsonEnvelope\u003e envelopes \u003d new LinkedList\u003c\u003e();\n-        for (int i \u003d 1; i \u003c\u003d numberOfEnvelopes; i++) {\n-            envelopes.add(envelope()\n-                    .with(metadataWithRandomUUID(eventName)\n-                            .createdAt(clock.now())\n-                            .withStreamId(STREAM_ID))\n-                    .withPayloadOf(\"value\", \"name\").build());\n-        }\n-        return envelopes.stream();\n+    private JsonEnvelope envelopeFrom(final String eventName) {\n+        return envelope()\n+                .with(metadataWithRandomUUID(eventName)\n+                        .createdAt(clock.now())\n+                        .withStreamId(STREAM_ID))\n+                .withPayloadOf(\"value\", \"name\")\n+                .build();\n     }\n \n     public static class DummyJmsEventPublisher implements EventPublisher {\n@@ -260,4 +252,4 @@ public EventLogInsertionStrategy eventLogInsertionStrategy() {\n             return new AnsiSQLEventLogInsertionStrategy();\n         }\n     }\n-}\n\\ No newline at end of file\n+}"
        },
        {
          "file_name": "event-sourcing/event-source/src/main/java/uk/gov/justice/services/eventsourcing/source/core/EnvelopeEventStream.java",
          "patch": "@@ -1,16 +1,19 @@\n package uk.gov.justice.services.eventsourcing.source.core;\n \n+import static uk.gov.justice.services.eventsourcing.source.core.Tolerance.CONSECUTIVE;\n+\n import uk.gov.justice.services.eventsourcing.source.core.exception.EventStreamException;\n import uk.gov.justice.services.messaging.JsonEnvelope;\n \n+import java.util.Optional;\n import java.util.UUID;\n import java.util.stream.Stream;\n \n public class EnvelopeEventStream implements EventStream {\n \n     private final EventStreamManager eventStreamManager;\n     private final UUID id;\n-\n+    private volatile Optional\u003cLong\u003e lastReadVersion \u003d Optional.empty();\n \n     EnvelopeEventStream(final UUID id, final EventStreamManager eventStreamManager) {\n         this.id \u003d id;\n@@ -19,26 +22,29 @@\n \n     @Override\n     public Stream\u003cJsonEnvelope\u003e read() {\n-        return eventStreamManager.read(id);\n+        markAsReadFrom(0L);\n+        return eventStreamManager.read(id).map(this::recordCurrentVersion);\n     }\n \n     @Override\n     public Stream\u003cJsonEnvelope\u003e readFrom(final long version) {\n-        return eventStreamManager.readFrom(id, version);\n+        markAsReadFrom(version - 1);\n+        return eventStreamManager.readFrom(id, version).map(this::recordCurrentVersion);\n     }\n \n     @Override\n     public long append(final Stream\u003cJsonEnvelope\u003e events) throws EventStreamException {\n-        return eventStreamManager.append(id, events);\n+        return append(events, CONSECUTIVE);\n     }\n \n     @Override\n-    public long append(final Stream\u003cJsonEnvelope\u003e stream, final Tolerance tolerance) throws EventStreamException {\n+    public long append(final Stream\u003cJsonEnvelope\u003e events, final Tolerance tolerance) throws EventStreamException {\n         switch (tolerance) {\n             case NON_CONSECUTIVE:\n-                return eventStreamManager.appendNonConsecutively(id, stream);\n+                return eventStreamManager.appendNonConsecutively(id, events);\n             default:\n-                return eventStreamManager.append(id, stream);\n+                final Optional\u003cLong\u003e lastReadVersion \u003d this.lastReadVersion;\n+                return lastReadVersion.isPresent() ? eventStreamManager.appendAfter(id, events, lastReadVersion.get()) : eventStreamManager.append(id, events);\n         }\n     }\n \n@@ -49,11 +55,26 @@ public long appendAfter(final Stream\u003cJsonEnvelope\u003e events, final long version) t\n \n     @Override\n     public long getCurrentVersion() {\n-        return eventStreamManager.getCurrentVersion(id);\n+        final Optional\u003cLong\u003e lastReadVersion \u003d this.lastReadVersion;\n+        return lastReadVersion.isPresent() ? lastReadVersion.get() : eventStreamManager.getCurrentVersion(id);\n     }\n \n     @Override\n     public UUID getId() {\n         return id;\n     }\n+\n+    private JsonEnvelope recordCurrentVersion(final JsonEnvelope event) {\n+        lastReadVersion \u003d Optional.of(\n+                event.metadata().version()\n+                        .orElseThrow(() -\u003e new IllegalStateException(\"Missing version in event from event store\")));\n+        return event;\n+    }\n+\n+    private synchronized void markAsReadFrom(final long version) {\n+        if (lastReadVersion.isPresent()) {\n+            throw new IllegalStateException(\"Event stream has already been read\");\n+        }\n+        lastReadVersion \u003d Optional.of(version);\n+    }\n }"
        },
        {
          "file_name": "event-sourcing/event-source/src/main/java/uk/gov/justice/services/eventsourcing/source/core/EventStreamManager.java",
          "patch": "@@ -1,6 +1,7 @@\n package uk.gov.justice.services.eventsourcing.source.core;\n \n \n+import static java.lang.String.format;\n import static java.util.stream.Collectors.toList;\n \n import uk.gov.justice.services.common.configuration.GlobalValue;\n@@ -138,7 +139,9 @@ private long append(final UUID id, final Stream\u003cJsonEnvelope\u003e events, final Opti\n         final List\u003cJsonEnvelope\u003e envelopeList \u003d events.collect(toList());\n \n         long currentVersion \u003d eventRepository.getCurrentSequenceIdForStream(id);\n-        validateVersion(id, versionFrom, currentVersion);\n+        if (versionFrom.isPresent()) {\n+            validateVersion(id, versionFrom.get(), currentVersion);\n+        }\n         validateEvents(id, envelopeList);\n \n         for (final JsonEnvelope event : envelopeList) {\n@@ -153,10 +156,13 @@ private void validateEvents(final UUID id, final List\u003cJsonEnvelope\u003e envelopeList\n         }\n     }\n \n-    private void validateVersion(final UUID id, final Optional\u003cLong\u003e versionFrom, final Long currentVersion) throws VersionMismatchException {\n-        if (versionFrom.isPresent() \u0026\u0026 !versionFrom.get().equals(currentVersion)) {\n-            throw new VersionMismatchException(String.format(\"Failed to append to stream %s. Version mismatch. Expected %d, Found %d\",\n-                    id, versionFrom.get(), currentVersion));\n+    private void validateVersion(final UUID id, final Long versionFrom, final Long currentVersion) throws VersionMismatchException {\n+        if (versionFrom \u003e currentVersion) {\n+            throw new VersionMismatchException(String.format(\"Failed to append to stream %s due to a version mismatch; expected %d, found %d\",\n+                    id, versionFrom, currentVersion));\n+        } else if (versionFrom \u003c currentVersion) {\n+            throw new OptimisticLockingRetryException(format(\"Optimistic locking failure while storing version %s of stream %s which is already at %s\",\n+                    versionFrom + 1, id, currentVersion));\n         }\n     }\n }"
        },
        {
          "file_name": "event-sourcing/event-source/src/test/java/uk/gov/justice/services/eventsourcing/source/core/EnvelopeEventStreamTest.java",
          "patch": "@@ -1,37 +1,65 @@\n package uk.gov.justice.services.eventsourcing.source.core;\n \n+import static java.util.stream.Collectors.toList;\n import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.hasSize;\n import static org.junit.Assert.assertThat;\n+import static org.mockito.Matchers.eq;\n import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+import static uk.gov.justice.services.messaging.JsonObjectMetadata.metadataWithDefaults;\n+import static uk.gov.justice.services.test.utils.core.messaging.JsonEnvelopeBuilder.envelope;\n \n import uk.gov.justice.services.eventsourcing.source.core.exception.EventStreamException;\n import uk.gov.justice.services.messaging.JsonEnvelope;\n+import uk.gov.justice.services.messaging.JsonObjectMetadata;\n+import uk.gov.justice.services.test.utils.core.messaging.JsonEnvelopeBuilder;\n \n+import java.util.List;\n import java.util.UUID;\n+import java.util.stream.Collectors;\n import java.util.stream.Stream;\n \n+import com.jayway.jsonassert.impl.matcher.IsCollectionWithSize;\n import org.junit.Before;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n import org.mockito.Mock;\n import org.mockito.runners.MockitoJUnitRunner;\n \n @RunWith(MockitoJUnitRunner.class)\n public class EnvelopeEventStreamTest {\n \n-    public static final Long VERSION \u003d 5L;\n+    public static final Long VERSION \u003d 3L;\n+    public static final Long MAX_VERSION \u003d 4L;\n     private static final UUID STREAM_ID \u003d UUID.randomUUID();\n+\n     @Mock\n     EventStreamManager eventStreamManager;\n \n     @Mock\n     Stream\u003cJsonEnvelope\u003e stream;\n \n+    @Captor\n+    ArgumentCaptor\u003cStream\u003cJsonEnvelope\u003e\u003e streamCaptor;\n+\n     private EventStream eventStream;\n \n     @Before\n     public void setup() {\n         eventStream \u003d new EnvelopeEventStream(STREAM_ID, eventStreamManager);\n+        when(eventStreamManager.read(STREAM_ID)).thenReturn(Stream.of(\n+                envelope().with(metadataWithDefaults().withVersion(1L)).build(),\n+                envelope().with(metadataWithDefaults().withVersion(2L)).build(),\n+                envelope().with(metadataWithDefaults().withVersion(3L)).build(),\n+                envelope().with(metadataWithDefaults().withVersion(4L)).build()));\n+        when(eventStreamManager.readFrom(STREAM_ID, VERSION)).thenReturn(Stream.of(\n+                envelope().with(metadataWithDefaults().withVersion(3L)).build(),\n+                envelope().with(metadataWithDefaults().withVersion(4L)).build()\n+        ));\n     }\n \n     @Test\n@@ -85,10 +113,42 @@ public void shouldReturnCurrentVersion() throws Exception {\n     }\n \n     @Test\n-    public void testGetId() throws Exception {\n+    public void shouldGetId() throws Exception {\n         final UUID actualId \u003d eventStream.getId();\n \n         assertThat(actualId, equalTo(STREAM_ID));\n     }\n \n+    @Test(expected \u003d IllegalStateException.class)\n+    public void shouldThrowExceptionIfReadTwice() {\n+        eventStream.read();\n+        eventStream.read();\n+    }\n+\n+    @Test\n+    public void shouldAppendToLastReadVersion() throws Exception {\n+        final JsonEnvelope event \u003d envelope().with(metadataWithDefaults()).build();\n+        final Stream\u003cJsonEnvelope\u003e events \u003d Stream.of(event);\n+\n+        eventStream.read().forEach(e -\u003e {});\n+        eventStream.append(events);\n+\n+        verify(eventStreamManager).appendAfter(eq(STREAM_ID), streamCaptor.capture(), eq(MAX_VERSION));\n+        final List\u003cJsonEnvelope\u003e appendedEvents \u003d streamCaptor.getValue().collect(toList());\n+        assertThat(appendedEvents, hasSize(1));\n+        assertThat(appendedEvents.get(0), is(event));\n+    }\n+\n+    @Test\n+    public void shouldAppendAnywhereIfStreamNotRead() throws Exception {\n+        final JsonEnvelope event \u003d envelope().with(metadataWithDefaults()).build();\n+        final Stream\u003cJsonEnvelope\u003e events \u003d Stream.of(event);\n+\n+        eventStream.append(events);\n+\n+        verify(eventStreamManager).append(eq(STREAM_ID), streamCaptor.capture());\n+        final List\u003cJsonEnvelope\u003e appendedEvents \u003d streamCaptor.getValue().collect(toList());\n+        assertThat(appendedEvents, hasSize(1));\n+        assertThat(appendedEvents.get(0), is(event));\n+    }\n }"
        },
        {
          "file_name": "event-sourcing/event-source/src/test/java/uk/gov/justice/services/eventsourcing/source/core/EventStreamManagerTest.java",
          "patch": "@@ -115,12 +115,19 @@ public void shouldThrowExceptionOnNullFromVersion() throws Exception {\n     }\n \n     @Test(expected \u003d VersionMismatchException.class)\n-    public void shouldThrowExceptionWhenFromVersionNotCorrect() throws Exception {\n+    public void shouldThrowExceptionWhenEventsAreMissing() throws Exception {\n         when(eventRepository.getCurrentSequenceIdForStream(STREAM_ID)).thenReturn(CURRENT_VERSION);\n \n         eventStreamManager.appendAfter(STREAM_ID, Stream.of(envelope().with(metadataWithDefaults()).build()), INVALID_VERSION);\n     }\n \n+    @Test(expected \u003d OptimisticLockingRetryException.class)\n+    public void shouldThrowExceptionWhenVersionAlreadyExists() throws Exception {\n+        when(eventRepository.getCurrentSequenceIdForStream(STREAM_ID)).thenReturn(CURRENT_VERSION + 1);\n+\n+        eventStreamManager.appendAfter(STREAM_ID, Stream.of(envelope().with(metadataWithDefaults()).build()), CURRENT_VERSION);\n+    }\n+\n     @Test\n     public void shouldReadStream() {\n         when(eventRepository.getByStreamId(STREAM_ID)).thenReturn(eventStream);"
        }
      ]
    }
  },
  {
    "name": "Fix a race condition in reindex\u0027s rethrottle",
    "url": "https://github.com/elastic/elasticsearch/pull/18731",
    "description": "If you rethrottled the request while is was performing a scroll\nrequest then it wouldn\u0027t properly pick up the rethrottle for that\nbatch. This was causing test failure and might cause issues for\nusers. The work around is simple though: just issue the rethrottle\nagain with a slightly faster throttle than the first time.\n\nCaught by:\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-os-compatibility/os\u003dcentos/525/console\n\nCloses #18744\n",
    "keywords": [
      "rethrottle"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/elastic/elasticsearch/commit/bd1af3450654140bff603a587ea575fbda6072fb",
      "files": [
        {
          "file_name": "modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkByScrollTask.java",
          "patch": "@@ -408,23 +408,8 @@ void delayPrepareBulkRequest(ThreadPool threadPool, TimeValue lastBatchStartTime\n         // Synchronize so we are less likely to schedule the same request twice.\n         synchronized (delayedPrepareBulkRequestReference) {\n             TimeValue delay \u003d throttleWaitTime(lastBatchStartTime, lastBatchSize);\n-            AbstractRunnable oneTime \u003d new AbstractRunnable() {\n-                private final AtomicBoolean hasRun \u003d new AtomicBoolean(false);\n-\n-                @Override\n-                protected void doRun() throws Exception {\n-                    // Paranoia to prevent furiously rethrottling from running the command multiple times. Without this we totally can.\n-                    if (hasRun.compareAndSet(false, true)) {\n-                        prepareBulkRequestRunnable.run();\n-                    }\n-                }\n-\n-                @Override\n-                public void onFailure(Throwable t) {\n-                    prepareBulkRequestRunnable.onFailure(t);\n-                }\n-            };\n-            delayedPrepareBulkRequestReference.set(new DelayedPrepareBulkRequest(threadPool, getRequestsPerSecond(), delay, oneTime));\n+            delayedPrepareBulkRequestReference.set(new DelayedPrepareBulkRequest(threadPool, getRequestsPerSecond(),\n+                    delay, new RunOnce(prepareBulkRequestRunnable)));\n         }\n     }\n \n@@ -540,4 +525,29 @@ TimeValue newDelay(long remainingDelay, float newRequestsPerSecond) {\n             return timeValueNanos(round(remainingDelay * requestsPerSecond / newRequestsPerSecond));\n         }\n     }\n+\n+    /**\n+     * Runnable that can only be run one time. This is paranoia to prevent furiously rethrottling from running the command multiple times.\n+     * Without it the command would be run multiple times.\n+     */\n+    private static class RunOnce extends AbstractRunnable {\n+        private final AtomicBoolean hasRun \u003d new AtomicBoolean(false);\n+        private final AbstractRunnable delegate;\n+\n+        public RunOnce(AbstractRunnable delegate) {\n+            this.delegate \u003d delegate;\n+        }\n+\n+        @Override\n+        protected void doRun() throws Exception {\n+            if (hasRun.compareAndSet(false, true)) {\n+                delegate.run();\n+            }\n+        }\n+\n+        @Override\n+        public void onFailure(Throwable t) {\n+            delegate.onFailure(t);\n+        }\n+    }\n }"
        }
      ]
    }
  },
  {
    "name": "Squash a race condition in RefreshListeners",
    "url": "https://github.com/elastic/elasticsearch/pull/18806",
    "description": "It presented as listeners never being called if you refresh at the same\ntime as the listener is added. It was caught rarely by\ntestConcurrentRefresh. mostly this is removing code and adding a comment:\n\n```\nNote that it is not safe for us to abort early if we haven\u0027t advanced the\nposition here because we set and read lastRefreshedLocation outside of a\nsynchronized block. We do that so that waiting for a refresh that has\nalready passed is just a volatile read but the cost is that any check\nwhether or not we\u0027ve advanced the position will introduce a race between\nadding the listener and the position check. We could work around this by\nmoving this assignment into the synchronized block below and double\nchecking lastRefreshedLocation in addOrNotify\u0027s synchronized block but\nthat doesn\u0027t seem worth it given that we already skip this process early\nif there aren\u0027t any listeners to iterate.\n```\n",
    "keywords": [
      "synchronized",
      "block",
      "position"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/elastic/elasticsearch/commit/e02d9f09455f5a7f12f9966d1e2a3032e5cf907e",
      "files": [
        {
          "file_name": "core/src/main/java/org/elasticsearch/index/shard/RefreshListeners.java",
          "patch": "@@ -137,14 +137,14 @@ public void afterRefresh(boolean didRefresh) throws IOException {\n              */\n             return;\n         }\n-        // First check if we\u0027ve actually moved forward. If not then just bail immediately.\n-        assert lastRefreshedLocation \u003d\u003d null || currentRefreshLocation.compareTo(lastRefreshedLocation) \u003e\u003d 0;\n-        if (lastRefreshedLocation !\u003d null \u0026\u0026 currentRefreshLocation.compareTo(lastRefreshedLocation) \u003d\u003d 0) {\n-            return;\n-        }\n         /*\n          * Set the lastRefreshedLocation so listeners that come in for locations before that will just execute inline without messing\n-         * around with refreshListeners or synchronizing at all.\n+         * around with refreshListeners or synchronizing at all. Note that it is not safe for us to abort early if we haven\u0027t advanced the\n+         * position here because we set and read lastRefreshedLocation outside of a synchronized block. We do that so that waiting for a\n+         * refresh that has already passed is just a volatile read but the cost is that any check whether or not we\u0027ve advanced the\n+         * position will introduce a race between adding the listener and the position check. We could work around this by moving this\n+         * assignment into the synchronized block below and double checking lastRefreshedLocation in addOrNotify\u0027s synchronized block but\n+         * that doesn\u0027t seem worth it given that we already skip this process early if there aren\u0027t any listeners to iterate.\n          */\n         lastRefreshedLocation \u003d currentRefreshLocation;\n         /*"
        }
      ]
    }
  },
  {
    "name": "fix OperatorConcat race condition where request lost",
    "url": "https://github.com/ReactiveX/RxJava/pull/2960",
    "description": "If a request arrives while `ConcatInnerSubscriber` is being constructed ([L199-201](https://github.com/ReactiveX/RxJava/blob/bad4d40a7b59cb443c3cb19d00ab80000e017a5f/src/main/java/rx/internal/operators/OperatorConcat.java#L199-L201)) then that additional request does not induce a request from the subscriber and could stall the stream. The fix is not to pass `requested` value in the constructor but to call `ConcatInnerSubscriber.requestMore` with `requested` only once `currentSubscriber` is set.\n",
    "keywords": [
      "request"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/ReactiveX/RxJava/commit/bb170b5a120367a47c682789bce443779283847f",
      "files": [
        {
          "file_name": "src/main/java/rx/internal/operators/OperatorConcat.java",
          "patch": "@@ -24,6 +24,7 @@\n import rx.Producer;\n import rx.Subscriber;\n import rx.functions.Action0;\n+import rx.internal.producers.ProducerArbiter;\n import rx.observers.SerializedSubscriber;\n import rx.subscriptions.SerialSubscription;\n import rx.subscriptions.Subscriptions;\n@@ -85,17 +86,19 @@ public void request(long n) {\n \n         volatile int wip;\n         @SuppressWarnings(\"rawtypes\")\n-        static final AtomicIntegerFieldUpdater\u003cConcatSubscriber\u003e WIP_UPDATER \u003d AtomicIntegerFieldUpdater.newUpdater(ConcatSubscriber.class, \"wip\");\n+        static final AtomicIntegerFieldUpdater\u003cConcatSubscriber\u003e WIP \u003d AtomicIntegerFieldUpdater.newUpdater(ConcatSubscriber.class, \"wip\");\n \n-        // accessed by REQUESTED_UPDATER\n+        // accessed by REQUESTED\n         private volatile long requested;\n         @SuppressWarnings(\"rawtypes\")\n-        private static final AtomicLongFieldUpdater\u003cConcatSubscriber\u003e REQUESTED_UPDATER \u003d AtomicLongFieldUpdater.newUpdater(ConcatSubscriber.class, \"requested\");\n+        private static final AtomicLongFieldUpdater\u003cConcatSubscriber\u003e REQUESTED \u003d AtomicLongFieldUpdater.newUpdater(ConcatSubscriber.class, \"requested\");\n+        private final ProducerArbiter arbiter;\n \n         public ConcatSubscriber(Subscriber\u003cT\u003e s, SerialSubscription current) {\n             super(s);\n             this.child \u003d s;\n             this.current \u003d current;\n+            this.arbiter \u003d new ProducerArbiter();\n             this.queue \u003d new ConcurrentLinkedQueue\u003cObject\u003e();\n             add(Subscriptions.create(new Action0() {\n                 @Override\n@@ -113,32 +116,27 @@ public void onStart() {\n         }\n \n         private void requestFromChild(long n) {\n+            if (n \u003c\u003d0) return;\n             // we track \u0027requested\u0027 so we know whether we should subscribe the next or not\n-            ConcatInnerSubscriber\u003cT\u003e actualSubscriber \u003d currentSubscriber;\n-            if (n \u003e 0 \u0026\u0026 BackpressureUtils.getAndAddRequest(REQUESTED_UPDATER, this, n) \u003d\u003d 0) {\n-                if (actualSubscriber \u003d\u003d null \u0026\u0026 wip \u003e 0) {\n+            long previous \u003d BackpressureUtils.getAndAddRequest(REQUESTED, this, n);\n+            arbiter.request(n);\n+            if (previous \u003d\u003d 0) {\n+                if (currentSubscriber \u003d\u003d null \u0026\u0026 wip \u003e 0) {\n                     // this means we may be moving from one subscriber to another after having stopped processing\n                     // so need to kick off the subscribe via this request notification\n                     subscribeNext();\n-                    // return here as we don\u0027t want to do the requestMore logic below (which would double request)\n-                    return;\n                 }\n             } \n-                \n-            if (actualSubscriber !\u003d null) {\n-                // otherwise we are just passing it through to the currentSubscriber\n-                actualSubscriber.requestMore(n);\n-            }\n         }\n \n         private void decrementRequested() {\n-            REQUESTED_UPDATER.decrementAndGet(this);\n+            REQUESTED.decrementAndGet(this);\n         }\n \n         @Override\n         public void onNext(Observable\u003c? extends T\u003e t) {\n             queue.add(nl.next(t));\n-            if (WIP_UPDATER.getAndIncrement(this) \u003d\u003d 0) {\n+            if (WIP.getAndIncrement(this) \u003d\u003d 0) {\n                 subscribeNext();\n             }\n         }\n@@ -152,14 +150,15 @@ public void onError(Throwable e) {\n         @Override\n         public void onCompleted() {\n             queue.add(nl.completed());\n-            if (WIP_UPDATER.getAndIncrement(this) \u003d\u003d 0) {\n+            if (WIP.getAndIncrement(this) \u003d\u003d 0) {\n                 subscribeNext();\n             }\n         }\n+        \n \n         void completeInner() {\n             currentSubscriber \u003d null;\n-            if (WIP_UPDATER.decrementAndGet(this) \u003e 0) {\n+            if (WIP.decrementAndGet(this) \u003e 0) {\n                 subscribeNext();\n             }\n             request(1);\n@@ -172,7 +171,7 @@ void subscribeNext() {\n                     child.onCompleted();\n                 } else if (o !\u003d null) {\n                     Observable\u003c? extends T\u003e obs \u003d nl.getValue(o);\n-                    currentSubscriber \u003d new ConcatInnerSubscriber\u003cT\u003e(this, child, requested);\n+                    currentSubscriber \u003d new ConcatInnerSubscriber\u003cT\u003e(this, child, arbiter);\n                     current.set(currentSubscriber);\n                     obs.unsafeSubscribe(currentSubscriber);\n                 }\n@@ -193,39 +192,42 @@ void subscribeNext() {\n         @SuppressWarnings(\"unused\")\n         private volatile int once \u003d 0;\n         @SuppressWarnings(\"rawtypes\")\n-        private final static AtomicIntegerFieldUpdater\u003cConcatInnerSubscriber\u003e ONCE_UPDATER \u003d AtomicIntegerFieldUpdater.newUpdater(ConcatInnerSubscriber.class, \"once\");\n+        private final static AtomicIntegerFieldUpdater\u003cConcatInnerSubscriber\u003e ONCE \u003d AtomicIntegerFieldUpdater.newUpdater(ConcatInnerSubscriber.class, \"once\");\n+        private final ProducerArbiter arbiter;\n \n-        public ConcatInnerSubscriber(ConcatSubscriber\u003cT\u003e parent, Subscriber\u003cT\u003e child, long initialRequest) {\n+        public ConcatInnerSubscriber(ConcatSubscriber\u003cT\u003e parent, Subscriber\u003cT\u003e child, ProducerArbiter arbiter) {\n             this.parent \u003d parent;\n             this.child \u003d child;\n-            request(initialRequest);\n-        }\n-\n-        void requestMore(long n) {\n-            request(n);\n+            this.arbiter \u003d arbiter;\n         }\n-\n+        \n         @Override\n         public void onNext(T t) {\n-            parent.decrementRequested();\n             child.onNext(t);\n+            parent.decrementRequested();\n+            arbiter.produced(1);\n         }\n \n         @Override\n         public void onError(Throwable e) {\n-            if (ONCE_UPDATER.compareAndSet(this, 0, 1)) {\n+            if (ONCE.compareAndSet(this, 0, 1)) {\n                 // terminal error through parent so everything gets cleaned up, including this inner\n                 parent.onError(e);\n             }\n         }\n \n         @Override\n         public void onCompleted() {\n-            if (ONCE_UPDATER.compareAndSet(this, 0, 1)) {\n+            if (ONCE.compareAndSet(this, 0, 1)) {\n                 // terminal completion to parent so it continues to the next\n                 parent.completeInner();\n             }\n         }\n+        \n+        @Override\n+        public void setProducer(Producer producer) {\n+            arbiter.setProducer(producer);\n+        }\n \n     };\n }"
        },
        {
          "file_name": "src/main/java/rx/internal/producers/ProducerArbiter.java",
          "patch": "@@ -95,7 +95,7 @@ public void produced(long n) {\n             if (r !\u003d Long.MAX_VALUE) {\n                 long u \u003d r - n;\n                 if (u \u003c 0) {\n-                    throw new IllegalStateException();\n+                    throw new IllegalStateException(\"more items arrived than were requested\");\n                 }\n                 requested \u003d u;\n             }"
        },
        {
          "file_name": "src/test/java/rx/internal/operators/OperatorConcatTest.java",
          "patch": "@@ -36,9 +36,7 @@\n import org.mockito.InOrder;\n \n import rx.Observable.OnSubscribe;\n-import rx.Scheduler.Worker;\n import rx.*;\n-import rx.functions.Action0;\n import rx.functions.Func1;\n import rx.internal.util.RxRingBuffer;\n import rx.observers.TestSubscriber;\n@@ -795,4 +793,33 @@ public void onNext(Integer t) {\n         assertTrue(completed.get());\n     }\n     \n+    @Test//(timeout \u003d 100000)\n+    public void concatMapRangeAsyncLoopIssue2876() {\n+        final long durationSeconds \u003d 2;\n+        final long startTime \u003d System.currentTimeMillis();\n+        for (int i \u003d 0;; i++) {\n+            //only run this for a max of ten seconds\n+            if (System.currentTimeMillis()-startTime \u003e TimeUnit.SECONDS.toMillis(durationSeconds))\n+                return;\n+            if (i % 1000 \u003d\u003d 0) {\n+                System.out.println(\"concatMapRangeAsyncLoop \u003e \" + i);\n+            }\n+            TestSubscriber\u003cInteger\u003e ts \u003d new TestSubscriber\u003cInteger\u003e();\n+            Observable.range(0, 1000)\n+            .concatMap(new Func1\u003cInteger, Observable\u003cInteger\u003e\u003e() {\n+                @Override\n+                public Observable\u003cInteger\u003e call(Integer t) {\n+                    return Observable.from(Arrays.asList(t));\n+                }\n+            })\n+            .observeOn(Schedulers.computation()).subscribe(ts);\n+\n+            ts.awaitTerminalEvent(2500, TimeUnit.MILLISECONDS);\n+            ts.assertTerminalEvent();\n+            ts.assertNoErrors();\n+            assertEquals(1000, ts.getOnNextEvents().size());\n+            assertEquals((Integer)999, ts.getOnNextEvents().get(999));\n+        }\n+    }\n+    \n }"
        }
      ]
    }
  },
  {
    "name": "Fix termination race condition in OperatorPublish.dispatch",
    "url": "https://github.com/ReactiveX/RxJava/pull/2934",
    "description": "Fixes the cause of #2933.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/ReactiveX/RxJava/commit/fe66cc9dfdee63f0523bc1d43bd505e63dc5b906",
      "files": [
        {
          "file_name": "src/main/java/rx/internal/operators/OperatorPublish.java",
          "patch": "@@ -459,6 +459,15 @@ void dispatch() {\n             try {\n                 for (;;) {\n                     /*\n+                     * We need to read terminalEvent before checking the queue for emptyness because\n+                     * all enqueue happens before setting the terminal event.\n+                     * If it were the other way around, when the emission is paused between\n+                     * checking isEmpty and checking terminalEvent, some other thread might\n+                     * have produced elements and set the terminalEvent and we\u0027d quit emitting\n+                     * prematurely.\n+                     */\n+                    Object term \u003d terminalEvent;\n+                    /*\n                      * See if the queue is empty; since we need this information multiple\n                      * times later on, we read it one.\n                      * Although the queue can become non-empty in the mean time, we will\n@@ -468,7 +477,7 @@ void dispatch() {\n                     // if the queue is empty and the terminal event was received, quit\n                     // and don\u0027t bother restoring emitting to false: no further activity is\n                     // possible at this point\n-                    if (checkTerminated(terminalEvent, empty)) {\n+                    if (checkTerminated(term, empty)) {\n                         skipFinal \u003d true;\n                         return;\n                     }\n@@ -508,10 +517,11 @@ void dispatch() {\n                         // it may happen everyone has unsubscribed between here and producers.get()\n                         // or we have no subscribers at all to begin with\n                         if (len \u003d\u003d unsubscribed) {\n+                            term \u003d terminalEvent;\n                             // so let\u0027s consume a value from the queue\n                             Object v \u003d queue.poll();\n                             // or terminate if there was a terminal event and the queue is empty\n-                            if (checkTerminated(terminalEvent, v \u003d\u003d null)) {\n+                            if (checkTerminated(term, v \u003d\u003d null)) {\n                                 skipFinal \u003d true;\n                                 return;\n                             }\n@@ -748,4 +758,4 @@ public void unsubscribe() {\n             }\n         }\n     }\n-}\n+}\n\\ No newline at end of file"
        }
      ]
    }
  },
  {
    "name": "Race condition when overdue attempts to cancel a subscription",
    "url": "https://github.com/killbill/killbill/issues/94",
    "description": "Consider the following scenario:\n- Overdue check scheduled effective at T\n- Payment retry scheduled effective at T\n\nThe payment retry will trigger an overdue refresh. Depending on timing, it is possible that they both end up trying to cancel the same subscription (the overdue state will be the same) and succeed, introducing multiple CANCEL events in subscription base.\n\nOne fix would be to resolve #39.\n\nWe probably also want to introduce an overdue _lock_ (which would be different than the entitlement one, and bail instead of wait in case a refresh is already in progress), to avoid sending multiple times the warning emails for example.\n",
    "keywords": [
      "cancel",
      "overdue",
      "subscription"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/killbill/killbill/commit/ef80631d8318ab923628bea9e00e2cfdd0f7ae13",
      "files": [
        {
          "file_name": "overdue/src/main/java/com/ning/billing/overdue/applicator/OverdueStateApplicator.java",
          "patch": "@@ -17,6 +17,7 @@\n package com.ning.billing.overdue.applicator;\n \n import java.io.IOException;\n+import java.util.Collection;\n import java.util.LinkedList;\n import java.util.List;\n import java.util.UUID;\n@@ -38,15 +39,14 @@\n import com.ning.billing.callcontext.InternalCallContext;\n import com.ning.billing.callcontext.InternalTenantContext;\n import com.ning.billing.catalog.api.BillingActionPolicy;\n+import com.ning.billing.catalog.api.ProductCategory;\n import com.ning.billing.clock.Clock;\n import com.ning.billing.entitlement.api.BlockingApiException;\n import com.ning.billing.entitlement.api.BlockingStateType;\n import com.ning.billing.entitlement.api.Entitlement;\n import com.ning.billing.entitlement.api.EntitlementApi;\n import com.ning.billing.entitlement.api.EntitlementApiException;\n import com.ning.billing.events.OverdueChangeInternalEvent;\n-import com.ning.billing.invoice.api.InvoiceApiException;\n-import com.ning.billing.invoice.api.InvoiceInternalApi;\n import com.ning.billing.junction.BlockingInternalApi;\n import com.ning.billing.junction.DefaultBlockingState;\n import com.ning.billing.overdue.OverdueApiException;\n@@ -69,6 +69,8 @@\n import com.ning.billing.util.tag.ControlTagType;\n import com.ning.billing.util.tag.Tag;\n \n+import com.google.common.base.Predicate;\n+import com.google.common.collect.Collections2;\n import com.google.common.collect.ImmutableList;\n import com.google.inject.Inject;\n import com.samskivert.mustache.MustacheException;\n@@ -266,10 +268,18 @@ private void cancelSubscriptionsIfRequired(final Account account, final OverdueS\n         }\n     }\n \n-    @SuppressWarnings(\"unchecked\")\n     private void computeEntitlementsToCancel(final Account account, final List\u003cEntitlement\u003e result, final InternalTenantContext context) throws EntitlementApiException {\n         final UUID tenantId \u003d nonEntityDao.retrieveIdFromObject(context.getTenantRecordId(), ObjectType.TENANT);\n-        result.addAll(entitlementApi.getAllEntitlementsForAccountId(account.getId(), context.toTenantContext(tenantId)));\n+        final List\u003cEntitlement\u003e allEntitlementsForAccountId \u003d entitlementApi.getAllEntitlementsForAccountId(account.getId(), context.toTenantContext(tenantId));\n+        // Entitlement is smart enough and will cancel the associated add-ons. See also discussion in https://github.com/killbill/killbill/issues/94\n+        final Collection\u003cEntitlement\u003e allEntitlementsButAddonsForAccountId \u003d Collections2.\u003cEntitlement\u003efilter(allEntitlementsForAccountId,\n+                                                                                                              new Predicate\u003cEntitlement\u003e() {\n+                                                                                                                  @Override\n+                                                                                                                  public boolean apply(final Entitlement entitlement) {\n+                                                                                                                      return !ProductCategory.ADD_ON.equals(entitlement.getLastActiveProductCategory());\n+                                                                                                                  }\n+                                                                                                              });\n+        result.addAll(allEntitlementsButAddonsForAccountId);\n     }\n \n     private void sendEmailIfRequired(final BillingState billingState, final Account account,"
        }
      ]
    }
  },
  {
    "name": "Race condition: null connection object",
    "url": "https://github.com/kontalk/androidclient/issues/694",
    "description": "And again...\n\n```\njava.lang.NullPointerException\n       at org.jivesoftware.smackx.csi.ClientStateIndicationManager.isSupported(ClientStateIndicationManager.java:41)\n       at org.jivesoftware.smackx.csi.ClientStateIndicationManager.throwIaeIfNotSupported(ClientStateIndicationManager.java:45)\n       at org.jivesoftware.smackx.csi.ClientStateIndicationManager.inactive(ClientStateIndicationManager.java:36)\n       at org.kontalk.service.msgcenter.MessageCenterService.inactive(MessageCenterService.java:1400)\n       at org.kontalk.service.msgcenter.MessageCenterService.access$200(MessageCenterService.java:148)\n       at org.kontalk.service.msgcenter.MessageCenterService$IdleConnectionHandler.handleMessage(MessageCenterService.java:440)\n       at org.kontalk.service.msgcenter.MessageCenterService$IdleConnectionHandler.handleMessage(MessageCenterService.java:420)\n       at android.os.Handler.dispatchMessage(Handler.java:99)\n       at android.os.Looper.loop(Looper.java:176)\n       at android.os.HandlerThread.run(HandlerThread.java:60)\n```\n\nIt seems that just checking against null isn\u0027t enough (damn concurrency).\n",
    "keywords": [
      "smackx",
      "os",
      "messagecenterservice",
      "org",
      "clientstateindicationmanager",
      "service",
      "android",
      "csi",
      "msgcenter",
      "jivesoftware",
      "kontalk"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/kontalk/androidclient/commit/6a57d0fdb6c4dda5925453b5187657042074ec7e",
      "files": [
        {
          "file_name": "app/src/main/java/org/kontalk/service/msgcenter/MessageCenterService.java",
          "patch": "@@ -1368,15 +1368,16 @@ private void discovery() {\n         sendPacket(items);\n     }\n \n-    private void active(boolean available) {\n-        if (mConnection !\u003d null) {\n+    private synchronized void active(boolean available) {\n+        final XMPPConnection connection \u003d mConnection;\n+        if (connection !\u003d null) {\n             cancelIdleAlarm();\n \n             if (available) {\n-                if (ClientStateIndicationManager.isSupported(mConnection)) {\n+                if (ClientStateIndicationManager.isSupported(connection)) {\n                     Log.d(TAG, \"entering active state\");\n                     try {\n-                        ClientStateIndicationManager.active(mConnection);\n+                        ClientStateIndicationManager.active(connection);\n                     }\n                     catch (NotConnectedException e) {\n                         return;\n@@ -1391,13 +1392,14 @@ private void active(boolean available) {\n         }\n     }\n \n-    private void inactive() {\n-        if (mConnection !\u003d null) {\n+    private synchronized void inactive() {\n+        final XMPPConnection connection \u003d mConnection;\n+        if (connection !\u003d null) {\n             if (!mInactive) {\n-                if (ClientStateIndicationManager.isSupported(mConnection)) {\n+                if (ClientStateIndicationManager.isSupported(connection)) {\n                     Log.d(TAG, \"entering inactive state\");\n                     try {\n-                        ClientStateIndicationManager.inactive(mConnection);\n+                        ClientStateIndicationManager.inactive(connection);\n                     }\n                     catch (NotConnectedException e) {\n                         cancelIdleAlarm();"
        }
      ]
    }
  },
  {
    "name": "Fix a race condition in Layer-Manager.",
    "url": "https://github.com/mapsforge/mapsforge/pull/799",
    "description": "This patch fix a race condition in the layer manager if layers are added/removed and the worker walk through the layer list.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/mapsforge/mapsforge/commit/a04d2cc994f505b086d71319e83995814cb9e9f1",
      "files": [
        {
          "file_name": "mapsforge-map/src/main/java/org/mapsforge/map/layer/LayerManager.java",
          "patch": "@@ -63,8 +63,10 @@ public void redrawLayers() {\n \n     @Override\n     protected void afterRun() {\n-        for (Layer layer : this.layers) {\n-            layer.onDestroy();\n+        synchronized (this.layers) {\n+            for (Layer layer : this.layers) {\n+                layer.onDestroy();\n+            }\n         }\n         this.drawingCanvas.destroy();\n     }\n@@ -85,9 +87,11 @@ protected void doWork() throws InterruptedException {\n             BoundingBox boundingBox \u003d MapPositionUtil.getBoundingBox(mapPosition, canvasDimension, tileSize);\n             Point topLeftPoint \u003d MapPositionUtil.getTopLeftPoint(mapPosition, canvasDimension, tileSize);\n \n-            for (Layer layer : this.layers) {\n-                if (layer.isVisible()) {\n-                    layer.draw(boundingBox, mapPosition.zoomLevel, this.drawingCanvas, topLeftPoint);\n+            synchronized (this.layers) {\n+                for (Layer layer : this.layers) {\n+                    if (layer.isVisible()) {\n+                        layer.draw(boundingBox, mapPosition.zoomLevel, this.drawingCanvas, topLeftPoint);\n+                    }\n                 }\n             }\n "
        }
      ]
    }
  },
  {
    "name": "ZWave: Fixed race condition of initializing converterMap",
    "url": "https://github.com/openhab/openhab2-addons/pull/688",
    "description": "",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/openhab/openhab2-addons/commit/ac0905fc3b70ab754adcc140d11066e36b1555f9",
      "files": [
        {
          "file_name": "addons/binding/org.openhab.binding.zwave/src/main/java/org/openhab/binding/zwave/internal/converter/ZWaveCommandClassConverter.java",
          "patch": "@@ -13,6 +13,7 @@\n import java.math.MathContext;\n import java.math.RoundingMode;\n import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n@@ -35,7 +36,32 @@\n  * @author Chris Jackson\n  */\n public abstract class ZWaveCommandClassConverter {\n-    private static Map\u003cCommandClass, Class\u003c? extends ZWaveCommandClassConverter\u003e\u003e converterMap \u003d null;\n+\n+    private static final Map\u003cCommandClass, Class\u003c? extends ZWaveCommandClassConverter\u003e\u003e converterMap;\n+\n+    static {\n+\n+        Map\u003cCommandClass, Class\u003c? extends ZWaveCommandClassConverter\u003e\u003e temp \u003d new HashMap\u003cCommandClass, Class\u003c? extends ZWaveCommandClassConverter\u003e\u003e();\n+\n+        temp.put(CommandClass.ALARM, ZWaveAlarmConverter.class);\n+        temp.put(CommandClass.BASIC, ZWaveBasicConverter.class);\n+        temp.put(CommandClass.BATTERY, ZWaveBatteryConverter.class);\n+        temp.put(CommandClass.COLOR, ZWaveColorConverter.class);\n+        temp.put(CommandClass.CONFIGURATION, ZWaveConfigurationConverter.class);\n+        temp.put(CommandClass.METER, ZWaveMeterConverter.class);\n+        temp.put(CommandClass.SENSOR_ALARM, ZWaveAlarmSensorConverter.class);\n+        temp.put(CommandClass.SENSOR_BINARY, ZWaveBinarySensorConverter.class);\n+        temp.put(CommandClass.SENSOR_MULTILEVEL, ZWaveMultiLevelSensorConverter.class);\n+        temp.put(CommandClass.SWITCH_BINARY, ZWaveBinarySwitchConverter.class);\n+        temp.put(CommandClass.SWITCH_MULTILEVEL, ZWaveMultiLevelSwitchConverter.class);\n+        temp.put(CommandClass.THERMOSTAT_FAN_MODE, ZWaveThermostatFanModeConverter.class);\n+        temp.put(CommandClass.THERMOSTAT_FAN_STATE, ZWaveThermostatFanStateConverter.class);\n+        temp.put(CommandClass.THERMOSTAT_MODE, ZWaveThermostatModeConverter.class);\n+        temp.put(CommandClass.THERMOSTAT_OPERATING_STATE, ZWaveThermostatOperatingStateConverter.class);\n+        temp.put(CommandClass.THERMOSTAT_SETPOINT, ZWaveThermostatSetpointConverter.class);\n+\n+        converterMap \u003d Collections.unmodifiableMap(temp);\n+    }\n \n     private static Logger logger \u003d LoggerFactory.getLogger(ZWaveCommandClassConverter.class);\n \n@@ -89,27 +115,6 @@ public int getRefreshInterval() {\n     }\n \n     public static ZWaveCommandClassConverter getConverter(CommandClass commandClass) {\n-        if (converterMap \u003d\u003d null) {\n-            converterMap \u003d new HashMap\u003cCommandClass, Class\u003c? extends ZWaveCommandClassConverter\u003e\u003e();\n-\n-            converterMap.put(CommandClass.ALARM, ZWaveAlarmConverter.class);\n-            converterMap.put(CommandClass.BASIC, ZWaveBasicConverter.class);\n-            converterMap.put(CommandClass.BATTERY, ZWaveBatteryConverter.class);\n-            converterMap.put(CommandClass.COLOR, ZWaveColorConverter.class);\n-            converterMap.put(CommandClass.CONFIGURATION, ZWaveConfigurationConverter.class);\n-            converterMap.put(CommandClass.METER, ZWaveMeterConverter.class);\n-            converterMap.put(CommandClass.SENSOR_ALARM, ZWaveAlarmSensorConverter.class);\n-            converterMap.put(CommandClass.SENSOR_BINARY, ZWaveBinarySensorConverter.class);\n-            converterMap.put(CommandClass.SENSOR_MULTILEVEL, ZWaveMultiLevelSensorConverter.class);\n-            converterMap.put(CommandClass.SWITCH_BINARY, ZWaveBinarySwitchConverter.class);\n-            converterMap.put(CommandClass.SWITCH_MULTILEVEL, ZWaveMultiLevelSwitchConverter.class);\n-            converterMap.put(CommandClass.THERMOSTAT_FAN_MODE, ZWaveThermostatFanModeConverter.class);\n-            converterMap.put(CommandClass.THERMOSTAT_FAN_STATE, ZWaveThermostatFanStateConverter.class);\n-            converterMap.put(CommandClass.THERMOSTAT_MODE, ZWaveThermostatModeConverter.class);\n-            converterMap.put(CommandClass.THERMOSTAT_OPERATING_STATE, ZWaveThermostatOperatingStateConverter.class);\n-            converterMap.put(CommandClass.THERMOSTAT_SETPOINT, ZWaveThermostatSetpointConverter.class);\n-        }\n-\n         Constructor\u003c? extends ZWaveCommandClassConverter\u003e constructor;\n         try {\n             if (converterMap.get(commandClass) \u003d\u003d null) {"
        }
      ]
    }
  },
  {
    "name": "Race condition in notifications",
    "url": "https://github.com/kontalk/androidclient/issues/273",
    "description": "And a very rare one. See: https://github.com/kontalk/androidclient/blob/master/app/src/main/java/org/kontalk/ui/MessagingNotification.java#L303\n\nIf the account is being removed in the meantime this method is executing (because it\u0027s called from a different thread), `getDefaultAccount` will return null, effectively generating a fatal NPE.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/kontalk/androidclient/commit/637d0f7a407ce67090e84535c499c83042df36ee",
      "files": [
        {
          "file_name": "app/src/main/java/org/kontalk/ui/MessagingNotification.java",
          "patch": "@@ -31,6 +31,7 @@\n import org.kontalk.provider.MyMessages.Threads;\n import org.kontalk.util.Preferences;\n \n+import android.accounts.Account;\n import android.app.Notification;\n import android.app.NotificationManager;\n import android.app.PendingIntent;\n@@ -143,6 +144,10 @@ public static void updateMessagesNotification(Context context, boolean isNew) {\n         // notifications are disabled\n         if (!Preferences.getNotificationsEnabled(context))\n             return;\n+        // no default account. WTF?!?\n+        Account account \u003d Authenticator.getDefaultAccount(context);\n+        if (account \u003d\u003d null)\n+            return;\n \n         // if notifying new messages, wait a little bit\n         // to let all incoming messages come through\n@@ -300,7 +305,7 @@ else if (content \u003d\u003d null \u0026\u0026 attMime !\u003d null) {\n                     // TODO i18n\n                     summary \u003d \"+\" + (convs.size() - count) + \" more\";\n                 else\n-                    summary \u003d Authenticator.getDefaultAccount(context).name;\n+                    summary \u003d account.name;\n \n                 ((InboxStyle) style).setSummaryText(summary);\n             }\n@@ -312,7 +317,7 @@ else if (content \u003d\u003d null \u0026\u0026 attMime !\u003d null) {\n                 // big text content\n                 style \u003d new BigTextStyle();\n                 ((BigTextStyle) style).bigText(content);\n-                ((BigTextStyle) style).setSummaryText(Authenticator.getDefaultAccount(context).name);\n+                ((BigTextStyle) style).setSummaryText(account.name);\n \n                 // ticker\n                 Contact contact \u003d Contact.findByUserId(context, peer);"
        }
      ]
    }
  },
  {
    "name": "Context race condition (null reference)",
    "url": "https://github.com/kontalk/androidclient/issues/965",
    "description": "```\r\njava.lang.NullPointerException: Attempt to invoke virtual method \u0027android.content.res.Resources android.content.Context.getResources()\u0027 on a null object reference\r\n       at org.kontalk.util.Preferences.getEncryptionEnabled(Preferences.java:196)\r\n       at org.kontalk.ui.AbstractComposeFragment.updateUI(AbstractComposeFragment.java:1963)\r\n       at org.kontalk.ui.ComposeMessageFragment.updateUI(ComposeMessageFragment.java:1027)\r\n       at org.kontalk.ui.AbstractComposeFragment.onCreateOptionsMenu(AbstractComposeFragment.java:765)\r\n       at android.support.v4.app.Fragment.performCreateOptionsMenu(Fragment.java:2288)\r\n       at android.support.v4.app.FragmentManagerImpl.dispatchCreateOptionsMenu(FragmentManager.java:2984)\r\n       at android.support.v4.app.FragmentController.dispatchCreateOptionsMenu(FragmentController.java:328)\r\n       at android.support.v4.app.FragmentActivity.onCreatePanelMenu(FragmentActivity.java:363)\r\n       at android.support.v7.view.WindowCallbackWrapper.onCreatePanelMenu(WindowCallbackWrapper.java:98)\r\n       at android.support.v7.app.AppCompatDelegateImplBase$AppCompatWindowCallbackBase.onCreatePanelMenu(AppCompatDelegateImplBase.java:335)\r\n       at android.support.v7.view.WindowCallbackWrapper.onCreatePanelMenu(WindowCallbackWrapper.java:98)\r\n       at android.support.v7.app.ToolbarActionBar.populateOptionsMenu(ToolbarActionBar.java:454)\r\n       at android.support.v7.app.ToolbarActionBar$1.run(ToolbarActionBar.java:61)\r\n       at android.os.Handler.handleCallback(Handler.java:739)\r\n       at android.os.Handler.dispatchMessage(Handler.java:95)\r\n       at android.os.Looper.loop(Looper.java:135)\r\n       at android.app.ActivityThread.main(ActivityThread.java:5669)\r\n       at java.lang.reflect.Method.invoke(Method.java)\r\n       at java.lang.reflect.Method.invoke(Method.java:372)\r\n       at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:960)\r\n       at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:755)\r\n```",
    "keywords": [
      "app",
      "v7",
      "handler",
      "os",
      "method",
      "org",
      "android",
      "abstractcomposefragment",
      "android support",
      "invoke",
      "org kontalk",
      "windowcallbackwrapper",
      "java",
      "ui",
      "oncreatepanelmenu",
      "toolbaractionbar",
      "lang",
      "support",
      "kontalk",
      "v4",
      "zygoteinit"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/kontalk/androidclient/commit/f43304fe70da9d42425378d7be74048556970ee7",
      "files": [
        {
          "file_name": "app/src/main/java/org/kontalk/ui/AbstractComposeFragment.java",
          "patch": "@@ -1958,18 +1958,20 @@ protected void updateUI() {\n \n         if (mToggleEncryptionMenu !\u003d null) {\n             Context context \u003d getActivity();\n-            if (mConversation !\u003d null \u0026\u0026 Preferences.getEncryptionEnabled(context)) {\n-                boolean encryption \u003d mConversation.isEncryptionEnabled();\n-                mToggleEncryptionMenu\n-                    .setVisible(true)\n-                    .setEnabled(true)\n-                    .setChecked(encryption);\n-            }\n-            else {\n-                mToggleEncryptionMenu\n-                    .setVisible(false)\n-                    .setEnabled(false)\n-                    .setChecked(false);\n+            if (context !\u003d null) {\n+                if (mConversation !\u003d null \u0026\u0026 Preferences.getEncryptionEnabled(context)) {\n+                    boolean encryption \u003d mConversation.isEncryptionEnabled();\n+                    mToggleEncryptionMenu\n+                        .setVisible(true)\n+                        .setEnabled(true)\n+                        .setChecked(encryption);\n+                }\n+                else {\n+                    mToggleEncryptionMenu\n+                        .setVisible(false)\n+                        .setEnabled(false)\n+                        .setChecked(false);\n+                }\n             }\n         }\n     }"
        }
      ]
    }
  },
  {
    "name": "fix #2991: race condition in OnheapIncrementalIndex#addToFacts",
    "url": "https://github.com/druid-io/druid/pull/3002",
    "description": "",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/druid-io/druid/commit/b5bd40659733ee5acf7e0be1cd317f6602b1cda4",
      "files": [
        {
          "file_name": "processing/src/main/java/io/druid/segment/incremental/OnheapIncrementalIndex.java",
          "patch": "@@ -170,20 +170,13 @@ protected Integer addToFacts(\n \n     if (null !\u003d priorIndex) {\n       aggs \u003d concurrentGet(priorIndex);\n+      doAggregate(aggs, rowContainer, row, reportParseExceptions);\n     } else {\n       aggs \u003d new Aggregator[metrics.length];\n-\n-      rowContainer.set(row);\n-      for (int i \u003d 0; i \u003c metrics.length; i++) {\n-        final AggregatorFactory agg \u003d metrics[i];\n-        aggs[i] \u003d agg.factorize(\n-            selectors.get(agg.getName())\n-        );\n-      }\n-      rowContainer.set(null);\n+      factorizeAggs(metrics, aggs, rowContainer, row);\n+      doAggregate(aggs, rowContainer, row, reportParseExceptions);\n \n       final Integer rowIndex \u003d indexIncrement.getAndIncrement();\n-\n       concurrentSet(rowIndex, aggs);\n \n       // Last ditch sanity checks\n@@ -196,12 +189,38 @@ protected Integer addToFacts(\n       } else {\n         // We lost a race\n         aggs \u003d concurrentGet(prev);\n+        doAggregate(aggs, rowContainer, row, reportParseExceptions);\n         // Free up the misfire\n         concurrentRemove(rowIndex);\n         // This is expected to occur ~80% of the time in the worst scenarios\n       }\n     }\n \n+    return numEntries.get();\n+  }\n+\n+  private void factorizeAggs(\n+      AggregatorFactory[] metrics,\n+      Aggregator[] aggs,\n+      ThreadLocal\u003cInputRow\u003e rowContainer,\n+      InputRow row\n+  )\n+  {\n+    rowContainer.set(row);\n+    for (int i \u003d 0; i \u003c metrics.length; i++) {\n+      final AggregatorFactory agg \u003d metrics[i];\n+      aggs[i] \u003d agg.factorize(selectors.get(agg.getName()));\n+    }\n+    rowContainer.set(null);\n+  }\n+\n+  private void doAggregate(\n+      Aggregator[] aggs,\n+      ThreadLocal\u003cInputRow\u003e rowContainer,\n+      InputRow row,\n+      boolean reportParseExceptions\n+  )\n+  {\n     rowContainer.set(row);\n \n     for (Aggregator agg : aggs) {\n@@ -221,9 +240,6 @@ protected Integer addToFacts(\n     }\n \n     rowContainer.set(null);\n-\n-\n-    return numEntries.get();\n   }\n \n   protected Aggregator[] concurrentGet(int offset)"
        },
        {
          "file_name": "processing/src/test/java/io/druid/segment/incremental/OnheapIncrementalIndexTest.java",
          "patch": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to Metamarkets Group Inc. (Metamarkets) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. Metamarkets licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package io.druid.segment.incremental;\n+\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Lists;\n+import io.druid.data.input.MapBasedInputRow;\n+import io.druid.granularity.QueryGranularities;\n+import io.druid.query.aggregation.AggregatorFactory;\n+import io.druid.query.aggregation.LongMaxAggregatorFactory;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.util.Random;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+public class OnheapIncrementalIndexTest\n+{\n+\n+  private static final int MAX_ROWS \u003d 100000;\n+\n+  @Test\n+  public void testMultithreadAddFacts() throws Exception\n+  {\n+    final OnheapIncrementalIndex index \u003d new OnheapIncrementalIndex(\n+        0,\n+        QueryGranularities.MINUTE,\n+        new AggregatorFactory[]{new LongMaxAggregatorFactory(\"max\", \"max\")},\n+        MAX_ROWS\n+    );\n+\n+    final Random random \u003d new Random();\n+    final int addThreadCount \u003d 2;\n+    Thread[] addThreads \u003d new Thread[addThreadCount];\n+    for (int i \u003d 0; i \u003c addThreadCount; ++i) {\n+      addThreads[i] \u003d new Thread(new Runnable()\n+      {\n+        @Override\n+        public void run()\n+        {\n+          try {\n+            for (int j \u003d 0; j \u003c MAX_ROWS / addThreadCount; ++j) {\n+              index.add(new MapBasedInputRow(\n+                  0,\n+                  Lists.newArrayList(\"billy\"),\n+                  ImmutableMap.\u003cString, Object\u003eof(\"billy\", random.nextLong(), \"max\", 1)\n+              ));\n+            }\n+          }\n+          catch (Exception e) {\n+            throw new RuntimeException(e);\n+          }\n+        }\n+      });\n+      addThreads[i].start();\n+    }\n+\n+    final AtomicInteger checkFailedCount \u003d new AtomicInteger(0);\n+    Thread checkThread \u003d new Thread(new Runnable()\n+    {\n+      @Override\n+      public void run()\n+      {\n+        while (!Thread.interrupted()) {\n+          for (int row : index.getFacts().values()) {\n+            if (index.getMetricLongValue(row, 0) !\u003d 1) {\n+              checkFailedCount.addAndGet(1);\n+            }\n+          }\n+        }\n+      }\n+    });\n+    checkThread.start();\n+\n+    for (int i \u003d 0; i \u003c addThreadCount; ++i) {\n+      addThreads[i].join();\n+    }\n+    checkThread.interrupt();\n+\n+    Assert.assertEquals(0, checkFailedCount.get());\n+  }\n+}\n\\ No newline at end of file"
        }
      ]
    }
  },
  {
    "name": "Race condition on Shutdown?",
    "url": "https://github.com/brettwooldridge/HikariCP/issues/229",
    "description": "Hi,\n\nif I shutdown Hikari before the Pool has been fully initialized (I guess before all the connections have been opened) sometimes I get an IllegalSateException\n\n`2015.01.19 13:47:44,793 CET [main] DEBUG HikariPool - Before shutdown pool stats HikariPool-0 (total\u003d8, inUse\u003d0, avail\u003d8, waiting\u003d0)\n2015.01.19 13:47:44,933 CET [HikariCP connection filler (pool HikariPool-0)] DEBUG HikariPool - Connection attempt to database HikariPool-0 failed: ConcurrentBag has been closed\njava.lang.IllegalStateException: ConcurrentBag has been closed\n    at com.zaxxer.hikari.util.ConcurrentBag.add(ConcurrentBag.java:184)\n    at com.zaxxer.hikari.pool.HikariPool.addConnection(HikariPool.java:436)\n    at com.zaxxer.hikari.pool.HikariPool.access$400(HikariPool.java:73)\n    at com.zaxxer.hikari.pool.HikariPool$1AddConnection.run(HikariPool.java:315)\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n    at java.util.concurrent.FutureTask.run(FutureTask.java:262)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:724)\n2015.01.19 13:47:45,41 CET [main] DEBUG HikariPool - After shutdown pool stats HikariPool-0 (total\u003d0, inUse\u003d0, avail\u003d0, waiting\u003d0)`\n\nNote the before shutting down total being 8 while my setting is `config.setMaximumPoolSize(10);`\nMaybe the `shutdown()` command does not stop the `addConnection()`?\n\nAnother question (probably unrelated): I have a project organized this way:\n- war\n  - jar1 accessing Oracle DB\n  - jar2 accessing MSSQL DB\n\nOn startup but jar1 \u0026 2 try to create their own Pool (they create a new config and create a new pool). In the classpath they share the same Hikari Jar. Is that supposed to work? Because I get strange errors!\n\nThanks\nAndrea\n",
    "keywords": [
      "com",
      "threadpoolexecutor",
      "`",
      "01",
      "debug",
      "java util",
      "concurrent",
      "19",
      "pool",
      "run",
      "zaxxer",
      "hikaripool",
      "hikaripool-0",
      "cet",
      "java",
      "util",
      "create",
      "shutdown",
      "hikari",
      "concurrentbag"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/brettwooldridge/HikariCP/commit/d4e426ba48d84b6e51d379ca7dab22eccf6710af",
      "files": [
        {
          "file_name": "hikaricp-common/src/main/java/com/zaxxer/hikari/pool/BaseHikariPool.java",
          "patch": "@@ -262,7 +262,7 @@ public final void shutdown() throws InterruptedException\n          connectionBag.close();\n          softEvictConnections();\n          houseKeepingExecutorService.shutdown();\n-         addConnectionExecutor.shutdown();\n+         addConnectionExecutor.shutdownNow();\n          houseKeepingExecutorService.awaitTermination(5L, TimeUnit.SECONDS);\n          addConnectionExecutor.awaitTermination(5L, TimeUnit.SECONDS);\n \n@@ -456,11 +456,13 @@ protected final boolean addConnection()\n          }\n          catch (Exception e) {\n             lastConnectionFailure.set(e);\n+            if (poolState \u003d\u003d POOL_RUNNING) {\n+               LOGGER.debug(\"Connection attempt to database {} failed: {}\", configuration.getPoolName(), e.getMessage(), e);\n+            }\n             poolUtils.quietlyCloseConnection(connection);\n-            LOGGER.debug(\"Connection attempt to database {} failed: {}\", configuration.getPoolName(), e.getMessage(), e);\n          }\n       }\n-   \n+\n       totalConnections.decrementAndGet(); // We failed or pool is max, so undo speculative increment of totalConnections\n       return false;\n    }"
        },
        {
          "file_name": "hikaricp-common/src/test/java/com/zaxxer/hikari/ShutdownTest.java",
          "patch": "@@ -239,12 +239,35 @@ public void testAfterShutdown() throws Exception\n    }\n \n    @Test\n+   public void testShutdownDuringInit() throws Exception\n+   {\n+      final HikariConfig config \u003d new HikariConfig();\n+      config.setMinimumIdle(5);\n+      config.setMaximumPoolSize(5);\n+      config.setConnectionTimeout(1000);\n+      config.setValidationTimeout(1000);\n+      config.setInitializationFailFast(true);\n+      config.setConnectionTestQuery(\"VALUES 1\");\n+      config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");\n+\n+      HikariDataSource ds \u003d new HikariDataSource(config);\n+      try {\n+         StubConnection.slowCreate \u003d true;\n+         UtilityElf.quietlySleep(3000L);\n+      }\n+      finally {\n+         ds.close();\n+      }\n+   }\n+\n+   @Test\n    public void testThreadedShutdown() throws Exception\n    {\n       final HikariConfig config \u003d new HikariConfig();\n       config.setMinimumIdle(5);\n       config.setMaximumPoolSize(5);\n       config.setConnectionTimeout(1000);\n+      config.setValidationTimeout(1000);\n       config.setInitializationFailFast(true);\n       config.setConnectionTestQuery(\"VALUES 1\");\n       config.setDataSourceClassName(\"com.zaxxer.hikari.mocks.StubDataSource\");"
        }
      ]
    }
  },
  {
    "name": "[#2993] Server metadata listener notification has a race condition",
    "url": "https://github.com/naver/pinpoint/pull/2994",
    "description": "use synchronized to prevent race condition",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/naver/pinpoint/commit/f349c7a0df72ead709a9a1ed0586ceb0a99536bd",
      "files": [
        {
          "file_name": "profiler/src/main/java/com/navercorp/pinpoint/profiler/context/DefaultServerMetaDataHolder.java",
          "patch": "@@ -16,6 +16,10 @@\n \r\n package com.navercorp.pinpoint.profiler.context;\r\n \r\n+import com.navercorp.pinpoint.bootstrap.context.ServerMetaData;\r\n+import com.navercorp.pinpoint.bootstrap.context.ServerMetaDataHolder;\r\n+import com.navercorp.pinpoint.bootstrap.context.ServiceInfo;\r\n+\r\n import java.util.ArrayList;\r\n import java.util.Collections;\r\n import java.util.HashMap;\r\n@@ -25,10 +29,6 @@\n import java.util.concurrent.ConcurrentHashMap;\r\n import java.util.concurrent.ConcurrentLinkedQueue;\r\n \r\n-import com.navercorp.pinpoint.bootstrap.context.ServerMetaData;\r\n-import com.navercorp.pinpoint.bootstrap.context.ServerMetaDataHolder;\r\n-import com.navercorp.pinpoint.bootstrap.context.ServiceInfo;\r\n-\r\n /**\r\n  * @author hyungil.jeong\r\n  */\r\n@@ -73,7 +73,7 @@ public void removeListener(ServerMetaDataListener listener) {\n     }\r\n \r\n     @Override\r\n-    public void notifyListeners() {\r\n+    public synchronized void notifyListeners() {\r\n         final ServerMetaData serverMetaData \u003d createServerMetaData();\r\n         for (ServerMetaDataListener listener : this.listeners) {\r\n             listener.publishServerMetaData(serverMetaData);\r"
        }
      ]
    }
  },
  {
    "name": "NPE due to race condition",
    "url": "https://github.com/integrity-tf/integrity/issues/61",
    "description": "When using the fork feature, NPEs can happen:\n\n```\n [java] ERROR occurred:  during test runner execution!\n     [java]          FO      FORK \u0027till0\u0027RK : Process terminated!\u0027\n     [java] till0\u0027: Process terminated!\n     [java] Exception in thread \"Thread-8\" java.lang.NullPointerException\n     [java]          at de.gebit.integrity.runner.forking.Fork$ForkMonitor.run(Fork.java:564)\n```\n",
    "keywords": [
      "fork",
      "[java]"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/integrity-tf/integrity/commit/ae93a9421cf459b5b2e789f1dea2311567491cb4",
      "files": [
        {
          "file_name": "de.gebit.integrity.runner/src/de/gebit/integrity/runner/forking/Fork.java",
          "patch": "@@ -561,7 +561,9 @@ public void run() {\n \t\t\t\t} catch (InterruptedException exc) {\n \t\t\t\t\t// ignore\n \t\t\t\t}\n-\t\t\t\tif (!process.isAlive()) {\n+\t\t\t\tif (process \u003d\u003d null) {\n+\t\t\t\t\tkill();\n+\t\t\t\t} else if (!process.isAlive()) {\n \t\t\t\t\tsynchronized (Fork.this) {\n \t\t\t\t\t\tif (!forkDeathConfirmed) {\n \t\t\t\t\t\t\tforkDeathConfirmed \u003d true;\n@@ -570,7 +572,7 @@ public void run() {\n \t\t\t\t\t\t\tprocess \u003d null;\n \t\t\t\t\t\t\tforkCallback.onForkExit(Fork.this);\n \t\t\t\t\t\t\tFork.this.notifyAll();\n-\t\t\t\t\t\t\treturn;\n+\t\t\t\t\t\t\tkill();\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n \t\t\t\t}"
        }
      ]
    }
  },
  {
    "name": "WringWorkerManager race condition causes extra worker",
    "url": "https://github.com/Multifarious/skid-road/issues/18",
    "description": "Main record() flow can kick of asynchronous worker creation when a new queue is created. If pruner runs between queue creation and completion of the async worker creation, then it also creates a worker. Mostly harmless, but creates an extra log file where none is needed.\n",
    "keywords": [
      "worker",
      "creation"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/Multifarious/skid-road/commit/cf152f5bf89112f4748a09c83529ed931fbec478",
      "files": [
        {
          "file_name": "skid-road/src/main/java/io/ifar/skidroad/writing/WritingWorkerManager.java",
          "patch": "@@ -178,16 +178,17 @@ public void record(T item) {\n             }\n         }\n \n-        if (shouldLaunchNewWorker)\n+        if (shouldLaunchNewWorker) {\n             asyncWorkerCreator.submit(new Runnable() {\n                 public void run() {\n                     try {\n-                        launchNewWorker(queue, startTime);\n+                        launchNewWorker(queue, startTime, 1);\n                     } catch (Exception e) {\n                         LOG.error(\"Could not launch WritingWorker\", e);\n                     }\n                 }\n             });\n+        }\n \n         return queue;\n     }\n@@ -254,7 +255,7 @@ protected void prune() {\n                 List\u003cThread\u003e workersForQueue \u003d getWorkersForStartTime(startTime);\n                 boolean needAnotherWorker \u003d workersForQueue.isEmpty() || (queue.size() \u003e\u003d spawnNewWorkerAtQueueDepth \u0026\u0026 workersForQueue.size() \u003c NUM_PROCESSORS);\n                 if (needAnotherWorker)\n-                    launchNewWorker(queue, startTime);\n+                    launchNewWorker(queue, startTime, workersForQueue.size() + 1);\n             }\n         }\n     }\n@@ -269,20 +270,31 @@ protected void prune() {\n         return result;\n     }\n \n-    protected void launchNewWorker(BlockingQueue\u003cT\u003e queue, DateTime startTime) {\n-        LOG.debug(\"Launching new worker for {}\", rollingScheme.getRepresentation(startTime));\n-        String logFilePathPattern \u003d rollingScheme.makeOutputPathPattern(startTime);\n-        LogFile logFileRecord \u003d tracker.open(rollingScheme.getRepresentation(startTime), logFilePathPattern, startTime);\n-        Thread worker \u003d factory.buildWorker(queue, logFileRecord, tracker);\n+    /**\n+     * CReates a new worker to consume from the provided queue.\n+     * @param queue queue from which worker will fetch events\n+     * @param startTime used to generate filename for worker\u0027s output\n+     * @param maxCount abort if queue already has this many workers\n+     */\n+    protected void launchNewWorker(BlockingQueue\u003cT\u003e queue, DateTime startTime, int maxCount) {\n         synchronized (workers) {\n             List\u003cThread\u003e workersForQueue \u003d workers.get(startTime);\n-            if (workersForQueue \u003d\u003d null) {\n-                workersForQueue \u003d new LinkedList\u003c\u003e();\n-                workers.put(startTime,workersForQueue);\n+            int currentCount \u003d workersForQueue \u003d\u003d null ? 0 : workersForQueue.size();\n+            if (currentCount \u003c maxCount) {\n+                LOG.debug(\"Launching new worker for {}\", rollingScheme.getRepresentation(startTime));\n+                String logFilePathPattern \u003d rollingScheme.makeOutputPathPattern(startTime);\n+                LogFile logFileRecord \u003d tracker.open(rollingScheme.getRepresentation(startTime), logFilePathPattern, startTime);\n+                Thread worker \u003d factory.buildWorker(queue, logFileRecord, tracker);\n+                if (workersForQueue \u003d\u003d null) {\n+                    workersForQueue \u003d new LinkedList\u003c\u003e();\n+                    workers.put(startTime,workersForQueue);\n+                }\n+                workersForQueue.add(worker);\n+                worker.start();\n+            } else {\n+                LOG.debug(\"Skip launch of new worker for {}; already have {}.\", rollingScheme.getRepresentation(startTime), maxCount);\n             }\n-            workersForQueue.add(worker);\n         }\n-        worker.start();\n     }\n \n     public void start() throws Exception {"
        }
      ]
    }
  },
  {
    "name": "Fix race condition in snapshot initialization",
    "url": "https://github.com/elastic/elasticsearch/pull/18426",
    "description": "When a snapshot initialization fails, the create snapshot method may return before the snapshot metadata in the cluster state is removed. This can cause follow up snapshot-API related calls to fail due to a snapshot still running. This is causing CI failures when we try to delete indices that were participating in failed snapshot to a read-only repository.\n\nCloses #18121\n",
    "keywords": [
      "snapshot"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/elastic/elasticsearch/commit/ce88d7f9ab8932b0d0db32021c622c3f5a86cd6e",
      "files": [
        {
          "file_name": "core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java",
          "patch": "@@ -23,6 +23,7 @@\n import com.carrotsearch.hppc.cursors.ObjectObjectCursor;\n import org.apache.lucene.util.CollectionUtil;\n import org.elasticsearch.ExceptionsHelper;\n+import org.elasticsearch.action.ActionListener;\n import org.elasticsearch.action.search.ShardSearchFailure;\n import org.elasticsearch.action.support.IndicesOptions;\n import org.elasticsearch.cluster.ClusterChangedEvent;\n@@ -44,6 +45,7 @@\n import org.elasticsearch.cluster.routing.RoutingTable;\n import org.elasticsearch.cluster.routing.ShardRouting;\n import org.elasticsearch.cluster.service.ClusterService;\n+import org.elasticsearch.common.Nullable;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.common.collect.ImmutableOpenMap;\n import org.elasticsearch.common.collect.Tuple;\n@@ -366,14 +368,7 @@ public ClusterState execute(ClusterState currentState) {\n                 @Override\n                 public void onFailure(String source, Throwable t) {\n                     logger.warn(\"[{}] failed to create snapshot\", t, snapshot.snapshotId());\n-                    removeSnapshotFromClusterState(snapshot.snapshotId(), null, t);\n-                    try {\n-                        repositoriesService.repository(snapshot.snapshotId().getRepository()).finalizeSnapshot(\n-                                snapshot.snapshotId(), snapshot.indices(), snapshot.startTime(), ExceptionsHelper.detailedMessage(t), 0, Collections.\u003cSnapshotShardFailure\u003eemptyList());\n-                    } catch (Throwable t2) {\n-                        logger.warn(\"[{}] failed to close snapshot in repository\", snapshot.snapshotId());\n-                    }\n-                    userCreateSnapshotListener.onFailure(t);\n+                    removeSnapshotFromClusterState(snapshot.snapshotId(), null, t, new CleanupAfterErrorListener(snapshot, true, userCreateSnapshotListener, t));\n                 }\n \n                 @Override\n@@ -395,17 +390,46 @@ public void clusterStateProcessed(String source, ClusterState oldState, ClusterS\n             });\n         } catch (Throwable t) {\n             logger.warn(\"failed to create snapshot [{}]\", t, snapshot.snapshotId());\n-            removeSnapshotFromClusterState(snapshot.snapshotId(), null, t);\n-            if (snapshotCreated) {\n+            removeSnapshotFromClusterState(snapshot.snapshotId(), null, t, new CleanupAfterErrorListener(snapshot, snapshotCreated, userCreateSnapshotListener, t));\n+        }\n+    }\n+\n+    private class CleanupAfterErrorListener implements ActionListener\u003cSnapshotInfo\u003e {\n+\n+        private final SnapshotsInProgress.Entry snapshot;\n+        private final boolean snapshotCreated;\n+        private final CreateSnapshotListener userCreateSnapshotListener;\n+        private final Throwable t;\n+\n+        public CleanupAfterErrorListener(SnapshotsInProgress.Entry snapshot, boolean snapshotCreated, CreateSnapshotListener userCreateSnapshotListener, Throwable t) {\n+            this.snapshot \u003d snapshot;\n+            this.snapshotCreated \u003d snapshotCreated;\n+            this.userCreateSnapshotListener \u003d userCreateSnapshotListener;\n+            this.t \u003d t;\n+        }\n+\n+        @Override\n+        public void onResponse(SnapshotInfo snapshotInfo) {\n+            cleanupAfterError();\n+        }\n+\n+        @Override\n+        public void onFailure(Throwable e) {\n+            cleanupAfterError();\n+        }\n+\n+        private void cleanupAfterError() {\n+            if(snapshotCreated) {\n                 try {\n-                    repositoriesService.repository(snapshot.snapshotId().getRepository()).finalizeSnapshot(snapshot.snapshotId(), snapshot.indices(), snapshot.startTime(),\n-                            ExceptionsHelper.detailedMessage(t), 0, Collections.\u003cSnapshotShardFailure\u003eemptyList());\n+                    repositoriesService.repository(snapshot.snapshotId().getRepository()).finalizeSnapshot(\n+                        snapshot.snapshotId(), snapshot.indices(), snapshot.startTime(), ExceptionsHelper.detailedMessage(t), 0, Collections.\u003cSnapshotShardFailure\u003eemptyList());\n                 } catch (Throwable t2) {\n                     logger.warn(\"[{}] failed to close snapshot in repository\", snapshot.snapshotId());\n                 }\n             }\n             userCreateSnapshotListener.onFailure(t);\n         }\n+\n     }\n \n     private SnapshotInfo inProgressSnapshot(SnapshotsInProgress.Entry entry) {\n@@ -818,6 +842,19 @@ public void run() {\n      * @param t          exception if snapshot failed\n      */\n     private void removeSnapshotFromClusterState(final SnapshotId snapshotId, final SnapshotInfo snapshot, final Throwable t) {\n+        removeSnapshotFromClusterState(snapshotId, snapshot, t, null);\n+    }\n+\n+    /**\n+     * Removes record of running snapshot from cluster state and notifies the listener when this action is complete\n+     *\n+     * @param snapshotId snapshot id\n+     * @param snapshot   snapshot info if snapshot was successful\n+     * @param t          exception if snapshot failed\n+     * @param listener   listener to notify when snapshot information is removed from the cluster state\n+     */\n+    private void removeSnapshotFromClusterState(final SnapshotId snapshotId, final SnapshotInfo snapshot, final Throwable t,\n+                                                @Nullable ActionListener\u003cSnapshotInfo\u003e listener) {\n         clusterService.submitStateUpdateTask(\"remove snapshot metadata\", new ClusterStateUpdateTask() {\n             @Override\n             public ClusterState execute(ClusterState currentState) {\n@@ -843,6 +880,9 @@ public ClusterState execute(ClusterState currentState) {\n             @Override\n             public void onFailure(String source, Throwable t) {\n                 logger.warn(\"[{}] failed to remove snapshot metadata\", t, snapshotId);\n+                if (listener !\u003d null) {\n+                    listener.onFailure(t);\n+                }\n             }\n \n             @Override\n@@ -858,7 +898,9 @@ public void clusterStateProcessed(String source, ClusterState oldState, ClusterS\n                         logger.warn(\"failed to notify listener [{}]\", t, listener);\n                     }\n                 }\n-\n+                if (listener !\u003d null) {\n+                    listener.onResponse(snapshot);\n+                }\n             }\n         });\n     }"
        }
      ]
    }
  },
  {
    "name": "Race condition when adding documents with file attachments",
    "url": "https://github.com/Findwise/Hydra/issues/198",
    "description": "When adding a document with binary file attachments, there is a time-period in which the document exists in the mongo database, but the files haven\u0027t been committed yet. This leads to stages sometimes being unable to fetch the binary attachment, giving rise to log messages such as:\n\n```\n2013-04-12 11:29:21 : ERROR  : Thread-17 : ChalmersPreProcessStage : Node gave an unexpected response: HTTP/1.1 404 Not Found\n2013-04-12 11:29:21 : ERROR  : Thread-17 : ChalmersPreProcessStage : Message: No file found by the name data for this document\n```\n",
    "keywords": [
      "file",
      "document"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/Findwise/Hydra/commit/87f40711e5a2945e470e7191bbfa4bcd307362df",
      "files": [
        {
          "file_name": "api/src/main/java/com/findwise/hydra/Document.java",
          "patch": "@@ -15,6 +15,7 @@\n \tString ACTION_KEY \u003d \"_action\";\n \tString CONTENTS_KEY \u003d \"contents\";\n \tString METADATA_KEY \u003d \"metadata\";\n+\tString COMMITTING_METADATA_FLAG \u003d \"committing\";\n \tString PENDING_METADATA_FLAG \u003d \"pending\";\n \tString PROCESSED_METADATA_FLAG \u003d \"processed\";\n \tString DISCARDED_METADATA_FLAG \u003d \"discarded\";"
        },
        {
          "file_name": "database-impl/inmemory/pom.xml",
          "patch": "@@ -57,6 +57,12 @@\n \t\t\t\u003ctype\u003ejar\u003c/type\u003e\n \t\t\t\u003cscope\u003ecompile\u003c/scope\u003e\n \t\t\u003c/dependency\u003e\n+\t\t\u003cdependency\u003e\n+\t\t\t\u003cgroupId\u003eorg.mockito\u003c/groupId\u003e\n+\t\t\t\u003cartifactId\u003emockito-all\u003c/artifactId\u003e\n+\t\t\t\u003cversion\u003e1.9.5\u003c/version\u003e\n+\t\t\t\u003cscope\u003etest\u003c/scope\u003e\n+\t\t\u003c/dependency\u003e\n \t\u003c/dependencies\u003e\n \n \t\u003cbuild\u003e"
        },
        {
          "file_name": "database-impl/inmemory/src/main/java/com/findwise/hydra/memorydb/MemoryDocumentIO.java",
          "patch": "@@ -278,6 +278,47 @@ public boolean insert(DatabaseDocument\u003cMemoryType\u003e d) {\n \t\treturn true;\n \t}\n \n+\t@Override\n+\tpublic boolean insert(DatabaseDocument\u003cMemoryType\u003e d, List\u003cDocumentFile\u003cMemoryType\u003e\u003e attachments) {\n+\t\tif(attachments \u003d\u003d null || attachments.isEmpty()) {\n+\t\t\treturn insert(d);\n+\t\t}\n+\n+\t\td.putMetadataField(Document.COMMITTING_METADATA_FLAG, true);\n+\n+\t\tif (!insert(d)) {\n+\t\t\treturn false;\n+\t\t};\n+\n+\t\tif (!writeAttachments(d, attachments)) {\n+\t\t\tdelete(d);\n+\t\t\treturn false;\n+\t\t}\n+\n+\t\td.putMetadataField(Document.COMMITTING_METADATA_FLAG, false);\n+\t\treturn update(d);\n+\t}\n+\n+\tprivate boolean writeAttachments(DatabaseDocument\u003cMemoryType\u003e d, List\u003cDocumentFile\u003cMemoryType\u003e\u003e attachments) {\n+\t\tfor(DocumentFile\u003cMemoryType\u003e attachment: attachments) {\n+\t\t\tattachment.setDocumentId(d.getID());\n+\t\t\ttry {\n+\t\t\t\twrite(attachment);\n+\t\t\t} catch (IOException e) {\n+\t\t\t\tlogger.error(\n+\t\t\t\t\t\tString.format(\n+\t\t\t\t\t\t\t\t\"Exception while writing filename:%s for id:%s\",\n+\t\t\t\t\t\t\t\tattachment.getFileName(),\n+\t\t\t\t\t\t\t\td.getID()\n+\t\t\t\t\t\t),\n+\t\t\t\t\t\te\n+\t\t\t\t);\n+\t\t\t\treturn false;\n+\t\t\t}\n+\t\t}\n+\t\treturn true;\n+\t}\n+\n \tprivate void removeNullFields(MemoryDocument md) {\n \t\tHashSet\u003cString\u003e fields \u003d new HashSet\u003cString\u003e();\n \t\tfor (String entry : md.getTouchedContent()) {"
        },
        {
          "file_name": "database-impl/inmemory/src/test/java/com/findwise/hydra/memorydb/MemoryDocumentIOTest.java",
          "patch": "@@ -1,9 +1,10 @@\n package com.findwise.hydra.memorydb;\n \n-import static org.junit.Assert.fail;\n-\n+import java.io.ByteArrayInputStream;\n import java.io.IOException;\n+import java.io.UnsupportedEncodingException;\n import java.util.ArrayList;\n+import java.util.Arrays;\n import java.util.List;\n import java.util.Map;\n import java.util.Random;\n@@ -22,6 +23,11 @@\n import com.findwise.hydra.DocumentFile;\n import com.findwise.hydra.SerializationUtils;\n \n+import static org.junit.Assert.*;\n+import static org.junit.Assert.assertEquals;\n+\n+import static org.mockito.Mockito.*;\n+\n @RunWith(RepeatRunner.class)\n public class MemoryDocumentIOTest {\n \tprivate MemoryDocumentIO io;\n@@ -62,6 +68,52 @@ public void testInsertDocument() {\n \t}\n \n \t@Test\n+\tpublic void testInsertWithAttachments() throws Exception {\n+\t\tMemoryDocument md \u003d TestTools.getRandomDocument();\n+\n+\t\tbyte[] inputData \u003d new byte[]{1,2,3};\n+\t\tDocumentFile\u003cMemoryType\u003e documentFile \u003d buildSimpleDocumentFile(inputData);\n+\t\tio.insert(md, Arrays.asList(documentFile));\n+\n+\t\t/* First of all, we should be able to fetch the attachment */\n+\t\tDocumentFile outputDocFile \u003d io.getDocumentFile(md, documentFile.getFileName());\n+\t\tassertNotNull(outputDocFile);\n+\n+\t\t/* And it should have the correct data */\n+\t\tbyte[] outputData \u003d IOUtils.toByteArray(outputDocFile.getStream());\n+\t\tassertArrayEquals(inputData, outputData);\n+\n+\t\t/* We have changed the state of the documentFile we sent in (for better or worse) */\n+\t\tassertEquals(md.getID(), documentFile.getDocumentId());\n+\n+\t\t/* The document in mongo has a metadata field reflecting the fact that it is fully committed */\n+\t\tMemoryDocument outputDocument \u003d io.getDocumentById(md.getID());\n+\t\tassertFalse((Boolean) outputDocument.getMetadataField(Document.COMMITTING_METADATA_FLAG));\n+\t}\n+\n+\t@Test\n+\tpublic void testInsertWithAttachmentsTwoStageCommit() throws Exception {\n+\t\tio \u003d spy(io);\n+\t\tMemoryDocument md \u003d TestTools.getRandomDocument();\n+\n+\t\t/* Assume that writing a DocumentFile raises an exception */\n+\t\tdoThrow(new RuntimeException()).when(io).write(any(DocumentFile.class));\n+\t\ttry {\n+\t\t\tio.insert(md, Arrays.asList(buildSimpleDocumentFile(new byte[]{})));\n+\t\t} catch (RuntimeException e) {\n+\t\t}\n+\n+\t\t/* Then the database document has metadata reflecting that it failed */\n+\t\tMemoryDocument outputDocument \u003d io.getDocumentById(md.getID());\n+\t\tassertTrue((Boolean) outputDocument.getMetadataField(Document.COMMITTING_METADATA_FLAG));\n+\t}\n+\n+\tprivate DocumentFile\u003cMemoryType\u003e buildSimpleDocumentFile(byte[] bytes) throws UnsupportedEncodingException {\n+\t\tByteArrayInputStream inputStream \u003d new ByteArrayInputStream(bytes);\n+\t\treturn new DocumentFile\u003cMemoryType\u003e(null, \"filename\", inputStream);\n+\t}\n+\n+\t@Test\n \tpublic void testUpdateDocument() {\n \t\tString field \u003d \"xyz\";\n \t\tString content \u003d \"zyx\";"
        },
        {
          "file_name": "database-impl/mongodb/pom.xml",
          "patch": "@@ -56,6 +56,12 @@\n \t\t\t\u003cscope\u003etest\u003c/scope\u003e\n \t\t\u003c/dependency\u003e\n \t\t\u003cdependency\u003e\n+\t\t\t\u003cgroupId\u003eorg.mockito\u003c/groupId\u003e\n+\t\t\t\u003cartifactId\u003emockito-all\u003c/artifactId\u003e\n+\t\t\t\u003cversion\u003e1.9.5\u003c/version\u003e\n+\t\t\t\u003cscope\u003etest\u003c/scope\u003e\n+\t\t\u003c/dependency\u003e\n+\t\t\u003cdependency\u003e\n \t\t\t\u003cgroupId\u003eorg.slf4j\u003c/groupId\u003e\n \t\t\t\u003cartifactId\u003eslf4j-api\u003c/artifactId\u003e\n \t\t\t\u003cversion\u003e1.6.4\u003c/version\u003e"
        },
        {
          "file_name": "database-impl/mongodb/src/main/java/com/findwise/hydra/mongodb/MongoDocumentIO.java",
          "patch": "@@ -255,7 +255,51 @@ public boolean insert(DatabaseDocument\u003cMongoType\u003e d) {\n \t\t}\n \t\treturn false;\n \t}\n-\t\n+\n+\t/* (non-Javadoc)\n+\t * @see com.findwise.hydra.DocumentWriter#insert(com.findwise.hydra.DatabaseDocument)\n+\t */\n+\t@Override\n+\tpublic boolean insert(DatabaseDocument\u003cMongoType\u003e d, List\u003cDocumentFile\u003cMongoType\u003e\u003e attachments) {\n+\t\tif(attachments \u003d\u003d null || attachments.isEmpty()) {\n+\t\t\treturn insert(d);\n+\t\t}\n+\n+\t\td.putMetadataField(MongoDocument.COMMITTING_METADATA_FLAG, true);\n+\n+\t\tif (!insert(d)) {\n+\t\t\treturn false;\n+\t\t};\n+\n+\t\tif (!writeAttachments(d, attachments)) {\n+\t\t\tdelete(d);\n+\t\t\treturn false;\n+\t\t}\n+\n+\t\td.putMetadataField(MongoDocument.COMMITTING_METADATA_FLAG, false);\n+\t\treturn update(d);\n+\t}\n+\n+\tprivate boolean writeAttachments(DatabaseDocument\u003cMongoType\u003e d, List\u003cDocumentFile\u003cMongoType\u003e\u003e attachments) {\n+\t\tfor(DocumentFile\u003cMongoType\u003e attachment: attachments) {\n+\t\t\tattachment.setDocumentId(d.getID());\n+\t\t\ttry {\n+\t\t\t\twrite(attachment);\n+\t\t\t} catch (IOException e) {\n+\t\t\t\tlogger.error(\n+\t\t\t\t\t\tString.format(\n+\t\t\t\t\t\t\t\t\"Exception while writing filename:%s for id:%s\",\n+\t\t\t\t\t\t\t\tattachment.getFileName(),\n+\t\t\t\t\t\t\t\td.getID()\n+\t\t\t\t\t\t),\n+\t\t\t\t\t\te\n+\t\t\t\t);\n+\t\t\t\treturn false;\n+\t\t\t}\n+\t\t}\n+\t\treturn true;\n+\t}\n+\n \tprivate Set\u003cString\u003e getNullFields(MongoDocument d) {\n \t\tSet\u003cString\u003e set \u003d new HashSet\u003cString\u003e();\n \t\tfor(Map.Entry\u003cString, Object\u003e e : d.getContentMap().entrySet()) {\n@@ -288,6 +332,11 @@ public MongoDocument getAndTag(DatabaseQuery\u003cMongoType\u003e query, String ... tag) {\n \t\tMongoQuery mq \u003d (MongoQuery)query;\n \t\tmq.requireMetadataFieldNotExists(Document.PENDING_METADATA_FLAG);\n \n+\t\t/* The document must be fully committed (i.e. all attachments are committed) before we can fetch it\n+\t\t * Using not equals to true here (instead of \"equals false\"), to allow for documents where committing\n+\t\t * isn\u0027t set at all. */\n+\t\tmq.requireMetadataFieldNotEquals(Document.COMMITTING_METADATA_FLAG, true);\n+\n \t\tfor(String t : tag) {\n \t\t\tmq.requireMetadataFieldNotExists(DatabaseDocument.FETCHED_METADATA_TAG+\".\"+t);\n \t\t}"
        },
        {
          "file_name": "database-impl/mongodb/src/test/java/com/findwise/hydra/mongodb/MongoDocumentIOTest.java",
          "patch": "@@ -2,10 +2,16 @@\n \n import static org.junit.Assert.fail;\n \n+import java.io.ByteArrayInputStream;\n+import java.io.UnsupportedEncodingException;\n+import java.util.Arrays;\n import java.util.Random;\n \n+import com.findwise.hydra.Document;\n+import com.findwise.hydra.DocumentFile;\n import junit.framework.Assert;\n \n+import org.apache.commons.io.IOUtils;\n import org.bson.types.ObjectId;\n import org.junit.AfterClass;\n import org.junit.Before;\n@@ -24,6 +30,9 @@\n import com.mongodb.Mongo;\n import com.mongodb.WriteConcern;\n \n+import static org.junit.Assert.*;\n+import static org.mockito.Mockito.*;\n+\n public class MongoDocumentIOTest {\n \tprivate MongoConnector mdc;\n \t\n@@ -269,6 +278,61 @@ public void testDoneContentTransfer() throws Exception {\n \t}\n \n \t@Test\n+\tpublic void testInsertWithAttachments() throws Exception {\n+\t\tMongoDocumentIO dw \u003d mdc.getDocumentWriter();\n+\t\tMongoDocument md \u003d new MongoDocument();\n+\n+\t\tbyte[] inputData \u003d new byte[]{1,2,3};\n+\t\tDocumentFile\u003cMongoType\u003e documentFile \u003d buildSimpleDocumentFile(inputData);\n+\t\tdw.insert(md, Arrays.asList(documentFile));\n+\n+\t\t/* First of all, we should be able to fetch the document file */\n+\t\tDocumentFile\u003cMongoType\u003e outputDocFile \u003d dw.getDocumentFile(md, documentFile.getFileName());\n+\t\tassertNotNull(outputDocFile);\n+\n+\t\t/* And it should have the correct data */\n+\t\tbyte[] outputData \u003d IOUtils.toByteArray(outputDocFile.getStream());\n+\t\tassertArrayEquals(inputData, outputData);\n+\n+\t\t/* We have changed the documentId of the documentFile we sent in (for better or worse) */\n+\t\tassertEquals(md.getID(), documentFile.getDocumentId());\n+\n+\t\t/* The document in mongo has \"committing\" metadata set to false (is fully committed) */\n+\t\tMongoDocument outputDocument \u003d mdc.getDocumentReader().getDocumentById(md.getID());\n+\t\tassertFalse((Boolean) outputDocument.getMetadataField(Document.COMMITTING_METADATA_FLAG));\n+\t}\n+\n+\t@Test\n+\t/* Test that we *can* get documents that are fully committed */\n+\tpublic void testFullyCommittedDocumentsCanBeTagged() throws Exception {\n+\t\tMongoDocumentIO dw \u003d mdc.getDocumentWriter();\n+\t\tMongoDocument md \u003d new MongoDocument();\n+\t\tdw.insert(md, Arrays.asList(buildSimpleDocumentFile(new byte[]{1, 2, 3})));\n+\t\tMongoQuery mongoQuery \u003d new MongoQuery();\n+\t\tmongoQuery.requireID(md.getID());\n+\t\tassertNotNull(dw.getAndTag(mongoQuery));\n+\t}\n+\n+\t@Test\n+\t/* Test that we *can\u0027t* get documents that are *not* fully committed */\n+\tpublic void testCommittingDocumentsCannotBeTagged() throws Exception {\n+\t\tMongoDocumentIO dw \u003d spy(mdc.getDocumentWriter());\n+\t\tMongoDocument md \u003d new MongoDocument();\n+\t\tdoThrow(new RuntimeException()).when(dw).write(any(DocumentFile.class));\n+\t\ttry {\n+\t\t\tdw.insert(md, Arrays.asList(buildSimpleDocumentFile(new byte[]{1, 2, 3})));\n+\t\t} catch( RuntimeException e) {}\n+\t\tMongoQuery mongoQuery \u003d new MongoQuery();\n+\t\tmongoQuery.requireID(md.getID());\n+\t\tassertNull(dw.getAndTag(mongoQuery));\n+\t}\n+\n+\tprivate DocumentFile\u003cMongoType\u003e buildSimpleDocumentFile(byte[] bytes) throws UnsupportedEncodingException {\n+\t\tByteArrayInputStream inputStream \u003d new ByteArrayInputStream(bytes);\n+\t\treturn new DocumentFile\u003cMongoType\u003e(null, \"filename\", inputStream);\n+\t}\n+\n+\t@Test\n \tpublic void testFetchRemoval() throws Exception {\n \t\tMongoDocumentIO dw \u003d (MongoDocumentIO) mdc.getDocumentWriter();\n \t\tMongoDocument md \u003d new MongoDocument();"
        },
        {
          "file_name": "database/src/main/java/com/findwise/hydra/CachingDocumentNIO.java",
          "patch": "@@ -2,7 +2,9 @@\n \n import java.io.IOException;\n import java.util.ArrayList;\n+import java.util.Arrays;\n import java.util.Collection;\n+import java.util.Collections;\n import java.util.ConcurrentModificationException;\n import java.util.Date;\n import java.util.List;\n@@ -166,6 +168,11 @@ public boolean insert(DatabaseDocument\u003cT\u003e d) {\n \t}\n \n \t@Override\n+\tpublic boolean insert(DatabaseDocument\u003cT\u003e d, List\u003cDocumentFile\u003cT\u003e\u003e attachments) {\n+\t\treturn writer.insert(d, attachments);\n+\t}\n+\n+\t@Override\n \tpublic boolean update(DatabaseDocument\u003cT\u003e d) {\n \t\tif (!cache.update(d)) {\n \t\t\tDatabaseDocument\u003cT\u003e doc \u003d reader.getDocumentById(d.getID());"
        },
        {
          "file_name": "database/src/main/java/com/findwise/hydra/DocumentWriter.java",
          "patch": "@@ -2,6 +2,7 @@\n \n import java.io.IOException;\n import java.util.Collection;\n+import java.util.List;\n \n import com.findwise.hydra.DocumentFile;\n \n@@ -145,15 +146,34 @@\n \t * Inserts a new document into the database. Will fail if the document\n \t * already has a non-null ID. The document\u0027s new ID will be applied to the\n \t * document.\n-\t * \n+\t *\n \t * A field that is \u003cpre\u003enull\u003c/pre\u003e is ignored.\n \t * \n \t * @param d\n \t *            the document to insert\n \t * @return false if the document already has an id, true otherwise.\n \t */\n \tboolean insert(DatabaseDocument\u003cT\u003e d);\n-\t\n+\n+\t/**\n+\t * Inserts a new document into the database. Will fail if the document\n+\t * already has a non-null ID. The document\u0027s new ID will be applied to the\n+\t * document. Until the attachments have been committed, the document will have\n+\t * metadata field \u003cpre\u003ecommitting\u003c/pre\u003e set to \u003cpre\u003etrue\u003c/pre\u003e; after they have been committed,\n+\t * it will be set to \u003cpre\u003efalse\u003c/pre\u003e.\n+\t *\n+\t * A field that is \u003cpre\u003enull\u003c/pre\u003e is ignored.\n+\t *\n+\t * @param d\n+\t *            the document to insert\n+\t * @param attachments\n+\t *            Any number of DocumentFile attachments belonging to the document.\n+\t *            The document ID for each DocumentFile will be overwritten using the\n+\t *            new ID obtained for the document, before the document files are\n+\t *            committed.\n+\t * @return false if the document already has an id, true otherwise.\n+\t */\n+\tboolean insert(DatabaseDocument\u003cT\u003e d, List\u003cDocumentFile\u003cT\u003e\u003e attachments);\n \t/**\n \t * Updates the document in the database. If any field in document is \n \t * \u003cpre\u003enull\u003c/pre\u003e, this field will be ignored and removed. "
        },
        {
          "file_name": "database/src/test/java/com/findwise/hydra/CachingDocumentNIOTest.java",
          "patch": "@@ -228,6 +228,16 @@ public void testMarkPending() {\n \t}\n \n \t@Test\n+\tpublic void testInsertWithAttachments() {\n+\t\tDocumentFile\u003cTestType\u003e mock \u003d mock(DocumentFile.class);\n+\t\tList\u003cDocumentFile\u003cTestType\u003e\u003e attachments \u003d Arrays.asList(mock);\n+\t\tio.insert(doc1, attachments);\n+\n+\t\tverifyNoMoreInteractions(cache);\n+\t\tverify(writer, times(1)).insert(doc1, attachments);\n+\t}\n+\n+\t@Test\n \tpublic void testInsert() {\n \t\tio.insert(doc1);\n "
        }
      ]
    }
  },
  {
    "name": "Fix race condition in leader initialization",
    "url": "https://github.com/atomix/copycat/pull/90",
    "description": "This PR fixes a race condition during leader initialization wherein a leader could attempt to apply its no-op entry to the state machine after it had already been applied. This was due to leaders asynchronously starting replication during the initialization phase. If the leader received another request which logged and replicated another entry, it could ultimately attempt to apply its initialization entries twice. However, starting replication asynchronously is not actually necessary, so this PR ensures that leaders synchronously append their `InitializeEntry` and `ConfigurationEntry` and begin replication during the leader initialization phase (`open`).\n",
    "keywords": [
      "replication",
      "leader",
      "initialization"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/atomix/copycat/commit/cdf31869691c67d3b09f8ed46613ad7dbd47fb72",
      "files": [
        {
          "file_name": "server/src/main/java/io/atomix/copycat/server/state/LeaderState.java",
          "patch": "@@ -59,10 +59,8 @@ public LeaderState(ServerState context) {\n     // Append initial entries to the log, including an initial no-op entry and the server\u0027s configuration.\n     appendInitialEntries();\n \n-    // Schedule the initial entries commit to occur after the state is opened. Attempting any communication\n-    // within the open() method will result in a deadlock since RaftProtocol calls this method synchronously.\n-    // What is critical about this logic is that the heartbeat timer not be started until a no-op entry has been committed.\n-    context.getThreadContext().execute(this::commitInitialEntries).whenComplete((result, error) -\u003e {\n+    // Commit the initial leader entries and then schedule the append timer.\n+    commitInitialEntries().whenComplete((result, error) -\u003e {\n       if (isOpen() \u0026\u0026 error \u003d\u003d null) {\n         startAppendTimer();\n       }\n@@ -88,10 +86,11 @@ private void appendInitialEntries() {\n     final long term \u003d context.getTerm();\n \n     // Append a no-op entry to reset session timeouts and commit entries from prior terms.\n-    try (NoOpEntry entry \u003d context.getLog().create(NoOpEntry.class)) {\n+    try (InitializeEntry entry \u003d context.getLog().create(InitializeEntry.class)) {\n       entry.setTerm(term)\n         .setTimestamp(appender.time());\n       assert context.getLog().append(entry) \u003d\u003d appender.index();\n+      LOGGER.debug(\"{} - Appended {}\", context.getCluster().getMember().serverAddress(), entry);\n     }\n \n     // Append a configuration entry to propagate the leader\u0027s cluster configuration."
        },
        {
          "file_name": "server/src/main/java/io/atomix/copycat/server/state/ServerStateMachine.java",
          "patch": "@@ -344,8 +344,8 @@ private void setLastCompleted(long lastCompleted) {\n       return apply((KeepAliveEntry) entry);\n     } else if (entry instanceof UnregisterEntry) {\n       return apply((UnregisterEntry) entry, expectResult);\n-    } else if (entry instanceof NoOpEntry) {\n-      return apply((NoOpEntry) entry);\n+    } else if (entry instanceof InitializeEntry) {\n+      return apply((InitializeEntry) entry);\n     } else if (entry instanceof ConnectEntry) {\n       return apply((ConnectEntry) entry);\n     } else if (entry instanceof ConfigurationEntry) {\n@@ -950,15 +950,15 @@ else if (entry.getIndex() \u003e session.getLastApplied()) {\n   }\n \n   /**\n-   * Applies a no-op entry to the state machine.\n+   * Applies an initialize entry to the state machine.\n    * \u003cp\u003e\n-   * No-op entries are committed by leaders at the start of their term. Typically, no-op entries\n+   * Initialize entries are committed by leaders at the start of their term. Typically, no-op entries\n    * serve as a mechanism to allow leaders to commit entries from prior terms. However, we extend\n    * the functionality of the no-op entry to use it as an indicator that a leadership change occurred.\n    * In order to ensure timeouts do not expire during lengthy leadership changes, we use no-op entries\n    * to reset timeouts for client sessions and server heartbeats.\n    */\n-  private CompletableFuture\u003cLong\u003e apply(NoOpEntry entry) {\n+  private CompletableFuture\u003cLong\u003e apply(InitializeEntry entry) {\n     // Iterate through all the server sessions and reset timestamps. This ensures that sessions do not\n     // timeout during leadership changes or shortly thereafter.\n     long timestamp \u003d executor.tick(entry.getTimestamp());"
        },
        {
          "file_name": "server/src/main/java/io/atomix/copycat/server/storage/entry/InitializeEntry.java",
          "patch": "@@ -20,17 +20,17 @@\n import io.atomix.copycat.server.storage.compaction.Compaction;\n \n /**\n- * No-op entry.\n+ * Initialize entry.\n  *\n  * @author \u003ca href\u003d\"http://github.com/kuujo\"\u003eJordan Halterman\u003c/a\u003e\n  */\n @SerializeWith(id\u003d224)\n-public class NoOpEntry extends TimestampedEntry\u003cNoOpEntry\u003e {\n+public class InitializeEntry extends TimestampedEntry\u003cInitializeEntry\u003e {\n \n-  public NoOpEntry() {\n+  public InitializeEntry() {\n   }\n \n-  public NoOpEntry(ReferenceManager\u003cEntry\u003c?\u003e\u003e referenceManager) {\n+  public InitializeEntry(ReferenceManager\u003cEntry\u003c?\u003e\u003e referenceManager) {\n     super(referenceManager);\n   }\n "
        },
        {
          "file_name": "server/src/main/resources/META-INF/services/io.atomix.catalyst.serializer.CatalystSerializable",
          "patch": "@@ -35,7 +35,7 @@ io.atomix.copycat.server.response.VoteResponse\n io.atomix.copycat.server.storage.entry.CommandEntry\n io.atomix.copycat.server.storage.entry.ConfigurationEntry\n io.atomix.copycat.server.storage.entry.KeepAliveEntry\n-io.atomix.copycat.server.storage.entry.NoOpEntry\n+io.atomix.copycat.server.storage.entry.InitializeEntry\n io.atomix.copycat.server.storage.entry.QueryEntry\n io.atomix.copycat.server.storage.entry.RegisterEntry\n io.atomix.copycat.server.storage.entry.ConnectEntry"
        },
        {
          "file_name": "server/src/test/java/io/atomix/copycat/server/state/ServerStateMachineTest.java",
          "patch": "@@ -168,7 +168,7 @@ public void testSessionLeaderReset() throws Throwable {\n     callerContext.execute(() -\u003e {\n \n       long index;\n-      try (NoOpEntry entry \u003d log.create(NoOpEntry.class)) {\n+      try (InitializeEntry entry \u003d log.create(InitializeEntry.class)) {\n         entry.setTerm(1)\n           .setTimestamp(timestamp + 100);\n         index \u003d log.append(entry);"
        }
      ]
    }
  },
  {
    "name": "Fix race condition in HystrixThreadPoolKey.asKey method",
    "url": "https://github.com/Netflix/Hystrix/pull/1271",
    "description": "Fix rare case when this method would return different values for the same key\n\nThe problem would happen when:\n1. Thread1: No such key when intern.get(name), so k was null\n2. Thread1: We would enter if-statement\n3. Thread2: Other thread would add key to intern map\n4. Thread1: We will not put new key to intern map, but we will return newly created value instead of one stored in map\n",
    "keywords": [
      "intern",
      "thread1",
      "map",
      "key"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/Netflix/Hystrix/commit/e27686bdca6aeefd855dbdca8933c783d576286e",
      "files": [
        {
          "file_name": "hystrix-core/build.gradle",
          "patch": "@@ -5,7 +5,7 @@ dependencies {\n     compile \u0027com.netflix.archaius:archaius-core:0.4.1\u0027\n     compile \u0027io.reactivex:rxjava:1.1.5\u0027\n     compile \u0027org.slf4j:slf4j-api:1.7.0\u0027\n-\tcompile \u0027org.hdrhistogram:HdrHistogram:2.1.7\u0027\n+    compile \u0027org.hdrhistogram:HdrHistogram:2.1.7\u0027\n     testCompile \u0027junit:junit-dep:4.10\u0027\n     testCompile project(\u0027:hystrix-junit\u0027)\n }\n@@ -16,8 +16,8 @@ javadoc {\n     // we do not want the com.netflix.hystrix.util package include\n     exclude \u0027**/util/**\u0027\n \n-        options {\n-\tdoclet \u003d \"org.benjchristensen.doclet.DocletExclude\"\n+    options {\n+        doclet \u003d \"org.benjchristensen.doclet.DocletExclude\"\n         docletpath \u003d [rootProject.file(\u0027./gradle/doclet-exclude.jar\u0027)]\n         stylesheetFile \u003d rootProject.file(\u0027./gradle/javadocStyleSheet.css\u0027)\n         windowTitle \u003d \"Hystrix Javadoc ${project.version}\"\n@@ -37,12 +37,12 @@ jar {\n }\n \n jmh {\n-\tfork \u003d 10\n-\titerations \u003d 3\n-\tjmhVersion \u003d \u00271.11.2\u0027\n-\tprofilers \u003d [\u0027gc\u0027]\n-\tthreads \u003d 8\n-\twarmup \u003d \u00271s\u0027\n-\twarmupBatchSize \u003d 1\n-\twarmupIterations \u003d 5\n+    fork \u003d 10\n+    iterations \u003d 3\n+    jmhVersion \u003d \u00271.11.2\u0027\n+    profilers \u003d [\u0027gc\u0027]\n+    threads \u003d 8\n+    warmup \u003d \u00271s\u0027\n+    warmupBatchSize \u003d 1\n+    warmupIterations \u003d 5\n }"
        },
        {
          "file_name": "hystrix-core/src/main/java/com/netflix/hystrix/HystrixCommandGroupKey.java",
          "patch": "@@ -15,7 +15,7 @@\n  */\n package com.netflix.hystrix;\n \n-import java.util.concurrent.ConcurrentHashMap;\n+import com.netflix.hystrix.util.InternMap;\n \n /**\n  * A group name for a {@link HystrixCommand}. This is used for grouping together commands such as for reporting, alerting, dashboards or team/library ownership.\n@@ -24,51 +24,36 @@\n  * \u003cp\u003e\n  * This interface is intended to work natively with Enums so that implementing code can have an enum with the owners that implements this interface.\n  */\n-public interface HystrixCommandGroupKey {\n-\n-    /**\n-     * The word \u0027name\u0027 is used instead of \u0027key\u0027 so that Enums can implement this interface and it work natively.\n-     * \n-     * @return String\n-     */\n-    public String name();\n-\n-    public static class Factory {\n-\n+public interface HystrixCommandGroupKey extends HystrixKey {\n+    class Factory {\n         private Factory() {\n         }\n \n         // used to intern instances so we don\u0027t keep re-creating them millions of times for the same key\n-        private static ConcurrentHashMap\u003cString, HystrixCommandGroupKey\u003e intern \u003d new ConcurrentHashMap\u003cString, HystrixCommandGroupKey\u003e();\n+        private static final InternMap\u003cString, HystrixCommandGroupDefault\u003e intern\n+                \u003d new InternMap\u003cString, HystrixCommandGroupDefault\u003e(\n+                new InternMap.ValueConstructor\u003cString, HystrixCommandGroupDefault\u003e() {\n+                    @Override\n+                    public HystrixCommandGroupDefault create(String key) {\n+                        return new HystrixCommandGroupDefault(key);\n+                    }\n+                });\n+\n \n         /**\n          * Retrieve (or create) an interned HystrixCommandGroup instance for a given name.\n-         * \n+         *\n          * @param name command group name\n          * @return HystrixCommandGroup instance that is interned (cached) so a given name will always retrieve the same instance.\n          */\n         public static HystrixCommandGroupKey asKey(String name) {\n-            HystrixCommandGroupKey k \u003d intern.get(name);\n-            if (k \u003d\u003d null) {\n-                k \u003d new HystrixCommandGroupDefault(name);\n-                intern.putIfAbsent(name, k);\n-            }\n-            return k;\n+           return intern.interned(name);\n         }\n \n-        private static class HystrixCommandGroupDefault implements HystrixCommandGroupKey {\n-\n-            private String name;\n-\n-            private HystrixCommandGroupDefault(String name) {\n-                this.name \u003d name;\n+        private static class HystrixCommandGroupDefault extends HystrixKey.HystrixKeyDefault implements HystrixCommandGroupKey {\n+            public HystrixCommandGroupDefault(String name) {\n+                super(name);\n             }\n-\n-            @Override\n-            public String name() {\n-                return name;\n-            }\n-\n         }\n \n         /* package-private */ static int getGroupCount() {"
        },
        {
          "file_name": "hystrix-core/src/main/java/com/netflix/hystrix/HystrixCommandKey.java",
          "patch": "@@ -15,29 +15,28 @@\n  */\n package com.netflix.hystrix;\n \n-import java.util.concurrent.ConcurrentHashMap;\n+import com.netflix.hystrix.util.InternMap;\n \n /**\n  * A key to represent a {@link HystrixCommand} for monitoring, circuit-breakers, metrics publishing, caching and other such uses.\n  * \u003cp\u003e\n  * This interface is intended to work natively with Enums so that implementing code can be an enum that implements this interface.\n  */\n-public interface HystrixCommandKey {\n-\n-    /**\n-     * The word \u0027name\u0027 is used instead of \u0027key\u0027 so that Enums can implement this interface and it work natively.\n-     * \n-     * @return String\n-     */\n-    public String name();\n-\n-    public static class Factory {\n-\n+public interface HystrixCommandKey extends HystrixKey {\n+    class Factory {\n         private Factory() {\n         }\n \n         // used to intern instances so we don\u0027t keep re-creating them millions of times for the same key\n-        private static ConcurrentHashMap\u003cString, HystrixCommandKey\u003e intern \u003d new ConcurrentHashMap\u003cString, HystrixCommandKey\u003e();\n+        private static final InternMap\u003cString, HystrixCommandKeyDefault\u003e intern\n+                \u003d new InternMap\u003cString, HystrixCommandKeyDefault\u003e(\n+                new InternMap.ValueConstructor\u003cString, HystrixCommandKeyDefault\u003e() {\n+                    @Override\n+                    public HystrixCommandKeyDefault create(String key) {\n+                        return new HystrixCommandKeyDefault(key);\n+                    }\n+                });\n+\n \n         /**\n          * Retrieve (or create) an interned HystrixCommandKey instance for a given name.\n@@ -46,30 +45,12 @@ private Factory() {\n          * @return HystrixCommandKey instance that is interned (cached) so a given name will always retrieve the same instance.\n          */\n         public static HystrixCommandKey asKey(String name) {\n-            HystrixCommandKey k \u003d intern.get(name);\n-            if (k \u003d\u003d null) {\n-                k \u003d new HystrixCommandKeyDefault(name);\n-                intern.putIfAbsent(name, k);\n-            }\n-            return k;\n+            return intern.interned(name);\n         }\n \n-        private static class HystrixCommandKeyDefault implements HystrixCommandKey {\n-\n-            private String name;\n-\n-            private HystrixCommandKeyDefault(String name) {\n-                this.name \u003d name;\n-            }\n-\n-            @Override\n-            public String name() {\n-                return name;\n-            }\n-            \n-            @Override\n-            public String toString() {\n-            \treturn name;\n+        private static class HystrixCommandKeyDefault extends HystrixKey.HystrixKeyDefault implements HystrixCommandKey {\n+            public HystrixCommandKeyDefault(String name) {\n+                super(name);\n             }\n         }\n "
        },
        {
          "file_name": "hystrix-core/src/main/java/com/netflix/hystrix/HystrixKey.java",
          "patch": "@@ -0,0 +1,34 @@\n+package com.netflix.hystrix;\n+\n+/**\n+ * Basic class for hystrix keys\n+ */\n+public interface HystrixKey {\n+    /**\n+     * The word \u0027name\u0027 is used instead of \u0027key\u0027 so that Enums can implement this interface and it work natively.\n+     *\n+     * @return String\n+     */\n+    String name();\n+\n+    /**\n+     * Default implementation of the interface\n+     */\n+    abstract class HystrixKeyDefault implements HystrixKey {\n+        private final String name;\n+\n+        public HystrixKeyDefault(String name) {\n+            this.name \u003d name;\n+        }\n+\n+        @Override\n+        public String name() {\n+            return name;\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return name;\n+        }\n+    }\n+}"
        },
        {
          "file_name": "hystrix-core/src/main/java/com/netflix/hystrix/HystrixThreadPoolKey.java",
          "patch": "@@ -15,31 +15,27 @@\n  */\n package com.netflix.hystrix;\n \n-import java.util.concurrent.ConcurrentHashMap;\n+import com.netflix.hystrix.util.InternMap;\n \n /**\n  * A key to represent a {@link HystrixThreadPool} for monitoring, metrics publishing, caching and other such uses.\n  * \u003cp\u003e\n  * This interface is intended to work natively with Enums so that implementing code can be an enum that implements this interface.\n  */\n-public interface HystrixThreadPoolKey {\n-\n-    /**\n-     * The \u0027key\u0027 used as the name for a thread-pool.\n-     * \u003cp\u003e\n-     * The word \u0027name\u0027 is used instead of \u0027key\u0027 so that Enums can implement this interface and it work natively.\n-     * \n-     * @return String\n-     */\n-    public String name();\n-\n-    public static class Factory {\n-\n+public interface HystrixThreadPoolKey extends HystrixKey {\n+    class Factory {\n         private Factory() {\n         }\n \n         // used to intern instances so we don\u0027t keep re-creating them millions of times for the same key\n-        private static ConcurrentHashMap\u003cString, HystrixThreadPoolKey\u003e intern \u003d new ConcurrentHashMap\u003cString, HystrixThreadPoolKey\u003e();\n+        private static final InternMap\u003cString, HystrixThreadPoolKey\u003e intern\n+                \u003d new InternMap\u003cString, HystrixThreadPoolKey\u003e(\n+                new InternMap.ValueConstructor\u003cString, HystrixThreadPoolKey\u003e() {\n+                    @Override\n+                    public HystrixThreadPoolKey create(String key) {\n+                        return new HystrixThreadPoolKeyDefault(key);\n+                    }\n+                });\n \n         /**\n          * Retrieve (or create) an interned HystrixThreadPoolKey instance for a given name.\n@@ -48,35 +44,17 @@ private Factory() {\n          * @return HystrixThreadPoolKey instance that is interned (cached) so a given name will always retrieve the same instance.\n          */\n         public static HystrixThreadPoolKey asKey(String name) {\n-            HystrixThreadPoolKey k \u003d intern.get(name);\n-            if (k \u003d\u003d null) {\n-                k \u003d new HystrixThreadPoolKeyDefault(name);\n-                intern.putIfAbsent(name, k);\n-            }\n-            return k;\n+           return intern.interned(name);\n         }\n \n-        private static class HystrixThreadPoolKeyDefault implements HystrixThreadPoolKey {\n-\n-            private String name;\n-\n-            private HystrixThreadPoolKeyDefault(String name) {\n-                this.name \u003d name;\n-            }\n-\n-            @Override\n-            public String name() {\n-                return name;\n-            }\n-            \n-            @Override\n-            public String toString() {\n-            \treturn name;\n+        private static class HystrixThreadPoolKeyDefault extends HystrixKeyDefault implements HystrixThreadPoolKey {\n+            public HystrixThreadPoolKeyDefault(String name) {\n+                super(name);\n             }\n         }\n \n         /* package-private */ static int getThreadPoolCount() {\n             return intern.size();\n         }\n     }\n-}\n\\ No newline at end of file\n+}"
        },
        {
          "file_name": "hystrix-core/src/main/java/com/netflix/hystrix/util/InternMap.java",
          "patch": "@@ -0,0 +1,34 @@\n+package com.netflix.hystrix.util;\n+\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ConcurrentMap;\n+\n+/**\n+ * Utility to have \u0027intern\u0027 - like functionality, which holds single instance of wrapper for a given key\n+ */\n+public class InternMap\u003cK, V\u003e {\n+    private final ConcurrentMap\u003cK, V\u003e storage \u003d new ConcurrentHashMap\u003cK, V\u003e();\n+    private final ValueConstructor\u003cK, V\u003e valueConstructor;\n+\n+    public interface ValueConstructor\u003cK, V\u003e {\n+        V create(K key);\n+    }\n+\n+    public InternMap(ValueConstructor\u003cK, V\u003e valueConstructor) {\n+        this.valueConstructor \u003d valueConstructor;\n+    }\n+\n+    public V interned(K key) {\n+        V existingKey \u003d storage.get(key);\n+        V newKey \u003d null;\n+        if (existingKey \u003d\u003d null) {\n+            newKey \u003d valueConstructor.create(key);\n+            existingKey \u003d storage.putIfAbsent(key, newKey);\n+        }\n+        return existingKey !\u003d null ? existingKey : newKey;\n+    }\n+\n+    public int size() {\n+        return storage.size();\n+    }\n+}"
        }
      ]
    }
  },
  {
    "name": "Rare race condition when introducing new fields into a mapping",
    "url": "https://github.com/elastic/elasticsearch/issues/3667",
    "description": "Dynamic mapping allow to dynamically introduce new fields into an existing mapping. There is a (pretty rare) race condition, where a new field/object being introduced will not be immediately visible for another document that introduces it at the same time.\n\nRelates to #3544 \n",
    "keywords": [
      "new",
      "mapping"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/elastic/elasticsearch/commit/bbce6e85883ef812a80f5713e001f4ad1de47f22",
      "files": [
        {
          "file_name": "bin/plugin",
          "patch": "@@ -1,50 +0,0 @@\n-#!/bin/sh\n-\n-CDPATH\u003d\"\"\n-SCRIPT\u003d\"$0\"\n-\n-# SCRIPT may be an arbitrarily deep series of symlinks. Loop until we have the concrete path.\n-while [ -h \"$SCRIPT\" ] ; do\n-  ls\u003d`ls -ld \"$SCRIPT\"`\n-  # Drop everything prior to -\u003e\n-  link\u003d`expr \"$ls\" : \u0027.*-\u003e \\(.*\\)$\u0027`\n-  if expr \"$link\" : \u0027/.*\u0027 \u003e /dev/null; then\n-    SCRIPT\u003d\"$link\"\n-  else\n-    SCRIPT\u003d`dirname \"$SCRIPT\"`/\"$link\"\n-  fi\n-done\n-\n-# determine elasticsearch home\n-ES_HOME\u003d`dirname \"$SCRIPT\"`/..\n-\n-# make ELASTICSEARCH_HOME absolute\n-ES_HOME\u003d`cd \"$ES_HOME\"; pwd`\n-\n-\n-if [ -x \"$JAVA_HOME/bin/java\" ]; then\n-    JAVA\u003d$JAVA_HOME/bin/java\n-else\n-    JAVA\u003d`which java`\n-fi\n-\n-# this is a poor mans getopt replacement\n-# real getopt cannot be used because we need to hand options over to the PluginManager\n-while [ $# -gt 0 ]; do\n-  case $1 in\n-    -D*\u003d*)\n-      properties\u003d\"$properties $1\"\n-      ;;\n-    -D*)\n-      var\u003d$1\n-      shift\n-      properties\u003d\"$properties $var\u003d$1\"\n-      ;;\n-    *)\n-      args\u003d\"$args $1\"\n-  esac\n-  shift\n-done\n-\n-exec $JAVA $JAVA_OPTS -Xmx64m -Xms16m -Delasticsearch -Des.path.home\u003d\"$ES_HOME\" $properties -cp \"$ES_HOME/lib/*\" org.elasticsearch.plugins.PluginManager $args\n-"
        },
        {
          "file_name": "src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java",
          "patch": "@@ -272,7 +272,7 @@ protected ParseContext initialValue() {\n \n     private final Filter typeFilter;\n \n-    private final Object mutex \u003d new Object();\n+    private final Object mappersMutex \u003d new Object();\n \n     private boolean initMappersAdded \u003d true;\n \n@@ -512,16 +512,6 @@ public ParsedDocument parse(SourceToParse source, @Nullable ParseListener listen\n                 parser.nextToken();\n             }\n \n-            // fire up any new mappers if exists\n-            if (!context.newFieldMappers().mappers.isEmpty()) {\n-                addFieldMappers(context.newFieldMappers().mappers);\n-                context.newFieldMappers().mappers.clear();\n-            }\n-            if (!context.newObjectMappers().mappers.isEmpty()) {\n-                addObjectMappers(context.newObjectMappers().mappers);\n-                context.newObjectMappers().mappers.clear();\n-            }\n-\n             for (RootMapper rootMapper : rootMappersOrdered) {\n                 rootMapper.postParse(context);\n             }\n@@ -530,18 +520,6 @@ public ParsedDocument parse(SourceToParse source, @Nullable ParseListener listen\n                 rootMapper.validate(context);\n             }\n         } catch (Throwable e) {\n-            // we have to fire up any new mappers even on a failure, because they\n-            // have been added internally to each compound mapper...\n-            // ... we have no option to \"rollback\" a change, which is very tricky in our copy on change system...\n-            if (!context.newFieldMappers().mappers.isEmpty()) {\n-                addFieldMappers(context.newFieldMappers().mappers);\n-                context.newFieldMappers().mappers.clear();\n-            }\n-            if (!context.newObjectMappers().mappers.isEmpty()) {\n-                addObjectMappers(context.newObjectMappers().mappers);\n-                context.newObjectMappers().mappers.clear();\n-            }\n-\n             // if its already a mapper parsing exception, no need to wrap it...\n             if (e instanceof MapperParsingException) {\n                 throw (MapperParsingException) e;\n@@ -586,12 +564,12 @@ public ParsedDocument parse(SourceToParse source, @Nullable ParseListener listen\n         return doc;\n     }\n \n-    private void addFieldMappers(Collection\u003cFieldMapper\u003e fieldMappers) {\n+    public void addFieldMappers(Collection\u003cFieldMapper\u003e fieldMappers) {\n         addFieldMappers(fieldMappers.toArray(new FieldMapper[fieldMappers.size()]));\n     }\n \n     private void addFieldMappers(FieldMapper... fieldMappers) {\n-        synchronized (mutex) {\n+        synchronized (mappersMutex) {\n             this.fieldMappers \u003d this.fieldMappers.concat(this, fieldMappers);\n         }\n         for (FieldMapperListener listener : fieldMapperListeners) {\n@@ -615,12 +593,12 @@ public void traverse(FieldMapperListener listener) {\n         rootObjectMapper.traverse(listener);\n     }\n \n-    private void addObjectMappers(Collection\u003cObjectMapper\u003e objectMappers) {\n+    public void addObjectMappers(Collection\u003cObjectMapper\u003e objectMappers) {\n         addObjectMappers(objectMappers.toArray(new ObjectMapper[objectMappers.size()]));\n     }\n \n     private void addObjectMappers(ObjectMapper... objectMappers) {\n-        synchronized (mutex) {\n+        synchronized (mappersMutex) {\n             MapBuilder\u003cString, ObjectMapper\u003e builder \u003d MapBuilder.newMapBuilder(this.objectMappers);\n             for (ObjectMapper objectMapper : objectMappers) {\n                 builder.put(objectMapper.fullPath(), objectMapper);"
        },
        {
          "file_name": "src/main/java/org/elasticsearch/index/mapper/MapperService.java",
          "patch": "@@ -84,7 +84,8 @@\n \n     private volatile Map\u003cString, DocumentMapper\u003e mappers \u003d ImmutableMap.of();\n \n-    private final Object mutex \u003d new Object();\n+    private final Object typeMutex \u003d new Object();\n+    private final Object mappersMutex \u003d new Object();\n \n     private volatile Map\u003cString, FieldMappers\u003e nameFieldMappers \u003d ImmutableMap.of();\n     private volatile Map\u003cString, FieldMappers\u003e indexNameFieldMappers \u003d ImmutableMap.of();\n@@ -225,7 +226,7 @@ public DocumentMapper merge(String type, String mappingSource, boolean applyDefa\n             DocumentMapper mapper \u003d documentParser.parse(type, mappingSource);\n             // still add it as a document mapper so we have it registered and, for example, persisted back into\n             // the cluster meta data if needed, or checked for existence\n-            synchronized (mutex) {\n+            synchronized (typeMutex) {\n                 mappers \u003d newMapBuilder(mappers).put(type, mapper).map();\n             }\n             defaultMappingSource \u003d mappingSource;\n@@ -238,7 +239,7 @@ public DocumentMapper merge(String type, String mappingSource, boolean applyDefa\n     // never expose this to the outside world, we need to reparse the doc mapper so we get fresh\n     // instances of field mappers to properly remove existing doc mapper\n     private DocumentMapper merge(DocumentMapper mapper) {\n-        synchronized (mutex) {\n+        synchronized (typeMutex) {\n             if (mapper.type().length() \u003d\u003d 0) {\n                 throw new InvalidTypeNameException(\"mapping type name is empty\");\n             }\n@@ -289,7 +290,7 @@ private DocumentMapper merge(DocumentMapper mapper) {\n     }\n \n     private void addObjectMappers(ObjectMapper[] objectMappers) {\n-        synchronized (mutex) {\n+        synchronized (mappersMutex) {\n             MapBuilder\u003cString, ObjectMappers\u003e fullPathObjectMappers \u003d newMapBuilder(this.fullPathObjectMappers);\n             for (ObjectMapper objectMapper : objectMappers) {\n                 ObjectMappers mappers \u003d fullPathObjectMappers.get(objectMapper.fullPath());\n@@ -309,7 +310,7 @@ private void addObjectMappers(ObjectMapper[] objectMappers) {\n     }\n \n     private void addFieldMappers(FieldMapper[] fieldMappers) {\n-        synchronized (mutex) {\n+        synchronized (mappersMutex) {\n             MapBuilder\u003cString, FieldMappers\u003e nameFieldMappers \u003d newMapBuilder(this.nameFieldMappers);\n             MapBuilder\u003cString, FieldMappers\u003e indexNameFieldMappers \u003d newMapBuilder(this.indexNameFieldMappers);\n             MapBuilder\u003cString, FieldMappers\u003e fullNameFieldMappers \u003d newMapBuilder(this.fullNameFieldMappers);\n@@ -348,7 +349,7 @@ private void addFieldMappers(FieldMapper[] fieldMappers) {\n     }\n \n     public void remove(String type) {\n-        synchronized (mutex) {\n+        synchronized (typeMutex) {\n             DocumentMapper docMapper \u003d mappers.get(type);\n             if (docMapper \u003d\u003d null) {\n                 return;\n@@ -363,60 +364,62 @@ public void remove(String type) {\n     }\n \n     private void removeObjectAndFieldMappers(DocumentMapper docMapper) {\n-        // we need to remove those mappers\n-        MapBuilder\u003cString, FieldMappers\u003e nameFieldMappers \u003d newMapBuilder(this.nameFieldMappers);\n-        MapBuilder\u003cString, FieldMappers\u003e indexNameFieldMappers \u003d newMapBuilder(this.indexNameFieldMappers);\n-        MapBuilder\u003cString, FieldMappers\u003e fullNameFieldMappers \u003d newMapBuilder(this.fullNameFieldMappers);\n-\n-        for (FieldMapper mapper : docMapper.mappers()) {\n-            FieldMappers mappers \u003d nameFieldMappers.get(mapper.names().name());\n-            if (mappers !\u003d null) {\n-                mappers \u003d mappers.remove(mapper);\n-                if (mappers.isEmpty()) {\n-                    nameFieldMappers.remove(mapper.names().name());\n-                } else {\n-                    nameFieldMappers.put(mapper.names().name(), mappers);\n+        synchronized (mappersMutex) {\n+            // we need to remove those mappers\n+            MapBuilder\u003cString, FieldMappers\u003e nameFieldMappers \u003d newMapBuilder(this.nameFieldMappers);\n+            MapBuilder\u003cString, FieldMappers\u003e indexNameFieldMappers \u003d newMapBuilder(this.indexNameFieldMappers);\n+            MapBuilder\u003cString, FieldMappers\u003e fullNameFieldMappers \u003d newMapBuilder(this.fullNameFieldMappers);\n+\n+            for (FieldMapper mapper : docMapper.mappers()) {\n+                FieldMappers mappers \u003d nameFieldMappers.get(mapper.names().name());\n+                if (mappers !\u003d null) {\n+                    mappers \u003d mappers.remove(mapper);\n+                    if (mappers.isEmpty()) {\n+                        nameFieldMappers.remove(mapper.names().name());\n+                    } else {\n+                        nameFieldMappers.put(mapper.names().name(), mappers);\n+                    }\n                 }\n-            }\n \n-            mappers \u003d indexNameFieldMappers.get(mapper.names().indexName());\n-            if (mappers !\u003d null) {\n-                mappers \u003d mappers.remove(mapper);\n-                if (mappers.isEmpty()) {\n-                    indexNameFieldMappers.remove(mapper.names().indexName());\n-                } else {\n-                    indexNameFieldMappers.put(mapper.names().indexName(), mappers);\n+                mappers \u003d indexNameFieldMappers.get(mapper.names().indexName());\n+                if (mappers !\u003d null) {\n+                    mappers \u003d mappers.remove(mapper);\n+                    if (mappers.isEmpty()) {\n+                        indexNameFieldMappers.remove(mapper.names().indexName());\n+                    } else {\n+                        indexNameFieldMappers.put(mapper.names().indexName(), mappers);\n+                    }\n                 }\n-            }\n \n-            mappers \u003d fullNameFieldMappers.get(mapper.names().fullName());\n-            if (mappers !\u003d null) {\n-                mappers \u003d mappers.remove(mapper);\n-                if (mappers.isEmpty()) {\n-                    fullNameFieldMappers.remove(mapper.names().fullName());\n-                } else {\n-                    fullNameFieldMappers.put(mapper.names().fullName(), mappers);\n+                mappers \u003d fullNameFieldMappers.get(mapper.names().fullName());\n+                if (mappers !\u003d null) {\n+                    mappers \u003d mappers.remove(mapper);\n+                    if (mappers.isEmpty()) {\n+                        fullNameFieldMappers.remove(mapper.names().fullName());\n+                    } else {\n+                        fullNameFieldMappers.put(mapper.names().fullName(), mappers);\n+                    }\n                 }\n             }\n-        }\n-        this.nameFieldMappers \u003d nameFieldMappers.map();\n-        this.indexNameFieldMappers \u003d indexNameFieldMappers.map();\n-        this.fullNameFieldMappers \u003d fullNameFieldMappers.map();\n-\n-        MapBuilder\u003cString, ObjectMappers\u003e fullPathObjectMappers \u003d newMapBuilder(this.fullPathObjectMappers);\n-        for (ObjectMapper mapper : docMapper.objectMappers().values()) {\n-            ObjectMappers mappers \u003d fullPathObjectMappers.get(mapper.fullPath());\n-            if (mappers !\u003d null) {\n-                mappers \u003d mappers.remove(mapper);\n-                if (mappers.isEmpty()) {\n-                    fullPathObjectMappers.remove(mapper.fullPath());\n-                } else {\n-                    fullPathObjectMappers.put(mapper.fullPath(), mappers);\n+            this.nameFieldMappers \u003d nameFieldMappers.map();\n+            this.indexNameFieldMappers \u003d indexNameFieldMappers.map();\n+            this.fullNameFieldMappers \u003d fullNameFieldMappers.map();\n+\n+            MapBuilder\u003cString, ObjectMappers\u003e fullPathObjectMappers \u003d newMapBuilder(this.fullPathObjectMappers);\n+            for (ObjectMapper mapper : docMapper.objectMappers().values()) {\n+                ObjectMappers mappers \u003d fullPathObjectMappers.get(mapper.fullPath());\n+                if (mappers !\u003d null) {\n+                    mappers \u003d mappers.remove(mapper);\n+                    if (mappers.isEmpty()) {\n+                        fullPathObjectMappers.remove(mapper.fullPath());\n+                    } else {\n+                        fullPathObjectMappers.put(mapper.fullPath(), mappers);\n+                    }\n                 }\n             }\n-        }\n \n-        this.fullPathObjectMappers \u003d fullPathObjectMappers.map();\n+            this.fullPathObjectMappers \u003d fullPathObjectMappers.map();\n+        }\n     }\n \n     /**\n@@ -457,7 +460,7 @@ public DocumentMapper documentMapperWithAutoCreate(String type) {\n             throw new TypeMissingException(index, type, \"trying to auto create mapping, but dynamic mapping is disabled\");\n         }\n         // go ahead and dynamically create it\n-        synchronized (mutex) {\n+        synchronized (typeMutex) {\n             mapper \u003d mappers.get(type);\n             if (mapper !\u003d null) {\n                 return mapper;"
        },
        {
          "file_name": "src/main/java/org/elasticsearch/index/mapper/ParseContext.java",
          "patch": "@@ -73,6 +73,7 @@\n     private Map\u003cString, String\u003e ignoredValues \u003d new HashMap\u003cString, String\u003e();\n \n     private boolean mappingsModified \u003d false;\n+    private boolean withinNewMapper \u003d false;\n \n     private boolean externalValueSet;\n \n@@ -82,9 +83,6 @@\n \n     private float docBoost \u003d 1.0f;\n \n-    private FieldMapperListener.Aggregator newFieldMappers \u003d new FieldMapperListener.Aggregator();\n-    private ObjectMapperListener.Aggregator newObjectMappers \u003d new ObjectMapperListener.Aggregator();\n-\n     public ParseContext(String index, @Nullable Settings indexSettings, DocumentMapperParser docMapperParser, DocumentMapper docMapper, ContentPath path) {\n         this.index \u003d index;\n         this.indexSettings \u003d indexSettings;\n@@ -110,26 +108,17 @@ public void reset(XContentParser parser, Document document, SourceToParse source\n         this.source \u003d source \u003d\u003d null ? null : sourceToParse.source();\n         this.path.reset();\n         this.mappingsModified \u003d false;\n+        this.withinNewMapper \u003d false;\n         this.listener \u003d listener \u003d\u003d null ? DocumentMapper.ParseListener.EMPTY : listener;\n         this.allEntries \u003d new AllEntries();\n         this.ignoredValues.clear();\n         this.docBoost \u003d 1.0f;\n-        this.newFieldMappers.mappers.clear();\n-        this.newObjectMappers.mappers.clear();\n     }\n \n     public boolean flyweight() {\n         return sourceToParse.flyweight();\n     }\n \n-    public FieldMapperListener.Aggregator newFieldMappers() {\n-        return newFieldMappers;\n-    }\n-\n-    public ObjectMapperListener.Aggregator newObjectMappers() {\n-        return newObjectMappers;\n-    }\n-\n     public DocumentMapperParser docMapperParser() {\n         return this.docMapperParser;\n     }\n@@ -142,6 +131,18 @@ public void setMappingsModified() {\n         this.mappingsModified \u003d true;\n     }\n \n+    public void setWithinNewMapper() {\n+        this.withinNewMapper \u003d true;\n+    }\n+\n+    public void clearWithinNewMapper() {\n+        this.withinNewMapper \u003d false;\n+    }\n+\n+    public boolean isWithinNewMapper() {\n+        return withinNewMapper;\n+    }\n+\n     public String index() {\n         return this.index;\n     }"
        },
        {
          "file_name": "src/main/java/org/elasticsearch/index/mapper/object/ObjectMapper.java",
          "patch": "@@ -518,11 +518,9 @@ private void serializeObject(final ParseContext context, String currentFieldName\n             } else if (dynamic \u003d\u003d Dynamic.TRUE) {\n                 // we sync here just so we won\u0027t add it twice. Its not the end of the world\n                 // to sync here since next operations will get it before\n-                boolean newMapper \u003d false;\n                 synchronized (mutex) {\n                     objectMapper \u003d mappers.get(currentFieldName);\n                     if (objectMapper \u003d\u003d null) {\n-                        newMapper \u003d true;\n                         // remove the current field name from path, since template search and the object builder add it as well...\n                         context.path().remove();\n                         Mapper.Builder builder \u003d context.root().findTemplateBuilder(context, currentFieldName, \"object\");\n@@ -535,21 +533,38 @@ private void serializeObject(final ParseContext context, String currentFieldName\n                         }\n                         BuilderContext builderContext \u003d new BuilderContext(context.indexSettings(), context.path());\n                         objectMapper \u003d builder.build(builderContext);\n-                        putMapper(objectMapper);\n                         // ...now re add it\n                         context.path().add(currentFieldName);\n                         context.setMappingsModified();\n+\n+                        if (context.isWithinNewMapper()) {\n+                            // within a new mapper, no need to traverse, just parse\n+                            objectMapper.parse(context);\n+                        } else {\n+                            // create a context of new mapper, so we batch aggregate all the changes within\n+                            // this object mapper once, and traverse all of them to add them in a single go\n+                            context.setWithinNewMapper();\n+                            try {\n+                                objectMapper.parse(context);\n+                                FieldMapperListener.Aggregator newFields \u003d new FieldMapperListener.Aggregator();\n+                                ObjectMapperListener.Aggregator newObjects \u003d new ObjectMapperListener.Aggregator();\n+                                objectMapper.traverse(newFields);\n+                                objectMapper.traverse(newObjects);\n+                                // callback on adding those fields!\n+                                context.docMapper().addFieldMappers(newFields.mappers);\n+                                context.docMapper().addObjectMappers(newObjects.mappers);\n+                            } finally {\n+                                context.clearWithinNewMapper();\n+                            }\n+                        }\n+\n+                        // only put after we traversed and did the callbacks, so other parsing won\u0027t see it only after we\n+                        // properly traversed it and adding the mappers\n+                        putMapper(objectMapper);\n+                    } else {\n+                        objectMapper.parse(context);\n                     }\n                 }\n-                // traverse and parse outside of the mutex\n-                if (newMapper) {\n-                    // we need to traverse in case we have a dynamic template and need to add field mappers\n-                    // introduced by it\n-                    objectMapper.traverse(context.newFieldMappers());\n-                    objectMapper.traverse(context.newObjectMappers());\n-                }\n-                // now, parse it\n-                objectMapper.parse(context);\n             } else {\n                 // not dynamic, read everything up to end object\n                 context.parser().skipChildren();\n@@ -607,11 +622,9 @@ private void serializeValue(final ParseContext context, String currentFieldName,\n         // we sync here since we don\u0027t want to add this field twice to the document mapper\n         // its not the end of the world, since we add it to the mappers once we create it\n         // so next time we won\u0027t even get here for this field\n-        boolean newMapper \u003d false;\n         synchronized (mutex) {\n             mapper \u003d mappers.get(currentFieldName);\n             if (mapper \u003d\u003d null) {\n-                newMapper \u003d true;\n                 BuilderContext builderContext \u003d new BuilderContext(context.indexSettings(), context.path());\n                 if (token \u003d\u003d XContentParser.Token.VALUE_STRING) {\n                     boolean resolved \u003d false;\n@@ -765,14 +778,29 @@ private void serializeValue(final ParseContext context, String currentFieldName,\n                         throw new ElasticSearchIllegalStateException(\"Can\u0027t handle serializing a dynamic type with content token [\" + token + \"] and field name [\" + currentFieldName + \"]\");\n                     }\n                 }\n+\n+                if (context.isWithinNewMapper()) {\n+                    mapper.parse(context);\n+                } else {\n+                    context.setWithinNewMapper();\n+                    try {\n+                        mapper.parse(context);\n+                        FieldMapperListener.Aggregator newFields \u003d new FieldMapperListener.Aggregator();\n+                        mapper.traverse(newFields);\n+                        context.docMapper().addFieldMappers(newFields.mappers);\n+                    } finally {\n+                        context.clearWithinNewMapper();\n+                    }\n+                }\n+\n+                // only put after we traversed and did the callbacks, so other parsing won\u0027t see it only after we\n+                // properly traversed it and adding the mappers\n                 putMapper(mapper);\n                 context.setMappingsModified();\n+            } else {\n+                mapper.parse(context);\n             }\n         }\n-        if (newMapper) {\n-            mapper.traverse(context.newFieldMappers());\n-        }\n-        mapper.parse(context);\n     }\n \n     @Override"
        },
        {
          "file_name": "src/test/java/org/elasticsearch/test/integration/indices/mapping/ConcurrentDynamicTemplateTests.java",
          "patch": "@@ -0,0 +1,91 @@\n+/*\n+ * Licensed to ElasticSearch and Shay Banon under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. ElasticSearch licenses this\n+ * file to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.test.integration.indices.mapping;\n+\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.action.WriteConsistencyLevel;\n+import org.elasticsearch.action.index.IndexResponse;\n+import org.elasticsearch.index.query.MatchQueryBuilder;\n+import org.elasticsearch.index.query.QueryBuilders;\n+import org.elasticsearch.search.SearchHits;\n+import org.elasticsearch.test.integration.AbstractSharedClusterTest;\n+import org.junit.Test;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+import java.util.concurrent.CopyOnWriteArrayList;\n+import java.util.concurrent.CountDownLatch;\n+\n+import static org.hamcrest.Matchers.emptyIterable;\n+\n+public class ConcurrentDynamicTemplateTests extends AbstractSharedClusterTest {\n+\n+    private final String mappingType \u003d \"test-mapping\";\n+\n+    @Test // see #3544\n+    public void testConcurrentDynamicMapping() throws Exception {\n+        final String mapping \u003d \"{\" + mappingType + \": {\" + \"\\\"properties\\\": {\" + \"\\\"an_id\\\": {\"\n+                + \"\\\"type\\\": \\\"string\\\",\" + \"\\\"store\\\": \\\"yes\\\",\" + \"\\\"index\\\": \\\"not_analyzed\\\"\" + \"}\" + \"},\" + \"\\\"dynamic_templates\\\": [\"\n+                + \"{\" + \"\\\"participants\\\": {\" + \"\\\"path_match\\\": \\\"*\\\",\" + \"\\\"mapping\\\": {\" + \"\\\"type\\\": \\\"string\\\",\" + \"\\\"store\\\": \\\"yes\\\",\"\n+                + \"\\\"index\\\": \\\"analyzed\\\",\" + \"\\\"analyzer\\\": \\\"whitespace\\\"\" + \"}\" + \"}\" + \"}\" + \"]\" + \"}\" + \"}\";\n+        // The \u0027fieldNames\u0027 array is used to help with retrieval of index terms\n+        // after testing\n+\n+        final String fieldName \u003d \"participants.ACCEPTED\";\n+        int iters \u003d atLeast(5);\n+        for (int i \u003d 0; i \u003c iters; i++) {\n+            wipeIndex(\"test\");\n+            client().admin().indices().prepareCreate(\"test\").addMapping(mappingType, mapping).execute().actionGet();\n+            ensureYellow();\n+            int numDocs \u003d atLeast(5);\n+            final CountDownLatch latch \u003d new CountDownLatch(numDocs);\n+            final List\u003cThrowable\u003e throwable \u003d new CopyOnWriteArrayList\u003cThrowable\u003e();\n+            for (int j \u003d 0; j \u003c numDocs; j++) {\n+                Map\u003cString, Object\u003e source \u003d new HashMap\u003cString, Object\u003e();\n+                source.put(\"an_id\", UUID.randomUUID().toString());\n+                source.put(fieldName, \"test-user\");\n+                client().prepareIndex(\"test\", mappingType).setSource(source).setConsistencyLevel(WriteConsistencyLevel.QUORUM).execute(new ActionListener\u003cIndexResponse\u003e() {\n+                    @Override\n+                    public void onResponse(IndexResponse response) {\n+                        latch.countDown();\n+                    }\n+\n+                    @Override\n+                    public void onFailure(Throwable e) {\n+                        throwable.add(e);\n+                        latch.countDown();\n+                    }\n+                });\n+            }\n+            latch.await();\n+            assertThat(throwable, emptyIterable());\n+            refresh();\n+            MatchQueryBuilder builder \u003d QueryBuilders.matchQuery(fieldName, \"test-user\");\n+            SearchHits sh \u003d client().prepareSearch(\"test\").setQuery(builder).execute().actionGet().getHits();\n+            assertEquals(sh.getTotalHits(), numDocs);\n+\n+            assertEquals(client().prepareSearch(\"test\").setQuery(QueryBuilders.matchQuery(fieldName, \"test user\")).execute().actionGet().getHits().getTotalHits(), 0);\n+\n+        }\n+    }\n+\n+}\n\\ No newline at end of file"
        }
      ]
    }
  },
  {
    "name": "(CDAP-4388) Fix the race condition in resource coordinator",
    "url": "https://github.com/caskdata/cdap/pull/5741",
    "description": "- Fix the ZKExtOperations methods\n  - Instead of using a fixed data value to be used in the retry operation,\n    switched to use Supplier of data so that the latest copy of data is provided\n    when the actual create / set happens\n  - Don\u0027t use create node with auto parent path creation as it will have a side\n    effect of \"locking\" the data value to the one when \"create\" method is called.\n    - Create parent is a async operation, meaning at the time when parent path creation\n      is completed, the actual value provided by the Supplier is already changed\n    - This is the root cause of CDAP-4388\n",
    "keywords": [
      "parent",
      "data",
      "create",
      "value"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/caskdata/cdap/commit/5bca556b6f62c4b3598eca618cd86e0c59ae3b8e",
      "files": [
        {
          "file_name": "cdap-common/src/main/java/co/cask/cdap/common/zookeeper/ZKExtOperations.java",
          "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright © 2014 Cask Data, Inc.\n+ * Copyright © 2014-2016 Cask Data, Inc.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n  * use this file except in compliance with the License. You may obtain a copy of\n@@ -18,6 +18,7 @@\n import co.cask.cdap.common.async.AsyncFunctions;\n import co.cask.cdap.common.io.Codec;\n import com.google.common.base.Function;\n+import com.google.common.base.Supplier;\n import com.google.common.util.concurrent.AsyncFunction;\n import com.google.common.util.concurrent.FutureCallback;\n import com.google.common.util.concurrent.Futures;\n@@ -51,17 +52,20 @@\n    *\n    * @param zkClient The ZKClient to perform the operations.\n    * @param path The path in ZK.\n-   * @param data The content of the ZK node.\n-   * @param result The result that will be set into the result future when completed successfully.\n+   * @param dataSupplier The supplier to provide the content to be set to the node. The supplier may get invoked\n+   *                     multiple times when the actual data is needed for creating or setting the content of\n+   *                     the given node. The supplier can be invoked from the caller thread as well as the\n+   *                     zookeeper event callback thread.\n+   * @param codec A {@link Codec} for serializing the data into byte array.\n    * @param maxFailure Maximum number of times to try to create/set the content.\n-   * @param \u003cV\u003e Type of the result.\n+   * @param \u003cT\u003e Type of the data.\n    * @return A {@link ListenableFuture} that will be completed when node is created or data is set. The future will\n    *         fail if failed to create and to set the data. Calling {@link ListenableFuture#cancel(boolean)} has\n    *         no effect.\n    */\n-  public static \u003cV\u003e ListenableFuture\u003cV\u003e createOrSet(ZKClient zkClient, String path,\n-                                                    byte[] data, V result, int maxFailure) {\n-    return setContent(zkClient, path, data, result, maxFailure, true, null);\n+  public static \u003cT\u003e ListenableFuture\u003cT\u003e createOrSet(ZKClient zkClient, String path, Supplier\u003cT\u003e dataSupplier,\n+                                                    Codec\u003cT\u003e codec, int maxFailure) {\n+    return createOrSetWithRetry(true, zkClient, path, dataSupplier, codec, null, maxFailure);\n   }\n \n   /**\n@@ -71,42 +75,48 @@\n    *\n    * @param zkClient The ZKClient to perform the operations.\n    * @param path The path in ZK.\n-   * @param data The content of the ZK node.\n-   * @param result The result that will be set into the result future when completed successfully.\n+   * @param dataSupplier The supplier to provide the content to be set to the node. The supplier may get invoked\n+   *                     multiple times when the actual data is needed for creating or setting the content of\n+   *                     the given node. The supplier can be invoked from the caller thread as well as the\n+   *                     zookeeper event callback thread.\n+   * @param codec A {@link Codec} for serializing the data into byte array.\n    * @param maxFailure Maximum number of times to try to create/set the content.\n-   * @param createAcl The access control list to set on the node, if it is created.\n-   * @param \u003cV\u003e Type of the result.\n+   * @param acls The access control list to set on the node, if it is created.\n+   * @param \u003cT\u003e Type of the data.\n    * @return A {@link ListenableFuture} that will be completed when node is created or data is set. The future will\n    *         fail if failed to create and to set the data. Calling {@link ListenableFuture#cancel(boolean)} has\n    *         no effect.\n    */\n-  public static \u003cV\u003e ListenableFuture\u003cV\u003e createOrSet(ZKClient zkClient, String path,\n-                                                    byte[] data, V result, int maxFailure, List\u003cACL\u003e createAcl) {\n-    return setContent(zkClient, path, data, result, maxFailure, true, createAcl);\n+  public static \u003cT\u003e ListenableFuture\u003cT\u003e createOrSet(ZKClient zkClient, String path, Supplier\u003cT\u003e dataSupplier,\n+                                                    Codec\u003cT\u003e codec, int maxFailure, List\u003cACL\u003e acls) {\n+    return createOrSetWithRetry(true, zkClient, path, dataSupplier, codec, acls, maxFailure);\n   }\n \n   /**\n-   * Attempts to set the content of the given node. If it failed due to node not exists\n+   * Attempts to set the content of the given node. If it failed due to node doesn\u0027t exist\n    * ({@link KeeperException.NoNodeException}), a persistent node will be created with the given content.\n    * This method is suitable for cases where the node is expected to be existed.\n    *\n    * @param zkClient The ZKClient to perform the operations.\n    * @param path The path in ZK.\n-   * @param data The content of the ZK node.\n-   * @param result The result that will be set into the result future when completed successfully.\n+   * @param dataSupplier The supplier to provide the content to be set to the node. The supplier may get invoked\n+   *                     multiple times when the actual data is needed for creating or setting the content of\n+   *                     the given node. The supplier can be invoked from the caller thread as well as the\n+   *                     zookeeper event callback thread.\n+   * @param codec A {@link Codec} for serializing the data into byte array.\n    * @param maxFailure Maximum number of times to try to create/set the content.\n-   * @param \u003cV\u003e Type of the result.\n+   * @param \u003cT\u003e Type of the data.\n    * @return A {@link ListenableFuture} that will be completed when node is created or data is set. The future will\n    *         fail if failed to create and to set the data. Calling {@link ListenableFuture#cancel(boolean)} has\n    *         no effect.\n    */\n-  public static \u003cV\u003e ListenableFuture\u003cV\u003e setOrCreate(ZKClient zkClient, String path,\n-                                                    byte[] data, V result, int maxFailure) {\n-    return setContent(zkClient, path, data, result, maxFailure, false, null);\n+  public static \u003cT\u003e ListenableFuture\u003cT\u003e setOrCreate(ZKClient zkClient, String path, Supplier\u003cT\u003e dataSupplier,\n+                                                    Codec\u003cT\u003e codec, int maxFailure) {\n+    return createOrSetWithRetry(false, zkClient, path, dataSupplier, codec, null, maxFailure);\n   }\n \n   /**\n-   * Update the content of the given node. If the node doesn\u0027t exists, it will try to create the node. Same as calling\n+   * Update the content of the given node. If the node doesn\u0027t exist, it will try to create the node. Same as calling\n    *\n    * {@link #updateOrCreate(ZKClient, String, Function, Codec, List)\n    * updateOrCreate(zkClient, path, modifier, codec, null)}\n@@ -119,7 +129,7 @@\n   }\n \n   /**\n-   * Update the content of the given node. If the node doesn\u0027t exists, it will try to create the node.\n+   * Update the content of the given node. If the node doesn\u0027t exist, it will try to create the node.\n    * The modifier will be executed in the ZooKeeper callback thread, hence no blocking operation should be performed\n    * in it. If blocking operation is needed, use the async version of this method.\n    *\n@@ -135,7 +145,7 @@\n   }\n \n   /**\n-   * Update the content of the given node. If the node doesn\u0027t exists, it will try to create the node. Same as calling\n+   * Update the content of the given node. If the node doesn\u0027t exist, it will try to create the node. Same as calling\n    *\n    * {@link #updateOrCreate(ZKClient, String, AsyncFunction, Codec, List)\n    * updateOrCreate(zkClient, path, modifier, codec, null)}\n@@ -148,7 +158,7 @@\n   }\n \n   /**\n-   * Update the content of the given node. If the node doesn\u0027t exists, it will try to create the node. If the node\n+   * Update the content of the given node. If the node doesn\u0027t exist, it will try to create the node. If the node\n    * exists, the existing content of the data will be provided to the modifier function to generate new content. A\n    * conditional set will be performed which requires existing content the same as the one provided to the modifier\n    * function. If the conditional set failed, the latest content will be fetched and fed to the modifier function\n@@ -175,94 +185,6 @@\n   }\n \n   /**\n-   * Attempts to set the content of the given node. If it failed due to node not exists\n-   * ({@link KeeperException.NoNodeException}), a persistent node will be created with the given content.\n-   * This method is suitable for cases where the node is expected to be existed.\n-   *\n-   * @param zkClient The ZKClient to perform the operations.\n-   * @param path The path in ZK.\n-   * @param data The content of the ZK node.\n-   * @param result The result that will be set into the result future when completed successfully.\n-   * @param maxFailure Maximum number of times to try to create/set the content.\n-   * @param createAcl The access control list to set on the node, if it is created.\n-   * @param \u003cV\u003e Type of the result.\n-   * @return A {@link ListenableFuture} that will be completed when node is created or data is set. The future will\n-   *         fail if failed to create and to set the data. Calling {@link ListenableFuture#cancel(boolean)} has\n-   *         no effect.\n-   */\n-  public static \u003cV\u003e ListenableFuture\u003cV\u003e setOrCreate(ZKClient zkClient, String path,\n-                                                    byte[] data, V result, int maxFailure, List\u003cACL\u003e createAcl) {\n-    return setContent(zkClient, path, data, result, maxFailure, false, createAcl);\n-  }\n-\n-  /**\n-   * Sets the content of a ZK node. Depends on the {@code createFirst} value,\n-   * either {@link ZKClient#create(String, byte[], org.apache.zookeeper.CreateMode)} or\n-   * {@link ZKClient#setData(String, byte[])} wil be called first.\n-   *\n-   * @param zkClient The ZKClient to perform the operations.\n-   * @param path The path in ZK.\n-   * @param data The content of the ZK node.\n-   * @param result The result that will be set into the result future when completed successfully.\n-   * @param maxFailure Maximum number of times to try to create/set the content.\n-   * @param createFirst If true, create is called first, otherwise setData is called first.\n-   * @param \u003cV\u003e Type of the result.\n-   * @return A {@link ListenableFuture} that will be completed when node is created or data is set. The future will\n-   *         fail if failed to create and to set the data. Calling {@link ListenableFuture#cancel(boolean)} has\n-   *         no effect.\n-   */\n-  private static \u003cV\u003e ListenableFuture\u003cV\u003e setContent(final ZKClient zkClient, final String path,\n-                                                    final byte[] data, final V result,\n-                                                    final int maxFailure, boolean createFirst,\n-                                                    final List\u003cACL\u003e createAcls) {\n-\n-    final SettableFuture\u003cV\u003e resultFuture \u003d SettableFuture.create();\n-    final AtomicInteger failureCount \u003d new AtomicInteger(0);\n-\n-    OperationFuture\u003c?\u003e operationFuture;\n-\n-    if (createFirst) {\n-      if (createAcls !\u003d null) {\n-        operationFuture \u003d zkClient.create(path, data, CreateMode.PERSISTENT, createAcls);\n-      } else {\n-        operationFuture \u003d zkClient.create(path, data, CreateMode.PERSISTENT);\n-      }\n-    } else {\n-      operationFuture \u003d zkClient.setData(path, data);\n-    }\n-\n-    Futures.addCallback(operationFuture, new FutureCallback\u003cObject\u003e() {\n-      @Override\n-      public void onSuccess(Object zkResult) {\n-        resultFuture.set(result);\n-      }\n-\n-      @Override\n-      public void onFailure(Throwable t) {\n-        if (failureCount.getAndIncrement() \u003e maxFailure) {\n-          resultFuture.setException(new Exception(\"Failed more than \" + maxFailure + \"times\", t));\n-        } else if (t instanceof KeeperException.NoNodeException) {\n-          // If node not exists, create it with the data\n-          OperationFuture\u003c?\u003e createFuture;\n-          if (createAcls !\u003d null) {\n-            createFuture \u003d zkClient.create(path, data, CreateMode.PERSISTENT, createAcls);\n-          } else {\n-            createFuture \u003d zkClient.create(path, data, CreateMode.PERSISTENT);\n-          }\n-          Futures.addCallback(createFuture, this, Threads.SAME_THREAD_EXECUTOR);\n-        } else if (t instanceof KeeperException.NodeExistsException) {\n-          // If the node exists when trying to create, set data.\n-          Futures.addCallback(zkClient.setData(path, data), this, Threads.SAME_THREAD_EXECUTOR);\n-        } else {\n-          resultFuture.setException(t);\n-        }\n-      }\n-    }, Threads.SAME_THREAD_EXECUTOR);\n-\n-    return resultFuture;\n-  }\n-\n-  /**\n    * Performs the get and condition set part as described in\n    * {@link #updateOrCreate(ZKClient, String, Function, Codec, List)}.\n    */\n@@ -309,7 +231,7 @@ public void onFailure(Throwable t) {\n                       // If the version is not good, get and set again\n                       getAndSet(zkClient, path, modifier, codec, resultFuture, createAcl);\n                     } else if (t instanceof KeeperException.NoNodeException) {\n-                      // If the node not exists, try to do create\n+                      // If the node doesn\u0027t exist, try to do create\n                       createOrGetAndSet(zkClient, path, modifier, codec, resultFuture, createAcl);\n                     } else {\n                       resultFuture.setException(t);\n@@ -334,7 +256,7 @@ public void onFailure(Throwable t) {\n \n       @Override\n       public void onFailure(Throwable t) {\n-        // If failed to get data because node not exists, try the create.\n+        // If failed to get data because node doesn\u0027t exist, try the create.\n         if (t instanceof KeeperException.NoNodeException) {\n           createOrGetAndSet(zkClient, path, modifier, codec, resultFuture, createAcl);\n         } else {\n@@ -344,7 +266,6 @@ public void onFailure(Throwable t) {\n     }, Threads.SAME_THREAD_EXECUTOR);\n   }\n \n-\n   /**\n    * Performs the create part as described in\n    * {@link #updateOrCreate(ZKClient, String, Function, Codec, List)}. If the creation failed with\n@@ -353,58 +274,293 @@ public void onFailure(Throwable t) {\n    */\n   private static \u003cV\u003e void createOrGetAndSet(final ZKClient zkClient, final String path,\n                                             final AsyncFunction\u003cV, V\u003e modifier, final Codec\u003cV\u003e codec,\n-                                            final SettableFuture\u003cV\u003e resultFuture, final List\u003cACL\u003e createAcl) {\n+                                            final SettableFuture\u003cV\u003e resultFuture, final List\u003cACL\u003e acls) {\n+\n+    // Tries to create the node first.\n+    ListenableFuture\u003cV\u003e createFuture \u003d create(zkClient, path, new Supplier\u003cListenableFuture\u003cV\u003e\u003e() {\n+      @Override\n+      public ListenableFuture\u003cV\u003e get() {\n+        try {\n+          return Futures.transform(modifier.apply(null), new Function\u003cV, V\u003e() {\n+            @Override\n+            public V apply(@Nullable V input) {\n+              // If the modifier returns null, it means aborting the operation\n+              // we throw an exception here so that it will be reflected in the \"createFuture\".\n+              // The callback on the createFuture will handle this exception\n+              if (input \u003d\u003d null) {\n+                throw new AbortModificationException();\n+              } else {\n+                return input;\n+              }\n+            }\n+          }, Threads.SAME_THREAD_EXECUTOR);\n+        } catch (Exception e) {\n+          return Futures.immediateFailedFuture(e);\n+        }\n+      }\n+    }, codec, acls, SettableFuture.\u003cV\u003ecreate());\n+\n     try {\n-      Futures.addCallback(modifier.apply(null), new FutureCallback\u003cV\u003e() {\n+      Futures.addCallback(createFuture, new FutureCallback\u003cV\u003e() {\n         @Override\n         public void onSuccess(final V content) {\n-          if (content \u003d\u003d null) {\n+          resultFuture.set(content);\n+        }\n+\n+        @Override\n+        public void onFailure(Throwable t) {\n+          if (t instanceof AbortModificationException) {\n+            // The modifier decided to abort. Just set the result future to complete\n             resultFuture.set(null);\n-            return;\n+          } else if (t instanceof KeeperException.NodeExistsException) {\n+            // If failed to create due to node exists, try to do getAndSet.\n+            getAndSet(zkClient, path, modifier, codec, resultFuture, acls);\n+          } else {\n+            resultFuture.setException(t);\n+          }\n+        }\n+      }, Threads.SAME_THREAD_EXECUTOR);\n+    } catch (Throwable e) {\n+      resultFuture.setException(e);\n+    }\n+  }\n+\n+  /**\n+   * Actual implementation of the three public methods.\n+   *\n+   * @see #createOrSet(ZKClient, String, Supplier, Codec, int)\n+   * @see #createOrSet(ZKClient, String, Supplier, Codec, int, List)\n+   * @see #setOrCreate(ZKClient, String, Supplier, Codec, int)\n+   */\n+  private static \u003cT\u003e ListenableFuture\u003cT\u003e createOrSetWithRetry(final boolean createFirst, final ZKClient zkClient,\n+                                                              final String path, final Supplier\u003cT\u003e dataSupplier,\n+                                                              final Codec\u003cT\u003e codec, @Nullable final Iterable\u003cACL\u003e acls,\n+                                                              final int maxRetry) {\n+    final SettableFuture\u003cT\u003e resultFuture \u003d SettableFuture.create();\n+    final AtomicInteger failures \u003d new AtomicInteger(0);\n+\n+    Futures.addCallback(\n+      doCreateOrSet(createFirst, zkClient, path, dataSupplier, codec, acls),\n+      new FutureCallback\u003cT\u003e() {\n+        @Override\n+        public void onSuccess(T result) {\n+          resultFuture.set(result);\n+        }\n+\n+        @Override\n+        public void onFailure(Throwable t) {\n+          if (failures.getAndIncrement() \u003c maxRetry) {\n+            Futures.addCallback(doCreateOrSet(createFirst, zkClient, path, dataSupplier, codec, acls),\n+                                this, Threads.SAME_THREAD_EXECUTOR);\n+          } else {\n+            resultFuture.setException(t);\n+          }\n+        }\n+      }, Threads.SAME_THREAD_EXECUTOR\n+    );\n+\n+    return resultFuture;\n+  }\n+\n+  /**\n+   * Tries create or set the content of a node. If {@code createFirst} is {@code true}, it will first try to create;\n+   * and if it failed with NodeExists error, then will try to perform set.\n+   * If {@code createFirst} is {@code false}, then it will first try to set and if it failed with NoNode error,\n+   * then will try to perform create.\n+   *\n+   * @param createFirst if {@code true}, try create and then set; if {@code false}, try set and then create.\n+   * @param zkClient The ZKClient to perform the operations.\n+   * @param path The path in ZK.\n+   * @param dataSupplier The supplier to provide the content to be set to the node.\n+   * @param codec A {@link Codec} for serializing the data into byte array.\n+   * @param acls The access control list to set on the node.\n+   * @param \u003cT\u003e type of the data to set to the node\n+   * @return A {@link ListenableFuture} that will be completed when node is created or data is set.\n+   *         The future will carry the actual content being set into the node.\n+   */\n+  private static \u003cT\u003e ListenableFuture\u003cT\u003e doCreateOrSet(final boolean createFirst, final ZKClient zkClient,\n+                                                       final String path, final Supplier\u003cT\u003e dataSupplier,\n+                                                       final Codec\u003cT\u003e codec, @Nullable final Iterable\u003cACL\u003e acls) {\n+    final SettableFuture\u003cT\u003e resultFuture \u003d SettableFuture.create();\n+    final Supplier\u003cListenableFuture\u003cT\u003e\u003e futureSupplier \u003d createFutureSupplier(dataSupplier);\n+    try {\n+      // Do a create/set first based on the argument\n+      ListenableFuture\u003cT\u003e future \u003d createFirst\n+        ? create(zkClient, path, futureSupplier, codec, acls, SettableFuture.\u003cT\u003ecreate())\n+        : setData(zkClient, path, dataSupplier, codec, SettableFuture.\u003cT\u003ecreate());\n+\n+      Futures.addCallback(future, new FutureCallback\u003cT\u003e() {\n+        @Override\n+        public void onSuccess(T result) {\n+          // If the operation completed, then we are done\n+          resultFuture.set(result);\n+        }\n+\n+        @Override\n+        public void onFailure(Throwable failure) {\n+          if (createFirst \u0026\u0026 failure instanceof KeeperException.NodeExistsException) {\n+            // If failed to create due to node exists exception, set the value\n+            setData(zkClient, path, dataSupplier, codec, resultFuture);\n+          } else if (!createFirst \u0026\u0026 failure instanceof KeeperException.NoNodeException) {\n+            // If failed to set due to no node exception, try to create the node\n+            create(zkClient, path, futureSupplier, codec, acls, resultFuture);\n+          } else {\n+            resultFuture.setException(failure);\n           }\n+        }\n+      }, Threads.SAME_THREAD_EXECUTOR);\n+    } catch (Exception e) {\n+      resultFuture.setException(e);\n+    }\n+    return resultFuture;\n+  }\n \n-          try {\n-            byte[] data \u003d codec.encode(content);\n+  /**\n+   * Creates a zookeeper node with the given data with automatic parent node creation.\n+   *\n+   * @param zkClient The ZKClient to perform the operations.\n+   * @param path The path in ZK.\n+   * @param dataSupplier a {@link Supplier} to provide a {@link ListenableFuture} that will yield data to be used\n+   *                     as the node content. The supplier may get invoked\n+   *                     multiple times when the actual data is needed for creating the content of\n+   *                     the given node. The supplier can be invoked from the caller thread as well as the\n+   *                     zookeeper event callback thread.\n+   * @param codec A {@link Codec} for serializing the data into byte array.\n+   * @param acls The access control list to set on the node.\n+   * @param resultFuture a {@link SettableFuture} for reflecting the operation result. If the create succeeded,\n+   *                     the result future will contain the actual object being set to the node.\n+   * @param \u003cT\u003e type of data content\n+   * @return the same resultFuture as being passed from parameter\n+   */\n+  private static \u003cT\u003e SettableFuture\u003cT\u003e create(final ZKClient zkClient, final String path,\n+                                              final Supplier\u003cListenableFuture\u003cT\u003e\u003e dataSupplier, final Codec\u003cT\u003e codec,\n+                                              @Nullable final Iterable\u003cACL\u003e acls,\n+                                              final SettableFuture\u003cT\u003e resultFuture) {\n+    // Invoke the supplier to get a ListenableFuture and performs node create when the data is available\n+    Futures.addCallback(dataSupplier.get(), new FutureCallback\u003cT\u003e() {\n+      @Override\n+      public void onSuccess(final T data) {\n+        try {\n+          // Try to create the node without creating parent. This is to make sure the latest data\n+          // is being used if there are concurrent modification to the node (CDAP-4388)\n+          OperationFuture\u003cString\u003e createFuture \u003d (acls \u003d\u003d null)\n+            ? zkClient.create(path, codec.encode(data), CreateMode.PERSISTENT, false)\n+            : zkClient.create(path, codec.encode(data), CreateMode.PERSISTENT, false, acls);\n \n-            OperationFuture\u003cString\u003e future;\n-            if (createAcl \u003d\u003d null) {\n-              future \u003d zkClient.create(path, data, CreateMode.PERSISTENT);\n-            } else {\n-              future \u003d zkClient.create(path, data, CreateMode.PERSISTENT, createAcl);\n+          Futures.addCallback(createFuture, new FutureCallback\u003cString\u003e() {\n+            @Override\n+            public void onSuccess(String result) {\n+              // If creation succeeded, the operation is completed\n+              resultFuture.set(data);\n             }\n \n-            Futures.addCallback(future, new FutureCallback\u003cString\u003e() {\n-              @Override\n-              public void onSuccess(String result) {\n-                resultFuture.set(content);\n-              }\n+            @Override\n+            public void onFailure(Throwable t) {\n+              if (t instanceof KeeperException.NoNodeException) {\n+                // If failed with NoNode, it means parent path doesn\u0027t exist. Create the parent path first and retry\n+                OperationFuture\u003cString\u003e createParentFuture \u003d zkClient.create(getParent(path), null,\n+                                                                             CreateMode.PERSISTENT);\n+                Futures.addCallback(createParentFuture, new FutureCallback\u003cString\u003e() {\n+                  @Override\n+                  public void onSuccess(String result) {\n+                    // If creation of parent path succeeded, try to create again.\n+                    // We call the create method again so that the dataSupplier will be called to get the latest value.\n+                    create(zkClient, path, dataSupplier, codec, acls, resultFuture);\n+                  }\n \n-              @Override\n-              public void onFailure(Throwable t) {\n-                if (t instanceof KeeperException.NodeExistsException) {\n-                  // If failed to create due to node exists, try to do getAndSet.\n-                  getAndSet(zkClient, path, modifier, codec, resultFuture, createAcl);\n-                } else {\n-                  resultFuture.setException(t);\n-                }\n+                  @Override\n+                  public void onFailure(Throwable t) {\n+                    // If failed to create parent path, fail the operation\n+                    resultFuture.setException(t);\n+                  }\n+                }, Threads.SAME_THREAD_EXECUTOR);\n+              } else {\n+                resultFuture.setException(t);\n               }\n-            }, Threads.SAME_THREAD_EXECUTOR);\n-          } catch (Throwable t) {\n-            resultFuture.setException(t);\n-          }\n+            }\n+          }, Threads.SAME_THREAD_EXECUTOR);\n+        } catch (Exception e) {\n+          resultFuture.setException(e);\n+        }\n+      }\n+\n+      @Override\n+      public void onFailure(Throwable t) {\n+        // If the supplier failed to give the node content, reflect the error in the result future.\n+        resultFuture.setException(t);\n+      }\n+    }, Threads.SAME_THREAD_EXECUTOR);\n+\n+    return resultFuture;\n+  }\n \n+  /**\n+   * Sets the data content of a zookeeper node\n+   *\n+   * @param zkClient The ZKClient to perform the operations.\n+   * @param path The path in ZK.\n+   * @param dataSupplier The supplier to provide the content to be set to the node.\n+   * @param codec A {@link Codec} for serializing the data into byte array.\n+   * @param resultFuture a {@link SettableFuture} for reflecting the operation result. If the setData succeeded,\n+   *                     the result future will contain the actual object being set to the node.\n+   * @param \u003cT\u003e type of data content\n+   * @return the same resultFuture as being passed from parameter\n+   */\n+  private static \u003cT\u003e SettableFuture\u003cT\u003e setData(ZKClient zkClient, String path,\n+                                               Supplier\u003cT\u003e dataSupplier, Codec\u003cT\u003e codec,\n+                                               final SettableFuture\u003cT\u003e resultFuture) {\n+    try {\n+      final T data \u003d dataSupplier.get();\n+      Futures.addCallback(zkClient.setData(path, codec.encode(data)), new FutureCallback\u003cStat\u003e() {\n+        @Override\n+        public void onSuccess(Stat state) {\n+          resultFuture.set(data);\n         }\n \n         @Override\n         public void onFailure(Throwable t) {\n           resultFuture.setException(t);\n         }\n       }, Threads.SAME_THREAD_EXECUTOR);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {\n       resultFuture.setException(e);\n     }\n+\n+    return resultFuture;\n+  }\n+\n+  /**\n+   * Creates a {@link Supplier} such that when invoked, it will invoke the given {@link Supplier} and wrap\n+   * the result with a {@link ListenableFuture}.\n+   */\n+  private static \u003cT\u003e Supplier\u003cListenableFuture\u003cT\u003e\u003e createFutureSupplier(final Supplier\u003cT\u003e supplier) {\n+    return new Supplier\u003cListenableFuture\u003cT\u003e\u003e() {\n+      @Override\n+      public ListenableFuture\u003cT\u003e get() {\n+        return Futures.immediateFuture(supplier.get());\n+      }\n+    };\n+  }\n+\n+  /**\n+   * Gets the parent of the given path.\n+   * @param path Path for computing its parent\n+   * @return Parent of the given path, or empty string if the given path is the root path already.\n+   */\n+  private static String getParent(String path) {\n+    String parentPath \u003d path.substring(0, path.lastIndexOf(\u0027/\u0027));\n+    return (parentPath.isEmpty() \u0026\u0026 !\"/\".equals(path)) ? \"/\" : parentPath;\n   }\n \n+  /**\n+   * An exception to indicate that the modification operation is aborted. This exception won\u0027t get propagated to\n+   * user, but instead used as a tagging exception for aborting the createOrGetAndSet operation.\n+   */\n+  private static final class AbortModificationException extends RuntimeException {\n+    // No-op\n+  }\n+\n+\n   private ZKExtOperations() {\n   }\n }"
        },
        {
          "file_name": "cdap-common/src/main/java/co/cask/cdap/common/zookeeper/coordination/ResourceCoordinator.java",
          "patch": "@@ -17,6 +17,9 @@\n \n import co.cask.cdap.api.common.Bytes;\n import co.cask.cdap.common.zookeeper.ZKExtOperations;\n+import com.google.common.base.Functions;\n+import com.google.common.base.Supplier;\n+import com.google.common.base.Suppliers;\n import com.google.common.collect.ImmutableSet;\n import com.google.common.collect.ImmutableSortedSet;\n import com.google.common.collect.Maps;\n@@ -41,8 +44,10 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import java.util.HashMap;\n import java.util.Map;\n import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.Executor;\n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.Executors;\n@@ -85,9 +90,11 @@ public ResourceCoordinator(ZKClient zkClient,\n     this.zkClient \u003d zkClient;\n     this.discoveryService \u003d discoveryService;\n     this.assignmentStrategy \u003d assignmentStrategy;\n-    this.requirements \u003d Maps.newHashMap();\n-    this.assignments \u003d Maps.newHashMap();\n-    this.serviceDiscovered \u003d Maps.newHashMap();\n+    this.requirements \u003d new HashMap\u003c\u003e();\n+    // The assignments map will be accessed from both the coordinator thread and the zk event thread\n+    // in order to make sure the latest assignment is being used to store in the ZK node.\n+    this.assignments \u003d new ConcurrentHashMap\u003c\u003e();\n+    this.serviceDiscovered \u003d new HashMap\u003c\u003e();\n     this.discoverableListener \u003d new DiscoverableChangeListener();\n   }\n \n@@ -364,14 +371,18 @@ public void onFailure(Throwable t) {\n    * @param assignment The assignment to be persisted.\n    */\n   private void saveAssignment(ResourceAssignment assignment) {\n-    assignments.put(assignment.getName(), assignment);\n+    String assignmentName \u003d assignment.getName();\n+    assignments.put(assignmentName, assignment);\n \n     try {\n       final byte[] data \u003d CoordinationConstants.RESOURCE_ASSIGNMENT_CODEC.encode(assignment);\n-      String zkPath \u003d CoordinationConstants.ASSIGNMENTS_PATH + \"/\" + assignment.getName();\n+      String zkPath \u003d CoordinationConstants.ASSIGNMENTS_PATH + \"/\" + assignmentName;\n \n+      Supplier\u003cResourceAssignment\u003e dataSupplier \u003d Suppliers.compose(Functions.forMap(assignments),\n+                                                                    Suppliers.ofInstance(assignmentName));\n       Futures.addCallback(\n-        ZKExtOperations.setOrCreate(zkClient, zkPath, data, assignment, CoordinationConstants.MAX_ZK_FAILURE_RETRY),\n+        ZKExtOperations.setOrCreate(zkClient, zkPath, dataSupplier, CoordinationConstants.RESOURCE_ASSIGNMENT_CODEC,\n+                                    CoordinationConstants.MAX_ZK_FAILURE_RETRY),\n         new FutureCallback\u003cResourceAssignment\u003e() {\n \n           @Override\n@@ -389,7 +400,7 @@ public void onFailure(Throwable t) {\n       );\n     } catch (Exception e) {\n       // Something very wrong\n-      LOG.error(\"Failed to save assignment: {}\", assignment.getName(), e);\n+      LOG.error(\"Failed to save assignment: {}\", assignmentName, e);\n     }\n   }\n "
        },
        {
          "file_name": "cdap-common/src/main/java/co/cask/cdap/common/zookeeper/coordination/ResourceCoordinatorClient.java",
          "patch": "@@ -20,6 +20,7 @@\n import com.google.common.base.Function;\n import com.google.common.base.Functions;\n import com.google.common.base.Objects;\n+import com.google.common.base.Suppliers;\n import com.google.common.base.Throwables;\n import com.google.common.collect.LinkedHashMultimap;\n import com.google.common.collect.Maps;\n@@ -92,15 +93,10 @@ public ResourceCoordinatorClient(ZKClient zkClient) {\n    *         {@link ListenableFuture#cancel(boolean)} has no effect.\n    */\n   public ListenableFuture\u003cResourceRequirement\u003e submitRequirement(ResourceRequirement requirement) {\n-    try {\n-      String zkPath \u003d CoordinationConstants.REQUIREMENTS_PATH + \"/\" + requirement.getName();\n-      byte[] data \u003d CoordinationConstants.RESOURCE_REQUIREMENT_CODEC.encode(requirement);\n-\n-      return ZKExtOperations.createOrSet(zkClient, zkPath, data,\n-                                         requirement, CoordinationConstants.MAX_ZK_FAILURE_RETRY);\n-    } catch (Exception e) {\n-      return Futures.immediateFailedFuture(e);\n-    }\n+    String zkPath \u003d CoordinationConstants.REQUIREMENTS_PATH + \"/\" + requirement.getName();\n+    return ZKExtOperations.createOrSet(zkClient, zkPath, Suppliers.ofInstance(requirement),\n+                                       CoordinationConstants.RESOURCE_REQUIREMENT_CODEC,\n+                                       CoordinationConstants.MAX_ZK_FAILURE_RETRY);\n   }\n \n   /**"
        },
        {
          "file_name": "cdap-common/src/main/java/co/cask/cdap/common/zookeeper/store/ZKPropertyStore.java",
          "patch": "@@ -20,6 +20,7 @@\n import co.cask.cdap.common.conf.PropertyUpdater;\n import co.cask.cdap.common.io.Codec;\n import co.cask.cdap.common.zookeeper.ZKExtOperations;\n+import com.google.common.base.Suppliers;\n import com.google.common.collect.Sets;\n import com.google.common.util.concurrent.FutureCallback;\n import com.google.common.util.concurrent.Futures;\n@@ -92,12 +93,8 @@ private ZKPropertyStore(ZKClient zkClient, Codec\u003cT\u003e codec) {\n \n   @Override\n   public ListenableFuture\u003cT\u003e set(String name, T property) {\n-    try {\n-      return ZKExtOperations.setOrCreate(zkClient, getPath(name),\n-                                         codec.encode(property), property, MAX_ZK_FAILURE_RETRIES);\n-    } catch (IOException e) {\n-      return Futures.immediateFailedFuture(e);\n-    }\n+    return ZKExtOperations.setOrCreate(zkClient, getPath(name), Suppliers.ofInstance(property),\n+                                       codec, MAX_ZK_FAILURE_RETRIES);\n   }\n \n   @Override"
        },
        {
          "file_name": "cdap-common/src/test/java/co/cask/cdap/common/zookeeper/ZKExtOperationsTest.java",
          "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright © 2014 Cask Data, Inc.\n+ * Copyright © 2014-2016 Cask Data, Inc.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n  * use this file except in compliance with the License. You may obtain a copy of\n@@ -18,6 +18,7 @@\n import co.cask.cdap.api.common.Bytes;\n import co.cask.cdap.common.io.Codec;\n import com.google.common.base.Function;\n+import com.google.common.base.Suppliers;\n import com.google.common.base.Throwables;\n import org.apache.twill.internal.zookeeper.InMemoryZKServer;\n import org.apache.twill.zookeeper.ZKClientService;\n@@ -138,6 +139,47 @@ public Integer apply(@Nullable Integer input) {\n     zkClient2.stopAndWait();\n   }\n \n+  @Test\n+  public void testCreateOrSet() throws Exception {\n+    String path \u003d \"/parent/testCreateOrSet\";\n+    ZKClientService zkClient \u003d ZKClientService.Builder.of(zkServer.getConnectionStr()).build();\n+    zkClient.startAndWait();\n+\n+    // Create with \"1\"\n+    Assert.assertEquals(1, ZKExtOperations.createOrSet(zkClient, path,\n+                                                       Suppliers.ofInstance(1), INT_CODEC, 0).get().intValue());\n+    // Should get \"1\" back\n+    Assert.assertEquals(1, INT_CODEC.decode(zkClient.getData(path).get().getData()).intValue());\n+\n+    // Set with \"2\"\n+    Assert.assertEquals(2, ZKExtOperations.createOrSet(zkClient, path,\n+                                                       Suppliers.ofInstance(2), INT_CODEC, 0).get().intValue());\n+    // Should get \"2\" back\n+    Assert.assertEquals(2, INT_CODEC.decode(zkClient.getData(path).get().getData()).intValue());\n+\n+    zkClient.stopAndWait();\n+  }\n+\n+  @Test\n+  public void testSetOrCreate() throws Exception {\n+    String path \u003d \"/parent/testSetOrCreate\";\n+    ZKClientService zkClient \u003d ZKClientService.Builder.of(zkServer.getConnectionStr()).build();\n+    zkClient.startAndWait();\n+\n+    // Create with \"1\"\n+    Assert.assertEquals(1, ZKExtOperations.setOrCreate(zkClient, path,\n+                                                       Suppliers.ofInstance(1), INT_CODEC, 0).get().intValue());\n+    // Should get \"1\" back\n+    Assert.assertEquals(1, INT_CODEC.decode(zkClient.getData(path).get().getData()).intValue());\n+\n+    // Set with \"2\"\n+    Assert.assertEquals(2, ZKExtOperations.setOrCreate(zkClient, path,\n+                                                       Suppliers.ofInstance(2), INT_CODEC, 0).get().intValue());\n+    // Should get \"2\" back\n+    Assert.assertEquals(2, INT_CODEC.decode(zkClient.getData(path).get().getData()).intValue());\n+\n+    zkClient.stopAndWait();\n+  }\n \n   @AfterClass\n   public static void finish() {"
        },
        {
          "file_name": "cdap-security/src/main/java/co/cask/cdap/security/zookeeper/SharedResourceCache.java",
          "patch": "@@ -19,6 +19,7 @@\n import co.cask.cdap.common.io.Codec;\n import co.cask.cdap.common.zookeeper.ZKExtOperations;\n import com.google.common.base.Preconditions;\n+import com.google.common.base.Suppliers;\n import com.google.common.base.Throwables;\n import com.google.common.cache.AbstractLoadingCache;\n import com.google.common.collect.Maps;\n@@ -165,16 +166,15 @@ public T getIfPresent(Object key) {\n   public void put(final String name, final T instance) {\n     final String znode \u003d joinZNode(parentZnode, name);\n     try {\n-      final byte[] encoded \u003d codec.encode(instance);\n       LOG.debug(\"Setting value for node {}\", znode);\n-      ListenableFuture\u003cString\u003e future \u003d ZKExtOperations.createOrSet(zookeeper, znode, encoded, znode,\n-                                                                    MAX_RETRIES, znodeACL);\n+      ListenableFuture\u003cT\u003e future \u003d ZKExtOperations.createOrSet(zookeeper, znode, Suppliers.ofInstance(instance),\n+                                                               codec, MAX_RETRIES, znodeACL);\n \n-      Futures.addCallback(future, new FutureCallback\u003cString\u003e() {\n+      Futures.addCallback(future, new FutureCallback\u003cT\u003e() {\n         @Override\n-        public void onSuccess(String result) {\n+        public void onSuccess(T result) {\n           LOG.debug(\"Created or set node {}\", znode);\n-          resources.put(name, instance);\n+          resources.put(name, result);\n         }\n \n         @Override\n@@ -184,7 +184,10 @@ public void onFailure(Throwable t) {\n         }\n       });\n \n-    } catch (IOException ioe) {\n+      // Block until it is done\n+      future.get();\n+\n+    } catch (Exception ioe) {\n       throw Throwables.propagate(ioe);\n     }\n   }"
        }
      ]
    }
  },
  {
    "name": "netshell-controller / netshell-odl-mdsal activator race condition",
    "url": "https://github.com/esnet/netshell/issues/31",
    "description": "The activator for netshell-controller depends on the activator for netshell-odl-mdsal already having been run.  In some cases there is a race condition on the two activators, with the result that netshell-controller is unable to install a callback handler to process PACKET_IN events, and the multi-point VPN can\u0027t learn about new hosts via their broadcast packets.\n\nA workaround was the delay the startup of netshell-controller, but this doesn\u0027t seem to work all of the time, probably due to timing on different platforms.  A real fix is to actually have the netshell-controller activator check the state of the operation requiring netshell-odl-mdsal to be sure that it actually completed correctly.\n\nTested fix in hand as I\u0027m filing this issue.\n",
    "keywords": [
      "netshell-controller",
      "activator",
      "netshell-odl-mdsal"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/esnet/netshell/commit/42fc206f2e5fdcc352a08c4dca2a8ca51c00985d",
      "files": [
        {
          "file_name": "controller/src/main/java/net/es/netshell/controller/core/Controller.java",
          "patch": "@@ -162,25 +162,40 @@ public Controller() {\n         // XXX When we move the SdnController stuff to a different bundle, this code should be\n         // a part of the activator of that bundle.\n         //\n-        // XXX When we start up a Karaf container that has netshell-controller already loaded,\n-        // there appears to be a (not yet well understood) race condition with the startup of the ODL\n+        // When we start up a Karaf container that has netshell-controller already loaded,\n+        // there appears to be a possible race condition with the startup of the ODL\n         // MD-SAL and ODL Corsa bundles.  The symptom is that SdnController doesn\u0027t get\n-        // PacketReceived notifications.  If we delay the instantiation of the SdnController object\n-        // by 20 seconds, this appears to let things settle down so that notifications work.\n-        try {\n-            Thread.sleep(20000);\n-        }\n-        catch (InterruptedException e) {\n-        }\n+        // PacketReceived notifications.  We make sure that the callback setting actually succeeds\n+        // and if not we wait a second and try again (giving up after 60 seconds).\n         try {\n             SdnController sdncont \u003d new SdnController();\n-            sdncont.setCallback();\n-            Thread sdnthr \u003d new Thread(sdncont);\n-            sdnthr.start();\n+            boolean ok \u003d false;\n+            Integer countdown \u003d new Integer(60);\n+            while (!ok) {\n+                boolean rc \u003d sdncont.setCallback();\n+                logger.info(\"sdncont.setCallback returns \" + (rc ? \"true\" : \"false\") + \" with countdown \" + countdown.toString());\n+\n+                if (rc) {\n+                    ok \u003d true;\n+                }\n+                else {\n+                    if (countdown-- \u003c 0) {\n+                        break;\n+                    }\n+                    Thread.sleep(1000);\n+                }\n+            }\n+            if (ok) {\n+                Thread sdnthr \u003d new Thread(sdncont);\n+                sdnthr.start();\n+            }\n+            else {\n+                throw new RuntimeException(\"Can\u0027t set SdnController callback\");\n+            }\n         }\n         catch (Exception e) {\n             e.printStackTrace();\n-            logger.error(\"Unable to start SDNController instance\");\n+            logger.error(\"Unable to start SdnController instance\");\n         }\n     }\n     public static Controller getInstance() { return instance; }"
        }
      ]
    }
  },
  {
    "name": "Race condition for MessageHandler/UUID",
    "url": "https://github.com/DesignAndDeploy/dnd/issues/17",
    "description": "If a message is received shortly after a ConnectionEstablished, the remoteUUID may not have been set yet which results in MessageHandlers being called with remoteUUID \u003d\u003d null.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/DesignAndDeploy/dnd/commit/a9d581384d0bfa69c55fbb093cb894bcfbc58284",
      "files": [
        {
          "file_name": "DND/src/edu/teco/dnd/network/TCPConnectionManager.java",
          "patch": "@@ -41,6 +41,8 @@\n import java.util.concurrent.locks.ReadWriteLock;\n import java.util.concurrent.locks.ReentrantReadWriteLock;\n \n+import javax.xml.crypto.dsig.spec.HMACParameterSpec;\n+\n import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.Logger;\n import org.apache.logging.log4j.ThreadContext;\n@@ -105,14 +107,19 @@\n \t * Contains all client channels with an established connection.\n \t */\n \tprivate final Map\u003cUUID, Channel\u003e clientChannels \u003d new HashMap\u003cUUID, Channel\u003e();\n+\t\n+\t/**\n+\t * Clients we sent a ConnectionEstablishedMessage to and waiting for their reply.\n+\t */\n+\tprivate final Map\u003cUUID, Channel\u003e waitingChannels \u003d new HashMap\u003cUUID, Channel\u003e();\n \n \t/**\n \t * Set to true if the TCPConnectionManager is shutting down.\n \t */\n \tprivate boolean shutdown \u003d false;\n \n \t/**\n-\t * Lock used for synchronizing access to {@link #serverChannels}, {@link #clientChannels},\n+\t * Lock used for synchronizing access to {@link #serverChannels}, {@link #clientChannels}, {@link #waitingChannels},\n \t * {@link #unconnectedChannels} and {@link #shutdown}.\n \t */\n \tprivate final ReadWriteLock channelsLock \u003d new ReentrantReadWriteLock();\n@@ -724,11 +731,11 @@ public void handleMessage(ChannelHandlerContext ctx,\n \t\t\tif (localUUID.compareTo(remoteUUID) \u003c 0) {\n \t\t\t\tboolean establish \u003d false;\n \t\t\t\tchannelsLock.readLock().lock();\n-\t\t\t\tif (!clientChannels.containsKey(remoteUUID)) {\n+\t\t\t\tif (!clientChannels.containsKey(remoteUUID) \u0026\u0026 !waitingChannels.containsKey(remoteUUID)) {\n \t\t\t\t\tchannelsLock.readLock().unlock();\n \t\t\t\t\tchannelsLock.writeLock().lock();\n-\t\t\t\t\tif (!clientChannels.containsKey(remoteUUID)) {\n-\t\t\t\t\t\tclientChannels.put(remoteUUID, ctx.channel());\n+\t\t\t\t\tif (!clientChannels.containsKey(remoteUUID) \u0026\u0026 !waitingChannels.containsKey(remoteUUID)) {\n+\t\t\t\t\t\twaitingChannels.put(remoteUUID, ctx.channel());\n \t\t\t\t\t\testablish \u003d true;\n \t\t\t\t\t}\n \t\t\t\t\tchannelsLock.readLock().lock();\n@@ -737,7 +744,6 @@ public void handleMessage(ChannelHandlerContext ctx,\n \t\t\t\tchannelsLock.readLock().unlock();\n \t\t\t\tif (establish) {\n \t\t\t\t\tctx.write(new ConnectionEstablishedMessage());\n-\t\t\t\t\tnotifyEstablished(remoteUUID);\n \t\t\t\t} else {\n \t\t\t\t\tLOGGER.debug(\"we already have a connection, closing\");\n \t\t\t\t\tctx.write(new ConnectionClosedMessage());\n@@ -759,20 +765,39 @@ public void handleMessage(ChannelHandlerContext ctx, ConnectionEstablishedMessag\n \t\t\t\treturn;\n \t\t\t}\n \t\t\tif (localUUID.compareTo(remoteUUID) \u003c 0) {\n-\t\t\t\tLOGGER.warn(\"got {} but the other module has a higher UUID\", msg);\n-\t\t\t\tLOGGER.exit();\n-\t\t\t\treturn;\n-\t\t\t}\n-\t\t\tchannelsLock.writeLock().lock();\n-\t\t\tfinal Channel channel \u003d clientChannels.get(remoteUUID);\n-\t\t\tif (channel !\u003d null \u0026\u0026 !channel.equals(ctx.channel())) {\n-\t\t\t\tLOGGER.info(\"got {} but there is already another connection ({}), closing that\");\n-\t\t\t\tunconnectedChannels.remove(channel);\n-\t\t\t\tchannel.close();\n+\t\t\t\tboolean establish \u003d false;\n+\t\t\t\tchannelsLock.readLock().lock();\n+\t\t\t\tif (ctx.channel().equals(waitingChannels.get(remoteUUID))) {\n+\t\t\t\t\tchannelsLock.readLock().unlock();\n+\t\t\t\t\tchannelsLock.writeLock().lock();\n+\t\t\t\t\tif (ctx.channel().equals(waitingChannels.get(remoteUUID))) {\n+\t\t\t\t\t\twaitingChannels.remove(remoteUUID);\n+\t\t\t\t\t\tclientChannels.put(remoteUUID, ctx.channel());\n+\t\t\t\t\t\testablish \u003d true;\n+\t\t\t\t\t}\n+\t\t\t\t\tchannelsLock.readLock().lock();\n+\t\t\t\t\tchannelsLock.writeLock().unlock();\n+\t\t\t\t}\n+\t\t\t\tchannelsLock.readLock().unlock();\n+\t\t\t\tif (establish) {\n+\t\t\t\t\tnotifyEstablished(remoteUUID);\n+\t\t\t\t} else {\n+\t\t\t\t\tLOGGER.warn(\"got {}, my UUID ({}) is lower than remote UUID, but channel is not waiting\",\n+\t\t\t\t\t\t\tmsg, localUUID, remoteUUID);\n+\t\t\t\t}\n+\t\t\t} else {\n+\t\t\t\tchannelsLock.writeLock().lock();\n+\t\t\t\tfinal Channel channel \u003d clientChannels.get(remoteUUID);\n+\t\t\t\tif (channel !\u003d null \u0026\u0026 !channel.equals(ctx.channel())) {\n+\t\t\t\t\tLOGGER.info(\"got {} but there is already another connection ({}), closing that\");\n+\t\t\t\t\tunconnectedChannels.remove(channel);\n+\t\t\t\t\tchannel.close();\n+\t\t\t\t}\n+\t\t\t\tclientChannels.put(remoteUUID, ctx.channel());\n+\t\t\t\tchannelsLock.writeLock().unlock();\n+\t\t\t\tctx.write(msg);\n+\t\t\t\tnotifyEstablished(remoteUUID);\n \t\t\t}\n-\t\t\tclientChannels.put(remoteUUID, ctx.channel());\n-\t\t\tchannelsLock.writeLock().unlock();\n-\t\t\tnotifyEstablished(remoteUUID);\n \t\t\tLOGGER.exit();\n \t\t}\n \t}"
        }
      ]
    }
  },
  {
    "name": "Race condition within ServiceLoader iterator.",
    "url": "https://github.com/talsma-ict/context-propagation/issues/8",
    "description": "Test that reproduces the `NoSuchElementException` that gets thrown:\r\n\r\n```java\r\n    @Test\r\n    public void testConcurrentSnapshots() throws ExecutionException, InterruptedException {\r\n        int threadcount \u003d 25;\r\n        ExecutorService threadpool \u003d Executors.newFixedThreadPool(threadcount);\r\n        try {\r\n            List\u003cFuture\u003cContextSnapshot\u003e\u003e snapshots \u003d new ArrayList\u003cFuture\u003cContextSnapshot\u003e\u003e(threadcount);\r\n            for (int i \u003d 0; i \u003c threadcount; i++) {\r\n                snapshots.add(threadpool.submit(new Callable\u003cContextSnapshot\u003e() {\r\n                    public ContextSnapshot call() throws Exception {\r\n                        return ContextManagers.createContextSnapshot();\r\n                    }\r\n                }));\r\n            }\r\n\r\n            for (int i \u003d 0; i \u003c threadcount; i++) {\r\n                assertThat(snapshots.get(i).get(), is(notNullValue()));\r\n            }\r\n        } finally {\r\n            threadpool.shutdown();\r\n        }\r\n    }\r\n```\r\n\r\nResults in:\r\n```\r\njava.util.NoSuchElementException\r\n\tat sun.misc.CompoundEnumeration.nextElement(CompoundEnumeration.java:59)\r\n\tat java.util.ServiceLoader$LazyIterator.hasNextService(ServiceLoader.java:357)\r\n\tat java.util.ServiceLoader$LazyIterator.hasNext(ServiceLoader.java:393)\r\n\tat java.util.ServiceLoader$1.hasNext(ServiceLoader.java:474)\r\n\tat nl.talsmasoftware.context.ContextManagers.createContextSnapshot(ContextManagers.java:80)\r\n```\r\n",
    "keywords": [
      "snapshots",
      "java",
      "util",
      "contextmanagers",
      "threadcount",
      ";",
      "serviceloader",
      "threadpool",
      "int"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/talsma-ict/context-propagation/commit/041be14a1662da4d474046b59c1f599a7aaee0ba",
      "files": [
        {
          "file_name": "context-propagation-java5/src/main/java/nl/talsmasoftware/context/ContextManagers.java",
          "patch": "@@ -237,34 +237,52 @@ public String toString() {\n      */\n     private static final class Loader\u003cSVC\u003e implements Iterable\u003cSVC\u003e {\n         private final Class\u003cSVC\u003e serviceType;\n-        private final Iterable\u003cSVC\u003e delegate;\n+        private volatile Iterable\u003cSVC\u003e delegate;\n \n-        @SuppressWarnings(\"unchecked\") // Type is actually safe, although we use reflection.\n         private Loader(Class\u003cSVC\u003e serviceType) {\n             this.serviceType \u003d serviceType;\n-            Iterable\u003cSVC\u003e serviceLoader \u003d null;\n+        }\n+\n+        private synchronized Iterable\u003cSVC\u003e delegate() {\n+            if (delegate \u003d\u003d null) {\n+                ArrayList\u003cSVC\u003e services \u003d new ArrayList\u003cSVC\u003e();\n+                Iterator\u003cSVC\u003e iterator \u003d loadServices(serviceType);\n+                while (iterator.hasNext()) try {\n+                    SVC service \u003d iterator.next();\n+                    if (service !\u003d null) services.add(service);\n+                } catch (NoSuchElementException nse) {\n+                    LOGGER.log(Level.SEVERE, \"Exception iterating service \" + serviceType + \": \" + nse.getMessage(), nse);\n+                }\n+                services.trimToSize();\n+                this.delegate \u003d Collections.unmodifiableList(services);\n+            }\n+            return delegate;\n+        }\n+\n+        @SuppressWarnings(\"unchecked\") // Type is actually safe, although we use reflection.\n+        private static \u003cSVC\u003e Iterator\u003cSVC\u003e loadServices(Class\u003cSVC\u003e serviceType) {\n             try { // Attempt to use Java 1.6 ServiceLoader:\n                 // ServiceLoader.load(ContextManager.class, ContextManagers.class.getClassLoader());\n-                serviceLoader \u003d (Iterable\u003cSVC\u003e) Class.forName(\"java.util.ServiceLoader\")\n+                return ((Iterable\u003cSVC\u003e) Class.forName(\"java.util.ServiceLoader\")\n                         .getDeclaredMethod(\"load\", Class.class, ClassLoader.class)\n-                        .invoke(null, serviceType, serviceType.getClassLoader());\n+                        .invoke(null, serviceType, serviceType.getClassLoader())).iterator();\n             } catch (ClassNotFoundException cnfe) {\n                 LOGGER.log(Level.FINEST, \"Java 6 ServiceLoader not found, falling back to the imageio ServiceRegistry.\");\n             } catch (NoSuchMethodException nsme) {\n-                LOGGER.log(Level.SEVERE, \"Could not find the \u0027load\u0027 method in the JDK\u0027s ServiceLoader.\", nsme);\n+                LOGGER.log(Level.SEVERE, \"Could not find the \u0027load\u0027 method in JDK\u0027s ServiceLoader.\", nsme);\n             } catch (IllegalAccessException iae) {\n-                LOGGER.log(Level.SEVERE, \"Not allowed to call the \u0027load\u0027 method in the JDK\u0027s ServiceLoader.\", iae);\n+                LOGGER.log(Level.SEVERE, \"Not allowed to call the \u0027load\u0027 method in JDK\u0027s ServiceLoader.\", iae);\n             } catch (InvocationTargetException ite) {\n                 throw new IllegalStateException(String.format(\n-                        \"Exception calling the \u0027load\u0027 method in the JDK\u0027s ServiceLoader for the %s service.\",\n+                        \"Exception calling the \u0027load\u0027 method in JDK\u0027s ServiceLoader for the %s service.\",\n                         serviceType.getSimpleName()), ite.getCause());\n             }\n-            this.delegate \u003d serviceLoader;\n+            return ServiceRegistry.lookupProviders(serviceType, serviceType.getClassLoader());\n         }\n \n         public Iterator\u003cSVC\u003e iterator() {\n-            return delegate !\u003d null ? delegate.iterator()\n-                    : ServiceRegistry.lookupProviders(serviceType, serviceType.getClassLoader());\n+            return delegate().iterator();\n         }\n     }\n+\n }"
        },
        {
          "file_name": "context-propagation-java5/src/test/java/nl/talsmasoftware/context/ContextManagersTest.java",
          "patch": "@@ -20,10 +20,13 @@\n import nl.talsmasoftware.context.executors.ContextAwareExecutorService;\n import org.junit.Test;\n \n+import java.util.ArrayList;\n+import java.util.List;\n import java.util.concurrent.*;\n \n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.notNullValue;\n import static org.hamcrest.Matchers.nullValue;\n \n /**\n@@ -103,4 +106,26 @@ public String call() throws Exception {\n         ctx1.close();\n     }\n \n+    @Test\n+    public void testConcurrentSnapshots() throws ExecutionException, InterruptedException {\n+        int threadcount \u003d 25;\n+        ExecutorService threadpool \u003d Executors.newFixedThreadPool(threadcount);\n+        try {\n+            List\u003cFuture\u003cContextSnapshot\u003e\u003e snapshots \u003d new ArrayList\u003cFuture\u003cContextSnapshot\u003e\u003e(threadcount);\n+            for (int i \u003d 0; i \u003c threadcount; i++) {\n+                snapshots.add(threadpool.submit(new Callable\u003cContextSnapshot\u003e() {\n+                    public ContextSnapshot call() throws Exception {\n+                        return ContextManagers.createContextSnapshot();\n+                    }\n+                }));\n+            }\n+\n+            for (int i \u003d 0; i \u003c threadcount; i++) {\n+                assertThat(snapshots.get(i).get(), is(notNullValue()));\n+            }\n+        } finally {\n+            threadpool.shutdown();\n+        }\n+    }\n+\n }"
        }
      ]
    }
  },
  {
    "name": "Possible race condition in HeterogeneousIslandModel",
    "url": "https://github.com/SigmaX/SigmaEC/issues/38",
    "description": "When running the `HeterogeneousIslandModelExample.properties` with more than one thread, an exception is occasionally thrown by FitnessComparator, because it encounters individuals whose fitness value has not been assigned.  This happens while the EA is attempting to execute inter-island migrations.  It could be partly related to issue #37.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/SigmaX/SigmaEC/commit/de8325632f96f783ce314be3925124a314f534ca",
      "files": [
        {
          "file_name": "src/SigmaEC/meta/Population.java",
          "patch": "@@ -47,7 +47,7 @@ public Population(final List\u003cT\u003e population) {\n         return subpopulations[i];\n     }\n     \n-    public void setSubpopulation(final int i, final List\u003cT\u003e population) {\n+    public synchronized void setSubpopulation(final int i, final List\u003cT\u003e population) {\n         assert(i \u003e\u003d 0);\n         assert(i \u003c subpopulations.length);\n         assert(population !\u003d null);"
        },
        {
          "file_name": "src/SigmaEC/meta/island/HeterogeneousIslandModelCircleOfLife.java",
          "patch": "@@ -22,6 +22,7 @@\n import java.util.concurrent.Callable;\n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.Executors;\n+import java.util.concurrent.Future;\n import java.util.logging.Level;\n import java.util.logging.Logger;\n \n@@ -115,11 +116,13 @@ public EvolutionResult evolve(final int run) {\n                 // Execute each island in parallel\n                 // FIXME This is causing race conditions.\n                 final Collection\u003cCallable\u003cVoid\u003e\u003e tasks \u003d new ArrayList\u003c\u003e(topology.numIslands());\n-                for (int i \u003d 0; i \u003c topology.numIslands(); i++)\n-                    tasks.add(new HeterogeneousIslandModelCircleOfLife.IslandStepper(run, step, islands.get(i), population));\n+                for (final HeterogeneousIslandConfiguration isl : islands)\n+                    tasks.add(new HeterogeneousIslandModelCircleOfLife.IslandStepper(run, step, isl, population));\n                 try {\n-                    executor.invokeAll(tasks);\n-                } catch (final InterruptedException ex) {\n+                    final List\u003cFuture\u003cVoid\u003e\u003e results \u003d executor.invokeAll(tasks);\n+                    for (final Future\u003cVoid\u003e f : results)\n+                        f.get(); // Throw exception if a thread dies\n+                } catch (final Exception ex) {\n                     Logger.getLogger(HeterogeneousIslandModelCircleOfLife.class.getName()).log(Level.SEVERE, null, ex);\n                 }\n \n@@ -143,6 +146,7 @@ public EvolutionResult evolve(final int run) {\n             return new EvolutionResult\u003c\u003e(population, bestSoFarInds, getFitnesses(bestSoFarInds));\n     }\n     \n+    // \u003ceditor-fold defaultstate\u003d\"collapsed\" desc\u003d\"CircleOfLife helpers\"\u003e\n     private List\u003cT\u003e getBestsOfStep(final Population\u003cT\u003e population) {\n         return new ArrayList\u003cT\u003e() {{\n            for (int i \u003d 0; i \u003c population.numSuppopulations(); i++)\n@@ -174,7 +178,8 @@ public EvolutionResult evolve(final int run) {\n                 add(ind.getFitness());\n         }};\n     }\n-\n+    // \u003c/editor-fold\u003e\n+    \n     /** Flush I/O buffers. */\n     private void flushMetrics() {\n         if (metrics.isDefined())\n@@ -299,9 +304,7 @@ public void step(final int run, final int step, final Population\u003cT\u003e population)\n             // Apply operators\n             for (final Operator\u003cT\u003e gen : operators) {\n                 final List\u003cT\u003e newSubpop \u003d gen.operate(run, step, population.getSubpopulation(islandID));\n-                synchronized (population) {\n                     population.setSubpopulation(islandID, newSubpop);\n-                }\n             }\n             \n             if (isDynamic)\n@@ -411,7 +414,7 @@ public final boolean repOK() {\n                 \u0026\u0026 !islands.isEmpty()\n                 \u0026\u0026 !Misc.containsNulls(islands);\n     }\n-\n+            \n     @Override\n     public boolean equals(final Object o) {\n         if (this \u003d\u003d o)"
        },
        {
          "file_name": "src/SigmaEC/meta/island/RandomMigrationPolicy.java",
          "patch": "@@ -101,7 +101,9 @@ private void migrate(final int sourcePopIndex, final int targetPopIndex, final P\n         final int targetIndex \u003d replacementSelector.selectIndividualIndex(targetPop);\n         final T targetInd \u003d targetPop.get(targetIndex);\n         if (alwaysReplace || fitnessComparator.get().betterThan(sourceInd, targetInd))\n-            targetPop.set(targetIndex, sourceInd);\n+            synchronized (this) { // XXX Ew.  Move this synchronization logic inside the Population class.\n+                targetPop.set(targetIndex, sourceInd);\n+            }\n     }\n \n     // \u003ceditor-fold defaultstate\u003d\"collapsed\" desc\u003d\"Standard Methods\"\u003e"
        },
        {
          "file_name": "src/SigmaEC/operate/PerGeneMutatingOperator.java",
          "patch": "@@ -8,6 +8,7 @@\n import SigmaEC.util.Parameters;\n import java.util.ArrayList;\n import java.util.List;\n+import java.util.Objects;\n \n /**\n  * Takes a population of LinearGenomeIndividuals and mutates individual genes\n@@ -18,34 +19,41 @@\n public class PerGeneMutatingOperator\u003cT extends LinearGenomeIndividual\u003cG\u003e, G extends Gene\u003e extends MutatingOperator\u003cT\u003e {\n     public final static String P_MUTATOR \u003d \"mutator\";\n     public final static String P_OVERLAP_STYLE \u003d \"overlapStyle\";\n+    public final static String P_CHILDREN_PER_PARENT \u003d \"childrenPerParent\";\n     \n     public static enum OverlapStyle { COMMA, PLUS };\n     private final OverlapStyle overlapStyle;\n+    private final int childrenPerParent;\n     \n     private final Mutator\u003cT, G\u003e mutator;\n-    private final Selector\u003cT\u003e parentSelector \u003d new IterativeSelector\u003cT\u003e();\n+    private final Selector\u003cT\u003e parentSelector \u003d new IterativeSelector\u003c\u003e();\n     \n     public PerGeneMutatingOperator(final Parameters parameters, final String base) {\n         assert(parameters !\u003d null);\n         assert(base !\u003d null);\n         this.mutator \u003d parameters.getInstanceFromParameter(Parameters.push(base, P_MUTATOR), Mutator.class);\n         overlapStyle \u003d OverlapStyle.valueOf(parameters.getOptionalStringParameter(Parameters.push(base, P_OVERLAP_STYLE), OverlapStyle.COMMA.toString()));\n+        childrenPerParent \u003d parameters.getOptionalIntParameter(Parameters.push(base, P_CHILDREN_PER_PARENT), 1);\n+        if (childrenPerParent \u003c\u003d 0)\n+            throw new IllegalStateException(String.format(\"%s: parameter \u0027%s\u0027 is set to %d, but must be positive.\", this.getClass().getSimpleName(), Parameters.push(base, P_CHILDREN_PER_PARENT), childrenPerParent));\n         assert(repOK());\n     }\n \n     @Override\n     public List\u003cT\u003e operate(final int run, final int generation, final List\u003cT\u003e parentPopulation) {\n-        final List\u003cT\u003e newPopulation \u003d new ArrayList\u003cT\u003e(parentPopulation.size());\n+        final List\u003cT\u003e newPopulation \u003d new ArrayList\u003c\u003e(parentPopulation.size());\n         for(int i \u003d 0; i \u003c parentPopulation.size(); i++) {\n-            final T individual \u003d parentSelector.selectIndividual(parentPopulation);\n-            newPopulation.add(operateInd(individual));\n+            final T parent \u003d parentSelector.selectIndividual(parentPopulation);\n+            for (int j \u003d 0; j \u003c childrenPerParent; j++)\n+                newPopulation.add(operateInd(parent));\n         }\n         switch (overlapStyle) {\n             case COMMA:\n                 return newPopulation;\n             case PLUS:\n-                parentPopulation.addAll(newPopulation);\n-                return parentPopulation;\n+                final List\u003cT\u003e combinedPopulation \u003d new ArrayList\u003c\u003e(parentPopulation);\n+                combinedPopulation.addAll(newPopulation);\n+                return combinedPopulation;\n             default:\n                 throw new IllegalStateException(\"Unrecognized overlap style encountered.\");\n         }\n@@ -59,13 +67,23 @@ public T operateInd(final T ind) {\n     // \u003ceditor-fold defaultstate\u003d\"collapsed\" desc\u003d\"Standard Methods\"\u003e\n     @Override\n     final public boolean repOK() {\n-        return mutator !\u003d null\n+        return P_CHILDREN_PER_PARENT !\u003d null\n+                \u0026\u0026 !P_CHILDREN_PER_PARENT.isEmpty()\n+                \u0026\u0026 P_MUTATOR !\u003d null\n+                \u0026\u0026 !P_MUTATOR.isEmpty()\n+                \u0026\u0026 P_OVERLAP_STYLE !\u003d null\n+                \u0026\u0026 !P_OVERLAP_STYLE.isEmpty()\n+                \u0026\u0026 childrenPerParent \u003e 0\n+                \u0026\u0026 mutator !\u003d null\n                 \u0026\u0026 parentSelector !\u003d null;\n     }\n     \n     @Override\n     public String toString() {\n-        return String.format(\"[%s: parentSelector\u003d%s, mutator\u003d%s\", this.getClass().getSimpleName(), parentSelector, mutator);\n+        return String.format(\"[%s: %s\u003d%s, %s\u003d%d, %s\u003d%s\", this.getClass().getSimpleName(),\n+                P_OVERLAP_STYLE, overlapStyle,\n+                P_CHILDREN_PER_PARENT, childrenPerParent,\n+                P_MUTATOR, mutator);\n     }\n     \n     @Override\n@@ -75,16 +93,20 @@ public boolean equals(final Object o) {\n         if (!(o instanceof PerGeneMutatingOperator))\n             return false;\n         \n-        final PerGeneMutatingOperator cRef \u003d (PerGeneMutatingOperator) o;\n-        return mutator.equals(cRef.mutator)\n-                \u0026\u0026 parentSelector.equals(cRef.parentSelector);\n+        final PerGeneMutatingOperator ref \u003d (PerGeneMutatingOperator) o;\n+        return childrenPerParent \u003d\u003d ref.childrenPerParent\n+                \u0026\u0026 overlapStyle.equals(ref.overlapStyle)\n+                \u0026\u0026 mutator.equals(ref.mutator)\n+                \u0026\u0026 parentSelector.equals(ref.parentSelector);\n     }\n \n     @Override\n     public int hashCode() {\n         int hash \u003d 5;\n-        hash \u003d 59 * hash + (this.mutator !\u003d null ? this.mutator.hashCode() : 0);\n-        hash \u003d 59 * hash + (this.parentSelector !\u003d null ? this.parentSelector.hashCode() : 0);\n+        hash \u003d 53 * hash + Objects.hashCode(this.overlapStyle);\n+        hash \u003d 53 * hash + this.childrenPerParent;\n+        hash \u003d 53 * hash + Objects.hashCode(this.mutator);\n+        hash \u003d 53 * hash + Objects.hashCode(this.parentSelector);\n         return hash;\n     }\n     //\u003c/editor-fold\u003e"
        },
        {
          "file_name": "src/SigmaEC/select/SelectionOperator.java",
          "patch": "@@ -13,24 +13,24 @@\n  */\n public class SelectionOperator\u003cT extends Individual\u003e extends Operator\u003cT\u003e {\n     public final static String P_SELECTOR \u003d \"selector\";\n-    public final static String P_CHILD_POP_SIZE \u003d \"childPopSize\";\n+    public final static String P_SURVIVOR_POP_SIZE \u003d \"survivorPopSize\";\n     \n     private final Selector\u003cT\u003e selector;\n-    private final Option\u003cInteger\u003e childPopSize;\n+    private final Option\u003cInteger\u003e survivorPopSize;\n     \n     public SelectionOperator(final Parameters parameters, final String base) {\n         assert(parameters !\u003d null);\n         assert(base !\u003d null);\n         selector \u003d parameters.getInstanceFromParameter(Parameters.push(base, P_SELECTOR), Selector.class);\n-        childPopSize \u003d parameters.getOptionalIntParameter(Parameters.push(base, P_CHILD_POP_SIZE));\n+        survivorPopSize \u003d parameters.getOptionalIntParameter(Parameters.push(base, P_SURVIVOR_POP_SIZE));\n         assert(repOK());\n     }\n     \n     @Override\n     public List\u003cT\u003e operate(final int run, final int generation, final List\u003cT\u003e population) {\n         assert(population !\u003d null);\n         assert(repOK());\n-        return selector.selectMultipleIndividuals(population, childPopSize.isDefined() ? childPopSize.get() : population.size());\n+        return selector.selectMultipleIndividuals(population, survivorPopSize.isDefined() ? survivorPopSize.get() : population.size());\n     }\n \n     // \u003ceditor-fold defaultstate\u003d\"collapsed\" desc\u003d\"Standard Methods\"\u003e"
        },
        {
          "file_name": "src/SigmaEC/util/math/Statistics.java",
          "patch": "@@ -30,6 +30,8 @@ public static double mean(double[] values) {\n     public static double std(double[] values, double mean) {\n         assert(Misc.doubleEquals(mean, mean(values)));\n         assert(values !\u003d null);\n+        if (values.length \u003c\u003d 1)\n+            return 0;\n         double sum \u003d 0;\n         for (int i \u003d 0; i \u003c values.length; i++)\n             sum +\u003d Math.pow(values[i] - mean, 2);\n@@ -38,6 +40,9 @@ public static double std(double[] values, double mean) {\n \n     /** Sample standard deviation (with Bessel\u0027s correction). */\n     public static double std(double[] values) {\n+        assert(values !\u003d null);\n+        if (values.length \u003c\u003d 1)\n+            return 0;\n         return std(values, mean(values));\n     }\n     "
        }
      ]
    }
  },
  {
    "name": "Race condition with embedded data node and mappings",
    "url": "https://github.com/dadoonet/spring-elasticsearch/issues/54",
    "description": "Sometimes it is convenient to have an embedded data node (e.g. for testing) instead of connecting to a running Elasticsearch instance or cluster.\n\nIn my Spring context, I have defined\n\n```\n\u003cutil:map id\u003d\"esProperties\"\u003e\n  \u003centry key\u003d\"cluster.name\" value\u003d\"some-name\"/\u003e\n  \u003centry key\u003d\"node.data\" value\u003d\"true\"/\u003e\n  \u003centry key\u003d\"path.data\" value\u003d\"some-location\"/\u003e\n  \u003centry key\u003d\"http.enabled\" value\u003d\"false\"/\u003e\n\u003c/util:map\u003e\n\n\u003celasticsearch:node id\u003d\"esNode\" properties\u003d\"esProperties\" /\u003e\n\u003celasticsearch:client node\u003d\"esNode\" id\u003d\"esClient\" /\u003e\n```\n\nThere are JSON files on the classpath defining some mappings.\n\n**Problem:** When I run a JUnit test case or start the web application for the first time (no index directory present), the ElasticSearch node and client fire up, create the mappings and everything runs fine. When I start either of them again with the index already created, I get an `IndexAlreadyExistsException` (root cause) right after the automatic discovery found the mapping files (this also happens when explicitly defining the mappings):\n\n```\nCaused by: org.elasticsearch.indices.IndexAlreadyExistsException: [data] already exists\nat org.elasticsearch.cluster.metadata.MetaDataCreateIndexService.validateIndexName(MetaDataCreateIndexService.java:159)\nat org.elasticsearch.cluster.metadata.MetaDataCreateIndexService.validate(MetaDataCreateIndexService.java:525)\nat org.elasticsearch.cluster.metadata.MetaDataCreateIndexService.access$100(MetaDataCreateIndexService.java:87)\nat org.elasticsearch.cluster.metadata.MetaDataCreateIndexService$2.execute(MetaDataCreateIndexService.java:224)\nat org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:328)\nat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:153)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\nat java.lang.Thread.run(Thread.java:745)\n```\n\nThe problem is that the node is not yet fully ready while the client thinks that the index doesn\u0027t exist and tries to create it. The tricky bit figuring this out was that it never occured during debugging, because then the node had enough time to finish initializing. \n\n**Solution:** Waiting for yellow cluster state in the `initialize()` method in `ElasticsearchAbstractClientFactoryBean.java` solved the problem for me:\n\n```\nprivate Client initialize() throws Exception {\n  client \u003d buildClient();\n\n  // FIX: wait for yellow before proceeding\n  client.admin().cluster().prepareHealth().setWaitForYellowStatus().execute().actionGet();\n\n  if (autoscan) {\n      computeMappings();\n  }\n  initTemplates();        \n  initMappings();\n  initAliases();\n\n  return client;\n}\n```\n\nBTW: Nice work!\n",
    "keywords": [
      "threadpoolexecutor",
      "cluster",
      "metadata",
      "id\u003d",
      "data",
      "org",
      "org elasticsearch",
      "concurrent",
      "index",
      "value\u003d",
      "run",
      "key\u003d",
      "/\u003e",
      "metadatacreateindexservice",
      "node",
      "mappings",
      "\u003centry",
      "java",
      "elasticsearch",
      "util",
      "util concurrent",
      "client",
      ";"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/dadoonet/spring-elasticsearch/commit/10edd207cae843eef5b8bab20faf7a51c66fe10f",
      "files": [
        {
          "file_name": "src/changes/changes.xml",
          "patch": "@@ -7,6 +7,9 @@\n             \u003caction issue\u003d\"53\" dev\u003d\"dadoonet\" type\u003d\"update\"\u003e\n                 Update to Elasticsearch 1.4.0.\n             \u003c/action\u003e\n+            \u003caction issue\u003d\"54\" dev\u003d\"dadoonet\" type\u003d\"update\" due-to\u003d\"Michael Dittenbach\"\u003e\n+                Race condition with embedded data node and mappings.\n+            \u003c/action\u003e\n         \u003c/release\u003e\n \n         \u003crelease date\u003d\"2014-02-14\" description\u003d\"August 2014 Release\" version\u003d\"1.3.0\"\u003e"
        },
        {
          "file_name": "src/main/java/fr/pilato/spring/elasticsearch/ElasticsearchAbstractClientFactoryBean.java",
          "patch": "@@ -345,6 +345,7 @@ public Client call() throws Exception {\n \r\n \tprivate Client initialize() throws Exception {\r\n \t\tclient \u003d buildClient();\r\n+\t\tclient.admin().cluster().prepareHealth().setWaitForYellowStatus().get();\r\n \t\tif (autoscan) {\r\n \t\t\tcomputeMappings();\r\n \t\t}\r"
        }
      ]
    }
  },
  {
    "name": "Fix race condition in ServerSession state",
    "url": "https://github.com/atomix/copycat/pull/141",
    "description": "`ServerSession`s are initialized with a state of `CLOSE`d and then `OPEN`ed once the session has been registered with the state machine. However, because commands for closed sessions cannot be applied to the state machine, and because commands are applied in a different thread, this results in skipping some commands when replaying the log and applying commands to the state machine quickly. This PR resolves this issue by initializing `ServerSession` state to `OPEN` and using a boolean flag to prevent publishing within the `register` method.\n",
    "keywords": [
      "machine",
      "state",
      "commands"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/atomix/copycat/commit/a816b3a125df0d840583da7c28662b2be7fef487",
      "files": [
        {
          "file_name": "server/src/main/java/io/atomix/copycat/server/state/ServerSession.java",
          "patch": "@@ -46,7 +46,8 @@\n   private final UUID client;\n   private final LogCleaner cleaner;\n   private final ServerStateMachineContext context;\n-  private volatile State state \u003d State.CLOSED;\n+  private boolean open;\n+  private volatile State state \u003d State.OPEN;\n   private final long timeout;\n   private Connection connection;\n   private Address address;\n@@ -102,7 +103,7 @@ public UUID client() {\n    * Opens the session.\n    */\n   void open() {\n-    setState(State.OPEN);\n+    open \u003d true;\n   }\n \n   @Override\n@@ -514,6 +515,7 @@ public Session publish(String event) {\n \n   @Override\n   public Session publish(String event, Object message) {\n+    Assert.state(open, \"cannot publish events during session registration\");\n     Assert.stateNot(state \u003d\u003d State.CLOSED, \"session is closed\");\n     Assert.stateNot(state \u003d\u003d State.EXPIRED, \"session is expired\");\n     Assert.state(context.consistency() !\u003d null, \"session events can only be published during command execution\");"
        },
        {
          "file_name": "server/src/main/java/io/atomix/copycat/server/state/ServerStateMachine.java",
          "patch": "@@ -540,7 +540,7 @@ else if (!session.state().active()) {\n       executor.executor().execute(() -\u003e keepAliveSession(index, timestamp, commandSequence, eventIndex, session, future, context));\n \n       // Update the session keep alive index for log cleaning.\n-      session.setKeepAliveIndex(entry.getIndex());\n+      session.setKeepAliveIndex(entry.getIndex()).setRequestSequence(commandSequence);\n     }\n \n     return future;"
        }
      ]
    }
  },
  {
    "name": "Fixed GUI race condition",
    "url": "https://github.com/s-match/s-match-utils/pull/15",
    "description": "Sometimes an obscure race condition can happen in the GUI, this pull request fixes it. \r\n\r\nIt was extracted from  @gbella [fork](https://github.com/gbella/s-match-utils/commit/be4634347270f16ae5756082888aa5d4d2a648ef) \r\n\r\n\r\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/s-match/s-match-utils/commit/e198ae1eafbf3bd1c6ba0a4434da9aee8a052216",
      "files": [
        {
          "file_name": "src/main/java/it/unitn/disi/smatch/gui/SMatchGUI.java",
          "patch": "@@ -3452,16 +3452,6 @@ public void propertyChange(PropertyChangeEvent evt) {\n     private SwingWorker\u003cIContextMapping\u003cINode\u003e, IMappingElement\u003cINode\u003e\u003e createMatchTask() {\n         final SwingWorker\u003cVoid, Void\u003e sourcePreprocess;\n         final SwingWorker\u003cVoid, Void\u003e targetPreprocess;\n-        if (!source.getRoot().nodeData().isSubtreePreprocessed()) {\n-            sourcePreprocess \u003d createContextOfflineTask(source, semSource, pbSourceProgress, true);\n-        } else {\n-            sourcePreprocess \u003d null;\n-        }\n-        if (!target.getRoot().nodeData().isSubtreePreprocessed()) {\n-            targetPreprocess \u003d createContextOfflineTask(target, semTarget, pbTargetProgress, false);\n-        } else {\n-            targetPreprocess \u003d null;\n-        }\n \n         // prepare the match task\n         pbProgress.setIndeterminate(true);\n@@ -3473,21 +3463,46 @@ public void propertyChange(PropertyChangeEvent evt) {\n         } else {\n             matchTask \u003d null;\n         }\n+        \n+        if (!source.getRoot().nodeData().isSubtreePreprocessed()) {\n+            sourcePreprocess \u003d createContextOfflineTask(source, semSource, pbSourceProgress, true);\n+        } else {\n+            sourcePreprocess \u003d null;\n+        }\n+        if (!target.getRoot().nodeData().isSubtreePreprocessed()) {\n+            targetPreprocess \u003d createContextOfflineTask(target, semTarget, pbTargetProgress, false);\n+        } else {\n+            targetPreprocess \u003d null;\n+        }\n+\n         SwingWorker\u003cIContextMapping\u003cINode\u003e, IMappingElement\u003cINode\u003e\u003e task \u003d\n                 new SwingWorker\u003cIContextMapping\u003cINode\u003e, IMappingElement\u003cINode\u003e\u003e() {\n                     @Override\n                     public IContextMapping\u003cINode\u003e doInBackground() throws Exception {\n-                        if (null !\u003d sourcePreprocess) {\n-                            sourcePreprocess.execute();\n-                        }\n-                        if (null !\u003d targetPreprocess) {\n-                            targetPreprocess.execute();\n-                        }\n-                        if (null !\u003d sourcePreprocess) {\n-                            sourcePreprocess.get();\n-                        }\n-                        if (null !\u003d targetPreprocess) {\n-                            targetPreprocess.get();\n+                        if (null !\u003d matchTask) {\n+                            // parallel execution of source and target preprocess\n+                            if (null !\u003d sourcePreprocess) {\n+                                sourcePreprocess.execute();\n+                            }\n+                            if (null !\u003d targetPreprocess) {\n+                                targetPreprocess.execute();\n+                            }\n+                            if (null !\u003d sourcePreprocess) {\n+                                sourcePreprocess.get();\n+                            }\n+                            if (null !\u003d targetPreprocess) {\n+                                targetPreprocess.get();\n+                            }\n+                        } else {\n+                            // serial execution of source and target preprocess\n+                            if (null !\u003d sourcePreprocess) {\n+                                sourcePreprocess.execute();\n+                                sourcePreprocess.get();\n+                            }\n+                            if (null !\u003d targetPreprocess) {\n+                                targetPreprocess.execute();\n+                                targetPreprocess.get();\n+                            }\n                         }\n \n                         semManager.acquire();"
        }
      ]
    }
  },
  {
    "name": "Race condition in pages.put(u, w)",
    "url": "https://github.com/codeforsanjose/BLiC-Java/issues/9",
    "description": "A URL could be added to the `pages` map between the time [`!this.pages.containsKey(u)`](https://github.com/codeforsanjose/BLiC-Java/blob/master/src/main/java/com/codeforsanjose/blic/Crawler.java#L69) runs, and the time [`this.pages.put(u,w)`](https://github.com/codeforsanjose/BLiC-Java/blob/master/src/main/java/com/codeforsanjose/blic/Crawler.java#L73) runs. This means another Crawler could be running for a `WebPage` that will be replaced from the `pages` map, updating a data structure that won\u0027t be printed in the report, and that work will be duplicated later.\n\nThis could be fixed by using `ConcurrentHashMap#putIfAbsent(absUrl, webPage)` instead of `put`. This would make `filterUnseen` only necessary for resolving absolute URLs.\n",
    "keywords": [
      "pages",
      "u"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/codeforsanjose/BLiC-Java/commit/dd443510c1da83a65352dd0c33a97cb83330e9ad",
      "files": [
        {
          "file_name": "src/main/java/com/codeforsanjose/blic/Crawler.java",
          "patch": "@@ -63,15 +63,13 @@ public void run() {\n             }\n             log.info(id + \": Crawling \" + this.name);\n             Elements anchors \u003d doc.select(\"a\");\n-            ArrayList\u003cURL\u003e unseenLinks \u003d filterUnseen(anchors);\n+            ArrayList\u003cURL\u003e unseenLinks \u003d mapToAbsolute(anchors);\n             log.info(id + \": Found \" + unseenLinks.size() + \" new links on page\");\n             for (URL u : unseenLinks) {\n-                if (u !\u003d null \u0026\u0026 !this.pages.containsKey(u)) {\n-                    if (this.depth_limit \u003e this.webpage.getDepth()) {\n-                        WebPage w \u003d new WebPage(this.webpage, u);\n-                        w.setDepth(this.webpage.getDepth() + 1);\n-                        this.pages.put(u, w);\n-                    }\n+                if (this.depth_limit \u003e this.webpage.getDepth()) {\n+                    WebPage w \u003d new WebPage(this.webpage, u);\n+                    w.setDepth(this.webpage.getDepth() + 1);\n+                    this.pages.putIfAbsent(u, w);\n                 }\n             }\n             this.webpage.setStatus(200);\n@@ -101,7 +99,7 @@ private boolean shouldCrawlPage() {\n         return this.webpage.getUrl().getHost().equals(base.getHost());\n     }\n \n-    private ArrayList\u003cURL\u003e filterUnseen(Elements anchors) {\n+    private ArrayList\u003cURL\u003e mapToAbsolute(Elements anchors) {\n         ArrayList\u003cURL\u003e res \u003d new ArrayList\u003c\u003e();\n         for (Element a : anchors) {\n             URL u \u003d parseUrl(a.attr(\"abs:href\"));"
        }
      ]
    }
  },
  {
    "name": "[CDAP-2729] fix race condition when app.fabric is up but dataset.explore is down",
    "url": "https://github.com/caskdata/cdap/pull/2924",
    "description": "",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/caskdata/cdap/commit/e040ca8d8a16cfa3ba6ae9f5e3ada422ed93a00a",
      "files": [
        {
          "file_name": "cdap-ui/app/services/namespace.js",
          "patch": "@@ -62,6 +62,7 @@ angular.module(PKG.name + \u0027.services\u0027)\n               }, 2000)();\n \n     }\n+\n     function success() {\n       EventPipe.emit(\u0027backendUp\u0027);\n       startPolling();"
        },
        {
          "file_name": "cdap-ui/server/express.js",
          "patch": "@@ -150,8 +150,8 @@ function makeApp (authAddress, cdapConfig) {\n           rejectUnauthorized: false,\n           requestCert: true,\n           agent: false\n-        }, function(err) {\n-          if (!err) {\n+        }, function(err, response) {\n+          if (!err \u0026\u0026 response.statusCode \u003d\u003d\u003d 200) {\n             res.status(200).send();\n           } else {\n             res.status(404).send();"
        }
      ]
    }
  },
  {
    "name": "Race condition when running against empty ElasticSearch",
    "url": "https://github.com/Graylog2/graylog2-server/issues/677",
    "description": "I started `graylog2-server` with a completely empty ElasticSearch and no indices.\n\n```\nlennart ~/workspace/graylog2/graylog2-server(master)$ java -jar graylog2-server/target/graylog2-server.jar \n2014-08-14 18:35:39,296 INFO : org.reflections.Reflections - Reflections took 267 ms to scan 1 urls, producing 8 keys and 18 values \n2014-08-14 18:35:39,636 INFO : org.reflections.Reflections - Reflections took 75 ms to scan 1 urls, producing 3 keys and 15 values \n2014-08-14 18:35:40,714 INFO : org.graylog2.Main - Graylog2 0.21.0-beta3-SNAPSHOT (3e66cbb) starting up. (JRE: Oracle Corporation 1.7.0_45 on Mac OS X 10.9.3)\n2014-08-14 18:35:41,069 INFO : org.graylog2.plugin.system.NodeId - Node ID: fb66b27e-993c-4595-940f-dd521dcdaa93\n2014-08-14 18:35:41,644 INFO : org.graylog2.caches.DiskJournalCache - Compacting off-heap message cache database files (input-cache)\n2014-08-14 18:35:41,864 INFO : org.graylog2.caches.DiskJournalCache - Compacting off-heap message cache database files (output-cache)\n2014-08-14 18:35:42,017 INFO : org.graylog2.buffers.OutputBuffer - Initialized OutputBuffer with ring size \u003c256\u003e and wait strategy \u003cBlockingWaitStrategy\u003e.\n2014-08-14 18:35:42,085 INFO : org.graylog2.shared.initializers.PeriodicalsService - Starting 12 periodicals ...\n2014-08-14 18:35:42,085 INFO : org.graylog2.periodical.Periodicals - Starting [org.graylog2.periodical.IndexerClusterCheckerThread] periodical in [0s], polling every [30s].\n2014-08-14 18:35:42,089 INFO : org.graylog2.periodical.Periodicals - Starting [org.graylog2.periodical.DeadLetterThread] periodical, running forever.\n2014-08-14 18:35:42,089 INFO : org.graylog2.periodical.Periodicals - Starting [org.graylog2.periodical.IndexRetentionThread] periodical in [0s], polling every [300s].\n2014-08-14 18:35:42,090 INFO : org.graylog2.periodical.Periodicals - Starting [org.graylog2.periodical.BatchedElasticSearchOutputFlushThread] periodical in [0s], polling every [1s].\n2014-08-14 18:35:42,090 INFO : org.graylog2.periodical.Periodicals - Starting [org.graylog2.periodical.StreamThroughputCounterManagerThread] periodical in [0s], polling every [1s].\n2014-08-14 18:35:42,091 INFO : org.graylog2.periodical.Periodicals - Starting [org.graylog2.periodical.VersionCheckThread] periodical in [0s], polling every [1800s].\n2014-08-14 18:35:42,092 INFO : org.graylog2.periodical.Periodicals - Starting [org.graylog2.periodical.MasterCacheWorkerThread] periodical, running forever.\n2014-08-14 18:35:42,093 INFO : org.graylog2.periodical.Periodicals - Starting [org.graylog2.periodical.AlertScannerThread] periodical in [10s], polling every [60s].\n2014-08-14 18:35:42,118 INFO : org.graylog2.periodical.Periodicals - Starting [org.graylog2.periodical.DeflectorManagerThread] periodical in [0s], polling every [10s].\n2014-08-14 18:35:42,126 INFO : org.graylog2.periodical.Periodicals - Starting [org.graylog2.periodical.ClusterHealthCheckThread] periodical in [0s], polling every [20s].\n2014-08-14 18:35:42,127 INFO : org.graylog2.periodical.Periodicals - Starting [org.graylog2.periodical.ThroughputCounterManagerThread] periodical in [0s], polling every [1s].\n2014-08-14 18:35:42,128 INFO : org.graylog2.periodical.Periodicals - Starting [org.graylog2.periodical.NodePingThread] periodical in [0s], polling every [1s].\n2014-08-14 18:35:42,244 INFO : org.graylog2.shared.initializers.RestApiService - Enabling CORS for REST API\n2014-08-14 18:35:42,459 INFO : org.elasticsearch.node - [graylog2-server] version[0.90.10], pid[89075], build[0a5781f/2014-01-10T10:18:37Z]\n2014-08-14 18:35:42,459 INFO : org.elasticsearch.node - [graylog2-server] initializing ...\n2014-08-14 18:35:42,472 INFO : org.elasticsearch.plugins - [graylog2-server] loaded [], sites []\n2014-08-14 18:35:44,504 INFO : org.drools.compiler.kie.builder.impl.KieRepositoryImpl - KieModule was added:MemoryKieModule[ ReleaseId\u003dorg.graylog2:dynamic-rules:0]\n2014-08-14 18:35:44,591 INFO : org.drools.compiler.kie.builder.impl.KieRepositoryImpl - Adding KieModule from resource :[ByteArrayResource resource\u003d[B@51da014f]\n2014-08-14 18:35:44,797 INFO : org.drools.compiler.kie.builder.impl.KieRepositoryImpl - KieModule was added:MemoryKieModule[ ReleaseId\u003dorg.graylog2:dynamic-rules:0]\n2014-08-14 18:35:45,064 INFO : org.elasticsearch.node - [graylog2-server] initialized\n2014-08-14 18:35:45,065 INFO : org.elasticsearch.node - [graylog2-server] starting ...\n2014-08-14 18:35:45,156 INFO : org.elasticsearch.transport - [graylog2-server] bound_address {inet[/0:0:0:0:0:0:0:0:9350]}, publish_address {inet[/172.16.0.18:9350]}\n2014-08-14 18:35:45,159 INFO : org.graylog2.bindings.providers.RulesEngineProvider - No static rules file loaded.\n2014-08-14 18:35:45,263 INFO : org.graylog2.shared.buffers.ProcessBuffer - Initialized ProcessBuffer with ring size \u003c256\u003e and wait strategy \u003cBlockingWaitStrategy\u003e.\n2014-08-14 18:35:47,217 INFO : org.glassfish.jersey.server.ApplicationHandler - Initiating Jersey application, version Jersey: 2.5 2013-12-18 14:27:29...\n2014-08-14 18:35:48,167 WARN : org.elasticsearch.discovery - [graylog2-server] waited for 3s and no initial state was set by the discovery\n2014-08-14 18:35:48,167 INFO : org.elasticsearch.discovery - [graylog2-server] graylog2-dev/erZs6U9GSS-dB74HHtpnXg\n2014-08-14 18:35:48,168 INFO : org.elasticsearch.node - [graylog2-server] started\n2014-08-14 18:35:48,232 INFO : org.elasticsearch.cluster.service - [graylog2-server] detected_master [Gold, Melissa][ExFhBoNASgypPy1_ZDsPlA][inet[/172.16.0.18:9300]], added {[Gold, Melissa][ExFhBoNASgypPy1_ZDsPlA][inet[/172.16.0.18:9300]],}, reason: zen-disco-receive(from master [[Gold, Melissa][ExFhBoNASgypPy1_ZDsPlA][inet[/172.16.0.18:9300]]])\n2014-08-14 18:35:49,104 INFO : org.graylog2.shared.initializers.RestApiService - Adding security context factory: \u003corg.graylog2.security.ShiroSecurityContextFactory@1309427c\u003e\n2014-08-14 18:35:49,113 INFO : org.graylog2.shared.initializers.RestApiService - Started REST API at \u003chttp://127.0.0.1:12900/\u003e\n2014-08-14 18:35:49,113 INFO : org.graylog2.shared.initializers.ServiceManagerListener - Services are healthy\n2014-08-14 18:35:49,115 INFO : org.graylog2.shared.initializers.InputSetupService - Triggering launching persisted inputs, node transitioned from Uninitialized [LB:DEAD] to Running [LB:ALIVE]\n2014-08-14 18:35:49,124 INFO : org.graylog2.Main - Services started, startup times in ms: {DeflectorSetupService [RUNNING]\u003d0, GelfChunkManagerService [RUNNING]\u003d0, GroovyShellSetupService [RUNNING]\u003d0, BufferSynchronizerService [RUNNING]\u003d0, OutputSetupService [RUNNING]\u003d0, MetricsReporterService [RUNNING]\u003d0, InputSetupService [RUNNING]\u003d6, PeriodicalsService [RUNNING]\u003d48, DashboardRegistryService [RUNNING]\u003d95, ProcessBufferService [RUNNING]\u003d3124, IndexerSetupService [RUNNING]\u003d6113, RestApiService [RUNNING]\u003d7026}\n2014-08-14 18:35:49,134 INFO : org.graylog2.Main - Graylog2 up and running.\n2014-08-14 18:35:49,186 WARN : org.graylog2.inputs.ServerInputRegistry - Cannot launch persisted input. No such type [org.graylog2.inputs.raw.mqtt.RawMQTTInput].\n2014-08-14 18:35:49,203 INFO : org.graylog2.inputs.ServerInputRegistry - Starting [org.graylog2.inputs.gelf.udp.GELFUDPInput] input with ID \u003c5350402f3004873c406377a1\u003e\n2014-08-14 18:35:49,203 INFO : org.graylog2.inputs.ServerInputRegistry - Starting [org.graylog2.inputs.syslog.udp.SyslogUDPInput] input with ID \u003c531e1d5430046acc82af284f\u003e\n2014-08-14 18:35:49,203 INFO : org.graylog2.inputs.ServerInputRegistry - Starting [org.graylog2.inputs.random.FakeHttpMessageInput] input with ID \u003c53a05f033004d398203abf5b\u003e\n2014-08-14 18:35:49,204 INFO : org.graylog2.inputs.ServerInputRegistry - Starting [org.graylog2.inputs.syslog.udp.SyslogUDPInput] input with ID \u003c5385cccc30042666bd9a6ca8\u003e\n2014-08-14 18:35:49,206 INFO : org.graylog2.inputs.ServerInputRegistry - Starting [org.graylog2.inputs.raw.udp.RawUDPInput] input with ID \u003c538b263e3004170a68991564\u003e\n2014-08-14 18:35:49,207 INFO : org.graylog2.inputs.ServerInputRegistry - Completed starting [org.graylog2.inputs.random.FakeHttpMessageInput] input with ID \u003c53a05f033004d398203abf5b\u003e\n2014-08-14 18:35:49,235 INFO : org.graylog2.inputs.syslog.udp.SyslogUDPInput - Started syslog UDP input server on /0.0.0.0:5567\n2014-08-14 18:35:49,235 INFO : org.graylog2.inputs.raw.udp.RawUDPInput - Started UDP raw/plaintext input on /0.0.0.0:8888\n2014-08-14 18:35:49,235 INFO : org.graylog2.inputs.ServerInputRegistry - Completed starting [org.graylog2.inputs.raw.udp.RawUDPInput] input with ID \u003c538b263e3004170a68991564\u003e\n2014-08-14 18:35:49,235 INFO : org.graylog2.inputs.gelf.udp.GELFUDPInput - Started GELF UDP input on /0.0.0.0:12201\n2014-08-14 18:35:49,236 INFO : org.graylog2.inputs.ServerInputRegistry - Completed starting [org.graylog2.inputs.gelf.udp.GELFUDPInput] input with ID \u003c5350402f3004873c406377a1\u003e\n2014-08-14 18:35:49,235 INFO : org.graylog2.inputs.ServerInputRegistry - Completed starting [org.graylog2.inputs.syslog.udp.SyslogUDPInput] input with ID \u003c5385cccc30042666bd9a6ca8\u003e\n2014-08-14 18:35:49,235 INFO : org.graylog2.inputs.syslog.udp.SyslogUDPInput - Started syslog UDP input server on /0.0.0.0:5514\n2014-08-14 18:35:49,236 INFO : org.graylog2.inputs.ServerInputRegistry - Completed starting [org.graylog2.inputs.syslog.udp.SyslogUDPInput] input with ID \u003c531e1d5430046acc82af284f\u003e\n2014-08-14 18:35:50,141 ERROR: org.graylog2.outputs.BatchedElasticSearchOutput - Unable to flush message buffer\norg.elasticsearch.indices.IndexMissingException: [graylog2_deflector] missing\n    at org.elasticsearch.cluster.metadata.MetaData.concreteIndex(MetaData.java:590)\n    at org.elasticsearch.action.bulk.TransportBulkAction.executeBulk(TransportBulkAction.java:159)\n    at org.elasticsearch.action.bulk.TransportBulkAction.doExecute(TransportBulkAction.java:145)\n    at org.elasticsearch.action.bulk.TransportBulkAction.doExecute(TransportBulkAction.java:63)\n    at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:63)\n    at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:49)\n    at org.elasticsearch.client.node.NodeClient.execute(NodeClient.java:85)\n    at org.elasticsearch.client.support.AbstractClient.bulk(AbstractClient.java:144)\n    at org.graylog2.indexer.Indexer.bulkIndex(Indexer.java:327)\n    at org.graylog2.outputs.ElasticSearchOutput.write(ElasticSearchOutput.java:85)\n    at org.graylog2.outputs.BatchedElasticSearchOutput.synchronousFlush(BatchedElasticSearchOutput.java:88)\n    at org.graylog2.outputs.BatchedElasticSearchOutput$1.run(BatchedElasticSearchOutput.java:102)\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n    at java.util.concurrent.FutureTask.run(FutureTask.java:262)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n2014-08-14 18:35:51,099 ERROR: org.graylog2.outputs.BatchedElasticSearchOutput - Unable to flush message buffer\norg.elasticsearch.indices.IndexMissingException: [graylog2_deflector] missing\n    at org.elasticsearch.cluster.metadata.MetaData.concreteIndex(MetaData.java:590)\n    at org.elasticsearch.action.bulk.TransportBulkAction.executeBulk(TransportBulkAction.java:159)\n    at org.elasticsearch.action.bulk.TransportBulkAction.doExecute(TransportBulkAction.java:145)\n    at org.elasticsearch.action.bulk.TransportBulkAction.doExecute(TransportBulkAction.java:63)\n    at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:63)\n    at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:49)\n    at org.elasticsearch.client.node.NodeClient.execute(NodeClient.java:85)\n    at org.elasticsearch.client.support.AbstractClient.bulk(AbstractClient.java:144)\n    at org.graylog2.indexer.Indexer.bulkIndex(Indexer.java:327)\n    at org.graylog2.outputs.ElasticSearchOutput.write(ElasticSearchOutput.java:85)\n    at org.graylog2.outputs.BatchedElasticSearchOutput.synchronousFlush(BatchedElasticSearchOutput.java:88)\n    at org.graylog2.outputs.BatchedElasticSearchOutput$1.run(BatchedElasticSearchOutput.java:102)\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n    at java.util.concurrent.FutureTask.run(FutureTask.java:262)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n2014-08-14 18:35:52,105 ERROR: org.graylog2.outputs.BatchedElasticSearchOutput - Unable to flush message buffer\norg.elasticsearch.indices.IndexMissingException: [graylog2_deflector] missing\n    at org.elasticsearch.cluster.metadata.MetaData.concreteIndex(MetaData.java:590)\n    at org.elasticsearch.action.bulk.TransportBulkAction.executeBulk(TransportBulkAction.java:159)\n    at org.elasticsearch.action.bulk.TransportBulkAction.doExecute(TransportBulkAction.java:145)\n    at org.elasticsearch.action.bulk.TransportBulkAction.doExecute(TransportBulkAction.java:63)\n    at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:63)\n    at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:49)\n    at org.elasticsearch.client.node.NodeClient.execute(NodeClient.java:85)\n    at org.elasticsearch.client.support.AbstractClient.bulk(AbstractClient.java:144)\n    at org.graylog2.indexer.Indexer.bulkIndex(Indexer.java:327)\n    at org.graylog2.outputs.ElasticSearchOutput.write(ElasticSearchOutput.java:85)\n    at org.graylog2.outputs.BatchedElasticSearchOutput.synchronousFlush(BatchedElasticSearchOutput.java:88)\n    at org.graylog2.outputs.BatchedElasticSearchOutput$1.run(BatchedElasticSearchOutput.java:102)\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n    at java.util.concurrent.FutureTask.run(FutureTask.java:262)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n2014-08-14 18:35:52,124 INFO : org.graylog2.indexer.Deflector - Did not find an deflector alias. Setting one up now.\n2014-08-14 18:35:52,127 INFO : org.graylog2.indexer.Deflector - There is no index target to point to. Creating one now.\n2014-08-14 18:35:52,130 INFO : org.graylog2.indexer.Deflector - Cycling deflector to next index now.\n2014-08-14 18:35:52,130 INFO : org.graylog2.indexer.Deflector - Cycling from \u003cnone\u003e to \u003cgraylog2_0\u003e\n2014-08-14 18:35:52,130 INFO : org.graylog2.indexer.Deflector - Creating index target \u003cgraylog2_0\u003e...\n2014-08-14 18:35:52,279 ERROR: org.graylog2.periodical.AlertScannerThread - Skipping alert check that threw an exception.\njava.util.NoSuchElementException\n    at org.elasticsearch.common.hppc.AbstractIterator.next(AbstractIterator.java:46)\n    at org.elasticsearch.common.collect.ImmutableOpenMap$1.next(ImmutableOpenMap.java:124)\n    at org.graylog2.indexer.indices.Indices.aliasTarget(Indices.java:189)\n    at org.graylog2.indexer.Deflector.getCurrentActualTargetIndex(Deflector.java:271)\n    at org.graylog2.indexer.IndexHelper.determineAffectedIndices(IndexHelper.java:120)\n    at org.graylog2.indexer.searches.Searches.count(Searches.java:100)\n    at org.graylog2.alerts.types.MessageCountAlertCondition.runCheck(MessageCountAlertCondition.java:80)\n    at org.graylog2.alerts.AlertServiceImpl.triggered(AlertServiceImpl.java:222)\n    at org.graylog2.periodical.AlertScannerThread.doRun(AlertScannerThread.java:105)\n    at org.graylog2.plugin.periodical.Periodical.run(Periodical.java:83)\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n    at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n2014-08-14 18:35:52,341 ERROR: org.graylog2.periodical.AlertScannerThread - Skipping alert check that threw an exception.\njava.util.NoSuchElementException\n    at org.elasticsearch.common.hppc.AbstractIterator.next(AbstractIterator.java:46)\n    at org.elasticsearch.common.collect.ImmutableOpenMap$1.next(ImmutableOpenMap.java:124)\n    at org.graylog2.indexer.indices.Indices.aliasTarget(Indices.java:189)\n    at org.graylog2.indexer.Deflector.getCurrentActualTargetIndex(Deflector.java:271)\n    at org.graylog2.indexer.IndexHelper.determineAffectedIndices(IndexHelper.java:120)\n    at org.graylog2.indexer.searches.Searches.fieldStats(Searches.java:254)\n    at org.graylog2.alerts.types.FieldValueAlertCondition.runCheck(FieldValueAlertCondition.java:93)\n    at org.graylog2.alerts.AlertServiceImpl.triggered(AlertServiceImpl.java:222)\n    at org.graylog2.periodical.AlertScannerThread.doRun(AlertScannerThread.java:105)\n    at org.graylog2.plugin.periodical.Periodical.run(Periodical.java:83)\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n    at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n2014-08-14 18:35:52,402 ERROR: org.graylog2.periodical.AlertScannerThread - Skipping alert check that threw an exception.\njava.util.NoSuchElementException\n    at org.elasticsearch.common.hppc.AbstractIterator.next(AbstractIterator.java:46)\n    at org.elasticsearch.common.collect.ImmutableOpenMap$1.next(ImmutableOpenMap.java:124)\n    at org.graylog2.indexer.indices.Indices.aliasTarget(Indices.java:189)\n    at org.graylog2.indexer.Deflector.getCurrentActualTargetIndex(Deflector.java:271)\n    at org.graylog2.indexer.IndexHelper.determineAffectedIndices(IndexHelper.java:120)\n    at org.graylog2.indexer.searches.Searches.count(Searches.java:100)\n    at org.graylog2.alerts.types.MessageCountAlertCondition.runCheck(MessageCountAlertCondition.java:80)\n    at org.graylog2.alerts.AlertServiceImpl.triggered(AlertServiceImpl.java:222)\n    at org.graylog2.periodical.AlertScannerThread.doRun(AlertScannerThread.java:105)\n    at org.graylog2.plugin.periodical.Periodical.run(Periodical.java:83)\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n    at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n2014-08-14 18:35:52,458 ERROR: org.graylog2.periodical.AlertScannerThread - Skipping alert check that threw an exception.\njava.util.NoSuchElementException\n    at org.elasticsearch.common.hppc.AbstractIterator.next(AbstractIterator.java:46)\n    at org.elasticsearch.common.collect.ImmutableOpenMap$1.next(ImmutableOpenMap.java:124)\n    at org.graylog2.indexer.indices.Indices.aliasTarget(Indices.java:189)\n    at org.graylog2.indexer.Deflector.getCurrentActualTargetIndex(Deflector.java:271)\n    at org.graylog2.indexer.IndexHelper.determineAffectedIndices(IndexHelper.java:120)\n    at org.graylog2.indexer.searches.Searches.count(Searches.java:100)\n    at org.graylog2.alerts.types.MessageCountAlertCondition.runCheck(MessageCountAlertCondition.java:80)\n    at org.graylog2.alerts.AlertServiceImpl.triggered(AlertServiceImpl.java:222)\n    at org.graylog2.periodical.AlertScannerThread.doRun(AlertScannerThread.java:105)\n    at org.graylog2.plugin.periodical.Periodical.run(Periodical.java:83)\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n    at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n2014-08-14 18:35:52,553 ERROR: org.graylog2.periodical.AlertScannerThread - Skipping alert check that threw an exception.\njava.util.NoSuchElementException\n    at org.elasticsearch.common.hppc.AbstractIterator.next(AbstractIterator.java:46)\n    at org.elasticsearch.common.collect.ImmutableOpenMap$1.next(ImmutableOpenMap.java:124)\n    at org.graylog2.indexer.indices.Indices.aliasTarget(Indices.java:189)\n    at org.graylog2.indexer.Deflector.getCurrentActualTargetIndex(Deflector.java:271)\n    at org.graylog2.indexer.IndexHelper.determineAffectedIndices(IndexHelper.java:120)\n    at org.graylog2.indexer.searches.Searches.fieldStats(Searches.java:254)\n    at org.graylog2.alerts.types.FieldValueAlertCondition.runCheck(FieldValueAlertCondition.java:93)\n    at org.graylog2.alerts.AlertServiceImpl.triggered(AlertServiceImpl.java:222)\n    at org.graylog2.periodical.AlertScannerThread.doRun(AlertScannerThread.java:105)\n    at org.graylog2.plugin.periodical.Periodical.run(Periodical.java:83)\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n    at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n2014-08-14 18:35:52,620 ERROR: org.graylog2.periodical.AlertScannerThread - Skipping alert check that threw an exception.\njava.util.NoSuchElementException\n    at org.elasticsearch.common.hppc.AbstractIterator.next(AbstractIterator.java:46)\n    at org.elasticsearch.common.collect.ImmutableOpenMap$1.next(ImmutableOpenMap.java:124)\n    at org.graylog2.indexer.indices.Indices.aliasTarget(Indices.java:189)\n    at org.graylog2.indexer.Deflector.getCurrentActualTargetIndex(Deflector.java:271)\n    at org.graylog2.indexer.IndexHelper.determineAffectedIndices(IndexHelper.java:120)\n    at org.graylog2.indexer.searches.Searches.count(Searches.java:100)\n    at org.graylog2.alerts.types.MessageCountAlertCondition.runCheck(MessageCountAlertCondition.java:80)\n    at org.graylog2.alerts.AlertServiceImpl.triggered(AlertServiceImpl.java:222)\n    at org.graylog2.periodical.AlertScannerThread.doRun(AlertScannerThread.java:105)\n    at org.graylog2.plugin.periodical.Periodical.run(Periodical.java:83)\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n    at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n2014-08-14 18:35:53,107 ERROR: org.graylog2.outputs.BatchedElasticSearchOutput - Unable to flush message buffer\norg.elasticsearch.indices.IndexMissingException: [graylog2_deflector] missing\n    at org.elasticsearch.cluster.metadata.MetaData.concreteIndex(MetaData.java:590)\n    at org.elasticsearch.action.bulk.TransportBulkAction.executeBulk(TransportBulkAction.java:159)\n    at org.elasticsearch.action.bulk.TransportBulkAction.doExecute(TransportBulkAction.java:145)\n    at org.elasticsearch.action.bulk.TransportBulkAction.doExecute(TransportBulkAction.java:63)\n    at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:63)\n    at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:49)\n    at org.elasticsearch.client.node.NodeClient.execute(NodeClient.java:85)\n    at org.elasticsearch.client.support.AbstractClient.bulk(AbstractClient.java:144)\n    at org.graylog2.indexer.Indexer.bulkIndex(Indexer.java:327)\n    at org.graylog2.outputs.ElasticSearchOutput.write(ElasticSearchOutput.java:85)\n    at org.graylog2.outputs.BatchedElasticSearchOutput.synchronousFlush(BatchedElasticSearchOutput.java:88)\n    at org.graylog2.outputs.BatchedElasticSearchOutput$1.run(BatchedElasticSearchOutput.java:102)\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n    at java.util.concurrent.FutureTask.run(FutureTask.java:262)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n2014-08-14 18:35:53,129 INFO : org.graylog2.system.jobs.SystemJobManager - Submitted SystemJob \u003c0ecb0280-23d1-11e4-b00e-4c8d79f2b596\u003e [org.graylog2.indexer.ranges.RebuildIndexRangesJob]\n2014-08-14 18:35:53,129 INFO : org.graylog2.indexer.Deflector - Done!\n2014-08-14 18:35:53,129 INFO : org.graylog2.indexer.ranges.RebuildIndexRangesJob - Re-calculating index ranges.\n2014-08-14 18:35:53,129 INFO : org.graylog2.indexer.Deflector - Pointing deflector to new target index....\n2014-08-14 18:35:53,184 INFO : org.graylog2.indexer.Deflector - Done!\n2014-08-14 18:35:53,265 INFO : org.graylog2.indexer.ranges.RebuildIndexRangesJob - Index [graylog2_0] is empty but it is the current deflector target. Inserting dummy index range.\n2014-08-14 18:35:53,267 INFO : org.graylog2.indexer.ranges.RebuildIndexRangesJob - Done calculating index ranges for 1 indices. Took 112ms.\n2014-08-14 18:35:53,268 INFO : org.graylog2.system.jobs.SystemJobManager - SystemJob \u003c0ecb0280-23d1-11e4-b00e-4c8d79f2b596\u003e [org.graylog2.indexer.ranges.RebuildIndexRangesJob] finished in 138ms.\n```\n",
    "keywords": [
      "exception",
      "threadpoolexecutor runworker",
      "cluster",
      "metadata",
      "impl",
      "syslogudpinput]",
      "java",
      "indexhelper",
      "235",
      "[0s]",
      "hppc abstractiterator",
      "16",
      "rebuildindexrangesjob",
      "raw",
      "[1s]",
      "indexer indexhelper",
      "completed",
      "execute",
      "graylog2 inputs",
      "immutableopenmap",
      "0",
      "scheduledthreadpoolexecutor$scheduledfuturetask",
      "node",
      "input",
      "1",
      "java:293",
      "util",
      "129",
      "doexecute",
      "starting",
      "java:178",
      "alertserviceimpl",
      "shared",
      "doexecute transportbulkaction",
      "elasticsearchoutput",
      "concurrent",
      "runandreset",
      "syslog",
      "130",
      "java:262",
      "[graylog2_deflector]",
      "builder",
      "action bulk",
      "run thread",
      "java:145",
      "java:144",
      "common collect",
      "periodicals",
      "runcheck messagecountalertcondition",
      "restapiservice",
      "started",
      "determineaffectedindices",
      "call",
      "java:271",
      "indices",
      "plugin",
      "org graylog2",
      "nosuchelementexception",
      "serverinputregistry",
      "java:159",
      "executors$runnableadapter",
      "[org",
      "searches java:100",
      "exception java",
      "inputs",
      "run",
      "empty",
      "unable",
      "immutableopenmap$1",
      "java:63",
      "completed starting",
      "transportbulkaction",
      "skipping",
      "info",
      "java:744 2014-08-14",
      "searches",
      "executebulk",
      "triggered alertserviceimpl",
      "count",
      "check",
      "graylog2 periodical",
      "syslog udp",
      "support",
      "threadpoolexecutor",
      "next",
      "[graylog2-server]",
      "ranges",
      "java:615",
      "reflections",
      "kie",
      "info ",
      "hppc",
      "bulkindex",
      "graylog2",
      "java:85",
      "common",
      "flush",
      "threadpoolexecutor java:1145",
      "alert",
      "java:83",
      "jersey",
      "java:80",
      "executors java:471",
      "now",
      "missing",
      "polling every",
      "client",
      "java:744",
      "java:189",
      "batchedelasticsearchoutput$1",
      "compiler",
      "every",
      "java:88",
      "16 0",
      "types",
      "transportaction",
      "org",
      "[org graylog2",
      "kiemodule",
      "skipping alert",
      "gelf",
      "immutableopenmap$1 next",
      "support transportaction",
      "periodical java:83",
      "fieldvaluealertcondition",
      "melissa][exfhbonasgyppy1_zdspla][inet[/172",
      "message",
      "periodical alertscannerthread",
      "target",
      "scheduledthreadpoolexecutor$scheduledfuturetask access$301",
      "searches count",
      "periodical",
      "executors",
      "triggered",
      "types messagecountalertcondition",
      "synchronousflush",
      "deflector",
      "batchedelasticsearchoutput",
      "235 info",
      "java util",
      "scheduledthreadpoolexecutor java:178",
      "execute transportaction",
      "scheduledthreadpoolexecutor java:293",
      "aliastarget",
      "elasticsearch",
      "inputs gelf",
      "messagecountalertcondition",
      "action",
      "id",
      "indexer deflector",
      "write",
      "threw",
      "java:327",
      "index",
      "dorun alertscannerthread",
      "indexer",
      "futuretask java:304",
      "alerts",
      "system",
      "concreteindex",
      "scheduledthreadpoolexecutor$scheduledfuturetask run",
      "starting [org",
      "action support",
      "bulk",
      "alerts alertserviceimpl",
      "scheduledthreadpoolexecutor",
      "2014-08-14 18:35:53",
      "server",
      "2014-08-14 18:35:52",
      "udp syslogudpinput]",
      "inputs serverinputregistry",
      "[running]\u003d0",
      "determineaffectedindices indexhelper",
      "periodical run",
      "futuretask runandreset",
      "indices indices",
      "nodeclient",
      "getcurrentactualtargetindex",
      "graylog2 outputs",
      "initialized",
      "java:304",
      "java:49",
      "bulk transportbulkaction",
      "java:46",
      "transportaction execute",
      "raw udp",
      "2014-08-14 18:35:42",
      "indexer ranges",
      "outputs batchedelasticsearchoutput",
      "2014-08-14 18:35:49",
      "2014-08-14 18:35:48",
      "util nosuchelementexception",
      "graylog2 indexer",
      "java:1145",
      "discovery",
      "shared initializers",
      "runworker",
      "abstractiterator",
      "threadpoolexecutor$worker",
      "threadpoolexecutor$worker run",
      "indexer searches",
      "outputs",
      "lang thread",
      "runcheck",
      "immutableopenmap java:124",
      "executors$runnableadapter call",
      "main",
      "polling",
      "2014-08-14",
      "java:120",
      "dorun",
      "util concurrent",
      "elasticsearch action",
      "buffer",
      "java:124",
      "error: org",
      "took",
      "ms",
      "/0 0",
      "graylog2 alerts",
      "[0s] polling",
      "done",
      "next abstractiterator",
      "alertscannerthread",
      "aliastarget indices",
      "203",
      "threadpoolexecutor java:615",
      "elasticsearch cluster",
      "collect",
      "udp",
      "no",
      "org elasticsearch",
      "elasticsearch client",
      "getcurrentactualtargetindex deflector",
      "error",
      "inputs syslog",
      "transportbulkaction doexecute",
      "running",
      "18:35:45",
      "abstractclient",
      "futuretask",
      "18:35:44",
      "18:35:42",
      "18:35:41",
      "java:105",
      "java:222",
      "lang",
      "elasticsearch common",
      "18:35:49",
      "java:102",
      "18:35:48",
      "129 info",
      "java:100",
      "/0",
      "access$301",
      "indexmissingexception",
      "drools",
      "plugin periodical",
      "thread",
      "java:471",
      "java:590",
      "18:35:53",
      "periodical periodicals",
      "18:35:52",
      "initializers",
      "kierepositoryimpl"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/Graylog2/graylog2-server/commit/475171fcc382de5b95a346da4c1ba51f773494e9",
      "files": [
        {
          "file_name": "graylog2-server/src/main/java/org/graylog2/bindings/InitializerBindings.java",
          "patch": "@@ -34,7 +34,6 @@ protected void configure() {\n         serviceBinder.addBinding().to(MetricsReporterService.class);\n         serviceBinder.addBinding().to(DashboardRegistryService.class);\n         serviceBinder.addBinding().to(ProcessBufferService.class);\n-        serviceBinder.addBinding().to(DeflectorSetupService.class);\n         serviceBinder.addBinding().to(IndexerSetupService.class);\n         serviceBinder.addBinding().to(BufferSynchronizerService.class);\n         serviceBinder.addBinding().to(OutputSetupService.class);"
        },
        {
          "file_name": "graylog2-server/src/main/java/org/graylog2/initializers/DeflectorSetupService.java",
          "patch": "@@ -1,62 +0,0 @@\n-/*\n- * Copyright 2012-2014 TORCH GmbH\n- *\n- * This file is part of Graylog2.\n- *\n- * Graylog2 is free software: you can redistribute it and/or modify\n- * it under the terms of the GNU General Public License as published by\n- * the Free Software Foundation, either version 3 of the License, or\n- * (at your option) any later version.\n- *\n- * Graylog2 is distributed in the hope that it will be useful,\n- * but WITHOUT ANY WARRANTY; without even the implied warranty of\n- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n- * GNU General Public License for more details.\n- *\n- * You should have received a copy of the GNU General Public License\n- * along with Graylog2.  If not, see \u003chttp://www.gnu.org/licenses/\u003e.\n- */\n-\n-package org.graylog2.initializers;\n-\n-import com.google.common.util.concurrent.AbstractIdleService;\n-import org.graylog2.indexer.Deflector;\n-import org.graylog2.indexer.Indexer;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-\n-import javax.inject.Inject;\n-import javax.inject.Singleton;\n-\n-/**\n- * @author Dennis Oelkers \u003cdennis@torch.sh\u003e\n- */\n-@Singleton\n-public class DeflectorSetupService extends AbstractIdleService {\n-    private static final Logger LOG \u003d LoggerFactory.getLogger(DeflectorSetupService.class);\n-    private final Deflector deflector;\n-    private final Indexer indexer;\n-    private final IndexerSetupService indexerSetupService;\n-\n-    @Inject\n-    public DeflectorSetupService(Deflector deflector,\n-                                 Indexer indexer,\n-                                 IndexerSetupService indexerSetupService) {\n-        this.deflector \u003d deflector;\n-        this.indexer \u003d indexer;\n-        this.indexerSetupService \u003d indexerSetupService;\n-    }\n-\n-    @Override\n-    protected void startUp() throws Exception {\n-        if (indexerSetupService.isRunning()) {\n-            // Set up deflector.\n-            LOG.info(\"Setting up deflector.\");\n-            deflector.setUp(indexer);\n-        }\n-    }\n-\n-    @Override\n-    protected void shutDown() throws Exception {\n-    }\n-}"
        },
        {
          "file_name": "graylog2-server/src/main/java/org/graylog2/initializers/IndexerSetupService.java",
          "patch": "@@ -21,6 +21,7 @@\n \n import com.google.common.util.concurrent.AbstractIdleService;\n import com.google.inject.Singleton;\n+import org.graylog2.indexer.Deflector;\n import org.graylog2.indexer.Indexer;\n import org.graylog2.plugin.Tools;\n import org.slf4j.Logger;\n@@ -37,11 +38,15 @@\n     private static final Logger LOG \u003d LoggerFactory.getLogger(IndexerSetupService.class);\n \n     private final Indexer indexer;\n+    private final Deflector deflector;\n     private final BufferSynchronizerService bufferSynchronizerService;\n \n     @Inject\n-    public IndexerSetupService(Indexer indexer, BufferSynchronizerService bufferSynchronizerService) {\n+    public IndexerSetupService(final Indexer indexer,\n+                               final Deflector deflector,\n+                               final BufferSynchronizerService bufferSynchronizerService) {\n         this.indexer \u003d indexer;\n+        this.deflector \u003d deflector;\n         this.bufferSynchronizerService \u003d bufferSynchronizerService;\n \n         // Shutdown after the BufferSynchronizerServer has stopped to avoid shutting down ES too early.\n@@ -58,12 +63,17 @@ public void terminated(State from) {\n     @Override\n     protected void startUp() throws Exception {\n         Tools.silenceUncaughtExceptionsInThisThread();\n+\n+        LOG.debug(\"Starting indexer\");\n         try {\n             indexer.start();\n         } catch (Exception e) {\n             bufferSynchronizerService.setIndexerUnavailable();\n             throw e;\n         }\n+\n+        LOG.debug(\"Setting up deflector\");\n+        deflector.setUp(indexer);\n     }\n \n     @Override"
        }
      ]
    }
  },
  {
    "name": "Fix Observable.range race condition",
    "url": "https://github.com/ReactiveX/RxJava/pull/2892",
    "description": "In `RangeProducer` if the first two requests come concurrently and are both for `Long.MAX_VALUE` then there is a possible race condition where the fast path is started twice thus emitting some or all elements twice.\n\nThis PR fixes the race by only allowing the fast path if the current request count is 0 (using `compareAndSet`).\n",
    "keywords": [
      "race"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/ReactiveX/RxJava/commit/aefdebb49b657eb698d2cb77681495611bd8e72e",
      "files": [
        {
          "file_name": "src/main/java/rx/internal/operators/OnSubscribeRange.java",
          "patch": "@@ -55,12 +55,11 @@ private RangeProducer(Subscriber\u003c? super Integer\u003e o, int start, int end) {\n \n         @Override\n         public void request(long n) {\n-            if (REQUESTED_UPDATER.get(this) \u003d\u003d Long.MAX_VALUE) {\n+            if (requested \u003d\u003d Long.MAX_VALUE) {\n                 // already started with fast-path\n                 return;\n             }\n-            if (n \u003d\u003d Long.MAX_VALUE) {\n-                REQUESTED_UPDATER.set(this, n);\n+            if (n \u003d\u003d Long.MAX_VALUE \u0026\u0026 REQUESTED_UPDATER.compareAndSet(this, 0, Long.MAX_VALUE)) {\n                 // fast-path without backpressure\n                 for (long i \u003d index; i \u003c\u003d end; i++) {\n                     if (o.isUnsubscribed()) {"
        }
      ]
    }
  },
  {
    "name": "Race condition in the DB",
    "url": "https://github.com/mgolokhov/dodroid/issues/60",
    "description": "One activity ([code](https://github.com/mgolokhov/dodroid/blob/master/app/src/main/java/doit/study/droid/TopicsActivity.java#L89)) writing to the DB by calling getContentResolver().applyBatch(operations), which should be atomic.\n\nSecond activity ([code](https://github.com/mgolokhov/dodroid/blob/master/app/src/main/java/doit/study/droid/QuestionsActivity.java#L74)) reading from the DB with the help of Cursor Loader, and sometimes gets old data (race condition).\n\n``` java\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 4\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 5\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 26\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 19\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 28\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 10\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 12\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 15\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 18\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 25\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 16\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 17\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 8\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 3\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 20\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 29\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 24\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 23\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 30\nD/NSA:QuestionsPagerAdapter:42: counter: 0\nD/NSA:QuizProvider:103: query db: content://doit.study.droid/question/rand/280 null null\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 6\nD/NSA:QuestionsPagerAdapter:42: counter: 0\nD/NSA:QuestionsPagerAdapter:42: counter: 0\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 1\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 14\nD/NSA:QuestionsPagerAdapter:42: counter: 0\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 7\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 27\nD/NSA:QuestionsPagerAdapter:42: counter: 0\nD/NSA:QuestionsActivity:84: load finished: 154982045\nD/NSA:QuestionsPagerAdapter:66: swap cursor, cnt: 104\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuestionsPagerAdapter:35: instantiateItem, pos\u003d0\nD/NSA:QuestionsPagerAdapter:25: getItem, pos\u003d0\nD/NSA:QuestionsPagerAdapter:35: instantiateItem, pos\u003d1\nD/NSA:QuestionsPagerAdapter:25: getItem, pos\u003d1\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 2\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 11\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 22\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 9\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 31\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 21\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 32\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 13\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 4\nW/FragmentManager: moveToState: Fragment state for QuestionFragment{5c25e01 #0 id\u003d0x7f0f00e5} not updated inline; expected state 3 found 2\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuestionsPagerAdapter:52: title pos: 0, questions: tags: [User Interfaces]\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuestionsPagerAdapter:52: title pos: 1, questions: tags: [User Interfaces]\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuizProvider:103: query db: content://doit.study.droid/tag null null\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuestionsPagerAdapter:42: counter: 104\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 5\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 26\nD/NSA:QuizProvider:103: query db: content://doit.study.droid/tag null null\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 19\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 28\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 10\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 12\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 15\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 18\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 25\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 16\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 17\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 8\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 3\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 20\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 29\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 24\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 23\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 30\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 6\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 1\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 14\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 7\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 27\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 2\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 11\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 22\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 9\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 31\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 21\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 32\nD/NSA:QuizProvider:138: update db: selected\u003dfalse _id \u003d 13\nD/NSA:QuizProvider:103: query db: content://doit.study.droid/question/rand/280 null null\nD/NSA:QuestionsActivity:84: load finished: 19434496\nD/NSA:QuestionsPagerAdapter:66: swap cursor, cnt: 0\nD/NSA:QuestionsPagerAdapter:42: counter: 0\nD/NSA:QuestionsPagerAdapter:42: counter: 0\n```\n\nSome resources:\n\nhttp://developer.android.com/guide/topics/providers/content-provider-basics.html#Batch\n\nhttp://www.androiddesignpatterns.com/2012/10/sqlite-contentprovider-thread-safety.html\n\nhttp://stackoverflow.com/questions/8104832/sqlite-simultaneous-reading-and-writing\n\nhttp://kagii-blog.tumblr.com/post/6828016869/android-sqlite-locking\n",
    "keywords": [
      "cursor",
      "study",
      "db: selected\u003dfalse",
      "update",
      "counter: 0",
      "104 d/nsa:questionspageradapter:42",
      "d/nsa:questionspageradapter:42: counter",
      "d/nsa:questionspageradapter:42",
      "d/nsa:quizprovider:138: update",
      "d/nsa:quizprovider:138",
      "content://doit",
      "update db",
      "query",
      "counter: 104",
      "counter",
      "selected\u003dfalse",
      "selected\u003dfalse _id",
      "0",
      "1",
      "2",
      "3",
      "null",
      "104",
      "_id",
      "d/nsa:quizprovider:103",
      "db"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/mgolokhov/dodroid/commit/28d817397a4eb91ceb5e4752a1afb9104aef4597",
      "files": [
        {
          "file_name": "app/src/main/java/doit/study/droid/QuestionsActivity.java",
          "patch": "@@ -19,7 +19,7 @@\n public class QuestionsActivity extends ActivityWithDrawer implements QuestionFragment.OnFragmentActivityChatter, LoaderManager.LoaderCallbacks\u003cCursor\u003e {\n     private static final boolean DEBUG \u003d true;\n     private ViewPager mPager;\n-    private final int QUIZ_SIZE \u003d 280;\n+    private final int QUIZ_SIZE \u003d 10;\n     private int mRightAnswered \u003d 0;\n     private static final int QUESTION_LOADER \u003d 0;\n     private QuestionsPagerAdapter mPagerAdapter;"
        },
        {
          "file_name": "app/src/main/java/doit/study/droid/TopicsActivity.java",
          "patch": "@@ -1,6 +1,7 @@\n package doit.study.droid;\n \n import android.content.ContentProviderOperation;\n+import android.content.ContentProviderResult;\n import android.content.ContentResolver;\n import android.content.ContentValues;\n import android.content.Context;\n@@ -10,6 +11,7 @@\n import android.graphics.Canvas;\n import android.graphics.drawable.Drawable;\n import android.net.Uri;\n+import android.os.AsyncTask;\n import android.os.Bundle;\n import android.os.RemoteException;\n import android.support.v4.app.LoaderManager;\n@@ -84,65 +86,54 @@ private void setSelectionToAllTags(boolean checked){\n         mTopicAdapter.notifyDataSetChanged();\n     }\n \n-//    @Override\n-//    protected void onPause() {\n-//        new Thread(){\n-//            @Override\n-//            public void run() {\n-//                Uri uri \u003d QuizProvider.TAG_URI;\n-//                StringBuilder selected \u003d new StringBuilder();\n-//                StringBuilder unselected \u003d new StringBuilder();\n-//                ContentValues contentValuesSelected \u003d new ContentValues();\n-//                contentValuesSelected.put(Tag.Table.SELECTED, 1);\n-//                ContentValues contentValuesUnselected \u003d new ContentValues();\n-//                contentValuesUnselected.put(Tag.Table.SELECTED, 0);\n-//                for (Tag tag: mTopicAdapter.getTags()) {\n-//                    if (tag.getSelectionStatus()) {\n-//                        if (selected.length() !\u003d 0)\n-//                            selected.append(\" OR \");\n-//                        selected.append(Tag.Table._ID).append(\" \u003d \").append(tag.getId());\n-//                    }\n-//                    else {\n-//                        if (unselected.length() !\u003d 0)\n-//                            unselected.append(\" OR \");\n-//                        unselected.append(Tag.Table._ID).append(\" \u003d \").append(tag.getId());\n-//                    }\n-//                }\n-//                getContentResolver().update(uri, contentValuesSelected, selected.toString(), null);\n-//                getContentResolver().update(uri, contentValuesUnselected, unselected.toString(), null);\n-//            }\n-//        }.start();\n-//        super.onPause();\n-//    }\n-\n-\n     @Override\n     protected void onPause() {\n         new Thread(){\n             @Override\n             public void run() {\n+                StringBuilder selected \u003d new StringBuilder();\n+                StringBuilder unselected \u003d new StringBuilder();\n+                for (Tag tag: mTopicAdapter.getTags()) {\n+                    if (tag.getSelectionStatus()) {\n+                        appendSelection(selected, tag.getId());\n+                    }\n+                    else {\n+                        appendSelection(unselected, tag.getId());\n+                    }\n+                }\n                 ArrayList\u003cContentProviderOperation\u003e ops \u003d new ArrayList\u003c\u003e();\n                 ContentProviderOperation.Builder builder;\n-                for (Tag tag: mTopicAdapter.getTags()) {\n-                    builder \u003d ContentProviderOperation.newUpdate(QuizProvider.TAG_URI);\n-                    builder.withValue(Tag.Table.SELECTED, tag.getSelectionStatus());\n-                    builder.withSelection(Tag.Table._ID + \" \u003d \" + tag.getId(), null);\n+                if (selected.length() !\u003d 0) {\n+                    builder \u003d ContentProviderOperation.newUpdate(QuizProvider.TAG_URI)\n+                            .withValue(Tag.Table.SELECTED, true)\n+                            .withSelection(selected.toString(), null);\n+                    ops.add(builder.build());\n+                }\n+                if (unselected.length() !\u003d 0) {\n+                    builder \u003d ContentProviderOperation.newUpdate(QuizProvider.TAG_URI)\n+                            .withValue(Tag.Table.SELECTED, false)\n+                            .withSelection(unselected.toString(), null);\n                     ops.add(builder.build());\n                 }\n                 try {\n-                    getContentResolver().applyBatch(QuizProvider.AUTHORITY, ops);\n-                    getContentResolver().notifyChange(QuizProvider.TAG_URI, null);\n-                    getContentResolver().notifyChange(QuizProvider.QUESTION_URI, null);\n+                    ContentProviderResult[] res \u003d getContentResolver().applyBatch(QuizProvider.AUTHORITY, ops);\n+                    Timber.d(\"Update result: %d\", res.length);\n                 } catch (RemoteException e) {\n                     e.printStackTrace();\n                 } catch (OperationApplicationException e) {\n                     e.printStackTrace();\n                 }\n             }\n+            private void appendSelection(StringBuilder s, int id){\n+                if (s.length() !\u003d 0)\n+                    s.append(\" OR \");\n+                s.append(Tag.Table._ID).append(\" \u003d \").append(id);\n+            }\n         }.start();\n         super.onPause();\n     }\n \n+\n     @Override\n     public Loader\u003cCursor\u003e onCreateLoader(int id, Bundle args) {\n         switch(id){\n@@ -245,12 +236,9 @@ public void swapCursor(Cursor newCursor) {\n             mCursor \u003d newCursor;\n             notifyDataSetChanged();\n         }\n-\n-        public Cursor getCursor() {\n-            return mCursor;\n-        }\n     }\n \n+\n     private static class DividerItemDecoration extends RecyclerView.ItemDecoration {\n \n         private final int[] ATTRS \u003d new int[]{android.R.attr.listDivider};"
        },
        {
          "file_name": "app/src/main/java/doit/study/droid/data/QuizProvider.java",
          "patch": "@@ -1,19 +1,26 @@\n package doit.study.droid.data;\n \n import android.content.ContentProvider;\n+import android.content.ContentProviderOperation;\n+import android.content.ContentProviderResult;\n import android.content.ContentResolver;\n import android.content.ContentValues;\n+import android.content.OperationApplicationException;\n import android.content.UriMatcher;\n import android.database.Cursor;\n import android.database.sqlite.SQLiteDatabase;\n import android.database.sqlite.SQLiteQueryBuilder;\n import android.net.Uri;\n+import android.support.annotation.NonNull;\n import android.support.annotation.Nullable;\n \n+import java.util.ArrayList;\n+\n import timber.log.Timber;\n \n public class QuizProvider extends ContentProvider {\n     private static final boolean DEBUG \u003d true;\n+    private boolean mIsBatchMode \u003d false;\n \n     public static final String AUTHORITY \u003d \"doit.study.droid\";\n     public static final Uri BASE_URI \u003d Uri.parse(\"content://\" + AUTHORITY);\n@@ -65,8 +72,6 @@\n     static {\n         sQuizQueryBuilder \u003d new SQLiteQueryBuilder();\n \n-        //This is an inner join which looks like\n-        //weather INNER JOIN location ON weather.location_id \u003d location._id\n         sQuizQueryBuilder.setTables(\n                 Question.Table.NAME +\n                         \" INNER JOIN \" + RelationTables.QuestionTag.NAME +\n@@ -76,6 +81,7 @@\n         );\n     }\n \n+\n     @Override\n     public boolean onCreate() {\n         mQuizDBHelper \u003d new QuizDBHelper(getContext());\n@@ -136,7 +142,8 @@ public int update(Uri uri, ContentValues values, String selection, String[] sele\n             case (TAG_DIR):{\n                 int mod \u003d db.update(Tag.Table.NAME, values, selection, selectionArgs);\n                 if (DEBUG) Timber.d(\"update db: %s %s\", values, selection);\n-                getContext().getContentResolver().notifyChange(uri, null);\n+                if (!mIsBatchMode)\n+                    getContext().getContentResolver().notifyChange(uri, null);\n                 return mod;\n             }\n         }\n@@ -151,7 +158,7 @@ public int delete(Uri uri, String selection, String[] selectionArgs) {\n \n     private Cursor getRandSelectedQuestions(Uri uri, String[] projection) {\n         String limit \u003d uri.getPathSegments().get(2);\n-        SQLiteDatabase db \u003d mQuizDBHelper.getReadableDatabase();\n+        SQLiteDatabase db \u003d mQuizDBHelper.getWritableDatabase();\n         String selection \u003d Tag.Table.NAME + \".\" + Tag.Table.SELECTED + \" \u003d 1\";\n         String sortOrder \u003d \"RANDOM()\";\n         return sQuizQueryBuilder.query(db, projection, selection, null, null, null, sortOrder, limit);\n@@ -160,7 +167,7 @@ private Cursor getRandSelectedQuestions(Uri uri, String[] projection) {\n \n     private Cursor getTags() {\n         // authority/tag/\n-        SQLiteDatabase db \u003d mQuizDBHelper.getReadableDatabase();\n+        SQLiteDatabase db \u003d mQuizDBHelper.getWritableDatabase();\n         String tagTotalCounter \u003d \"COUNT(\" + Tag.Table.FQ_TEXT + \") as \" + Tag.Table.TOTAL_COUNTER;\n         String tagStudiedCounter \u003d \"SUM(\" + Question.Table.FQ_STATUS + \"\u003d\" + Tag.Table.QTY_WHEN_STUDIED + \") as \" +\n                 Tag.Table.STUDIED_COUNTER;\n@@ -169,7 +176,25 @@ private Cursor getTags() {\n     }\n \n     private Cursor getQuestions(Uri uri, String [] projection){\n-        SQLiteDatabase db \u003d mQuizDBHelper.getReadableDatabase();\n+        SQLiteDatabase db \u003d mQuizDBHelper.getWritableDatabase();\n         return db.query(Question.Table.NAME, projection, null, null, null, null, null);\n     }\n+\n+\n+    @NonNull\n+    @Override\n+    public ContentProviderResult[] applyBatch(ArrayList\u003cContentProviderOperation\u003e operations) throws OperationApplicationException {\n+        SQLiteDatabase db \u003d mQuizDBHelper.getWritableDatabase();\n+        mIsBatchMode \u003d true;\n+        db.beginTransaction();\n+        try {\n+            final ContentProviderResult [] res \u003d super.applyBatch(operations);\n+            db.setTransactionSuccessful();\n+            getContext().getContentResolver().notifyChange(QuizProvider.BASE_URI, null);\n+            return res;\n+        } finally {\n+            mIsBatchMode \u003d false;\n+            db.endTransaction();\n+        }\n+    }\n }"
        }
      ]
    }
  },
  {
    "name": "Eliminates a race condition in SharedResourceCache",
    "url": "https://github.com/caskdata/cdap/pull/5806",
    "description": "- Make sure the put call only returns after the value\n  is set to the internal cache.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/caskdata/cdap/commit/386a96e7cd51a188102ed4489c228261decd8402",
      "files": [
        {
          "file_name": "cdap-security/src/main/java/co/cask/cdap/security/zookeeper/SharedResourceCache.java",
          "patch": "@@ -27,6 +27,7 @@\n import com.google.common.util.concurrent.FutureCallback;\n import com.google.common.util.concurrent.Futures;\n import com.google.common.util.concurrent.ListenableFuture;\n+import com.google.common.util.concurrent.SettableFuture;\n import org.apache.twill.common.Threads;\n import org.apache.twill.zookeeper.NodeChildren;\n import org.apache.twill.zookeeper.NodeData;\n@@ -167,25 +168,29 @@ public void put(final String name, final T instance) {\n     final String znode \u003d joinZNode(parentZnode, name);\n     try {\n       LOG.debug(\"Setting value for node {}\", znode);\n-      ListenableFuture\u003cT\u003e future \u003d ZKExtOperations.createOrSet(zookeeper, znode, Suppliers.ofInstance(instance),\n-                                                               codec, MAX_RETRIES, znodeACL);\n \n-      Futures.addCallback(future, new FutureCallback\u003cT\u003e() {\n-        @Override\n-        public void onSuccess(T result) {\n-          LOG.debug(\"Created or set node {}\", znode);\n-          resources.put(name, result);\n-        }\n+      final SettableFuture\u003cT\u003e completion \u003d SettableFuture.create();\n+      Futures.addCallback(\n+        ZKExtOperations.createOrSet(zookeeper, znode, Suppliers.ofInstance(instance), codec, MAX_RETRIES, znodeACL),\n+        new FutureCallback\u003cT\u003e() {\n+          @Override\n+          public void onSuccess(T result) {\n+            LOG.debug(\"Created or set node {}\", znode);\n+            resources.put(name, result);\n+            completion.set(result);\n+          }\n \n-        @Override\n-        public void onFailure(Throwable t) {\n-          LOG.error(\"Failed to set value for node {}\", znode, t);\n-          listeners.notifyError(name, t);\n+          @Override\n+          public void onFailure(Throwable t) {\n+            LOG.error(\"Failed to set value for node {}\", znode, t);\n+            listeners.notifyError(name, t);\n+            completion.setException(t);\n+          }\n         }\n-      });\n+      );\n \n       // Block until it is done\n-      future.get();\n+      completion.get();\n \n     } catch (Exception ioe) {\n       throw Throwables.propagate(ioe);"
        }
      ]
    }
  },
  {
    "name": "Race condition on aggregation initialization",
    "url": "https://github.com/qcri/Arabesque/issues/11",
    "description": "Certain configurations could lead to aggregation-related logic being executed before aggregations have been initialized causing a NPE crash.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/qcri/Arabesque/commit/0eeea909476215ce6d5152cb234202d6096ec88f",
      "files": [
        {
          "file_name": "src/main/java/io/arabesque/computation/ExecutionEngine.java",
          "patch": "@@ -87,7 +87,6 @@ protected void init() {\n             if (configuration.getEmbeddingClass() \u003d\u003d null) {\n                 configuration.setEmbeddingClass(computation.getEmbeddingClass());\n             }\n-            computation.initAggregations();\n         }\n \n         computation.init();"
        },
        {
          "file_name": "src/main/java/io/arabesque/conf/Configuration.java",
          "patch": "@@ -135,6 +135,8 @@ public static void set(Configuration configuration) {\n     public Configuration(ImmutableClassesGiraphConfiguration giraphConfiguration) {\n         this.giraphConfiguration \u003d giraphConfiguration;\n \n+        LOG.info(\"Initializing Configuration...\");\n+\n         useCompressedCaches \u003d getBoolean(CONF_COMPRESSED_CACHES, CONF_COMPRESSED_CACHES_DEFAULT);\n         cacheThresholdSize \u003d getInteger(CONF_CACHE_THRESHOLD_SIZE, CONF_CACHE_THRESHOLD_SIZE_DEFAULT);\n         infoPeriod \u003d getLong(INFO_PERIOD, INFO_PERIOD_DEFAULT);\n@@ -162,9 +164,10 @@ public void initialize() {\n             return;\n         }\n \n-        initialized \u003d true;\n+        Computation\u003c?\u003e computation \u003d createComputation();\n+        computation.initAggregations();\n+\n         OptimizationSetDescriptor optimizationSetDescriptor \u003d ReflectionUtils.newInstance(optimizationSetDescriptorClass);\n-        LOG.info(\"Initializing configuration\");\n         OptimizationSet optimizationSet \u003d optimizationSetDescriptor.describe();\n \n         LOG.info(\"Active optimizations: \" + optimizationSet);\n@@ -177,6 +180,8 @@ public void initialize() {\n         mainGraph \u003d createGraph();\n \n         optimizationSet.applyAfterGraphLoad();\n+        initialized \u003d true;\n+        LOG.info(\"Configuration initialized\");\n     }\n \n     public ImmutableClassesGiraphConfiguration getUnderlyingConfiguration() {"
        }
      ]
    }
  },
  {
    "name": "Possible race condition with undertow port binding",
    "url": "https://github.com/wildfly-extras/wildfly-camel/issues/1243",
    "description": "```\n2016-07-05 11:27:55,321 ERROR [stderr] (main) Caused by: java.lang.IllegalStateException: Cannot bind to specific port: http://localhost:8080/rest/hello/%7Bname%7D\n2016-07-05 11:27:55,321 ERROR [stderr] (main)   at org.jboss.gravia.utils.IllegalStateAssertion.assertTrue(IllegalStateAssertion.java:59)\n2016-07-05 11:27:55,322 ERROR [stderr] (main)   at org.wildfly.extension.camel.undertow.CamelUndertowHostService$WildFlyUndertowHost.validateEndpointURI(CamelUndertowHostService.java:177)\n2016-07-05 11:27:55,322 ERROR [stderr] (main)   at org.apache.camel.component.undertow.UndertowConsumer.doStart(UndertowConsumer.java:72)\n2016-07-05 11:27:55,322 ERROR [stderr] (main)   at org.wildfly.extension.camel.undertow.WildFlyUndertowComponent$WildFlyUndertowUndertowConsumer.doStart(WildFlyUndertowComponent.java:91)\n2016-07-05 11:27:55,322 ERROR [stderr] (main)   at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:61)\n2016-07-05 11:27:55,322 ERROR [stderr] (main)   at org.apache.camel.impl.DefaultCamelContext.startService(DefaultCamelContext.java:3275)\n2016-07-05 11:27:55,322 ERROR [stderr] (main)   at org.apache.camel.impl.DefaultCamelContext.doStartOrResumeRouteConsumers(DefaultCamelContext.java:3569)\n2016-07-05 11:27:55,322 ERROR [stderr] (main)   at org.apache.camel.impl.DefaultCamelContext.doStartRouteConsumers(DefaultCamelContext.java:3505)\n2016-07-05 11:27:55,322 ERROR [stderr] (main)   at org.apache.camel.impl.DefaultCamelContext.safelyStartRouteServices(DefaultCamelContext.java:3435)\n2016-07-05 11:27:55,323 ERROR [stderr] (main)   at org.apache.camel.impl.DefaultCamelContext.doStartOrResumeRoutes(DefaultCamelContext.java:3203)\n2016-07-05 11:27:55,323 ERROR [stderr] (main)   at org.apache.camel.impl.DefaultCamelContext.doStartCamel(DefaultCamelContext.java:3059)\n2016-07-05 11:27:55,323 ERROR [stderr] (main)   at org.apache.camel.impl.DefaultCamelContext.access$000(DefaultCamelContext.java:175)\n2016-07-05 11:27:55,323 ERROR [stderr] (main)   at org.apache.camel.impl.DefaultCamelContext$2.call(DefaultCamelContext.java:2854)\n2016-07-05 11:27:55,323 ERROR [stderr] (main)   at org.apache.camel.impl.DefaultCamelContext$2.call(DefaultCamelContext.java:2850)\n2016-07-05 11:27:55,323 ERROR [stderr] (main)   at org.apache.camel.impl.DefaultCamelContext.doWithDefinedClassLoader(DefaultCamelContext.java:2873)\n2016-07-05 11:27:55,323 ERROR [stderr] (main)   at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:2850)\n2016-07-05 11:27:55,323 ERROR [stderr] (main)   at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:61)\n2016-07-05 11:27:55,324 ERROR [stderr] (main)   at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:2819)\n2016-07-05 11:27:55,324 ERROR [stderr] (main)   at org.wildfly.swarm.camel.core.runtime.CamelCoreConfiguration$BootstrapCamelContextService.start(Ca\n```\n",
    "keywords": [
      "servicesupport",
      "camel impl",
      "undertow",
      "org apache",
      "323 error",
      "main",
      "error",
      "apache camel",
      "impl",
      "11:27:55 323",
      "11:27:55 322",
      "apache",
      "dostart",
      "camel",
      "impl defaultcamelcontext",
      "[stderr]",
      "error [stderr]",
      "11:27:55",
      "org",
      "defaultcamelcontext",
      "start",
      "2016-07-05 11:27:55",
      "org wildfly",
      "322",
      "323",
      "wildfly",
      "2016-07-05",
      "[stderr] main"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/wildfly-extras/wildfly-camel/commit/ad53c79276c5f89b6b25b08d2b10b695d5ffd837",
      "files": [
        {
          "file_name": "subsystem/undertow/src/main/java/org/wildfly/extension/camel/undertow/CamelUndertowHostService.java",
          "patch": "@@ -20,6 +20,8 @@\n \n package org.wildfly.extension.camel.undertow;\n \n+import static org.wildfly.extension.camel.CamelLogger.LOGGER;\n+\n import java.net.InetAddress;\n import java.net.MalformedURLException;\n import java.net.URI;\n@@ -32,7 +34,6 @@\n import org.jboss.gravia.runtime.ModuleContext;\n import org.jboss.gravia.runtime.Runtime;\n import org.jboss.gravia.runtime.ServiceRegistration;\n-import org.jboss.gravia.utils.IllegalStateAssertion;\n import org.jboss.msc.service.AbstractService;\n import org.jboss.msc.service.ServiceBuilder;\n import org.jboss.msc.service.ServiceController;\n@@ -76,6 +77,7 @@\n     private UndertowEventListener eventListener;\n     private UndertowHost undertowHost;\n \n+    @SuppressWarnings(\"deprecation\")\n     public static ServiceController\u003cUndertowHost\u003e addService(ServiceTarget serviceTarget, SubsystemRuntimeState runtimeState) {\n         CamelUndertowHostService service \u003d new CamelUndertowHostService(runtimeState);\n         ServiceBuilder\u003cUndertowHost\u003e builder \u003d serviceTarget.addService(SERVICE_NAME, service);\n@@ -102,30 +104,10 @@ public void start(StartContext startContext) throws StartException {\n     }\n \n     private URL getConnectionURL() throws StartException {\n+\n         SocketBinding socketBinding \u003d injectedHttpSocketBinding.getValue();\n         InetAddress address \u003d socketBinding.getNetworkInterfaceBinding().getAddress();\n \n-        /* Derive the address from network interfaces\n-        if (address.getHostAddress().equals(\"127.0.0.1\")) {\n-            InetAddress derived \u003d null;\n-            try {\n-                List\u003cNetworkInterface\u003e nets \u003d Collections.list(NetworkInterface.getNetworkInterfaces());\n-                for (int i \u003d 0; derived \u003d\u003d null \u0026\u0026 i \u003c nets.size(); i++) {\n-                    for (InetAddress aux : Collections.list(nets.get(i).getInetAddresses())) {\n-                        if (!aux.getHostAddress().equals(\"127.0.0.1\")) {\n-                            derived \u003d aux;\n-                            break;\n-                        }\n-                    }\n-                }\n-            } catch (SocketException ex) {\n-                throw new StartException(ex);\n-            }\n-            IllegalStateAssertion.assertNotNull(derived, \"Cannot derive internet address from interfaces\");\n-            address \u003d derived;\n-        }\n-        */\n-\n         URL result;\n         try {\n             String hostAddress \u003d NetworkUtils.formatPossibleIpv6Address(address.getHostAddress());\n@@ -172,9 +154,11 @@ public void validateEndpointURI(URI httpURI) {\n                     }\n                 }\n             }\n-\n-            IllegalStateAssertion.assertEquals(\"localhost\", httpURI.getHost(), \"Cannot bind to host other than \u0027localhost\u0027: \" + httpURI);\n-            IllegalStateAssertion.assertTrue(portMatched, \"Cannot bind to specific port: \" + httpURI);\n+            \n+            if (!\"localhost\".equals(httpURI.getHost())) \n+                LOGGER.warn(\"Cannot bind to host other than \u0027localhost\u0027: {}\", httpURI);\n+            if (!portMatched) \n+                LOGGER.warn(\"Cannot bind to specific port: {}\", httpURI);\n         }\n \n         @Override"
        }
      ]
    }
  },
  {
    "name": "Possible TransferChannel race condition",
    "url": "https://github.com/puniverse/quasar/issues/176",
    "description": "See [report on user group](https://groups.google.com/forum/#!topic/quasar-pulsar-user/U2ztEdoPFqw).\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/puniverse/quasar/commit/21accb64f6e193a66f610e2ef1edc17504cb067a",
      "files": [
        {
          "file_name": "quasar-core/src/main/java/co/paralleluniverse/strands/channels/TransferChannel.java",
          "patch": "@@ -382,17 +382,20 @@ final boolean tryMatchData() {\n         }\n \n         boolean lease() {\n+            final SelectActionImpl sa \u003d this.sa;\n             if (sa \u003d\u003d null)\n                 return true;\n             return sa.lease();\n         }\n \n         void returnLease() {\n+            final SelectActionImpl sa \u003d this.sa;\n             if (sa !\u003d null)\n                 sa.returnLease();\n         }\n \n         void won() {\n+            final SelectActionImpl sa \u003d this.sa;\n             if (sa !\u003d null) {\n                 Object x \u003d item;\n                 sa.setItem(x \u003d\u003d CHANNEL_CLOSED ? null : x);"
        }
      ]
    }
  },
  {
    "name": "Fix race condition and android bugs resulting in an incomplete/corrupted installation",
    "url": "https://github.com/nordnet/cordova-hot-code-push/pull/44",
    "description": "This will make sure the www folder is never left in a corrupted state. If it is corrupted, it will always be recreated on app start. See: https://github.com/nordnet/cordova-hot-code-push/issues/43\n\nAlso once I added logging, I noticed a race condition with two installations being started concurrently, and interfering with each other\u0027s files. \n\nI noticed that **two** calls were being made to the `install` method, and because isInstalling was set from within the thread, both installs would start concurrently. See the small fix in UpdatesInstaller.java.\n\nThe two threads would then compete over the `www_backup` folder, and in my app\u0027s case, this would always fail the update because I have a lot of files in the app and file system errors would occur as the two threads were deleting and creating the same files. I believe this was probably the root cause of issue #43, but the strengthening added for that doesn\u0027t hurt either.\n",
    "keywords": [
      "files",
      "two"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/nordnet/cordova-hot-code-push/commit/c616fe1cd6a3d9142734b7908cebbb5785de3fa0",
      "files": [
        {
          "file_name": "src/android/src/com/nordnetab/chcp/main/HotCodePushPlugin.java",
          "patch": "@@ -34,6 +34,8 @@\n import com.nordnetab.chcp.main.utils.Paths;\n import com.nordnetab.chcp.main.utils.VersionHelper;\n \n+import com.nordnetab.chcp.main.model.ChcpError;\n+\n import org.apache.cordova.CallbackContext;\n import org.apache.cordova.ConfigXmlParser;\n import org.apache.cordova.CordovaArgs;\n@@ -368,7 +370,12 @@ private void installUpdate(CallbackContext jsCallback) {\n             installJsCallback \u003d jsCallback;\n         }\n \n-        UpdatesInstaller.install(fileStructure);\n+        if (UpdatesInstaller.install(fileStructure)) {\n+          // ensure that we set the www folder as invalid, temporarily,\n+          // so that if the app crashes or is killed we don\u0027t run from a corrupted www folder\n+          pluginInternalPrefs.setWwwFolderInstalled(false);\n+          pluginInternalPrefsStorage.storeInPreference(pluginInternalPrefs);\n+        }\n     }\n \n     // endregion\n@@ -436,6 +443,7 @@ private void redirectToLocalStorage() {\n         currentUrl \u003d currentUrl.replace(LOCAL_ASSETS_FOLDER, \"\");\n         String external \u003d Paths.get(fileStructure.wwwFolder(), currentUrl);\n         if (!new File(external).exists()) {\n+            Log.d(\"CHCP\", \"External starting page not found. Aborting page change.\");\n             return;\n         }\n \n@@ -617,6 +625,10 @@ public void onEvent(NothingToUpdateEvent event) {\n     @SuppressWarnings(\"unused\")\n     public void onEvent(UpdateDownloadErrorEvent event) {\n         Log.d(\"CHCP\", \"Failed to update\");\n+        if (event.error() \u003d\u003d ChcpError.LOCAL_VERSION_OF_APPLICATION_CONFIG_NOT_FOUND || event.error() \u003d\u003d ChcpError.LOCAL_VERSION_OF_MANIFEST_NOT_FOUND) {\n+          Log.d(\"CHCP\", \"Can\u0027t load application config from installation folder. Reinstalling external folder\");\n+          installWwwFolder();\n+        }\n \n         PluginResult jsResult \u003d PluginResultHelper.pluginResultFromEvent(event);\n \n@@ -645,6 +657,10 @@ public void onEvent(UpdateDownloadErrorEvent event) {\n     public void onEvent(UpdateInstalledEvent event) {\n         Log.d(\"CHCP\", \"Update is installed\");\n \n+        // reconfirm that our www folder is now valid\n+        pluginInternalPrefs.setWwwFolderInstalled(true);\n+        pluginInternalPrefsStorage.storeInPreference(pluginInternalPrefs);\n+\n         final PluginResult jsResult \u003d PluginResultHelper.pluginResultFromEvent(event);\n \n         if (installJsCallback !\u003d null) {\n@@ -666,8 +682,12 @@ private void resetApplicationToStartingPage() {\n             public void run() {\n                 webView.clearHistory();\n                 webView.clearCache();\n-                final String startingPage \u003d getStartingPage() + \"?\" + System.currentTimeMillis();\n-                final String externalStartingPage \u003d FILE_PREFIX + Paths.get(fileStructure.wwwFolder(), startingPage);\n+                final String external \u003d Paths.get(fileStructure.wwwFolder(), getStartingPage());\n+                if (!new File(external).exists()) {\n+                    Log.d(\"CHCP\", \"External starting page not found. Aborting page change.\");\n+                    return;\n+                }\n+                final String externalStartingPage \u003d FILE_PREFIX + external + \"?\" + System.currentTimeMillis();\n                 webView.loadUrlIntoView(externalStartingPage, false);\n             }\n         });"
        },
        {
          "file_name": "src/android/src/com/nordnetab/chcp/main/updater/UpdatesInstaller.java",
          "patch": "@@ -53,10 +53,10 @@ public static boolean isInstalling() {\n     }\n \n     private static void execute(final InstallationWorker task) {\n+        isInstalling \u003d true;\n         new Thread(new Runnable() {\n             @Override\n             public void run() {\n-                isInstalling \u003d true;\n                 task.run();\n                 isInstalling \u003d false;\n             }"
        }
      ]
    }
  },
  {
    "name": "[service_discovery] Fix race condition preventing SD initialization",
    "url": "https://github.com/DataDog/jmxfetch/pull/135",
    "description": "If JMXFetch starts before the collector process creates the SD pipe,\r\nJMXFetch doesn\u0027t find the SD pipe and never re-tries opening it (until\r\nit\u0027s fully restarted).\r\n\r\nTo solve this, retry opening the SD pipe at every run iteration when\r\nSD is enabled. Also, add an `--sd-enabled` option to know whether\r\nJMXFetch should enable SD (i.e. whether it should expect the SD pipe\r\nto exist or not).\r\n\r\nThe `--sd-standby` option is not used and has therefore been removed.\r\n\r\nThis change requires a change to `dd-agent` to make `jmxfetch.py` pass\r\nthe `--sd-enabled` option when SD-JMXFetch is enabled. See https://github.com/DataDog/dd-agent/pull/3306",
    "keywords": [
      "sd",
      "jmxfetch",
      "pipe",
      "option"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/DataDog/jmxfetch/commit/856838f87ebc20d03cc3a4b378bee86456f628f7",
      "files": [
        {
          "file_name": "src/main/java/org/datadog/jmxfetch/App.java",
          "patch": "@@ -3,12 +3,10 @@\n import java.io.ByteArrayInputStream;\n import java.io.File;\n import java.io.FileInputStream;\n-import java.io.FileFilter;\n import java.io.FileNotFoundException;\n import java.io.InputStream;\n import java.io.IOException;\n import java.io.UnsupportedEncodingException;\n-import java.util.Arrays;\n import java.util.ArrayList;\n import java.util.Enumeration;\n import java.util.HashMap;\n@@ -169,6 +167,17 @@ private String getSDName(String config){\n       return SERVICE_DISCOVERY_PREFIX + splitted[0].substring(2, splitted[0].length());\n     }\n \n+    private FileInputStream newSdPipe() {\n+        FileInputStream sdPipe \u003d null;\n+        try {\n+            sdPipe \u003d new FileInputStream(appConfig.getServiceDiscoveryPipe()); //Should we use RandomAccessFile?\n+            LOGGER.info(\"Named pipe for Service Discovery opened\");\n+        } catch (FileNotFoundException e) {\n+            LOGGER.info(\"Unable to open named pipe for Service Discovery.\");\n+        }\n+        return sdPipe;\n+    }\n+\n     public boolean processServiceDiscovery(byte[] buffer) {\n       boolean reinit \u003d false;\n       String[] discovered;\n@@ -210,11 +219,9 @@ void start() {\n         long delta_s \u003d 0;\n         FileInputStream sdPipe \u003d null;\n \n-        try {\n-          sdPipe \u003d new FileInputStream(appConfig.getServiceDiscoveryPipe()); //Should we use RandomAccessFile?\n-        } catch (FileNotFoundException e) {\n-          LOGGER.warn(\"Unable to open named pipe - Service Discovery disabled.\");\n-          sdPipe \u003d null;\n+        if(appConfig.getSDEnabled()) {\n+            LOGGER.info(\"Service Discovery enabled\");\n+            sdPipe \u003d newSdPipe();\n         }\n \n         while (true) {\n@@ -225,13 +232,17 @@ void start() {\n             }\n \n             // any SD configs waiting in pipe?\n+            if(sdPipe \u003d\u003d null \u0026\u0026 appConfig.getSDEnabled()) {\n+                // If SD is enabled and the pipe is not open, retry opening pipe\n+                sdPipe \u003d newSdPipe();\n+            }\n             try {\n-              if(sdPipe !\u003d null \u0026\u0026 sdPipe.available() \u003e 0) {\n-                int len \u003d sdPipe.available();\n-                byte[] buffer \u003d new byte[len];\n-                sdPipe.read(buffer);\n-                setReinit(processServiceDiscovery(buffer));\n-              }\n+                int len;\n+                if(sdPipe !\u003d null \u0026\u0026 (len \u003d sdPipe.available()) \u003e 0) {\n+                    byte[] buffer \u003d new byte[len];\n+                    sdPipe.read(buffer);\n+                    setReinit(processServiceDiscovery(buffer));\n+                }\n             } catch(IOException e) {\n               LOGGER.warn(\"Unable to read from pipe - Service Discovery configuration may have been skipped.\");\n             }"
        },
        {
          "file_name": "src/main/java/org/datadog/jmxfetch/AppConfig.java",
          "patch": "@@ -76,10 +76,10 @@\n             required \u003d false)\n     private int checkPeriod \u003d 15000;\n \n-    @Parameter(names \u003d {\"--sd_standby\", \"-w\"},\n-            description \u003d \"Service Discovery standby.\",\n+    @Parameter(names \u003d {\"--sd_enabled\", \"-w\"},\n+            description \u003d \"Enable Service Discovery.\",\n             required \u003d false)\n-    private boolean sdStandby \u003d false;\n+    private boolean sdEnabled \u003d false;\n \n     @Parameter(names \u003d {\"--sd_pipe\", \"-S\"},\n             description \u003d \"Service Discovery pipe name.\",\n@@ -128,8 +128,8 @@ public int getCheckPeriod() {\n         return checkPeriod;\n     }\n \n-    public boolean getSDStandby() {\n-        return sdStandby;\n+    public boolean getSDEnabled() {\n+        return sdEnabled;\n     }\n \n     public Reporter getReporter() {"
        },
        {
          "file_name": "src/test/java/org/datadog/jmxfetch/TestCommon.java",
          "patch": "@@ -103,6 +103,7 @@ protected void initApplication(String yamlFileName, String serviceDiscoveryPipeF\n         if (sdEnabled) {\n             params.add(4, \"--tmp_directory\");\n             params.add(5, \"/foo\"); //could be anything we\u0027re stubbing it out\n+            params.add(6, \"--sd_enabled\");\n         }\n         new JCommander(appConfig, params.toArray(new String[params.size()]));\n "
        }
      ]
    }
  },
  {
    "name": "NMS-8735: Race condition in Minion provisioning",
    "url": "https://github.com/OpenNMS/opennms/pull/1015",
    "description": "- JIRA: http://issues.opennms.org/browse/NMS-8735\n- Bamboo: http://bamboo.internal.opennms.com:8085/browse/OPENNMS-ONMS976\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/OpenNMS/opennms/commit/ee99881b1f207b32d2b0d1abeb477a14e5d6adad",
      "files": [
        {
          "file_name": "features/events/api/src/main/java/org/opennms/netmgt/events/api/EventSubscriptionService.java",
          "patch": "@@ -87,5 +87,14 @@\n      */\n     public void removeEventListener(EventListener listener, String uei);\n \n+    /**\n+     * Checks if there is at least one listener for the given uei.\n+     *\n+     * @param uei the uie to check for\n+     *\n+     * @return {@code true} iff there is at least one listener\n+     */\n+    public boolean hasEventListener(final String uei);\n+\n \n }"
        },
        {
          "file_name": "features/events/daemon/src/main/java/org/opennms/netmgt/eventd/EventIpcManagerDefaultImpl.java",
          "patch": "@@ -576,4 +576,13 @@ public void setHandlerQueueLength(int size) {\n         Assert.state(m_eventHandlerPool \u003d\u003d null, \"handlerQueueLength property cannot be set after afterPropertiesSet() is called\");\n         m_handlerQueueLength \u003d size;\n     }\n+\n+    @Override\n+    public boolean hasEventListener(final String uei) {\n+        if (this.m_ueiListeners.containsKey(uei)) {\n+            return this.m_ueiListeners.get(uei).size() \u003e 0;\n+        } else {\n+            return false;\n+        }\n+    }\n }"
        },
        {
          "file_name": "features/minion/heartbeat/consumer/src/main/java/org/opennms/minion/heartbeat/consumer/HeartbeatConsumer.java",
          "patch": "@@ -29,6 +29,7 @@\n package org.opennms.minion.heartbeat.consumer;\n \n import com.google.common.collect.Sets;\n+\n import org.opennms.core.ipc.sink.api.MessageConsumer;\n import org.opennms.core.ipc.sink.api.MessageConsumerManager;\n import org.opennms.core.ipc.sink.api.SinkModule;\n@@ -38,6 +39,7 @@\n import org.opennms.netmgt.events.api.EventConstants;\n import org.opennms.netmgt.events.api.EventProxy;\n import org.opennms.netmgt.events.api.EventProxyException;\n+import org.opennms.netmgt.events.api.EventSubscriptionService;\n import org.opennms.netmgt.model.events.EventBuilder;\n import org.opennms.netmgt.model.minion.OnmsMinion;\n import org.opennms.netmgt.provision.persist.ForeignSourceRepository;\n@@ -80,7 +82,11 @@\n \n     @Autowired\n     @Qualifier(\"eventProxy\")\n-    private EventProxy m_eventProxy;\n+    private EventProxy eventProxy;\n+\n+    @Autowired\n+    @Qualifier(\"eventSubscriptionService\")\n+    private EventSubscriptionService eventSubscriptionService;\n \n     @Override\n     @Transactional\n@@ -92,10 +98,14 @@ public void handleMessage(MinionIdentityDTO minionHandle) {\n         if (minion \u003d\u003d null) {\n             minion \u003d new OnmsMinion();\n             minion.setId(minionHandle.getId());\n+\n+            // The real location is filled in below, but we set this to null\n+            // for now to detect requisition changes\n+            minion.setLocation(null);\n         }\n \n-        String prevLocation \u003d minion.getLocation();\n-        String nextLocation \u003d minionHandle.getLocation();\n+        final String prevLocation \u003d minion.getLocation();\n+        final String nextLocation \u003d minionHandle.getLocation();\n \n         minion.setLocation(minionHandle.getLocation());\n \n@@ -111,10 +121,16 @@ public void handleMessage(MinionIdentityDTO minionHandle) {\n     private void provision(final OnmsMinion minion,\n                            final String prevLocation,\n                            final String nextLocation) {\n+        // Return fast if automatic provisioning is disabled\n         if (!PROVISIONING) {\n             return;\n         }\n \n+        // Return fast until the provisioner is running to pick up the events send below\n+        if (!this.eventSubscriptionService.hasEventListener(EventConstants.RELOAD_IMPORT_UEI)) {\n+            return;\n+        }\n+\n         final String prevForeignSource \u003d String.format(PROVISIONING_FOREIGN_SOURCE_PATTERN, prevLocation);\n         final String nextForeignSource \u003d String.format(PROVISIONING_FOREIGN_SOURCE_PATTERN, nextLocation);\n \n@@ -125,7 +141,7 @@ private void provision(final OnmsMinion minion,\n             final Requisition prevRequisition \u003d this.deployedForeignSourceRepository.getRequisition(prevForeignSource);\n             if (prevRequisition !\u003d null \u0026\u0026 prevRequisition.getNode(minion.getId()) !\u003d null) {\n                 prevRequisition.deleteNode(minion.getId());\n-                prevRequisition.setDate(new Date());\n+                prevRequisition.updateDateStamp();\n \n                 deployedForeignSourceRepository.save(prevRequisition);\n                 deployedForeignSourceRepository.flush();\n@@ -137,7 +153,7 @@ private void provision(final OnmsMinion minion,\n         Requisition nextRequisition \u003d deployedForeignSourceRepository.getRequisition(nextForeignSource);\n         if (nextRequisition \u003d\u003d null) {\n             nextRequisition \u003d new Requisition(nextForeignSource);\n-            nextRequisition.setDate(new Date());\n+            nextRequisition.updateDateStamp();\n \n             // We have to save the requisition before we can alter the according foreign source definition\n             deployedForeignSourceRepository.save(nextRequisition);\n@@ -181,7 +197,7 @@ private void provision(final OnmsMinion minion,\n             eventBuilder.addParam(EventConstants.PARM_URL, String.valueOf(deployedForeignSourceRepository.getRequisitionURL(alteredForeignSource)));\n \n             try {\n-                m_eventProxy.send(eventBuilder.getEvent());\n+                eventProxy.send(eventBuilder.getEvent());\n             } catch (final EventProxyException e) {\n                 throw new DataAccessResourceFailureException(\"Unable to send event to import group \" + alteredForeignSource, e);\n             }"
        },
        {
          "file_name": "opennms-dao-mock/src/main/java/org/opennms/netmgt/dao/mock/MockEventIpcManager.java",
          "patch": "@@ -411,4 +411,14 @@ public void send(final Log eventLog) throws EventProxyException {\n         sendNow(eventLog);\n     }\n \n+    @Override\n+    public boolean hasEventListener(final String uei) {\n+        for (final ListenerKeeper keeper : this.m_listeners) {\n+            if (keeper.m_ueiList.contains(uei)) {\n+                return true;\n+            }\n+        }\n+\n+        return false;\n+    }\n }"
        },
        {
          "file_name": "smoke-test/src/test/java/org/opennms/smoketest/minion/MinionHeartBeatTest.java",
          "patch": "@@ -91,14 +91,13 @@ public void minionHeartBeatTestForLastUpdated() {\n \n \t\t// The heartbeat runs every minute so if we miss the first one, poll long enough\n \t\t// to catch the next one\n-\t\tawait().atMost(900, SECONDS)\n+\t\tawait().atMost(90, SECONDS)\n \t\t\t   .pollInterval(5, SECONDS)\n \t\t\t   .until(DaoUtils.countMatchingCallable(minionDao,\n \t\t\t\t\t\t\t\t\t\t\t\t\t new CriteriaBuilder(OnmsMinion.class).ge(\"lastUpdated\", startOfTest).toCriteria()),\n \t\t\t\t\t  greaterThan(0));\n \n-\t\t/* Ignoring due to NMS-8735\n-\t\tawait().atMost(90, SECONDS)\n+\t\tawait().atMost(180, SECONDS)\n \t\t\t   .pollInterval(5, SECONDS)\n \t\t\t   .until(DaoUtils.countMatchingCallable(nodeDao,\n \t\t\t\t\t\t\t\t\t\t\t\t\t new CriteriaBuilder(OnmsNode.class).eq(\"foreignSource\", \"Minions\")\n@@ -107,6 +106,5 @@ public void minionHeartBeatTestForLastUpdated() {\n \t\t\t\t\t  equalTo(1));\n \n \t\tAssert.assertEquals(\"MINION\", nodeDao.get(\"Minions:00000000-0000-0000-0000-000000ddba11\").getLocation().getLocationName());\n-\t    */\n \t}\n }"
        }
      ]
    }
  },
  {
    "name": "Fix race condition for touch on read",
    "url": "https://github.com/Playtika/spring-data-aerospike/pull/40",
    "description": "",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/Playtika/spring-data-aerospike/commit/85bab562d6d7b1c7b4491c9bc9c3993369b478a9",
      "files": [
        {
          "file_name": "src/main/java/org/springframework/data/aerospike/core/AerospikeTemplate.java",
          "patch": "@@ -311,25 +311,32 @@ public boolean exists(Serializable id, Class\u003c?\u003e type) {\n \t\t\tAerospikePersistentEntity\u003c?\u003e entity \u003d mappingContext.getPersistentEntity(type);\n \t\t\tKey key \u003d getKey(id, entity);\n \n-\t\t\tRecord record \u003d this.client.get(null, key);\n-\t\t\tif (record !\u003d null \u0026\u0026 entity.isTouchOnRead()) {\n+\t\t\tRecord record;\n+\t\t\tif (entity.isTouchOnRead()) {\n \t\t\t\tAssert.state(!entity.hasExpirationProperty(), \"Touch on read is not supported for expiration property\");\n-\t\t\t\trecord \u003d getAndTouch(key, record, entity.getExpiration());\n+\t\t\t\trecord \u003d getAndTouch(key, entity.getExpiration());\n+\t\t\t} else {\n+\t\t\t\trecord \u003d this.client.get(null, key);\n \t\t\t}\n+\n \t\t\treturn mapToEntity(key, type, record);\n \t\t}\n \t\tcatch (AerospikeException e) {\n+\t\t\t//touch operation returns error if key not found\n+\t\t\tif (e.getResultCode() \u003d\u003d ResultCode.KEY_NOT_FOUND_ERROR) {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n \t\t\tDataAccessException translatedException \u003d exceptionTranslator.translateExceptionIfPossible(e);\n \t\t\tthrow translatedException \u003d\u003d null ? e : translatedException;\n \t\t}\n \t}\n \n-\tprivate Record getAndTouch(Key key, Record record, int expiration) {\n+\tprivate Record getAndTouch(Key key, int expiration) {\n \t\tWritePolicy writePolicy \u003d new WritePolicy(client.writePolicyDefault);\n \t\twritePolicy.expiration \u003d expiration;\n \n-\t\tRecord touched \u003d this.client.operate(writePolicy, key, Operation.touch(), Operation.getHeader());\n-\t\treturn new Record(record.bins, touched.generation, touched.expiration);\n+\t\treturn this.client.operate(writePolicy, key, Operation.touch(), Operation.get());\n \t}\n \n \t@Override"
        },
        {
          "file_name": "src/test/java/org/springframework/data/aerospike/AsyncUtils.java",
          "patch": "@@ -1,25 +1,39 @@\n package org.springframework.data.aerospike;\n \n-import java.util.Collection;\n-import java.util.Collections;\n-import java.util.List;\n import java.util.concurrent.*;\n \n+import static java.util.Collections.nCopies;\n+import static java.util.concurrent.CompletableFuture.runAsync;\n+\n public class AsyncUtils {\n \n-\tpublic static void executeConcurrently(int numThreads, Callable\u003cVoid\u003e task) throws Exception {\n+\tpublic static void executeConcurrently(int numThreads, Runnable task) throws Exception {\n \t\tExecutorService pool \u003d Executors.newFixedThreadPool(numThreads);\n \n \t\ttry {\n-\t\t\tCollection\u003cCallable\u003cVoid\u003e\u003e tasks \u003d Collections.nCopies(numThreads, task);\n+\t\t\tCountDownLatch countDownLatch \u003d new CountDownLatch(1);\n+\t\t\tCompletableFuture future \u003d nCopies(numThreads, withCountDownLatch(task, countDownLatch))\n+\t\t\t\t\t.stream()\n+\t\t\t\t\t.map(runnable -\u003e runAsync(runnable, pool))\n+\t\t\t\t\t.reduce((l, r) -\u003e CompletableFuture.allOf(l, r))\n+\t\t\t\t\t.get();\n \n-\t\t\tList\u003cFuture\u003cVoid\u003e\u003e futures \u003d pool.invokeAll(tasks);\n-\t\t\tfor (Future future : futures) {\n-\t\t\t\tfuture.get(5, TimeUnit.SECONDS);\n-\t\t\t}\n+\t\t\tcountDownLatch.countDown();\n+\t\t\tfuture.get(5, TimeUnit.SECONDS);\n \t\t} finally {\n \t\t\tpool.shutdownNow();\n \t\t}\n \n \t}\n+\n+\tprivate static Runnable withCountDownLatch(Runnable task, CountDownLatch countDownLatch) {\n+\t\treturn () -\u003e {\n+\t\t\ttry {\n+\t\t\t\tcountDownLatch.await();\n+\t\t\t\ttask.run();\n+\t\t\t} catch (InterruptedException e) {\n+\t\t\t\tthrow new RuntimeException(\"Thread is interrupted\", e);\n+\t\t\t}\n+\t\t};\n+\t}\n }"
        },
        {
          "file_name": "src/test/java/org/springframework/data/aerospike/SampleClasses.java",
          "patch": "@@ -348,12 +348,20 @@ public User convert(AerospikeReadData source) {\n \n \t\t@Id\n \t\tprivate String id;\n+\n+\t\tprivate int field;\n+\n \t\t@Version\n \t\tprivate long version;\n \n-\t\t@PersistenceConstructor\n \t\tpublic DocumentWithTouchOnRead(String id) {\n+\t\t\tthis(id, 0);\n+\t\t}\n+\n+\t\t@PersistenceConstructor\n+\t\tpublic DocumentWithTouchOnRead(String id, int field) {\n \t\t\tthis.id \u003d id;\n+\t\t\tthis.field \u003d field;\n \t\t}\n \t}\n "
        },
        {
          "file_name": "src/test/java/org/springframework/data/aerospike/core/AerospikeTemplateTests.java",
          "patch": "@@ -17,6 +17,7 @@\n import org.junit.Test;\n import org.junit.rules.ExpectedException;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.dao.ConcurrencyFailureException;\n import org.springframework.dao.DataRetrievalFailureException;\n import org.springframework.dao.DuplicateKeyException;\n import org.springframework.dao.OptimisticLockingFailureException;\n@@ -186,7 +187,6 @@ public void shouldUpdateAlreadyExistingDocument() throws Exception {\n                 } catch (OptimisticLockingFailureException e) {\n                 }\n             }\n-            return null;\n         });\n \n \t\tVersionedClass actual \u003d template.findById(id, VersionedClass.class);\n@@ -211,7 +211,6 @@ public void shouldSaveOnlyFirstDocumentAndNextAttemptsShouldFailWithOptimisticLo\n             } catch (OptimisticLockingFailureException e) {\n                 optimisticLockCounter.incrementAndGet();\n             }\n-            return null;\n         });\n \n \t\tassertThat(optimisticLockCounter.intValue()).isEqualTo(numberOfConcurrentSaves - 1);\n@@ -897,4 +896,31 @@ public void findById_shouldFailOnTouchOnReadWithExpirationProperty() {\n \t\ttemplate.insert(new DocumentWithTouchOnReadAndExpirationProperty(id, EXPIRATION_ONE_MINUTE));\n \t\ttemplate.findById(id, DocumentWithTouchOnReadAndExpirationProperty.class);\n \t}\n+\n+\t@Test\n+\tpublic void shouldConcurrentlyUpdateDocumentIfTouchOnReadIsTrue() throws Exception {\n+\t\tint numberOfConcurrentUpdate \u003d 10;\n+\t\tAsyncUtils.executeConcurrently(numberOfConcurrentUpdate, new Runnable() {\n+\t\t\t@Override\n+\t\t\tpublic void run() {\n+\t\t\t\ttry {\n+\t\t\t\t\tDocumentWithTouchOnRead existing \u003d template.findById(id, DocumentWithTouchOnRead.class) ;\n+\t\t\t\t\tDocumentWithTouchOnRead toUpdate;\n+\t\t\t\t\tif (existing !\u003d null) {\n+\t\t\t\t\t\ttoUpdate \u003d new DocumentWithTouchOnRead(id, existing.getField() + 1, existing.getVersion());\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\ttoUpdate \u003d new DocumentWithTouchOnRead(id, 1);\n+\t\t\t\t\t}\n+\n+\t\t\t\t\ttemplate.save(toUpdate);\n+\t\t\t\t} catch (ConcurrencyFailureException e) {\n+\t\t\t\t\t//try again\n+\t\t\t\t\trun();\n+\t\t\t\t}\n+\t\t\t}\n+\t\t});\n+\n+\t\tDocumentWithTouchOnRead actual \u003d template.findById(id, DocumentWithTouchOnRead.class);\n+\t\tassertThat(actual.getField()).isEqualTo(numberOfConcurrentUpdate);\n+\t}\n }"
        }
      ]
    }
  },
  {
    "name": "REPL has a race condition",
    "url": "https://github.com/flabbergast-config/flabbergast/issues/39",
    "description": "The REPL doesn\u0027t check if all the printed items have finished evaluating, so it can show frames with unfinished values.\n",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/flabbergast-config/flabbergast/commit/a0067c923cfa927dd21c14dccaf8071106cebcab",
      "files": [
        {
          "file_name": "platform/cli/compiler-cli.flbgst",
          "patch": "@@ -1734,6 +1734,7 @@ kws : compiler_lib.kws_repl_tmpl {\n \t\t\t\tindent : indent,\n \t\t\t\tcode :\n \t\t\t\t\t\"\\(sum_indent)\\(output_callback.storage_name).Load(\\(generator));\" \u0026\n+\t\t\t\t\t\"\\(sum_indent)\\(generator).SlotIfFrame(\\(item.storage_name));\" \u0026\n \t\t\t\t\t\"\\(sum_indent)\\(generator).LoadReboxed(\\(item.storage_name), typeof(object));\" \u0026\n \t\t\t\t\t\"\\(sum_indent)\\(generator).Builder.Emit(System.Reflection.Emit.OpCodes.Callvirt, typeof(ConsumeResult).GetMethod(\\\"Invoke\\\", new [] { typeof(object) }));\" \u0026\n \t\t\t\t\tcode"
        },
        {
          "file_name": "platform/cli/generator.cs",
          "patch": "@@ -745,6 +745,12 @@ internal abstract class Generator {\n \t * Generate a successful return.\n \t */\n \tpublic void Return(LoadableValue result) {\n+\t\tSlotIfFrame(result);\n+\t\tCopyField(result, typeof(Computation).GetField(\"result\", BindingFlags.NonPublic | BindingFlags.Instance));\n+\t\tBuilder.Emit(OpCodes.Ldc_I4_1);\n+\t\tBuilder.Emit(OpCodes.Ret);\n+\t}\n+\tpublic void SlotIfFrame(LoadableValue result) {\n \t\tif (result.BackingType \u003d\u003d typeof(Frame) || result.BackingType \u003d\u003d typeof(object)) {\n \t\t\tvar end \u003d Builder.DefineLabel();\n \t\t\tif (result.BackingType \u003d\u003d typeof(object)) {\n@@ -759,9 +765,6 @@ internal abstract class Generator {\n \t\t\tBuilder.Emit(OpCodes.Call, typeof(Frame).GetMethod(\"Slot\"));\n \t\t\tBuilder.MarkLabel(end);\n \t\t}\n-\t\tCopyField(result, typeof(Computation).GetField(\"result\", BindingFlags.NonPublic | BindingFlags.Instance));\n-\t\tBuilder.Emit(OpCodes.Ldc_I4_1);\n-\t\tBuilder.Emit(OpCodes.Ret);\n \t}\n \tprivate LoadableValue ToStringishHelper(LoadableValue source) {\n \t\tif (source.BackingType \u003d\u003d typeof(bool)) {"
        },
        {
          "file_name": "platform/cli/repl.cs",
          "patch": "@@ -77,7 +77,7 @@ public class REPL {\n \n \t\t\tif (files.Count \u003d\u003d 1) {\n \t\t\t\tvar parser \u003d Parser.Open(files[0]);\n-\t\t\t\tvar root_type \u003d parser.ParseFile(collector, unit, \"TestRoot\");\n+\t\t\t\tvar root_type \u003d parser.ParseFile(collector, unit, \"REPLRoot\");\n \t\t\t\tif (root_type !\u003d null) {\n \t\t\t\t\tvar computation \u003d (Computation) Activator.CreateInstance(root_type, task_master);\n \t\t\t\t\tcomputation.Notify(r \u003d\u003e original \u003d r as Frame);\n@@ -102,12 +102,16 @@ public class REPL {\n \n \t\t\twhile (run \u0026\u0026 (s \u003d line_editor.Edit(id + \"‽ \", \"\")) !\u003d null) {\n \t\t\t\tvar parser \u003d new Parser(\"line\" + id, s);\n-\t\t\t\tvar run_type \u003d parser.ParseRepl(collector, unit, \"Test\" + id++);\n+\t\t\t\tvar run_type \u003d parser.ParseRepl(collector, unit, \"REPL\" + id++);\n \t\t\t\tif (run_type !\u003d null) {\n-\t\t\t\t\tvar computation \u003d (Computation) Activator.CreateInstance(run_type, new object[] { task_master, original, current, update_current, (ConsumeResult) HandleResult, (ConsumeResult) Console.WriteLine });\n+\t\t\t\t\tobject result \u003d null;\n+\t\t\t\t\tvar computation \u003d (Computation) Activator.CreateInstance(run_type, new object[] { task_master, original, current, update_current, (ConsumeResult) (output \u003d\u003e result \u003d output), (ConsumeResult) Console.WriteLine });\n \t\t\t\t\tcomputation.Notify(r \u003d\u003e run \u003d (r as bool?) ?? true);\n \t\t\t\t\ttask_master.Slot(computation);\n \t\t\t\t\ttask_master.Run();\n+\t\t\t\t\tif (result !\u003d null) {\n+\t\t\t\t\t\tHandleResult(result);\n+\t\t\t\t\t}\n \t\t\t\t\ttask_master.ReportCircularEvaluation();\n \t\t\t\t}\n \t\t\t}"
        },
        {
          "file_name": "platform/jvm/compiler-jvm.flbgst",
          "patch": "@@ -1818,6 +1818,7 @@ kws : compiler_lib.kws_repl_tmpl {\n \t\t\t\tindent : indent,\n \t\t\t\tcode :\n \t\t\t\t\t\"\\(sum_indent)\\(output_callback.storage_name).load(\\(generator));\" \u0026\n+\t\t\t\t\t\"\\(sum_indent)\\(generator).slotIfFrame(\\(item.storage_name));\" \u0026\n \t\t\t\t\t\"\\(sum_indent)\\(generator).loadReboxed(\\(item.storage_name), Object.class);\" \u0026\n \t\t\t\t\t\"\\(sum_indent)\\(generator).visitMethod(ConsumeResult.class.getMethod(\\\"consume\\\", Object.class));\" \u0026\n \t\t\t\t\tcode"
        },
        {
          "file_name": "platform/jvm/compiler/flabbergast/Generator.java",
          "patch": "@@ -367,23 +367,7 @@ public int defineState() {\n \t * @throws NoSuchMethodException\n \t */\n \tpublic void doReturn(LoadableValue result) throws Exception {\n-\t\tif (result.getBackingType() \u003d\u003d Frame.class\n-\t\t\t\t|| result.getBackingType() \u003d\u003d Object.class) {\n-\t\t\tLabel end \u003d new Label();\n-\t\t\tif (result.getBackingType() \u003d\u003d Object.class) {\n-\t\t\t\tresult.load(builder);\n-\t\t\t\tbuilder.visitTypeInsn(Opcodes.INSTANCEOF,\n-\t\t\t\t\t\tgetInternalName(Frame.class));\n-\t\t\t\tbuilder.visitJumpInsn(Opcodes.IFEQ, end);\n-\t\t\t\tresult.load(builder);\n-\t\t\t\tbuilder.visitTypeInsn(Opcodes.CHECKCAST,\n-\t\t\t\t\t\tgetInternalName(Frame.class));\n-\t\t\t} else {\n-\t\t\t\tresult.load(builder);\n-\t\t\t}\n-\t\t\tvisitMethod(Frame.class.getMethod(\"slot\"));\n-\t\t\tbuilder.visitLabel(end);\n-\t\t}\n+\t\tslotIfFrame(result);\n \t\tcopyField(result, \"result\", Object.class);\n \t\tbuilder.visitInsn(Opcodes.ICONST_0);\n \t\tbuilder.visitInsn(Opcodes.IRETURN);\n@@ -1085,6 +1069,25 @@ public void slot(LoadableValue target) throws Exception {\n \t\tvisitMethod(TaskMaster.class.getMethod(\"slot\", Computation.class));\n \t}\n \n+\tpublic void slotIfFrame(LoadableValue result) throws Exception {\n+\t\tif (result.getBackingType() \u003d\u003d Frame.class\n+\t\t\t\t|| result.getBackingType() \u003d\u003d Object.class) {\n+\t\t\tLabel end \u003d new Label();\n+\t\t\tif (result.getBackingType() \u003d\u003d Object.class) {\n+\t\t\t\tresult.load(builder);\n+\t\t\t\tbuilder.visitTypeInsn(Opcodes.INSTANCEOF,\n+\t\t\t\t\t\tgetInternalName(Frame.class));\n+\t\t\t\tbuilder.visitJumpInsn(Opcodes.IFEQ, end);\n+\t\t\t\tresult.load(builder);\n+\t\t\t\tbuilder.visitTypeInsn(Opcodes.CHECKCAST,\n+\t\t\t\t\t\tgetInternalName(Frame.class));\n+\t\t\t} else {\n+\t\t\t\tresult.load(builder);\n+\t\t\t}\n+\t\t\tvisitMethod(Frame.class.getMethod(\"slot\"));\n+\t\t\tbuilder.visitLabel(end);\n+\t\t}\n+\t}\n \t/**\n \t * Slot a computation for execution and stop execution.\n \t * "
        },
        {
          "file_name": "platform/jvm/compiler/flabbergast/MainREPL.java",
          "patch": "@@ -16,12 +16,23 @@\n \n \tpublic static class PrintToConsole extends ElaboratePrinter {\n \t\tprivate ConsoleReader reader;\n+\t\tprivate Object value;\n \n \t\tpublic PrintToConsole(ConsoleReader reader) {\n \t\t\tthis.reader \u003d reader;\n \t\t}\n \n \t\t@Override\n+\t\tpublic void consume(Object result) {\n+\t\t\tvalue \u003d result;\n+\t\t}\n+\n+\t\tpublic void print() {\n+\t\t\tif (value !\u003d null)\n+\t\t\t\tprint(value);\n+\t\t}\n+\n+\t\t@Override\n \t\tprotected void write(String string) throws IOException {\n \t\t\treader.printString(string);\n \t\t}\n@@ -106,7 +117,7 @@ public static void main(String[] args) {\n \n \t\tErrorCollector collector \u003d new ConsoleCollector();\n \t\tDynamicCompiler compiler \u003d new DynamicCompiler(collector);\n-\t\tTaskMaster task_master \u003d new ConsoleTaskMaster();\n+\t\tConsoleTaskMaster task_master \u003d new ConsoleTaskMaster();\n \t\ttask_master.addUriHandler(BuiltInLibraries.INSTANCE);\n \t\ttask_master.addUriHandler(new LoadPrecompiledLibraries());\n \t\ttask_master.addUriHandler(compiler);\n@@ -160,11 +171,11 @@ public void consume(Object result) {\n \t\t\treader.setUsePagination(true);\n \t\t\tString line;\n \t\t\tint id \u003d 0;\n-\t\t\tElaboratePrinter printer \u003d new PrintToConsole(reader);\n-\t\t\tRawPrint raw_printer \u003d new RawPrint(reader);\n \t\t\tKeepRunning keep_running \u003d new KeepRunning();\n \t\t\twhile (keep_running.allowed() \u0026\u0026 (line \u003d reader.readLine()) !\u003d null) {\n \t\t\t\tParser parser \u003d new Parser(\"\u003cconsole\u003e\", line);\n+\t\t\t\tPrintToConsole printer \u003d new PrintToConsole(reader);\n+\t\t\t\tRawPrint raw_printer \u003d new RawPrint(reader);\n \t\t\t\tClass\u003c? extends Computation\u003e run_type \u003d parser.parseRepl(\n \t\t\t\t\t\tcollector, compiler.getCompilationUnit(),\n \t\t\t\t\t\t\"flabbergast/interactive/Line\" + (id++));\n@@ -178,6 +189,8 @@ public void consume(Object result) {\n \t\t\t\t\tcomputation.listen(keep_running);\n \t\t\t\t\ttask_master.slot(computation);\n \t\t\t\t\ttask_master.run();\n+\t\t\t\t\tprinter.print();\n+\t\t\t\t\ttask_master.reportCircularEvaluation();\n \t\t\t\t}\n \t\t\t}\n \t\t} catch (Exception e) {"
        },
        {
          "file_name": "platform/jvm/runtime/flabbergast/ElaboratePrinter.java",
          "patch": "@@ -8,6 +8,10 @@\n \n \t@Override\n \tpublic void consume(Object result) {\n+\t\tprint(result);\n+\t}\n+\n+\tprotected void print(Object result) {\n \t\tMap\u003cFrame, String\u003e seen \u003d new HashMap\u003cFrame, String\u003e();\n \t\ttry {\n \t\t\tprint(result, \"\", seen);"
        }
      ]
    }
  },
  {
    "name": "Race condition when cancelling a capture while the camera is in use",
    "url": "https://github.com/nathan-osman/chronosnap/issues/7",
    "description": "If the camera is being used to capture an image and the capture is canceled, the service does not properly handle this condition and a race condition can cause a `NullPointerException`.\n",
    "keywords": [
      "condition",
      "capture"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/nathan-osman/chronosnap/commit/e668a61b4c4c8b9fc6995c26bb53d8b6614f82d4",
      "files": [
        {
          "file_name": "app/src/main/java/com/nathanosman/chronosnap/preference/CameraPreference.java",
          "patch": "@@ -15,7 +15,8 @@\n  * Custom preference type for selecting a camera\n  *\n  * Since the number and type of hardware cameras can differ from one model to\n- * the next, the user needs to be able to select which one to use.\n+ * the next, the user needs to be able to select which one to use. Subclassing\n+ * ListPreference allows us to pick the default value at runtime.\n  */\n public class CameraPreference extends ListPreference {\n "
        },
        {
          "file_name": "app/src/main/java/com/nathanosman/chronosnap/preference/SettingsActivity.java",
          "patch": "@@ -12,6 +12,10 @@\n \n /**\n  * Configurable settings for the application\n+ *\n+ * Currently, all settings are displayed within a single PreferenceFragment.\n+ * As the number of settings grows, I expect that they will need to be grouped\n+ * differently.\n  */\n public class SettingsActivity extends PreferenceActivity {\n \n@@ -25,17 +29,22 @@ public void onCreate(Bundle savedInstanceState) {\n             super.onCreate(savedInstanceState);\n             addPreferencesFromResource(R.xml.preferences);\n \n+            // Ensure that the summary is updated when preferences change\n             bindPreferenceSummaryToValue(findPreference(\"interval\"));\n             bindPreferenceSummaryToValue(findPreference(\"limit\"));\n             bindPreferenceSummaryToValue(findPreference(\"camera\"));\n             bindPreferenceSummaryToValue(findPreference(\"focus\"));\n         }\n \n+        /**\n+         * When a preference changes value, the summary should be updated\n+         */\n         private static Preference.OnPreferenceChangeListener sListener \u003d new Preference.OnPreferenceChangeListener() {\n             @Override\n             public boolean onPreferenceChange(Preference preference, Object newValue) {\n                 String stringValue \u003d newValue.toString();\n \n+                // The method for updating the summary differs based on the preference type\n                 if (preference instanceof ListPreference) {\n                     ListPreference listPreference \u003d (ListPreference) preference;\n                     int index \u003d listPreference.findIndexOfValue(stringValue);\n@@ -49,9 +58,11 @@ public boolean onPreferenceChange(Preference preference, Object newValue) {\n             }\n         };\n \n+        /**\n+         * Bind a preference\u0027s value to its summary and load the initial value\n+         */\n         private static void bindPreferenceSummaryToValue(Preference preference) {\n             preference.setOnPreferenceChangeListener(sListener);\n-\n             sListener.onPreferenceChange(preference, PreferenceManager\n                     .getDefaultSharedPreferences(preference.getContext())\n                     .getString(preference.getKey(), \"\"));"
        },
        {
          "file_name": "app/src/main/java/com/nathanosman/chronosnap/service/CaptureService.java",
          "patch": "@@ -10,6 +10,7 @@\n import android.os.Build;\n import android.os.IBinder;\n import android.preference.PreferenceManager;\n+import android.support.v4.app.NotificationCompat;\n import android.support.v4.content.LocalBroadcastManager;\n import android.util.Log;\n import android.widget.Toast;\n@@ -84,6 +85,10 @@\n     // Used for capturing the images\n     private ImageCapturer mImageCapturer;\n \n+    // Used for tracking stop requests\n+    private boolean mCaptureInProgress \u003d false;\n+    private boolean mPendingShutdown \u003d false;\n+\n     /**\n      * Reimplementation of Service.onCreate()\n      */\n@@ -101,8 +106,6 @@ public void onCreate() {\n     @Override\n     public int onStartCommand(Intent intent, int flags, int startId) {\n \n-        // TODO: figure out why the intent is sometimes NULL\n-\n         if (intent !\u003d null) {\n \n             // Dispatch the command to the appropriate method\n@@ -135,35 +138,32 @@ public IBinder onBind(Intent intent) {\n     }\n \n     /**\n-     * Send a broadcast with current status\n+     * Send a broadcast with the current capture status\n+     *\n+     * Status currently includes the start time, current index, and remaining\n+     * image count (0 if no limit).\n      */\n     private void broadcastStatus() {\n \n         Intent intent \u003d new Intent(BROADCAST_STATUS);\n         intent.putExtra(EXTRA_START_TIME, mStartTime);\n         intent.putExtra(EXTRA_IMAGES_CAPTURED, mIndex);\n         intent.putExtra(EXTRA_IMAGES_REMAINING, mLimit \u003d\u003d 0 ? 0 : mLimit - mIndex);\n+\n+        // Send the broadcast\n         LocalBroadcastManager.getInstance(this).sendBroadcast(intent);\n     }\n \n     /**\n      * Start capturing a sequence of images\n      */\n-    @SuppressWarnings(\"deprecation\")\n     private void startCapture() {\n \n+        // TODO: this method needs heavy refactoring\n+\n         log(\"Starting image capture.\");\n \n-        // Indicate that this is a foreground service by creating a persistent\n-        // notification displayed while the capture is in progress\n-        Intent intent \u003d new Intent(this, MainActivity.class);\n-        Notification notification \u003d new Notification.Builder(this)\n-                .setContentTitle(getText(R.string.notification_title))\n-                .setContentText(getText(R.string.notification_text))\n-                .setSmallIcon(R.drawable.ic_stat_notify)\n-                .setContentIntent(PendingIntent.getActivity(this, 0, intent, 0))\n-                .getNotification();\n-        startForeground(1, notification);\n+        createNotification();\n \n         // Set the start time and reset the index\n         mStartTime \u003d System.currentTimeMillis();\n@@ -189,83 +189,145 @@ private void startCapture() {\n \n         // Broadcast the new status (that the capture has started) and set an alarm\n         broadcastStatus();\n-        setAlarm();\n+        setAlarm(System.currentTimeMillis() + mInterval);\n     }\n \n     /**\n      * Stop capturing a sequence of images\n+     *\n+     * This may not actually stop the capture immediately since it is\n+     * currently not possible to interrupt an individual image capture in\n+     * progress.\n      */\n     private void stopCapture() {\n \n         log(\"Stopping image capture.\");\n \n-        // TODO: this currently cannot cancel an image capture in progress\n-\n-        // Cancel any pending capture intents and leave the foreground\n-        mAlarmManager.cancel(mCaptureIntent);\n-        stopForeground(true);\n-\n-        // Reset the start time (to indicate no transfer) and broadcast this status\n-        mStartTime \u003d 0;\n-        broadcastStatus();\n+        // If a capture is in progress, set a flag to shutdown after the\n+        // capture completes - otherwise, immediately shut down\n+        if (mCaptureInProgress) {\n+            mPendingShutdown \u003d true;\n+        } else {\n \n-        // Stop the service\n-        stopSelf();\n+            // TODO: this doesn\u0027t do anything currently but will be needed later\n+            mImageCapturer.close();\n+            shutdown();\n+        }\n     }\n \n     /**\n      * Capture a single image\n+     *\n+     * The capture process is performed asynchronously and the results are\n+     * provided through the two callbacks.\n      */\n     private void capture() {\n \n         log(\"Capturing image #\" + String.valueOf(mIndex) + \".\");\n \n+        // Grab the current time for calculating the next alarm interval later\n+        final long captureTime \u003d System.currentTimeMillis();\n+\n+        // Signal that the capture is in progress\n+        mCaptureInProgress \u003d true;\n+\n+        // Begin the capture\n         mImageCapturer.startCapture(mIndex, new ImageCapturer.CaptureCallback() {\n \n             @Override\n-            public void onSuccess() {\n+            public void onComplete(String errorMessage) {\n \n-                log(\"Image #\" + String.valueOf(mIndex) + \" captured.\");\n+                // Log the status of the capture\n+                if (errorMessage \u003d\u003d null) {\n+                    log(\"Image #\" + String.valueOf(mIndex) + \" captured.\");\n+                } else {\n+                    log(\"Error: \" + errorMessage);\n+                }\n \n-                // Increment the counter and broadcast the status\n-                mIndex++;\n-                broadcastStatus();\n+                // Capture is no longer in progress\n+                mCaptureInProgress \u003d false;\n \n-                // Check to see if more images should be captured (and set the alarm)\n-                // or if the limit was reached (and the capture may be stopped\n-                if (mLimit \u003d\u003d 0 || mIndex \u003c mLimit) {\n+                // Shutdown the capture if one of the following occurred:\n+                // - the capture was stopped (mPendingShutdown)\n+                // - an error message was supplied\n+                // - a limit was supplied and it has been reached\n+                if (mPendingShutdown || errorMessage !\u003d null || mLimit !\u003d 0 \u0026\u0026 (mIndex + 1) \u003d\u003d mLimit) {\n \n-                    // TODO: this should be a configurable setting\n+                    // Close the camera since it won\u0027t be needed anymore\n                     mImageCapturer.close();\n \n-                    setAlarm();\n+                    // TODO: display an actual error notification instead of a toast\n+\n+                    // If an error occurred, then display a toast\n+                    if (errorMessage !\u003d null) {\n+                        Toast.makeText(CaptureService.this, errorMessage, Toast.LENGTH_LONG).show();\n+                    }\n+\n+                    mPendingShutdown \u003d false;\n+                    shutdown();\n \n                 } else {\n-                    stopCapture();\n+\n+                    // Increment the counter and broadcast the status\n+                    mIndex++;\n+                    broadcastStatus();\n+\n+                    // TODO: check to see if closing the camera is necessary\n+                    mImageCapturer.close();\n+\n+                    // Set an alarm for the next capture\n+                    setAlarm(captureTime + mInterval);\n                 }\n             }\n+        });\n+    }\n \n-            @Override\n-            public void onError(String description) {\n+    /**\n+     * Log the specified message\n+     * @param message a descriptive status message\n+     */\n+    private void log(String message) {\n+        Log.d(CaptureService.class.getSimpleName(), message);\n+    }\n+\n+    /**\n+     * Create the persistent notification that will be displayed during capture\n+     *\n+     * The notification includes an action to immediately stop the capture.\n+     */\n+    private void createNotification() {\n \n-                log(\"Error: \" + description);\n+        // Create a pending intent that will display the main UI\n+        PendingIntent mainIntent \u003d PendingIntent.getActivity(this, 0,\n+                new Intent(this, MainActivity.class), 0);\n \n-                // Inform the user that an error has occurred during capture\n-                Toast.makeText(CaptureService.this, R.string.toast_error_storage_img,\n-                        Toast.LENGTH_LONG).show();\n+        // Create a pending intent that will stop the capture\n+        PendingIntent stopIntent \u003d PendingIntent.getService(this, 0,\n+                new Intent(this, CaptureService.class).setAction(ACTION_STOP_CAPTURE), 0);\n \n-                // Stop the capture\n-                stopCapture();\n-            }\n-        });\n+        // TODO: \"stop\" is not localized\n+\n+        // Create the notification, noting that NotificationCompat will ignore\n+        // any of the methods that aren\u0027t available on the current platform\n+        Notification notification \u003d new NotificationCompat.Builder(this)\n+                .addAction(R.drawable.ic_action_stop, \"Stop\", stopIntent)\n+                .setCategory(Notification.CATEGORY_SERVICE)\n+                .setColor(getResources().getColor(R.color.material_primary))\n+                .setContentIntent(mainIntent)\n+                .setContentText(getText(R.string.notification_text))\n+                .setContentTitle(getText(R.string.notification_title))\n+                .setSmallIcon(R.drawable.ic_stat_notify)\n+                .build();\n+\n+        // Build the notification and move the service into the foreground\n+        startForeground(1, notification);\n     }\n \n     /**\n      * Set the alarm for the next capture\n+     * @param triggerAtMillis time at which to capture the next image\n      */\n-    private void setAlarm() {\n-\n-        long triggerAtMillis \u003d System.currentTimeMillis() + mInterval;\n+    private void setAlarm(long triggerAtMillis) {\n \n         // For KitKat and newer devices, we need to use setExact or we don\u0027t\n         // end up with the same level of precision as earlier versions\n@@ -277,9 +339,25 @@ private void setAlarm() {\n     }\n \n     /**\n-     * Log the specified message\n+     * Completely abort the capture\n+     *\n+     * All alarms are canceled, the service is pulled out of the foreground,\n+     * variables are reset, and the status is broadcast one last time. This\n+     * should never be called while a single image capture is in progress.\n      */\n-    private void log(String message) {\n-        Log.d(CaptureService.class.getSimpleName(), message);\n+    private void shutdown() {\n+\n+        log(\"Shutting down service.\");\n+\n+        // Cancel any pending alarms and leave the foreground\n+        mAlarmManager.cancel(mCaptureIntent);\n+        stopForeground(true);\n+\n+        // Reset the start time and broadcast this status\n+        mStartTime \u003d 0;\n+        broadcastStatus();\n+\n+        // Stop the service since there is no need to keep it running\n+        stopSelf();\n     }\n }\n\\ No newline at end of file"
        },
        {
          "file_name": "app/src/main/java/com/nathanosman/chronosnap/service/ImageCapturer.java",
          "patch": "@@ -22,22 +22,19 @@\n     /**\n      * Callback interface used to provide notification of capture state\n      *\n-     * Both of the callbacks may leave the camera open (to save time when\n-     * starting the next capture), so it needs to be explicitly closed when\n-     * capturing is finished.\n+     * Note that the camera may still be open at this point and .close()\n+     * should be called.\n      */\n     public interface CaptureCallback {\n \n         /**\n-         * Called when a capture completes successfully\n+         * Called when a capture completes\n+         * @param errorMessage descriptive message if an error occurred or null\n+         *\n+         * errorMessage will be null if no error has occurred. Otherwise it\n+         * contains a human-readable description of the error.\n          */\n-        void onSuccess();\n-\n-        /**\n-         * Called when an error condition occurs\n-         * @param description human-readable description of the error condition\n-         */\n-        void onError(String description);\n+        void onComplete(String errorMessage);\n     }\n \n     // Data initialized in the constructor\n@@ -49,7 +46,8 @@\n     private int mIndex;\n     private CaptureCallback mCaptureCallback;\n \n-    // (Potentially) persistent connection to the camera\n+    // Connection to the camera (may be maintained for multiple captures)\n+    // Because this app works on 4.0.4+, we can\u0027t easily use the Camera2 API\n     @SuppressWarnings(\"deprecation\")\n     private Camera mCamera;\n \n@@ -108,15 +106,13 @@ protected String doInBackground(Void... params) {\n                 @Override\n                 protected void onPostExecute(String message) {\n \n-                    // If message is non-null, then call CaptureCallback.onError(),\n+                    // If message is non-null, then pass along the error message,\n                     // otherwise start the camera preview and begin autofocus\n                     if (message !\u003d null) {\n-                        mCaptureCallback.onError(message);\n-                        return;\n+                        mCaptureCallback.onComplete(message);\n+                    } else {\n+                        setup();\n                     }\n-\n-                    // Move to the setup step\n-                    setup();\n                 }\n             }.execute();\n         }\n@@ -137,6 +133,8 @@ public void close() {\n \n     /**\n      * Setup the camera in preparation for image capture\n+     *\n+     * Currently, this step is limited to autofocus.\n      */\n     @SuppressWarnings(\"deprecation\")\n     private void setup() {\n@@ -152,17 +150,14 @@ private void setup() {\n                 @Override\n                 public void onAutoFocus(boolean success, Camera camera) {\n \n-                    // TODO: if unable to focus, try again a couple of times\n                     // TODO: error message needs to be localized\n \n-                    // If setup was not successful, we need to report an error\n+                    // If the camera was unable to focus, report the error\n                     if (!success) {\n-                        mCaptureCallback.onError(\"Unable to focus.\");\n-                        return;\n+                        mCaptureCallback.onComplete(\"Unable to focus.\");\n+                    } else {\n+                        capture();\n                     }\n-\n-                    // Move to the capture step\n-                    capture();\n                 }\n             });\n \n@@ -191,7 +186,7 @@ public void onPictureTaken(byte[] data, Camera camera) {\n \n                     // Report an error if the directory could not be created\n                     if (!mSequencePath.mkdirs()) {\n-                        mCaptureCallback.onError(\"Unable to create storage directory.\");\n+                        mCaptureCallback.onComplete(\"Unable to create storage directory.\");\n                         return;\n                     }\n                 }\n@@ -208,12 +203,12 @@ public void onPictureTaken(byte[] data, Camera camera) {\n \n                 } catch (IOException e) {\n \n-                    mCaptureCallback.onError(e.getMessage());\n+                    mCaptureCallback.onComplete(e.getMessage());\n                     return;\n                 }\n \n                 // Indicate that the capture was successful\n-                mCaptureCallback.onSuccess();\n+                mCaptureCallback.onComplete(null);\n             }\n         });\n     }"
        }
      ]
    }
  },
  {
    "name": "Race condition creating target list after closing an exercise that adds its own targets",
    "url": "https://github.com/phrack/ShootOFF/issues/608",
    "description": "1. Tell Steel Challenge\u0027s constructor to print out the number of targets.\n2. Open a course.\n3. Start cowboy fast draw, bouncing targets, shoot don\u0027t shoot, or some other exercise that adds its own targets.\n4. Turn off the exercise started above and start Steel Challenge by clicking Steel Challenge with the other exercise still selected.\n\nExpected: Target count reads the number of targets in the course.\nActual: The target count reads the number of targets in the course + the number of targets the previous exercise had open at the time it closed.\n\nI first noticed this when switching from Shoot Don\u0027t Shoot to Steel Challenge because Steel Challenge kept saying I missed five targets every time even though I was hitting all 5 targets that were up. Shoot Don\u0027t Shoot had 5 targets up when I started Steel Challenge and these targets were being included in the mix (i.e. to Steel Challenge I had 10 targets I needed to shoot instead of just the 5 that actually were up).\n",
    "keywords": [
      "steel",
      "number",
      "steel challenge",
      "5",
      "exercise",
      "course",
      "challenge",
      "shoot",
      "targets",
      "target"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/phrack/ShootOFF/commit/cdfae410d56554cd89b94cc0a9ce98765f930aab",
      "files": [
        {
          "file_name": "src/main/java/com/shootoff/gui/controller/ShootOFFController.java",
          "patch": "@@ -919,24 +919,25 @@ public void showBrightnessWarning(Camera webcam) {\n \t@Override\n \tpublic void setExercise(TrainingExercise exercise) {\n \t\ttry {\n-\t\t\tif (exercise \u003d\u003d null)\n-\t\t\t{\n-\t\t\t\tconfig.setExercise(null);\n-\t\t\t\treturn;\n-\t\t\t}\n-\t\t\t\n-\t\t\tConstructor\u003c?\u003e ctor \u003d exercise.getClass().getConstructor(List.class);\n+\t\t\t// If there is a current exercise, ensure it is destroyed\n+\t\t\t// before starting an new one in case it\u0027s a projector\n+\t\t\t// exercise that added targets that need to be removed.\n+\t\t\tconfig.setExercise(null);\n \n-\t\t\tList\u003cTarget\u003e knownTargets \u003d new ArrayList\u003cTarget\u003e();\n+\t\t\tif (exercise \u003d\u003d null) return;\n+\n+\t\t\tfinal Constructor\u003c?\u003e ctor \u003d exercise.getClass().getConstructor(List.class);\n+\n+\t\t\tfinal List\u003cTarget\u003e knownTargets \u003d new ArrayList\u003cTarget\u003e();\n \t\t\tknownTargets.addAll(getTargets());\n \n \t\t\tif (projectorSlide.getArenaPane() !\u003d null) {\n \t\t\t\tknownTargets.addAll(projectorSlide.getArenaPane().getCanvasManager().getTargets());\n \t\t\t}\n \n-\t\t\tTrainingExercise newExercise \u003d (TrainingExercise) ctor.newInstance(knownTargets);\n+\t\t\tfinal TrainingExercise newExercise \u003d (TrainingExercise) ctor.newInstance(knownTargets);\n \n-\t\t\tOptional\u003cPlugin\u003e plugin \u003d pluginEngine.getPlugin(newExercise);\n+\t\t\tfinal Optional\u003cPlugin\u003e plugin \u003d pluginEngine.getPlugin(newExercise);\n \t\t\tif (plugin.isPresent()) {\n \t\t\t\tconfig.setPlugin(plugin.get());\n \t\t\t} else {\n@@ -965,11 +966,13 @@ public void setExercise(TrainingExercise exercise) {\n \t@Override\n \tpublic void setProjectorExercise(TrainingExercise exercise) {\n \t\ttry {\n-\t\t\tConstructor\u003c?\u003e ctor \u003d exercise.getClass().getConstructor(List.class);\n-\t\t\tTrainingExercise newExercise \u003d (TrainingExercise) ctor\n+\t\t\tconfig.setExercise(null);\n+\t\t\t\n+\t\t\tfinal Constructor\u003c?\u003e ctor \u003d exercise.getClass().getConstructor(List.class);\n+\t\t\tfinal TrainingExercise newExercise \u003d (TrainingExercise) ctor\n \t\t\t\t\t.newInstance(projectorSlide.getArenaPane().getCanvasManager().getTargets());\n \n-\t\t\tOptional\u003cPlugin\u003e plugin \u003d pluginEngine.getPlugin(newExercise);\n+\t\t\tfinal Optional\u003cPlugin\u003e plugin \u003d pluginEngine.getPlugin(newExercise);\n \t\t\tif (plugin.isPresent()) {\n \t\t\t\tconfig.setPlugin(plugin.get());\n \t\t\t} else {"
        },
        {
          "file_name": "src/main/java/com/shootoff/plugins/ProjectorTrainingExerciseBase.java",
          "patch": "@@ -41,7 +41,6 @@\n import com.shootoff.courses.io.CourseIO;\n import com.shootoff.gui.LocatedImage;\n import com.shootoff.gui.ShotEntry;\n-import com.shootoff.gui.TargetView;\n import com.shootoff.gui.controller.ShootOFFController;\n import com.shootoff.gui.pane.ProjectorArenaPane;\n import com.shootoff.targets.Target;\n@@ -345,7 +344,7 @@ public boolean setTargetDistance(Target target, int currentRealWidth, int curren\n \t\t\t\t.calculateObjectSize(currentRealWidth, currentRealHeight, desiredDistance);\n \n \t\tif (targetDimensions.isPresent()) {\n-\t\t\tDimension2D d \u003d targetDimensions.get();\n+\t\t\tfinal Dimension2D d \u003d targetDimensions.get();\n \t\t\ttarget.setDimensions(d.getWidth(), d.getHeight());\n \n \t\t\treturn true;\n@@ -357,15 +356,15 @@ public boolean setTargetDistance(Target target, int currentRealWidth, int curren\n \t@Override\n \tpublic void destroy() {\n \t\tfor (Target target : targets)\n-\t\t\tarenaPane.getCanvasManager().removeTarget((TargetView) target);\n+\t\t\tarenaPane.getCanvasManager().removeTarget(target);\n \n+\t\ttargets.clear();\n+\t\t\n \t\tPlatform.runLater(() -\u003e {\n \t\t\tif (arenaPane !\u003d null)\n \t\t\t\tarenaPane.getCanvasManager().getCanvasGroup().getChildren().remove(exerciseLabel);\n \t\t});\n \n-\t\ttargets.clear();\n-\n \t\tsuper.destroy();\n \t}\n }"
        },
        {
          "file_name": "src/main/java/com/shootoff/plugins/ShootDontShoot.java",
          "patch": "@@ -121,7 +121,7 @@ public void run() {\n \n \t\t\tthisSuper.showTextOnFeed(String.format(\"missed targets: %d%nbad hits: %d\", missedTargets, badHits));\n \n-\t\t\tif (!testRun) {\n+\t\t\tif (!testRun \u0026\u0026 continueExercise.get()) {\n \t\t\t\tfor (Target target : shootTargets)\n \t\t\t\t\tthisSuper.removeTarget(target);\n \t\t\t\tshootTargets.clear();"
        }
      ]
    }
  },
  {
    "name": "Race condition in SoundSystem when changing settings during playback",
    "url": "https://github.com/jtrfp/terminal-recall/issues/212",
    "description": "SoundSystem is giving a race condition when changing sound settings during playback. States of buffer size, format, and texture specifications are uncertain throughout the sound processing loop.",
    "keywords": [],
    "code": {
      "language": "Java",
      "url": "https://github.com/jtrfp/terminal-recall/commit/227ca0851afd296dd341834c61544cfd9fa35c0d",
      "files": [
        {
          "file_name": "src/main/java/org/jtrfp/trcl/snd/SoundSystem.java",
          "patch": "@@ -16,19 +16,14 @@\n import java.beans.PropertyChangeListener;\n import java.beans.PropertyChangeSupport;\n import java.nio.BufferUnderflowException;\n-import java.nio.ByteBuffer;\n-import java.nio.ByteOrder;\n import java.nio.FloatBuffer;\n import java.nio.IntBuffer;\n-import java.util.ArrayList;\n-import java.util.Comparator;\n-import java.util.HashMap;\n+import java.util.ArrayDeque;\n+import java.util.Collections;\n import java.util.HashSet;\n-import java.util.Iterator;\n-import java.util.TreeSet;\n+import java.util.Queue;\n import java.util.concurrent.Callable;\n import java.util.concurrent.atomic.AtomicBoolean;\n-import java.util.concurrent.locks.ReentrantLock;\n \n import javax.media.opengl.GL2ES2;\n import javax.sound.sampled.AudioFormat;\n@@ -39,13 +34,18 @@\n import org.jtrfp.trcl.conf.TRConfigurationFactory.TRConfiguration;\n import org.jtrfp.trcl.core.Features;\n import org.jtrfp.trcl.core.TRFactory.TR;\n-import org.jtrfp.trcl.gpu.GLFrameBuffer;\n import org.jtrfp.trcl.gpu.GLTexture;\n-import org.jtrfp.trcl.gpu.GLTexture.PixelReadDataType;\n-import org.jtrfp.trcl.gpu.GLTexture.PixelReadOrder;\n import org.jtrfp.trcl.gpu.GPU;\n import org.jtrfp.trcl.obj.RelevantEverywhere;\n-import org.jtrfp.trcl.snd.SoundEvent.Factory;\n+import org.jtrfp.trcl.snd.SoundSystemKernel.AddToActiveEvents;\n+import org.jtrfp.trcl.snd.SoundSystemKernel.AddToPendingEvents;\n+import org.jtrfp.trcl.snd.SoundSystemKernel.RemoveFromEvents;\n+import org.jtrfp.trcl.snd.SoundSystemKernel.SetActiveDevice;\n+import org.jtrfp.trcl.snd.SoundSystemKernel.SetActiveDriver;\n+import org.jtrfp.trcl.snd.SoundSystemKernel.SetActiveOutput;\n+import org.jtrfp.trcl.snd.SoundSystemKernel.SetBufferLag;\n+import org.jtrfp.trcl.snd.SoundSystemKernel.SetBufferSizeFrames;\n+import org.jtrfp.trcl.snd.SoundSystemKernel.SetFormat;\n import org.jtrfp.trcl.tools.Util;\n \n public class SoundSystem {\n@@ -68,26 +68,24 @@\n            BUFFER_SIZE_FRAMES_STRING \u003d \"bufferSizeFramesString\";\n     \n     private TR tr;\n-    private GLFrameBuffer playbackFrameBuffer;\n-    private GLTexture playbackTexture;\n     protected final PropertyChangeSupport pcs \u003d new PropertyChangeSupport(this);\n-    private final HashMap\u003cSoundEvent.Factory,ArrayList\u003cSoundEvent\u003e\u003e eventMap \n-     \u003d new HashMap\u003cSoundEvent.Factory,ArrayList\u003cSoundEvent\u003e\u003e();\n+    \n     private SamplePlaybackEvent.Factory playbackFactory, musicPlaybackFactory;\n     private MusicPlaybackEvent.Factory musicFactory;\n     private LoopingSoundEvent.Factory loopFactory;\n     private long soundRenderingFinishedSync;\n     private AtomicBoolean paused \u003d new AtomicBoolean(false);\n     private int bufferSizeFrames \u003d 4096;\n-    private ByteBuffer gpuFloatBytes;\n+    \n     private static final AudioProcessor SILENCE \u003d new Silence();\n     private TRConfiguration trConfiguration;\n     private boolean         initialized \u003d false;\n     private GPU             gpu;\n     private boolean         bufferLag\u003dtrue, linearFiltering\u003dfalse;\n     private double          modStereoWidth \u003d .3;\n     private final CollectionActionDispatcher\u003cString\u003e audioDriverNames \u003d new CollectionActionDispatcher\u003cString\u003e(new HashSet\u003cString\u003e());\n-    private final ReentrantLock lock \u003d new ReentrantLock();\n+    private final SoundSystemKernel soundSystemKernel \u003d new SoundSystemKernel();\n+    private final Queue\u003cRunnable\u003e runnableQueue \u003d new ArrayDeque\u003c\u003e(512);\n     \n    ////VARS\n    private AudioDriver          activeDriver;\n@@ -100,25 +98,15 @@\n                                 outputByName,\n                                 formatByName;\n     \n-    private boolean firstRun\u003dtrue;\n-    private final TreeSet\u003cSoundEvent\u003e pendingEvents \u003d new TreeSet\u003cSoundEvent\u003e(new Comparator\u003cSoundEvent\u003e(){\n-\t@Override\n-\tpublic int compare(SoundEvent first, SoundEvent second) {\n-\t    final double result \u003d 88200. * (first.getStartRealtimeSeconds()-second.getStartRealtimeSeconds());\n-\t    if(result\u003d\u003d0)return first.hashCode()-second.hashCode();\n-\t    else if(result\u003e0)return 1;\n-\t    else return -1;\n-\t}//end compare()\n-    });\n-    private final ArrayList\u003cSoundEvent\u003e activeEvents \u003d new ArrayList\u003cSoundEvent\u003e();\n+    \n     private double bufferTimeCounter;\n     \n \n     public static final double DEFAULT_SFX_VOLUME \u003d .3;\n-    private static final int NUM_BUFFER_ROWS\u003d1;\n     \n     public SoundSystem() {\n \taudioDriverNames.add(\"org.jtrfp.trcl.snd.JavaSoundSystemAudioOutput\");//TODO: Implement a registry.\n+\tsoundSystemKernel.setRunnableQueue(runnableQueue);\n     }// end constructor\n     \n     public void initialize(){\n@@ -129,6 +117,10 @@ public void initialize(){\n \tSystem.out.println(\"Setting up sound system...\");\n \tloadConfigAndAttachListeners();\n \tfinal GPU gpu \u003d getGpu();\n+\t\n+\tsoundSystemKernel.setGpu(gpu);\n+\tsoundSystemKernel.setThreadManager(tr.getThreadManager());\n+\t\n \ttr.getThreadManager().submitToGL(new Callable\u003cVoid\u003e() {\n \t    @Override\n \t    public Void call() throws Exception {\n@@ -149,7 +141,6 @@ public Void call() throws Exception {\n \tloopFactory    \u003d new LoopingSoundEvent.Factory(tr);\n \t\n \tnew Thread() {//TODO: This is not thread-safe with sound config changes!\n-\t    private final DynamicCompressor compressor \u003d new DynamicCompressor();\n \t    @Override\n \t    public void run() {\n \t\ttry {\n@@ -169,25 +160,9 @@ public void run() {\n \t\t\twhile(getActiveFormat() \u003d\u003d null || getActiveOutput() \u003d\u003d null || getActiveDevice() \u003d\u003d null)\n \t\t\t    Thread.sleep(100);//Rolling loop waiting for valid state.\n \t\t\t\n-\t\t\t    renderPrep();\n-\t\t\t    tr.getThreadManager().submitToGL(new Callable\u003cVoid\u003e() {\n-\t\t\t\t@Override\n-\t\t\t\tpublic Void call() throws Exception {\n-\t\t\t\t    final ByteBuffer floatBytes \u003d getGPUFloatBytes();\n-\t\t\t\t    floatBytes.clear();\n-\t\t\t\t    render(getGpu().getGl(), floatBytes);\n-\t\t\t\t    return null;\n-\t\t\t\t}\n-\t\t\t    }).get();\n-\t\t\t    //sBuf.clear();\n-\t\t\t    final FloatBuffer fBuf \u003d getGPUFloatBytes().asFloatBuffer();\n-\t\t\t    fBuf.clear();\n-\t\t\t    compressor.setSource(fBuf);\n-\t\t\t    final AudioDriver driver \u003d getActiveDriver();\n-\t\t\t    if(driver!\u003dnull){\n-\t\t\t\tdriver.setSource(compressor);\n-\t\t\t\tdriver.flush();\n-\t\t\t    }//end driver!\u003dnull\n+\t\t\t  //TODO: Kernel call\n+\t\t\tsoundSystemKernel.execute(bufferTimeCounter);\n+\t\t\tbufferTimeCounter +\u003d getBufferSizeSeconds();\n \t\t    }// end while(true)\n \t\t} catch (Exception e) {\n \t\t    tr.showStopper(e);\n@@ -425,109 +400,22 @@ private int getFilteringParm(){\n     }\n     \n     public void enqueuePlaybackEvent(SoundEvent evt){\n-\tlock.lock();try{\n \t    if(evt instanceof RelevantEverywhere)\n-\t\tactiveEvents.add(evt);\n-\t    else pendingEvents.add(evt);\n-\t}finally{lock.unlock();}\n-    }\n-    \n-    private void firstRun(){\n-\tfirstRun\u003dfalse;\n-    }\n-\n-    private void renderPrep(){\n-\tlock.lock();\n-\ttry{\n-\t    cleanActiveEvents();\n-\t    pickupActiveEvents(getBufferSizeFrames()/getActiveFormat().getFrameRate());\n-\t}finally{lock.unlock();}\n-    }\n-    \n-    private void render(GL2ES2 gl, ByteBuffer audioByteBuffer) {\n-\tif( lock.tryLock() )try{\n-\t    if (firstRun)\n-\t\tfirstRun();\n-\t    final GPU gpu \u003d getGpu();\n-\n-\t    if(isBufferLag())\n-\t\treadGLAudioBuffer(gpu,audioByteBuffer);\n-\n-\t    // Render\n-\t    getPlaybackFrameBuffer().bindToDraw();\n-\t    gl.glViewport(0, 0, getBufferSizeFrames(), 1);\n-\t    gl.glClear(GL2ES2.GL_COLOR_BUFFER_BIT);\n-\t    for (SoundEvent ev : activeEvents) {// TODO: Replace with Factory calls\n-\t\tif (ev.isActive()) {\n-\t\t    final SoundEvent.Factory factory \u003d ev.getOrigin();\n-\t\t    if (!eventMap.containsKey(factory))\n-\t\t\teventMap.put(factory, new ArrayList\u003cSoundEvent\u003e());\n-\t\t    eventMap.get(factory).add(ev);\n-\t\t}// end if(active)\n-\t    }// end for(events)\n-\t    for(Factory factory:eventMap.keySet()){\n-\t\tfinal ArrayList\u003cSoundEvent\u003e events \u003d eventMap.get(factory);\n-\t\tfactory.apply(gl, events, bufferTimeCounter);\n-\t\tevents.clear();\n-\t    }//end for(keySet)\n-\n-\t    if(!isBufferLag())\n-\t\treadGLAudioBuffer(gpu,audioByteBuffer);\n-\n-\t    bufferTimeCounter +\u003d getBufferSizeSeconds();\n-\t    // Cleanup\n-\t    gpu.defaultFrameBuffers();\n-\t    gpu.defaultProgram();\n-\t    gpu.defaultTIU();\n-\t    gpu.defaultTexture();\n-\t    gpu.defaultViewport();\n-\t}finally{lock.unlock();}\n-    }// end render()\n+\t\tsynchronized(runnableQueue){\n+\t\t   runnableQueue.add(new AddToActiveEvents(Collections.singleton(evt), soundSystemKernel));\n+\t\t}//end sync(queue)\n+\t    else synchronized(runnableQueue){\n+\t\t   runnableQueue.add(new AddToPendingEvents(Collections.singleton(evt), soundSystemKernel));\n+\t\t}//end sync(queue)\n+    }//end enqueuePlaybackEvent\n     \n     public double getBufferSizeSeconds() {\n \tfinal AudioFormat activeFormat \u003d getActiveFormat();\n \tif( activeFormat !\u003d null )\n \t    return (double)getBufferSizeFrames() / (double)getActiveFormat().getFrameRate();\n \treturn 0;\n     }\n-\n-    private void readGLAudioBuffer(GPU gpu, ByteBuffer audioByteBuffer){\n-\t// Read and export previous results to sound card.\n-\tfinal GL2ES2 gl \u003d gpu.getGl();\n-\tgpu.defaultFrameBuffers();\n-\tgetPlaybackTexture().bind().readPixels(PixelReadOrder.RG, PixelReadDataType.FLOAT,\n-\t\taudioByteBuffer).unbind();// RG_INTEGER throws INVALID_OPERATION!?\n-    }//end readGLAudioBuffer(...)\n-    \n-    private void pickupActiveEvents(double windowSizeInSeconds){\n-\tfinal double playbackTimeSeconds \u003d bufferTimeCounter;\n-\tfinal Iterator\u003cSoundEvent\u003e eI \u003d pendingEvents.iterator();\n-\twhile(eI.hasNext()){\n-\t    final SoundEvent event \u003d eI.next();\n-\t    if(event.isDestroyed())\n-\t\teI.remove();\n-\t    else if(event.getStartRealtimeSeconds()\u003cplaybackTimeSeconds+windowSizeInSeconds \u0026\u0026 event.getEndRealtimeSeconds()\u003eplaybackTimeSeconds){\n-\t\tactiveEvents.add(event);\n-\t\teI.remove();\n-\t    }//end if(in range)\n-\t    if(event.getStartRealtimeSeconds()\u003eplaybackTimeSeconds+windowSizeInSeconds)\n-\t\treturn;//Everything after this point is out of range.\n-\t}//end hashNext(...)\n-    }//end pickupActiveEvents()\n     \n-    private void cleanActiveEvents(){\n-\tfinal double currentTimeSeconds \u003d bufferTimeCounter;\n-\tfinal Iterator\u003cSoundEvent\u003e eI \u003d activeEvents.iterator();\n-\twhile(eI.hasNext()){\n-\t    final SoundEvent event \u003d eI.next();\n-\t    if(event.isDestroyed())\n-\t\teI.remove();\n-\t    else if(event.getEndRealtimeSeconds()\u003ccurrentTimeSeconds \u0026\u0026 \n-\t\t    !(event instanceof RelevantEverywhere))\n-\t\teI.remove();\n-\t}//end while(hasNext)\n-    }//end cleanActiveEvents()\n-\n     /**\n      * @return the playbackFactory\n      */\n@@ -547,15 +435,10 @@ public double getCurrentFrameBufferTimeCounter() {\n     }\n \n     public void dequeueSoundEvent(SoundEvent event) {\n-\tlock.lock();try{\n-\t    pendingEvents.remove(event);\n-\t    activeEvents.remove(event);\n-\t}finally{lock.unlock();}\n-    }//end dequeneSoundEvent(...)\n-\n-    public GLFrameBuffer getSoundOutputFrameBuffer() {\n-\treturn playbackFrameBuffer;\n-    }\n+\tsynchronized(runnableQueue){\n+\t    runnableQueue.add(new RemoveFromEvents(Collections.singleton(event), soundSystemKernel));\n+\t}//end sync()\n+    }//end dequeueSoundEvent(...)\n \n     public double getSamplesPerMilli() {\n \treturn ((double)getActiveFormat().getFrameRate())/1000.;\n@@ -564,7 +447,7 @@ public double getSamplesPerMilli() {\n     /**\n      * @return the activeDriver\n      */\n-    private AudioDriver getActiveDriver() {\n+    AudioDriver getActiveDriver() {\n \tif(activeDriver\u003d\u003dnull){\n             System.out.println(\"Overriding null driver to default...\");\n             setActiveDriver(new JavaSoundSystemAudioOutput());\n@@ -576,15 +459,19 @@ private AudioDriver getActiveDriver() {\n      * @param activeDriver the activeDriver to set\n      */\n     private void setActiveDriver(AudioDriver activeDriver) {\n-\tif(this.activeDriver!\u003dnull)\n-\t    activeDriver.release();\n+\t//if(this.activeDriver!\u003dnull)\n+\t//    activeDriver.release();\n \tfinal AudioDriver oldActiveDriver \u003d this.activeDriver;\n-        this.activeDriver \u003d activeDriver;\n-        activeDriver.setBufferSizeFrames(getBufferSizeFrames());\n-        setActiveDevice(activeDriver.getDefaultDevice());\n+\tthis.activeDriver \u003d activeDriver;\n+\t\n+\tsynchronized(runnableQueue){\n+\t    runnableQueue.add(new SetActiveDriver(activeDriver, soundSystemKernel));\n+\t    setBufferSizeFrames(getBufferSizeFrames());//Reset\n+\t    setActiveDevice(activeDriver.getDefaultDevice());\n+\t}\n         System.out.println(\"SoundSystem: Active Driver Set To \"+activeDriver);\n         pcs.firePropertyChange(ACTIVE_DRIVER, oldActiveDriver, activeDriver);\n-    }\n+    }//end setActiveDriver(...)\n \n     /**\n      * @return the activeDevice\n@@ -603,9 +490,14 @@ private AudioDevice getActiveDevice() {\n     private void setActiveDevice(AudioDevice activeDevice) {\n \tfinal AudioDevice oldDevice \u003d this.activeDevice;\n         this.activeDevice \u003d activeDevice;\n-        pcs.firePropertyChange(ACTIVE_DEVICE, oldDevice, activeDevice);\n-        setActiveOutput(activeDevice.getDefaultOutput());\n+        \n+        synchronized( runnableQueue ) {\n+            runnableQueue.add(new SetActiveDevice(activeDevice, soundSystemKernel));\n+            setActiveOutput(activeDevice.getDefaultOutput());\n+        }//end sync\n+        \n         System.out.println(\"SoundSystem: Active Device Set To \"+activeDevice);\n+        pcs.firePropertyChange(ACTIVE_DEVICE, oldDevice, activeDevice);\n     }\n \n     /**\n@@ -623,12 +515,17 @@ private AudioOutput getActiveOutput() {\n     private void setActiveOutput(AudioOutput newActiveOutput) {\n \tfinal AudioOutput oldOutput \u003d this.activeOutput;\n         this.activeOutput \u003d newActiveOutput;\n+        \n+        synchronized( runnableQueue ){\n+            runnableQueue.add(new SetActiveOutput(newActiveOutput, soundSystemKernel));\n+            if( newActiveOutput !\u003d null )\n+        \tsetActiveFormat(newActiveOutput.getDefaultFormat());\n+            else\n+        \tsetActiveFormat(null);\n+        }//end sync()\n+        \n         System.out.println(\"SoundSystem: Active Output Set To \"+newActiveOutput);\n-\tgetActiveDriver().setOutput(newActiveOutput);\n-\tif( newActiveOutput !\u003d null )\n-\t    setActiveFormat(newActiveOutput.getDefaultFormat());\n-\telse\n-\t    setActiveFormat(null);\n+\t//getActiveDriver().setOutput(newActiveOutput);\n \tpcs.firePropertyChange(ACTIVE_OUTPUT, oldOutput, newActiveOutput);\n     }\n \n@@ -662,9 +559,13 @@ private void setActiveFormat(AudioFormat newFormat) {\n \t\t    newFormat.isBigEndian());\n \t\n         this.activeFormat \u003d newFormat;\n+        \n+        synchronized( runnableQueue ) {\n+            if( activeDriver !\u003d null )\n+                runnableQueue.add(new SetFormat(newFormat, soundSystemKernel));\n+        }//end sync()\n+        \n         System.out.println(\"SoundSystem: Active Format Set To \"+newFormat+\" for driver \"+activeDriver);\n-        if(activeDriver!\u003dnull)\n-\t    activeDriver.setFormat(newFormat);\n         pcs.firePropertyChange(ACTIVE_FORMAT, oldFormat, newFormat);\n     }\n \n@@ -679,15 +580,15 @@ int getBufferSizeFrames() {\n      * @param bufferSizeFrames the bufferSizeFrames to set\n      */\n     public void setBufferSizeFrames(int bufferSizeFrames) {\n-\tlock.lock();try{\n \t    System.out.println(\"setBufferSizeFrames \"+bufferSizeFrames);\n \t    if(bufferSizeFrames\u003c\u003d0)\n \t\tthrow new RuntimeException(\"Invalid buffer size: \"+bufferSizeFrames+\". Must be greater than zero.\");\n+\t    final int oldValue \u003d this.bufferSizeFrames;\n \t    this.bufferSizeFrames \u003d bufferSizeFrames;\n-\t    getActiveDriver().setBufferSizeFrames(bufferSizeFrames);\n-\t    stalePlaybackTexture();\n-\t    staleFloatBytes();\n-\t}finally{lock.unlock();}\n+\t    synchronized( runnableQueue ) {\n+\t\trunnableQueue.add(new SetBufferSizeFrames(bufferSizeFrames, soundSystemKernel));\n+\t    }//end sync()\n+\t    pcs.firePropertyChange(BUFFER_SIZE_FRAMES, oldValue, bufferSizeFrames);\n     }\n     \n     public void setBufferSizeFramesString(String newValue){\n@@ -698,107 +599,6 @@ public String getBufferSizeFramesString(){\n \treturn \"\"+getBufferSizeFrames();\n     }\n     \n-    private GLFrameBuffer getPlaybackFrameBuffer(){\n-\tlock.lock(); try{\n-\t    if(playbackFrameBuffer\u003d\u003dnull){\n-\t\tplaybackFrameBuffer \u003d tr.getThreadManager().submitToGL(new Callable\u003cGLFrameBuffer\u003e(){\n-\t\t    @Override\n-\t\t    public GLFrameBuffer call() throws Exception {\n-\t\t\tfinal GPU gpu \u003d getGpu();\n-\t\t\tgpu.defaultTexture();\n-\t\t\tgpu.defaultTIU();\n-\t\t\tfinal GLTexture texture \u003d getPlaybackTexture();\n-\t\t\treturn getGpu()\n-\t\t\t\t.newFrameBuffer()\n-\t\t\t\t.bindToDraw()\n-\t\t\t\t.attachDrawTexture(texture,\n-\t\t\t\t\tGL2ES2.GL_COLOR_ATTACHMENT0);\n-\t\t    }}).get();\n-\t    }//end if(playbackFrameBuffer\u003d\u003dnull)\n-\t    return playbackFrameBuffer;\n-\t}finally{lock.unlock();}\n-    }//end getPlaybackFrameBuffer()\n-\n-    private void stalePlaybackFrameBuffer(){\n-\tlock.lock();try{\n-\t    if(playbackFrameBuffer!\u003dnull){\n-\t\tfinal GLFrameBuffer toDelete \u003d playbackFrameBuffer;\n-\t\ttr.getThreadManager().submitToGL(new Callable\u003cVoid\u003e(){\n-\t\t    @Override\n-\t\t    public Void call() throws Exception {\n-\t\t\ttoDelete.destroy();\n-\t\t\treturn null;\n-\t\t    }});\n-\t    }//end playbackFrameBuffer!\u003dnull\n-\t    playbackFrameBuffer\u003dnull;\n-\t}finally{lock.unlock();}\n-    }//end stalePlaybackFrameBuffer()\n-    \n-    private GLTexture getPlaybackTexture(){\n-\tlock.lock();try{\n-\t    if(playbackTexture\u003d\u003dnull){\n-\t\ttr.getThreadManager().submitToGL(new Callable\u003cVoid\u003e(){\n-\t\t    @Override\n-\t\t    public Void call() throws Exception {\n-\t\t\tfinal GPU gpu \u003d getGpu();\n-\t\t\tgpu.defaultProgram();\n-\t\t\tgpu.defaultTIU();\n-\t\t\tgpu.defaultTexture();\n-\t\t\tgpu.defaultFrameBuffers();\n-\t\t\tplaybackTexture \u003d gpu\n-\t\t\t\t.newTexture()\n-\t\t\t\t.bind()\n-\t\t\t\t.setMagFilter(GL2ES2.GL_NEAREST)\n-\t\t\t\t.setMinFilter(GL2ES2.GL_NEAREST)\n-\t\t\t\t.setWrapS(GL2ES2.GL_CLAMP_TO_EDGE)\n-\t\t\t\t.setWrapT(GL2ES2.GL_CLAMP_TO_EDGE)\n-\t\t\t\t.setDebugName(\"playbackTexture\")\n-\t\t\t\t.setExpectedMinValue(-1, -1, -1, -1)\n-\t\t\t\t.setExpectedMaxValue(1, 1, 1, 1)\n-\t\t\t\t.setPreferredUpdateIntervalMillis(100)\n-\t\t\t\t.setImage(GL2ES2.GL_RG32F, getBufferSizeFrames(),\n-\t\t\t\t\tNUM_BUFFER_ROWS, GL2ES2.GL_RGBA, GL2ES2.GL_FLOAT,\n-\t\t\t\t\tnull);\n-\t\t\treturn null;\n-\t\t    }}).get();\n-\t    }\n-\t    return playbackTexture;\n-\t}finally{lock.unlock();}\n-    }//end getPlaybackTexture()\n-    \n-    private void stalePlaybackTexture(){\n-\tlock.lock();try{\n-\tif(playbackTexture!\u003dnull){\n-\t    final GLTexture toDelete \u003d playbackTexture;\n-\t    tr.getThreadManager().submitToGL(new Callable\u003cVoid\u003e(){\n-\t\t@Override\n-\t\tpublic Void call() throws Exception {\n-\t\t    toDelete.delete();//This fails with no-GL exception?!\n-\t\t    return null;\n-\t\t}});\n-\t}//end playbackTexture!\u003dnull\n-        stalePlaybackFrameBuffer();\n-\tplaybackTexture\u003dnull;\n-\t}finally{lock.unlock();}\n-    }//end stalePlaybackTexture()\n-\n-    private ByteBuffer getGPUFloatBytes() {\n-\tif(gpuFloatBytes\u003d\u003dnull)\n-\t    setGPUFloatBytes(ByteBuffer.allocateDirect(\n-\t\t     getBufferSizeFrames()*4\n-\t\t     *getActiveFormat().getChannels())\n-\t\t    .order(ByteOrder.nativeOrder()));\n-\treturn gpuFloatBytes;\n-    }\n-\n-    private void setGPUFloatBytes(ByteBuffer gpuFloatBytes) {\n-\tthis.gpuFloatBytes \u003d gpuFloatBytes;\n-    }\n-    \n-    private void staleFloatBytes(){\n-\tgpuFloatBytes\u003dnull;\n-    }\n-\n     public LoopingSoundEvent.Factory getLoopFactory() {\n         return loopFactory;\n     }\n@@ -863,6 +663,9 @@ public void setBufferLag(Boolean bufferLag) {\n \tSystem.out.println(\"setBufferLag \"+bufferLag);\n \tfinal Boolean oldValue \u003d this.bufferLag;\n         this.bufferLag \u003d bufferLag;\n+        synchronized( runnableQueue ) {\n+            runnableQueue.add(new SetBufferLag(bufferLag,soundSystemKernel));\n+        }\n         pcs.firePropertyChange(BUFFER_LAG, oldValue, bufferLag);\n     }\n "
        }
      ]
    }
  },
  {
    "name": "Gateway: a race condition can prevent the initial cluster state from being recovered",
    "url": "https://github.com/elastic/elasticsearch/pull/13997",
    "description": "After a full cluster restart, the elected master is tasked with recovery the last known cluster state from disk. To do so, the GatewayService registers it self as a listener to cluster state changes, triggering the recovery if the local node is elected. Sadly the initial post-election cluster state can be missed if it\u0027s being processed while the listener is registered (i.e., the listener is too late but the discoveryService.initialStateReceived is not yet set). In this case the cluster state from disk will be recovered with the next change (typically node join).\n\n In practice this is not a big deal as master election takes at least 3s (by which time the gateway is long started), but it does make some of our tests to fail: http://build-us-00.elastic.co/job/es_core_master_centos/7915/\n\n To fix this, we submit a cluster state task after the edition of the listener, so we are guaranteed to check things while they are at rest.\n\n While at it, I removed some left over latch which we don\u0027t really wait on anymore.\n\nI marked this PR as going to 2.1, 2.2 and 3.0. Still on the fence w.r.t 2.0. would love some input on that.\n",
    "keywords": [
      "cluster",
      "2",
      "listener",
      "state",
      "cluster state"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/elastic/elasticsearch/commit/de7d3cf7525af9aa28b50c2ac69de000c1881b77",
      "files": [
        {
          "file_name": "core/src/main/java/org/elasticsearch/discovery/DiscoveryService.java",
          "patch": "@@ -112,14 +112,6 @@ public DiscoveryNode localNode() {\n         return discovery.localNode();\n     }\n \n-    /**\n-     * Returns \u003ctt\u003etrue\u003c/tt\u003e if the initial state was received within the timeout waiting for it\n-     * on {@link #doStart()}.\n-     */\n-    public boolean initialStateReceived() {\n-        return initialStateListener.initialStateReceived;\n-    }\n-\n     public String nodeDescription() {\n         return discovery.nodeDescription();\n     }"
        },
        {
          "file_name": "core/src/main/java/org/elasticsearch/gateway/GatewayService.java",
          "patch": "@@ -43,7 +43,6 @@\n import org.elasticsearch.rest.RestStatus;\n import org.elasticsearch.threadpool.ThreadPool;\n \n-import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.atomic.AtomicBoolean;\n \n /**\n@@ -108,16 +107,27 @@ public GatewayService(Settings settings, Gateway gateway, AllocationService allo\n     @Override\n     protected void doStart() {\n         clusterService.addLast(this);\n-        // if we received initial state, see if we can recover within the start phase, so we hold the\n-        // node from starting until we recovered properly\n-        if (discoveryService.initialStateReceived()) {\n-            ClusterState clusterState \u003d clusterService.state();\n-            if (clusterState.nodes().localNodeMaster() \u0026\u0026 clusterState.blocks().hasGlobalBlock(STATE_NOT_RECOVERED_BLOCK)) {\n-                checkStateMeetsSettingsAndMaybeRecover(clusterState, false);\n+        // check we didn\u0027t miss any cluster state that came in until now / during the addition\n+        clusterService.submitStateUpdateTask(\"gateway_initial_state_recovery\", new ClusterStateUpdateTask() {\n+\n+            @Override\n+            public ClusterState execute(ClusterState currentState) throws Exception {\n+                checkStateMeetsSettingsAndMaybeRecover(currentState);\n+                return currentState;\n             }\n-        } else {\n-            logger.debug(\"can\u0027t wait on start for (possibly) reading state from gateway, will do it asynchronously\");\n-        }\n+\n+            @Override\n+            public boolean runOnlyOnMaster() {\n+                // It\u0027s OK to run on non masters as checkStateMeetsSettingsAndMaybeRecover checks for this\n+                // we return false to avoid unneeded failure logs\n+                return false;\n+            }\n+\n+            @Override\n+            public void onFailure(String source, Throwable t) {\n+                logger.warn(\"unexpected failure while checking if state can be recovered. another attempt will be made with the next cluster state change\", t);\n+            }\n+        });\n     }\n \n     @Override\n@@ -134,12 +144,19 @@ public void clusterChanged(final ClusterChangedEvent event) {\n         if (lifecycle.stoppedOrClosed()) {\n             return;\n         }\n-        if (event.localNodeMaster() \u0026\u0026 event.state().blocks().hasGlobalBlock(STATE_NOT_RECOVERED_BLOCK)) {\n-            checkStateMeetsSettingsAndMaybeRecover(event.state(), true);\n-        }\n+        checkStateMeetsSettingsAndMaybeRecover(event.state());\n     }\n \n-    protected void checkStateMeetsSettingsAndMaybeRecover(ClusterState state, boolean asyncRecovery) {\n+    protected void checkStateMeetsSettingsAndMaybeRecover(ClusterState state) {\n+        if (state.nodes().localNodeMaster() \u003d\u003d false) {\n+            // not our job to recover\n+            return;\n+        }\n+        if (state.blocks().hasGlobalBlock(STATE_NOT_RECOVERED_BLOCK) \u003d\u003d false) {\n+            // already recovered\n+            return;\n+        }\n+\n         DiscoveryNodes nodes \u003d state.nodes();\n         if (state.blocks().hasGlobalBlock(discoveryService.getNoMasterBlock())) {\n             logger.debug(\"not recovering from gateway, no master elected yet\");\n@@ -171,51 +188,32 @@ protected void checkStateMeetsSettingsAndMaybeRecover(ClusterState state, boolea\n                     reason \u003d \"expecting [\" + expectedMasterNodes + \"] master nodes, but only have [\" + nodes.masterNodes().size() + \"]\";\n                 }\n             }\n-            performStateRecovery(asyncRecovery, enforceRecoverAfterTime, reason);\n+            performStateRecovery(enforceRecoverAfterTime, reason);\n         }\n     }\n \n-    private void performStateRecovery(boolean asyncRecovery, boolean enforceRecoverAfterTime, String reason) {\n-        final Gateway.GatewayStateRecoveredListener recoveryListener \u003d new GatewayRecoveryListener(new CountDownLatch(1));\n+    private void performStateRecovery(boolean enforceRecoverAfterTime, String reason) {\n+        final Gateway.GatewayStateRecoveredListener recoveryListener \u003d new GatewayRecoveryListener();\n \n         if (enforceRecoverAfterTime \u0026\u0026 recoverAfterTime !\u003d null) {\n             if (scheduledRecovery.compareAndSet(false, true)) {\n                 logger.info(\"delaying initial state recovery for [{}]. {}\", recoverAfterTime, reason);\n-                threadPool.schedule(recoverAfterTime, ThreadPool.Names.GENERIC, new Runnable() {\n-                    @Override\n-                    public void run() {\n-                        if (recovered.compareAndSet(false, true)) {\n-                            logger.info(\"recover_after_time [{}] elapsed. performing state recovery...\", recoverAfterTime);\n-                            gateway.performStateRecovery(recoveryListener);\n-                        }\n+                threadPool.schedule(recoverAfterTime, ThreadPool.Names.GENERIC, () -\u003e {\n+                    if (recovered.compareAndSet(false, true)) {\n+                        logger.info(\"recover_after_time [{}] elapsed. performing state recovery...\", recoverAfterTime);\n+                        gateway.performStateRecovery(recoveryListener);\n                     }\n                 });\n             }\n         } else {\n             if (recovered.compareAndSet(false, true)) {\n-                if (asyncRecovery) {\n-                    threadPool.generic().execute(new Runnable() {\n-                        @Override\n-                        public void run() {\n-                            gateway.performStateRecovery(recoveryListener);\n-                        }\n-                    });\n-                } else {\n-                    logger.trace(\"performing state recovery...\");\n-                    gateway.performStateRecovery(recoveryListener);\n-                }\n+                threadPool.generic().execute(() -\u003e gateway.performStateRecovery(recoveryListener));\n             }\n         }\n     }\n \n     class GatewayRecoveryListener implements Gateway.GatewayStateRecoveredListener {\n \n-        private final CountDownLatch latch;\n-\n-        GatewayRecoveryListener(CountDownLatch latch) {\n-            this.latch \u003d latch;\n-        }\n-\n         @Override\n         public void onSuccess(final ClusterState recoveredState) {\n             logger.trace(\"successful state recovery, importing cluster state...\");\n@@ -271,7 +269,6 @@ public void onFailure(String source, Throwable t) {\n                 @Override\n                 public void clusterStateProcessed(String source, ClusterState oldState, ClusterState newState) {\n                     logger.info(\"recovered [{}] indices into cluster_state\", newState.metaData().indices().size());\n-                    latch.countDown();\n                 }\n             });\n         }\n@@ -283,6 +280,7 @@ public void onFailure(String message) {\n             // don\u0027t remove the block here, we don\u0027t want to allow anything in such a case\n             logger.info(\"metadata state not restored, reason: {}\", message);\n         }\n+\n     }\n \n     // used for testing"
        }
      ]
    }
  },
  {
    "name": "Fix possible race condition in checksum name generator",
    "url": "https://github.com/elastic/elasticsearch/pull/6662",
    "description": "When three threads are trying to write checksums at the same time, it\u0027s possible for all three threads to obtain the same checksum file name A. Then the first thread enters the synchronized section, creates the file with name A and exits. The second thread enters the synchronized section, checks that A exists, creates file A+1 and exits the critical section. Then it proceeds to clean up  and deletes all checksum files including A. If it happens before the third thread enters the synchronized section, it\u0027s possible for the third thread to check for A and since it no longer exists create the checksum file A the second time, which triggers \"file _checksums-XXXXXXXXXXXXX was already written to\" exception in MockDirectoryWrapper and fails recovery.\n",
    "keywords": [
      "synchronized",
      "file",
      "enters",
      "checksum",
      "name",
      "section",
      "possible",
      "thread"
    ],
    "code": {
      "language": "Java",
      "url": "https://github.com/elastic/elasticsearch/commit/f14edefc9d6a503d8ad9695dea489685e4e44b38",
      "files": [
        {
          "file_name": "src/main/java/org/elasticsearch/index/store/Store.java",
          "patch": "@@ -224,8 +224,9 @@ public void renameFile(String from, String to) throws IOException {\n     public void writeChecksums() throws IOException {\n         ensureOpen();\n         ImmutableMap\u003cString, StoreFileMetaData\u003e files \u003d list();\n-        String checksumName \u003d CHECKSUMS_PREFIX + System.currentTimeMillis();\n+        String checksumName;\n         synchronized (mutex) {\n+            checksumName \u003d CHECKSUMS_PREFIX + System.currentTimeMillis();\n             Map\u003cString, String\u003e checksums \u003d new HashMap\u003c\u003e();\n             for (StoreFileMetaData metaData : files.values()) {\n                 if (metaData.checksum() !\u003d null) {"
        }
      ]
    }
  }
]